import{r as v,b as ae,C as l,j as e,a5 as w}from"./index-BN59IPuR.js";import ie from"./ExportButton-DZlgKW38.js";import{U as ne}from"./UserListModal-CKFlKaiz.js";import{c as oe,f as O}from"./analyticsHelpers-CSR5MBQA.js";import{T as x}from"./triangle-alert-BiLwPYAF.js";import{T as le}from"./target-BKXpjjKz.js";import{U as de}from"./users-DfBEJjiL.js";import{C as ce}from"./clock-DhNh1aMV.js";import{R as T}from"./CategoricalChart-CzuH2uZD.js";import{P as F,a as W}from"./PieChart-g_EZZCd1.js";import{C as z}from"./tooltipContext-BOM3BAMY.js";import"./circle-alert-D9jL_IN1.js";import"./cloud-fkqvd_L-.js";import"./smile-Cok2J4_2.js";const me=v.memo(({data:i={},period:d})=>{const D=ae(),[o,c]=v.useState({isOpen:!1,title:"",users:[],totalUsers:0,type:""}),t=v.useMemo(()=>{if(!i)return null;const s=i.totalUsers||0,a=i.totalCheckins||0,K=i.submissionRate||0,y=Array.isArray(i.periodTimeline)?i.periodTimeline:[],H=i.periodLengthDays||y.length||0,J=oe(y,H,d),h=Math.max(J,1),g=s*h,Q=g>0?Math.min(100,Math.round(a/g*100)):0,p=Array.isArray(i.flaggedUsers)?i.flaggedUsers:[],m=new Map;p.forEach(r=>{const n=r?.userId?._id||r?.userId||r?.email||r?.name||r?.id||null;if(!n)return;const $=n.toString();m.has($)||m.set($,r)});const C=(m.size>0?Array.from(m.values()):p).length,u=s>0?Math.min(s,C):C,k=s>0?u/s*100:0,U=Math.round(Math.min(100,Math.max(0,k))),V=Math.round(Math.max(0,100-U)),X=Math.max(0,Math.min(s,s-u)),M=i.moodDistribution||{},Y=i.aiMoodIndicators||{},P=Object.values(M).reduce((r,n)=>r+n,0),f=Object.entries(M).map(([r,n])=>({mood:r.charAt(0).toUpperCase()+r.slice(1),count:n,percentage:P>0?Math.round(n/P*100):0,isAIGenerated:Y[r]||r.includes("ai")||r.includes("AI")||r.includes("detected")})).sort((r,n)=>n.percentage-r.percentage),A=i.weatherDistribution||{},Z=i.aiWeatherIndicators||{},R=Object.values(A).reduce((r,n)=>r+n,0),ee=Object.entries(A).map(([r,n])=>({weather:r.charAt(0).toUpperCase()+r.slice(1),count:n,percentage:R>0?Math.round(n/R*100):0,isAIGenerated:Z[r]||r.includes("ai")||r.includes("AI")||r.includes("pattern")||r.includes("analyzed")})).sort((r,n)=>n.percentage-r.percentage),S=i.unitBreakdown||[],L=S.reduce((r,n)=>r+(n.submitted||0),0),se=S.map(r=>({unit:r.unit||"Unknown",count:r.submitted||0,percentage:L>0?Math.round(r.submitted/L*100):0})).sort((r,n)=>n.percentage-r.percentage),j=[],b=[],N=Math.min(100,Math.max(0,k));N>20&&j.push({type:"high",title:"High Support Need",message:`${N.toFixed(1)}% (${u} people) indicated they need support. Consider proactive outreach.`,icon:x,color:"text-red-500"}),f.some(r=>["sad","anxious","overwhelmed"].includes(r.mood.toLowerCase()))&&j.push({type:"medium",title:"Emotional Well-being Concerns",message:"Negative mood patterns detected. Monitor closely and consider additional support resources.",icon:x,color:"text-yellow-500"}),N<10&&b.push({title:"Strong Team Resilience",message:"Low support requests indicate good overall team well-being.",icon:l,color:"text-green-500"}),f.some(r=>["happy","excited","calm"].includes(r.mood.toLowerCase()))&&b.push({title:"Positive Team Dynamics",message:"Strong presence of positive moods suggests healthy team environment.",icon:l,color:"text-green-500"});const I=Array.isArray(i.notSubmittedUsers)?i.notSubmittedUsers:[],te=I.length||Math.max(0,s-Math.round(a/h)),re=Math.min(s,Math.max(0,te));return{participationRate:Q,rawSubmissionRate:K,flaggedPercentage:U,readinessPercentage:V,moodPercentages:f,weatherPercentages:ee,unitPercentages:se,totalUsers:s,totalCheckins:a,flaggedUsersCount:u,flaggedUserRecords:p,riskFactors:j,positiveIndicators:b,moodLists:i.moodLists||{},weatherLists:i.weatherLists||{},unitLists:i.unitLists||{},notSubmittedUsers:I,notSubmittedCount:re,workdayCount:h,expectedSubmissions:g,readinessUserCount:X}},[i,d]),E=s=>{c({isOpen:!0,title:`${s.mood} Mood Users`,users:t.moodLists[s.mood.toLowerCase()]||[],totalUsers:t.totalCheckins,type:"mood"})},_=s=>{c({isOpen:!0,title:`${s.weather} Weather Users`,users:t.weatherLists[s.weather.toLowerCase()]||[],totalUsers:t.totalCheckins,type:"weather"})},q=s=>{c({isOpen:!0,title:`${s.unit} Unit Users`,users:t.unitLists[s.unit.toLowerCase()]||[],totalUsers:t.totalCheckins,type:"unit"})},B=()=>{t&&D("/emotional-checkin/not-submitted",{state:{snapshot:{totalUsers:t.totalUsers,totalCheckins:t.totalCheckins,notSubmittedUsers:t.notSubmittedUsers,notSubmittedCount:t.notSubmittedCount,expectedSubmissions:t.expectedSubmissions,workdayCount:t.workdayCount,participationRate:t.participationRate,period:d}}})},G=()=>{c({isOpen:!1,title:"",users:[],totalUsers:0,type:""})};return t?e.jsxs("div",{className:"glass glass-card transition-all duration-300",children:[e.jsx("div",{className:"glass__refract"}),e.jsx("div",{className:"glass__noise"}),e.jsxs("div",{className:"relative z-10 p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(le,{className:"w-4 h-4 text-primary"}),e.jsx("h2",{className:"text-base md:text-lg font-semibold text-foreground",children:"Overview Analytics"})]}),e.jsx(ie,{period:d})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-border/40 backdrop-blur-sm cursor-pointer hover:bg-card/60 transition-colors",onClick:B,title:"Click to see users who haven't submitted yet",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Participation Rate"}),e.jsx(de,{className:"w-4 h-4 text-emerald-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[t.participationRate,"%"]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500 ease-out",style:{width:`${t.participationRate}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[O(t.totalCheckins)," submissions "," Â· "," expected ",O(t.expectedSubmissions)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Normalized across ",t.workdayCount===1?"today":`${t.workdayCount} workdays`]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1 font-medium",children:"Click to view not submitted users"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-border/40 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Emotional Readiness"}),e.jsx(w,{className:"w-4 h-4 text-emerald-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[t.readinessPercentage,"%"]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500 ease-out",style:{width:`${t.readinessPercentage}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.readinessUserCount," of ",t.totalUsers," users ready"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-white/20 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Top Mood"}),e.jsx(w,{className:"w-4 h-4 text-blue-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[t.moodPercentages[0]?.percentage||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:t.moodPercentages[0]?.mood||"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.moodPercentages[0]?.count||0," responses"]}),t.moodPercentages[0]?.count===0&&e.jsx("div",{className:"mt-2 w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gray-400 to-gray-300 w-full"})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-border/40 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Top Weather"}),e.jsx(w,{className:"w-4 h-4 text-purple-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[t.weatherPercentages[0]?.percentage||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:t.weatherPercentages[0]?.weather||"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[t.weatherPercentages[0]?.count||0," responses"]}),t.weatherPercentages[0]?.count===0&&e.jsx("div",{className:"mt-2 w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gray-400 to-gray-300 w-full"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-red-500"}),"Risk Factors"]}),e.jsx("div",{className:"space-y-2",children:t.riskFactors?.length>0?t.riskFactors.slice(0,2).map((s,a)=>e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(x,{className:`w-4 h-4 mt-0.5 ${s.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.message})]})]})},a)):e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4 text-green-500"}),e.jsx("p",{className:"text-sm text-green-700",children:"No significant risk factors detected"})]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4 text-green-500"}),"Positive Indicators"]}),e.jsx("div",{className:"space-y-2",children:t.positiveIndicators?.length>0?t.positiveIndicators.slice(0,2).map((s,a)=>e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(l,{className:`w-4 h-4 mt-0.5 ${s.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:s.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:s.message})]})]})},a)):e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ce,{className:"w-4 h-4 text-yellow-500"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Monitoring for positive indicators"})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Mood Distribution"}),e.jsx("div",{className:"h-48",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsx(F,{children:e.jsx(W,{data:t.moodPercentages.slice(0,5),cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"count",onClick:(s,a)=>E(t.moodPercentages.slice(0,5)[a]),style:{cursor:"pointer"},children:t.moodPercentages.slice(0,5).map((s,a)=>e.jsx(z,{fill:`hsl(${a*60}, 70%, 50%)`,style:{cursor:"pointer"}},`mood-${a}`))})})})}),e.jsx("div",{className:"mt-2 space-y-1",children:t.moodPercentages.slice(0,5).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*60}, 70%, 50%)`}}),e.jsxs("span",{className:"text-foreground capitalize",children:[s.mood,s.isAIGenerated&&e.jsx("span",{className:"ml-1 text-xs text-blue-600 font-medium",children:"(AI)"})]})]}),e.jsxs("span",{className:"text-muted-foreground",children:[s.percentage,"% (",s.count,")"]})]},s.mood))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Weather Distribution"}),e.jsx("div",{className:"h-48",children:e.jsx(T,{width:"100%",height:"100%",children:e.jsx(F,{children:e.jsx(W,{data:t.weatherPercentages.slice(0,5),cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"count",onClick:(s,a)=>_(t.weatherPercentages.slice(0,5)[a]),style:{cursor:"pointer"},children:t.weatherPercentages.slice(0,5).map((s,a)=>e.jsx(z,{fill:`hsl(${a*45+180}, 70%, 50%)`,style:{cursor:"pointer"}},`weather-${a}`))})})})}),e.jsx("div",{className:"mt-2 space-y-1",children:t.weatherPercentages.slice(0,5).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*45+180}, 70%, 50%)`}}),e.jsxs("span",{className:"text-foreground capitalize",children:[s.weather,s.isAIGenerated&&e.jsx("span",{className:"ml-1 text-xs text-blue-600 font-medium",children:"(AI)"})]})]}),e.jsxs("span",{className:"text-muted-foreground",children:[s.percentage,"% (",s.count,")"]})]},s.weather))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Unit Distribution"}),e.jsx("div",{className:"space-y-2",children:t.unitPercentages.slice(0,5).map((s,a)=>e.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-muted/20 p-1 rounded transition-colors",onClick:()=>q(s),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*72+90}, 70%, 50%)`}}),e.jsx("span",{className:"text-sm text-foreground capitalize",children:s.unit})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-muted/30 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all duration-500 ease-out",style:{width:`${s.percentage}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground w-8 text-right",children:[s.percentage,"%"]})]})]},s.unit))})]})]})]}),e.jsx(ne,{isOpen:o.isOpen,onClose:G,title:o.title,users:o.users,totalUsers:o.totalUsers,type:o.type})]}):null});me.displayName="PercentageAnalytics";export{me as default};
