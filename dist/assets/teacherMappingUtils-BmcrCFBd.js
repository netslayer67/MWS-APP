import{n as k,d as D}from"./teacherGradeUtils-CER7NXSQ.js";import{S as U}from"./shield-check-BRd4wDSg.js";import{c as G,ai as x}from"./index-BN59IPuR.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],_=G("clipboard-check",N),T=[{key:"active",label:"Active Interventions",sub:"Kids in a boost bubble",icon:U,accent:"from-[#0ea5e9]/90 via-[#818cf8]/85 to-[#34d399]/80"},{key:"due",label:"Updates Due",sub:"Check-ins waiting today",icon:_,accent:"from-[#fcd34d]/90 via-[#fb923c]/85 to-[#38bdf8]/80"},{key:"success",label:"Success Rate",sub:"Kids hitting targets",icon:x,accent:"from-[#22d3ee]/90 via-[#a855f7]/85 to-[#f472b6]/80"}],m=(e,r={month:"short",day:"numeric"})=>{if(!e)return"—";try{return new Intl.DateTimeFormat("en-US",r).format(new Date(e))}catch{return"—"}},M=e=>e?e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""):`student-${Math.random().toString(36).slice(2,6)}`,Y=()=>{try{return JSON.parse(localStorage.getItem("auth_user")||"null")}catch{return null}},$=e=>{if(e?.status!=="active")return!1;const r=e?.checkIns?.slice(-1)[0]?.date;return r?(Date.now()-new Date(r).getTime())/(1e3*60*60*24)>=7:!0},q=(e=[])=>{const r=e.filter(c=>c.status==="active").length,a=e.filter($).length,p=e.reduce((c,n)=>c+(n.goals?.length||0),0),s=e.reduce((c,n)=>c+(n.goals?.filter(t=>t.completed).length||0),0),i=p||e.length||1,u=e.filter(c=>c.status==="completed").length,o=Math.round((s||u)/i*100);return[{...T[0],value:r},{...T[1],value:a},{...T[2],value:`${Number.isFinite(o)?o:0}%`}]},R={active:"On Track",paused:"Needs Attention",completed:"Completed",closed:"Closed"},b={active:4,paused:3,completed:2,closed:1},A={tier1:1,tier2:2,tier3:3},E=e=>{if(!e)return"Tier 2";const r=e.toString().toLowerCase();return r.includes("3")?"Tier 3":r.includes("1")?"Tier 1":"Tier 2"},L=e=>{if(!e)return null;const r=e.toString().toLowerCase();return r.includes("3")?"tier3":r.includes("2")?"tier2":r.includes("1")?"tier1":null},K=e=>e?.focusAreas?.length?e.focusAreas[0]:e?.tier==="tier3"?"Intensive Support":"Literacy & SEL",z=(e,r)=>{const a=[e?.metricLabel,e?.notes,e?.focusAreas?.join(" "),r?.type].filter(Boolean).join(" ").toLowerCase();return/attendance|present|absen/.test(a)?"%":/reading|fluency|literacy|wpm/.test(a)?"wpm":/math|numeracy|accuracy|score/.test(a)?"score":/behavior|sel|conduct|check-in|checkin/.test(a)?"pts":"score"},O=(e,r)=>{if(!e)return"Ongoing";const a=new Date(e),p=r?new Date(r):new Date,s=Math.max(1,Math.round((p-a)/(1e3*60*60*24*7)));return`${s} wk${s>1?"s":""}`},F=e=>{const r=e?.checkIns?.slice(-1)[0]?.date||e?.startDate;if(!r)return"Awaiting update";const a=new Date(r);return a.setDate(a.getDate()+7),m(a)},B=(e={})=>{const r=e.checkIns||[];if(r.length){const i=r.length;return r.map((u,o)=>{const c=Math.round((o+1)/i*100),n=m(u.date);return{label:n,date:n,reading:c,goal:100,value:c}})}const a=e.goals||[];if(a.length){const i=a.length;let u=0;return a.map((o,c)=>{o.completed&&(u+=1);const n=Math.round(u/i*100),t=o.description||`Goal ${c+1}`;return{label:t,date:t,reading:n,goal:100,value:n}})}const p=e.status==="completed"?100:0,s=m(e.startDate);return[{label:s,date:s,reading:p,goal:100,value:p}]},P=(e={})=>(e.checkIns||[]).slice(-6).reverse().map(r=>({date:m(r.date,{month:"short",day:"numeric",year:"numeric"}),score:"-",notes:r.summary||r.nextSteps||"Check-in recorded"})),J=(e=[],r="MTSS Mentor")=>{const a=new Map;e.forEach(o=>{const c=K(o),n=E(o.tier),t=o.status||"active",f=F(o),y=B(o),S=P(o),d=o.goals||[],v=d.filter(l=>l.completed).length;(o.studentIds||[]).forEach(l=>{const h=l?._id?.toString?.()||l?.id||l;if(!h)return;const I=k(l?.currentGrade||l?.classes?.[0]?.grade||l?.unit||l?.class||"-"),w=z(o,l),g={id:h,assignmentId:o._id?.toString?.()||null,slug:l?.slug||M(l?.name),name:l?.name||"Student",grade:I,type:c,tier:n,progress:R[t]||"On Track",nextUpdate:f,statusKey:t,profile:{teacher:r,mentor:o.mentorId?.name||r,type:c,strategy:o.focusAreas?.join(", ")||`Support focus - ${n}`,started:m(o.startDate),duration:O(o.startDate,o.endDate),baseline:d.length?0:null,current:d.length?v:o.checkIns?.length||(t==="completed"?1:0),target:d.length||Math.max(o.checkIns?.length||1,1),progressUnit:w,chart:y,history:S}},C=a.get(h);(!C||b[t]>b[C.statusKey])&&a.set(h,g)})});const s=Array.from(a.values()).sort((o,c)=>b[c.statusKey]-b[o.statusKey]),i=s[0]?.profile?.chart||[],u=s[0]?`${s[0].tier} ${s[0].type}`:null;return{students:s.map(({statusKey:o,...c})=>c),spotlightChart:i,focusLabel:u}},V=(e=[],r=[],a={allowedGrades:[]})=>{const p=new Map(r.map(t=>[t.id?.toString?.()||t.slug||t.name,t])),s=a.allowedGrades||[],i=a.allowedClasses||[],u=a.strictClassFilter,o=t=>!s.length||s.includes(k(t)),c=t=>{if(!u||!i.length)return!0;const f=D(t);return f?i.includes(f):!1},n=e.map(t=>{const f=t.id?.toString?.()||t._id?.toString?.()||t.slug||t.name,y=k(t.grade||t.currentGrade||t.className||"-"),S=D(t.className||t.currentGrade||t.unit);if(!o(y)||!c(S))return null;const d=p.get(f),v=L(t.tier||t.primaryIntervention?.tier||t.profile?.tier),l=L(d?.tier),h=A[v]||0,I=A[l]||0,g=d&&(!h||I>h)?d:t;return{id:f,slug:t.slug||M(t.name),name:t.name,grade:y,className:S||t.className,type:g?.type||t.type||"Universal Supports",tier:g?.tier||t.tier||"Tier 1",progress:g?.progress||t.progress||"Not Assigned",nextUpdate:g?.nextUpdate||t.nextUpdate||"Not scheduled",assignmentId:d?.assignmentId||null,profile:g?.profile||d?.profile||t.profile,interventions:t.interventions,primaryIntervention:t.primaryIntervention}}).filter(Boolean);return!n.length&&r.length?r:n};export{_ as C,V as a,q as b,Y as g,J as m};
