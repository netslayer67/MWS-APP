import{a as f,u as y,b as u,r as i,O as p,j as e,o as v,m as l,V as b,Q as w}from"./index-BeQwOtyQ.js";import{C as m,c as x,a as C,b as L}from"./card-D-goIzvr.js";import{B as g}from"./badge-CKD0dT5b.js";import{s as n}from"./socketService-CrK7Ga1g.js";import{M as H}from"./message-circle-CTFW4W9G.js";const S=()=>{const j=f(),d=y(),{user:r}=u(s=>s.auth),{checkinHistory:o}=u(s=>s.checkin),h=i.useMemo(()=>o?o.filter(s=>s.userId===r?.id):[],[o,r?.id]),a=i.useMemo(()=>h.filter(s=>s.details).map(s=>({id:s._id,date:new Date(s.date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),time:new Date(s.date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),details:s.details,weatherType:s.weatherType,moods:s.selectedMoods||[],presenceLevel:s.presenceLevel,capacityLevel:s.capacityLevel})).sort((s,t)=>new Date(t.date)-new Date(s.date)),[h]);i.useEffect(()=>{if(r){d(p({page:1,limit:50})),n.connect(),n.joinPersonal(r.id);const s=t=>{console.log("Real-time personal check-in update:",t),d(p({page:1,limit:50}))};return n.onPersonalNewCheckin(s),()=>{n.offPersonalNewCheckin(s),n.leavePersonal()}}},[d,r]);const N=i.useMemo(()=>({hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{staggerChildren:.05}}}),[]),c=i.useMemo(()=>({hidden:{opacity:0,y:6},show:{opacity:1,y:0,transition:{duration:.32}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsx(v,{children:e.jsx("title",{children:"Emotional History â€” MWS APP"})}),e.jsx(l.main,{initial:"hidden",animate:"show",variants:N,className:"relative min-h-dvh w-full px-4 pb-12 pt-6",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs(l.header,{variants:c,className:"mb-6 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>j(-1),"aria-label":"Go back",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border bg-card/40 backdrop-blur-md hover:bg-accent/8 transition-colors duration-300",children:e.jsx(b,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Emotional History"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Your reflections & thoughts over time"})]})]}),e.jsx(l.section,{variants:c,children:a.length>0?e.jsx("div",{className:"space-y-4",children:a.map(s=>e.jsx(m,{className:"glass glass-card",children:e.jsx(x,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(w,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:s.date}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.time})]}),e.jsx(g,{variant:"outline",className:"text-xs",children:s.weatherType})]}),e.jsx("div",{className:"bg-secondary/20 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:s.details})}),s.moods.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.moods.map(t=>e.jsx(g,{variant:"secondary",className:"text-xs",children:t},t))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-foreground/70 pt-2 border-t border-border/50",children:[e.jsxs("span",{children:["Presence: ",s.presenceLevel,"/10"]}),e.jsxs("span",{children:["Capacity: ",s.capacityLevel,"/10"]})]})]})})},s.id))}):e.jsx(m,{className:"glass glass-card",children:e.jsxs(x,{className:"text-center py-12",children:[e.jsx(H,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("h3",{className:"text-lg font-medium mb-2 text-foreground",children:"No History Yet"}),e.jsx("p",{className:"text-foreground/70 text-sm",children:"You haven't completed any emotional check-ins or added reflections yet. Start with daily check-ins to see your history here."})]})})}),a.length>0&&e.jsx(l.section,{variants:c,className:"mt-6",children:e.jsxs(m,{className:"glass glass-card",children:[e.jsx(C,{children:e.jsx(L,{children:"History Summary"})}),e.jsx(x,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:a.length}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Total Reflections"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.round(a.reduce((s,t)=>s+t.presenceLevel,0)/a.length*10)/10}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Average Presence"})]})]})})]})})]})})]})};export{S as default};
