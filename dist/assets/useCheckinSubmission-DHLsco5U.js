const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-BdD-LP6G.js","assets/index-D2rZlo4J.js","assets/index-BMWanOc6.css","assets/face_mesh-B-RIQy6T.js","assets/camera_utils-8lnaEEpH.js"])))=>i.map(i=>d[i]);
import{c as me,r as j,j as m,m as H,p as Ne,al as Fe,am as _e,R as Oe,F as Ue,v as Le,an as Be,_ as oe,ao as ze,ap as We}from"./index-D2rZlo4J.js";import{B as pe}from"./brain-DBN6rPTE.js";import{C as qe}from"./camera-DHu_mxui.js";import{E as He}from"./eye-_f8Do5l9.js";import{Z as De}from"./zap-krYSk9az.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=[["path",{d:"M12 2v2",key:"tus03m"}],["path",{d:"m4.93 4.93 1.41 1.41",key:"149t6j"}],["path",{d:"M20 12h2",key:"1q8mjw"}],["path",{d:"m19.07 4.93-1.41 1.41",key:"1shlcs"}],["path",{d:"M15.947 12.65a4 4 0 0 0-5.925-4.128",key:"dpwdj0"}],["path",{d:"M13 22H7a5 5 0 1 1 4.9-6H13a3 3 0 0 1 0 6Z",key:"s09mg5"}]],gt=me("cloud-sun",Ye);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ge=[["path",{d:"M19.414 14.414C21 12.828 22 11.5 22 9.5a5.5 5.5 0 0 0-9.591-3.676.6.6 0 0 1-.818.001A5.5 5.5 0 0 0 2 9.5c0 2.3 1.5 4 3 5.5l5.535 5.362a2 2 0 0 0 2.879.052 2.12 2.12 0 0 0-.004-3 2.124 2.124 0 1 0 3-3 2.124 2.124 0 0 0 3.004 0 2 2 0 0 0 0-2.828l-1.881-1.882a2.41 2.41 0 0 0-3.409 0l-1.71 1.71a2 2 0 0 1-2.828 0 2 2 0 0 1 0-2.828l2.823-2.762",key:"17lmqv"}]],ft=me("heart-handshake",Ge);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $e=[["path",{d:"M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"14sxne"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}],["path",{d:"M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16",key:"1hlbsb"}],["path",{d:"M16 16h5v5",key:"ccwih5"}]],yt=me("refresh-ccw",$e),Ve=j.memo(({onStartScan:p})=>m.jsxs(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center space-y-6",children:[m.jsx(H.div,{className:"w-16 h-16 mx-auto rounded-2xl bg-primary flex items-center justify-center shadow-lg shadow-primary/20",animate:{scale:[1,1.05,1]},transition:{duration:3,repeat:1/0},children:m.jsx(pe,{className:"w-8 h-8 text-primary-foreground"})}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"AI Emotional Analysis"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Advanced AI psychology analysis with 99% accuracy detection"})]}),m.jsx(H.button,{onClick:p,className:"w-full py-4 rounded-xl bg-primary text-primary-foreground font-semibold shadow-lg shadow-primary/25 hover:shadow-primary/35 transition-all duration-300",whileHover:{scale:1.02},whileTap:{scale:.98},"aria-label":"Start AI emotional analysis scan",children:m.jsxs("div",{className:"flex items-center justify-center gap-2",children:[m.jsx(qe,{className:"w-5 h-5","aria-hidden":"true"}),"Start AI Scan"]})}),m.jsxs("p",{className:"text-xs text-muted-foreground flex items-center justify-center gap-1.5",children:[m.jsx(Ne,{className:"w-3 h-3"}),"Processed locally â€¢ No data stored"]})]},"intro"));Ve.displayName="IntroSection";var le={exports:{}},Ze=le.exports,be;function Je(){return be||(be=1,(function(p,e){(function(n,a){p.exports=a(Fe())})(Ze,function(i){return(function(n){var a={};function o(s){if(a[s])return a[s].exports;var l=a[s]={i:s,l:!1,exports:{}};return n[s].call(l.exports,l,l.exports,o),l.l=!0,l.exports}return o.m=n,o.c=a,o.d=function(s,l,g){o.o(s,l)||Object.defineProperty(s,l,{enumerable:!0,get:g})},o.r=function(s){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(s,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(s,"__esModule",{value:!0})},o.t=function(s,l){if(l&1&&(s=o(s)),l&8||l&4&&typeof s=="object"&&s&&s.__esModule)return s;var g=Object.create(null);if(o.r(g),Object.defineProperty(g,"default",{enumerable:!0,value:s}),l&2&&typeof s!="string")for(var C in s)o.d(g,C,(function(y){return s[y]}).bind(null,C));return g},o.n=function(s){var l=s&&s.__esModule?function(){return s.default}:function(){return s};return o.d(l,"a",l),l},o.o=function(s,l){return Object.prototype.hasOwnProperty.call(s,l)},o.p="",o(o.s="./src/react-webcam.tsx")})({"./src/react-webcam.tsx":(function(n,a,o){o.r(a);var s=o("react"),l=(function(){var x=function(w,h){return x=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(u,d){u.__proto__=d}||function(u,d){for(var k in d)d.hasOwnProperty(k)&&(u[k]=d[k])},x(w,h)};return function(w,h){x(w,h);function u(){this.constructor=w}w.prototype=h===null?Object.create(h):(u.prototype=h.prototype,new u)}})(),g=function(){return g=Object.assign||function(x){for(var w,h=1,u=arguments.length;h<u;h++){w=arguments[h];for(var d in w)Object.prototype.hasOwnProperty.call(w,d)&&(x[d]=w[d])}return x},g.apply(this,arguments)},C=function(x,w){var h={};for(var u in x)Object.prototype.hasOwnProperty.call(x,u)&&w.indexOf(u)<0&&(h[u]=x[u]);if(x!=null&&typeof Object.getOwnPropertySymbols=="function")for(var d=0,u=Object.getOwnPropertySymbols(x);d<u.length;d++)w.indexOf(u[d])<0&&Object.prototype.propertyIsEnumerable.call(x,u[d])&&(h[u[d]]=x[u[d]]);return h};(function(){typeof window>"u"||(navigator.mediaDevices===void 0&&(navigator.mediaDevices={}),navigator.mediaDevices.getUserMedia===void 0&&(navigator.mediaDevices.getUserMedia=function(w){var h=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;return h?new Promise(function(u,d){h.call(navigator,w,u,d)}):Promise.reject(new Error("getUserMedia is not implemented in this browser"))}))})();function y(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}var z=(function(x){l(w,x);function w(h){var u=x.call(this,h)||this;return u.canvas=null,u.ctx=null,u.requestUserMediaId=0,u.unmounted=!1,u.state={hasUserMedia:!1},u}return w.prototype.componentDidMount=function(){var h=this,u=h.state,d=h.props;if(this.unmounted=!1,!y()){d.onUserMediaError("getUserMedia not supported");return}u.hasUserMedia||this.requestUserMedia(),d.children&&typeof d.children!="function"&&console.warn("children must be a function")},w.prototype.componentDidUpdate=function(h){var u=this.props;if(!y()){u.onUserMediaError("getUserMedia not supported");return}var d=JSON.stringify(h.audioConstraints)!==JSON.stringify(u.audioConstraints),k=JSON.stringify(h.videoConstraints)!==JSON.stringify(u.videoConstraints),B=h.minScreenshotWidth!==u.minScreenshotWidth,R=h.minScreenshotHeight!==u.minScreenshotHeight;(k||B||R)&&(this.canvas=null,this.ctx=null),(d||k)&&(this.stopAndCleanup(),this.requestUserMedia())},w.prototype.componentWillUnmount=function(){this.unmounted=!0,this.stopAndCleanup()},w.stopMediaStream=function(h){h&&(h.getVideoTracks&&h.getAudioTracks?(h.getVideoTracks().map(function(u){h.removeTrack(u),u.stop()}),h.getAudioTracks().map(function(u){h.removeTrack(u),u.stop()})):h.stop())},w.prototype.stopAndCleanup=function(){var h=this.state;h.hasUserMedia&&(w.stopMediaStream(this.stream),h.src&&window.URL.revokeObjectURL(h.src))},w.prototype.getScreenshot=function(h){var u=this,d=u.state,k=u.props;if(!d.hasUserMedia)return null;var B=this.getCanvas(h);return B&&B.toDataURL(k.screenshotFormat,k.screenshotQuality)},w.prototype.getCanvas=function(h){var u=this,d=u.state,k=u.props;if(!this.video||!d.hasUserMedia||!this.video.videoHeight)return null;if(!this.ctx){var B=this.video.videoWidth,R=this.video.videoHeight;if(!this.props.forceScreenshotSourceSize){var M=B/R;B=k.minScreenshotWidth||this.video.clientWidth,R=B/M,k.minScreenshotHeight&&R<k.minScreenshotHeight&&(R=k.minScreenshotHeight,B=R*M)}this.canvas=document.createElement("canvas"),this.canvas.width=h?.width||B,this.canvas.height=h?.height||R,this.ctx=this.canvas.getContext("2d")}var O=this,_=O.ctx,A=O.canvas;return _&&A&&(A.width=h?.width||A.width,A.height=h?.height||A.height,k.mirrored&&(_.translate(A.width,0),_.scale(-1,1)),_.imageSmoothingEnabled=k.imageSmoothing,_.drawImage(this.video,0,0,h?.width||A.width,h?.height||A.height),k.mirrored&&(_.scale(-1,1),_.translate(-A.width,0))),A},w.prototype.requestUserMedia=function(){var h=this,u=this.props,d=function(R,M){var O={video:typeof M<"u"?M:!0};u.audio&&(O.audio=typeof R<"u"?R:!0),h.requestUserMediaId++;var _=h.requestUserMediaId;navigator.mediaDevices.getUserMedia(O).then(function(A){h.unmounted||_!==h.requestUserMediaId?w.stopMediaStream(A):h.handleUserMedia(null,A)}).catch(function(A){h.handleUserMedia(A)})};if("mediaDevices"in navigator)d(u.audioConstraints,u.videoConstraints);else{var k=function(R){return{optional:[{sourceId:R}]}},B=function(R){var M=R.deviceId;return typeof M=="string"?M:Array.isArray(M)&&M.length>0?M[0]:typeof M=="object"&&M.ideal?M.ideal:null};MediaStreamTrack.getSources(function(R){var M=null,O=null;R.forEach(function(W){W.kind==="audio"?M=W.id:W.kind==="video"&&(O=W.id)});var _=B(u.audioConstraints);_&&(M=_);var A=B(u.videoConstraints);A&&(O=A),d(k(M),k(O))})}},w.prototype.handleUserMedia=function(h,u){var d=this.props;if(h||!u){this.setState({hasUserMedia:!1}),d.onUserMediaError(h);return}this.stream=u;try{this.video&&(this.video.srcObject=u),this.setState({hasUserMedia:!0})}catch{this.setState({hasUserMedia:!0,src:window.URL.createObjectURL(u)})}d.onUserMedia(u)},w.prototype.render=function(){var h=this,u=this,d=u.state,k=u.props,B=k.audio;k.forceScreenshotSourceSize;var R=k.disablePictureInPicture;k.onUserMedia,k.onUserMediaError,k.screenshotFormat,k.screenshotQuality,k.minScreenshotWidth,k.minScreenshotHeight,k.audioConstraints,k.videoConstraints,k.imageSmoothing;var M=k.mirrored,O=k.style,_=O===void 0?{}:O,A=k.children,W=C(k,["audio","forceScreenshotSourceSize","disablePictureInPicture","onUserMedia","onUserMediaError","screenshotFormat","screenshotQuality","minScreenshotWidth","minScreenshotHeight","audioConstraints","videoConstraints","imageSmoothing","mirrored","style","children"]),X=M?g(g({},_),{transform:(_.transform||"")+" scaleX(-1)"}):_,ee={getScreenshot:this.getScreenshot.bind(this)};return s.createElement(s.Fragment,null,s.createElement("video",g({autoPlay:!0,disablePictureInPicture:R,src:d.src,muted:!B,playsInline:!0,ref:function(Z){h.video=Z},style:X},W)),A&&A(ee))},w.defaultProps={audio:!1,disablePictureInPicture:!1,forceScreenshotSourceSize:!1,imageSmoothing:!0,mirrored:!1,onUserMedia:function(){},onUserMediaError:function(){},screenshotFormat:"image/webp",screenshotQuality:.92},w})(s.Component);a.default=z}),react:(function(n,a){n.exports=i})}).default})})(le)),le.exports}var Qe=Je();const xe=_e(Qe),Ke=j.memo(()=>m.jsxs(H.div,{className:"absolute inset-0 pointer-events-none",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:[m.jsx(H.div,{className:"absolute left-0 right-0 h-[1px] bg-gradient-to-r from-transparent via-primary to-transparent shadow-[0_0_6px_rgba(139,28,47,0.3)]",animate:{top:["0%","100%"]},transition:{duration:2.5,repeat:1/0,ease:"linear"}}),m.jsx(H.div,{className:"absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 w-12 h-12 md:w-16 md:h-16 border border-primary/40 rounded-full",animate:{scale:[1,1.1,1],opacity:[.3,.6,.3]},transition:{duration:2.5,repeat:1/0}})]})),Xe=j.memo(({videoRef:p,scanProgress:e,detectedFeatures:i,onEmotionDetected:n,onTakePhoto:a,stage:o})=>{const[s,l]=j.useState(!1),[g,C]=j.useState(null),y=Oe.useRef(null);return j.useEffect(()=>{y?.current&&p&&(p.current=y.current.video,l(!0),console.log("ðŸ“¹ Video element assigned to ref"))},[]),o==="preview"?m.jsxs(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("h2",{className:"text-xl font-bold text-foreground",children:"Camera Preview"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Position yourself comfortably and ensure good lighting"})]}),m.jsx("div",{className:"relative aspect-square rounded-2xl overflow-hidden border-2 border-primary/50 shadow-xl shadow-primary/10",children:m.jsx(xe,{audio:!1,ref:y,mirrored:!0,videoConstraints:{facingMode:"user"},onUserMedia:()=>l(!0),style:{width:"100%",height:"100%"}})}),m.jsxs("div",{className:"space-y-3",children:[m.jsx("p",{className:"text-sm text-muted-foreground",children:"When you're ready, we'll take a photo for emotion analysis"}),m.jsx("button",{onClick:a,className:"w-full px-6 py-3 bg-primary text-primary-foreground rounded-lg font-medium hover:bg-primary/90 transition-colors",children:"I'm Ready - Take Photo"})]})]},"preview"):m.jsxs(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center space-y-6",children:[m.jsxs("div",{className:"space-y-2",children:[m.jsx("h2",{className:"text-xl font-bold text-foreground",children:"AI Emotional Analysis"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Advanced face scanning with real-time emotion detection"}),g&&m.jsxs("p",{className:"text-xs text-primary font-medium",children:["Detected: ",g.primaryEmotion," (",(g.confidence*100).toFixed(0),"% confidence)"]}),!g&&m.jsx("p",{className:"text-xs text-muted-foreground",children:"Analyzing facial expressions..."})]}),m.jsxs("div",{className:"relative aspect-square rounded-2xl overflow-hidden border-2 border-primary/50 shadow-xl shadow-primary/10",children:[m.jsx(xe,{audio:!1,ref:y,mirrored:!0,videoConstraints:{facingMode:"user"},onUserMedia:()=>l(!0),style:{width:"100%",height:"100%"}}),m.jsx(Ke,{}),i.length>0&&m.jsx("div",{className:"absolute bottom-3 left-3 right-3 space-y-1.5",children:i.slice(-3).map((z,x)=>m.jsxs(H.div,{initial:{opacity:0,x:-15},animate:{opacity:1,x:0},className:"flex items-center gap-2 text-[11px] md:text-xs text-primary-foreground bg-primary/80 backdrop-blur-sm px-2.5 py-1 rounded-lg",children:[m.jsx(Ue,{className:"w-3 h-3"}),z]},x))})]}),m.jsxs("div",{className:"space-y-3",children:[m.jsxs("div",{className:"flex justify-between text-sm",children:[m.jsx("span",{className:"text-muted-foreground",children:"Progress"}),m.jsxs("span",{className:"text-foreground font-semibold",children:[Math.round(e),"%"]})]}),m.jsx("div",{className:"h-2 rounded-full bg-surface/50 overflow-hidden",children:m.jsx(H.div,{className:"h-full bg-primary",initial:{width:0},animate:{width:`${e}%`},transition:{duration:.3}})})]}),m.jsxs("div",{className:"flex items-center justify-center gap-2 text-sm text-muted-foreground",children:[m.jsx(pe,{className:"w-4 h-4 animate-pulse text-primary"}),"Advanced AI analysis in progress..."]})]},"scanning")});Xe.displayName="ScanningSection";const et=j.memo(()=>m.jsxs(H.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"text-center space-y-6 py-8",children:[m.jsx(H.div,{animate:{rotate:360},transition:{duration:2,repeat:1/0,ease:"linear"},className:"w-16 h-16 mx-auto",children:m.jsx(pe,{className:"w-full h-full text-primary"})}),m.jsxs("div",{className:"space-y-2",children:[m.jsx("h2",{className:"text-lg font-bold text-foreground",children:"Analyzing Emotions"}),m.jsx("p",{className:"text-sm text-muted-foreground",children:"Cross-referencing with emotion database"})]})]},"analyzing"));et.displayName="AnalyzingSection";var ge={};(function p(e,i,n,a){var o=!!(e.Worker&&e.Blob&&e.Promise&&e.OffscreenCanvas&&e.OffscreenCanvasRenderingContext2D&&e.HTMLCanvasElement&&e.HTMLCanvasElement.prototype.transferControlToOffscreen&&e.URL&&e.URL.createObjectURL),s=typeof Path2D=="function"&&typeof DOMMatrix=="function",l=(function(){if(!e.OffscreenCanvas)return!1;try{var r=new OffscreenCanvas(1,1),t=r.getContext("2d");t.fillRect(0,0,1,1);var f=r.transferToImageBitmap();t.createPattern(f,"no-repeat")}catch{return!1}return!0})();function g(){}function C(r){var t=i.exports.Promise,f=t!==void 0?t:e.Promise;return typeof f=="function"?new f(r):(r(g,g),null)}var y=(function(r,t){return{transform:function(f){if(r)return f;if(t.has(f))return t.get(f);var c=new OffscreenCanvas(f.width,f.height),v=c.getContext("2d");return v.drawImage(f,0,0),t.set(f,c),c},clear:function(){t.clear()}}})(l,new Map),z=(function(){var r=Math.floor(16.666666666666668),t,f,c={},v=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(t=function(S){var E=Math.random();return c[E]=requestAnimationFrame(function b(I){v===I||v+r-1<I?(v=I,delete c[E],S()):c[E]=requestAnimationFrame(b)}),E},f=function(S){c[S]&&cancelAnimationFrame(c[S])}):(t=function(S){return setTimeout(S,r)},f=function(S){return clearTimeout(S)}),{frame:t,cancel:f}})(),x=(function(){var r,t,f={};function c(v){function S(E,b){v.postMessage({options:E||{},callback:b})}v.init=function(b){var I=b.transferControlToOffscreen();v.postMessage({canvas:I},[I])},v.fire=function(b,I,N){if(t)return S(b,null),t;var U=Math.random().toString(36).slice(2);return t=C(function(F){function L(q){q.data.callback===U&&(delete f[U],v.removeEventListener("message",L),t=null,y.clear(),N(),F())}v.addEventListener("message",L),S(b,U),f[U]=L.bind(null,{data:{callback:U}})}),t},v.reset=function(){v.postMessage({reset:!0});for(var b in f)f[b](),delete f[b]}}return function(){if(r)return r;if(!n&&o){var v=["var CONFETTI, SIZE = {}, module = {};","("+p.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{r=new Worker(URL.createObjectURL(new Blob([v])))}catch(S){return typeof console<"u"&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",S),null}c(r)}return r}})(),w={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function h(r,t){return t?t(r):r}function u(r){return r!=null}function d(r,t,f){return h(r&&u(r[t])?r[t]:w[t],f)}function k(r){return r<0?0:Math.floor(r)}function B(r,t){return Math.floor(Math.random()*(t-r))+r}function R(r){return parseInt(r,16)}function M(r){return r.map(O)}function O(r){var t=String(r).replace(/[^0-9a-f]/gi,"");return t.length<6&&(t=t[0]+t[0]+t[1]+t[1]+t[2]+t[2]),{r:R(t.substring(0,2)),g:R(t.substring(2,4)),b:R(t.substring(4,6))}}function _(r){var t=d(r,"origin",Object);return t.x=d(t,"x",Number),t.y=d(t,"y",Number),t}function A(r){r.width=document.documentElement.clientWidth,r.height=document.documentElement.clientHeight}function W(r){var t=r.getBoundingClientRect();r.width=t.width,r.height=t.height}function X(r){var t=document.createElement("canvas");return t.style.position="fixed",t.style.top="0px",t.style.left="0px",t.style.pointerEvents="none",t.style.zIndex=r,t}function ee(r,t,f,c,v,S,E,b,I){r.save(),r.translate(t,f),r.rotate(S),r.scale(c,v),r.arc(0,0,1,E,b,I),r.restore()}function Z(r){var t=r.angle*(Math.PI/180),f=r.spread*(Math.PI/180);return{x:r.x,y:r.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:r.startVelocity*.5+Math.random()*r.startVelocity,angle2D:-t+(.5*f-Math.random()*f),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:r.color,shape:r.shape,tick:0,totalTicks:r.ticks,decay:r.decay,drift:r.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:r.gravity*3,ovalScalar:.6,scalar:r.scalar,flat:r.flat}}function ce(r,t){t.x+=Math.cos(t.angle2D)*t.velocity+t.drift,t.y+=Math.sin(t.angle2D)*t.velocity+t.gravity,t.velocity*=t.decay,t.flat?(t.wobble=0,t.wobbleX=t.x+10*t.scalar,t.wobbleY=t.y+10*t.scalar,t.tiltSin=0,t.tiltCos=0,t.random=1):(t.wobble+=t.wobbleSpeed,t.wobbleX=t.x+10*t.scalar*Math.cos(t.wobble),t.wobbleY=t.y+10*t.scalar*Math.sin(t.wobble),t.tiltAngle+=.1,t.tiltSin=Math.sin(t.tiltAngle),t.tiltCos=Math.cos(t.tiltAngle),t.random=Math.random()+2);var f=t.tick++/t.totalTicks,c=t.x+t.random*t.tiltCos,v=t.y+t.random*t.tiltSin,S=t.wobbleX+t.random*t.tiltCos,E=t.wobbleY+t.random*t.tiltSin;if(r.fillStyle="rgba("+t.color.r+", "+t.color.g+", "+t.color.b+", "+(1-f)+")",r.beginPath(),s&&t.shape.type==="path"&&typeof t.shape.path=="string"&&Array.isArray(t.shape.matrix))r.fill(P(t.shape.path,t.shape.matrix,t.x,t.y,Math.abs(S-c)*.1,Math.abs(E-v)*.1,Math.PI/10*t.wobble));else if(t.shape.type==="bitmap"){var b=Math.PI/10*t.wobble,I=Math.abs(S-c)*.1,N=Math.abs(E-v)*.1,U=t.shape.bitmap.width*t.scalar,F=t.shape.bitmap.height*t.scalar,L=new DOMMatrix([Math.cos(b)*I,Math.sin(b)*I,-Math.sin(b)*N,Math.cos(b)*N,t.x,t.y]);L.multiplySelf(new DOMMatrix(t.shape.matrix));var q=r.createPattern(y.transform(t.shape.bitmap),"no-repeat");q.setTransform(L),r.globalAlpha=1-f,r.fillStyle=q,r.fillRect(t.x-U/2,t.y-F/2,U,F),r.globalAlpha=1}else if(t.shape==="circle")r.ellipse?r.ellipse(t.x,t.y,Math.abs(S-c)*t.ovalScalar,Math.abs(E-v)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI):ee(r,t.x,t.y,Math.abs(S-c)*t.ovalScalar,Math.abs(E-v)*t.ovalScalar,Math.PI/10*t.wobble,0,2*Math.PI);else if(t.shape==="star")for(var T=Math.PI/2*3,D=4*t.scalar,$=8*t.scalar,V=t.x,K=t.y,te=5,Q=Math.PI/te;te--;)V=t.x+Math.cos(T)*$,K=t.y+Math.sin(T)*$,r.lineTo(V,K),T+=Q,V=t.x+Math.cos(T)*D,K=t.y+Math.sin(T)*D,r.lineTo(V,K),T+=Q;else r.moveTo(Math.floor(t.x),Math.floor(t.y)),r.lineTo(Math.floor(t.wobbleX),Math.floor(v)),r.lineTo(Math.floor(S),Math.floor(E)),r.lineTo(Math.floor(c),Math.floor(t.wobbleY));return r.closePath(),r.fill(),t.tick<t.totalTicks}function Y(r,t,f,c,v){var S=t.slice(),E=r.getContext("2d"),b,I,N=C(function(U){function F(){b=I=null,E.clearRect(0,0,c.width,c.height),y.clear(),v(),U()}function L(){n&&!(c.width===a.width&&c.height===a.height)&&(c.width=r.width=a.width,c.height=r.height=a.height),!c.width&&!c.height&&(f(r),c.width=r.width,c.height=r.height),E.clearRect(0,0,c.width,c.height),S=S.filter(function(q){return ce(E,q)}),S.length?b=z.frame(L):F()}b=z.frame(L),I=F});return{addFettis:function(U){return S=S.concat(U),N},canvas:r,promise:N,reset:function(){b&&z.cancel(b),I&&I()}}}function ae(r,t){var f=!r,c=!!d(t||{},"resize"),v=!1,S=d(t,"disableForReducedMotion",Boolean),E=o&&!!d(t||{},"useWorker"),b=E?x():null,I=f?A:W,N=r&&b?!!r.__confetti_initialized:!1,U=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,F;function L(T,D,$){for(var V=d(T,"particleCount",k),K=d(T,"angle",Number),te=d(T,"spread",Number),Q=d(T,"startVelocity",Number),Se=d(T,"decay",Number),Ee=d(T,"gravity",Number),Ie=d(T,"drift",Number),fe=d(T,"colors",M),je=d(T,"ticks",Number),ye=d(T,"shapes"),Te=d(T,"scalar"),Pe=!!d(T,"flat"),ve=_(T),we=V,ue=[],Re=r.width*ve.x,Ae=r.height*ve.y;we--;)ue.push(Z({x:Re,y:Ae,angle:K,spread:te,startVelocity:Q,color:fe[we%fe.length],shape:ye[B(0,ye.length)],ticks:je,decay:Se,gravity:Ee,drift:Ie,scalar:Te,flat:Pe}));return F?F.addFettis(ue):(F=Y(r,ue,I,D,$),F.promise)}function q(T){var D=S||d(T,"disableForReducedMotion",Boolean),$=d(T,"zIndex",Number);if(D&&U)return C(function(Q){Q()});f&&F?r=F.canvas:f&&!r&&(r=X($),document.body.appendChild(r)),c&&!N&&I(r);var V={width:r.width,height:r.height};b&&!N&&b.init(r),N=!0,b&&(r.__confetti_initialized=!0);function K(){if(b){var Q={getBoundingClientRect:function(){if(!f)return r.getBoundingClientRect()}};I(Q),b.postMessage({resize:{width:Q.width,height:Q.height}});return}V.width=V.height=null}function te(){F=null,c&&(v=!1,e.removeEventListener("resize",K)),f&&r&&(document.body.contains(r)&&document.body.removeChild(r),r=null,N=!1)}return c&&!v&&(v=!0,e.addEventListener("resize",K,!1)),b?b.fire(T,V,te):L(T,V,te)}return q.reset=function(){b&&b.reset(),F&&F.reset()},q}var ie;function re(){return ie||(ie=ae(null,{useWorker:!0,resize:!0})),ie}function P(r,t,f,c,v,S,E){var b=new Path2D(r),I=new Path2D;I.addPath(b,new DOMMatrix(t));var N=new Path2D;return N.addPath(I,new DOMMatrix([Math.cos(E)*v,Math.sin(E)*v,-Math.sin(E)*S,Math.cos(E)*S,f,c])),N}function G(r){if(!s)throw new Error("path confetti are not supported in this browser");var t,f;typeof r=="string"?t=r:(t=r.path,f=r.matrix);var c=new Path2D(t),v=document.createElement("canvas"),S=v.getContext("2d");if(!f){for(var E=1e3,b=E,I=E,N=0,U=0,F,L,q=0;q<E;q+=2)for(var T=0;T<E;T+=2)S.isPointInPath(c,q,T,"nonzero")&&(b=Math.min(b,q),I=Math.min(I,T),N=Math.max(N,q),U=Math.max(U,T));F=N-b,L=U-I;var D=10,$=Math.min(D/F,D/L);f=[$,0,0,$,-Math.round(F/2+b)*$,-Math.round(L/2+I)*$]}return{type:"path",path:t,matrix:f}}function J(r){var t,f=1,c="#000000",v='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof r=="string"?t=r:(t=r.text,f="scalar"in r?r.scalar:f,v="fontFamily"in r?r.fontFamily:v,c="color"in r?r.color:c);var S=10*f,E=""+S+"px "+v,b=new OffscreenCanvas(S,S),I=b.getContext("2d");I.font=E;var N=I.measureText(t),U=Math.ceil(N.actualBoundingBoxRight+N.actualBoundingBoxLeft),F=Math.ceil(N.actualBoundingBoxAscent+N.actualBoundingBoxDescent),L=2,q=N.actualBoundingBoxLeft+L,T=N.actualBoundingBoxAscent+L;U+=L+L,F+=L+L,b=new OffscreenCanvas(U,F),I=b.getContext("2d"),I.font=E,I.fillStyle=c,I.fillText(t,q,T);var D=1/f;return{type:"bitmap",bitmap:b.transferToImageBitmap(),matrix:[D,0,0,D,-U*D/2,-F*D/2]}}i.exports=function(){return re().apply(this,arguments)},i.exports.reset=function(){re().reset()},i.exports.create=ae,i.exports.shapeFromPath=G,i.exports.shapeFromText=J})((function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}})(),ge,!1);const vt=ge.exports;ge.exports.create;const tt=j.memo(({emotions:p})=>m.jsxs("div",{children:[m.jsxs("h4",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wide mb-2 flex items-center gap-2",children:[m.jsx(Le,{className:"w-3 h-3"}),"Emotions Detected"]}),m.jsx("div",{className:"flex flex-wrap gap-1.5",children:p.map((e,i)=>m.jsx(H.span,{initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:i*.05},className:"px-2 py-1 rounded-md bg-primary/5 text-xs font-medium text-foreground border border-primary/20",children:e},i))})]}));tt.displayName="EmotionsDetected";const nt=j.memo(({expressions:p})=>m.jsxs("div",{children:[m.jsxs("h4",{className:"text-xs font-bold text-muted-foreground uppercase tracking-wide mb-2 flex items-center gap-2",children:[m.jsx(He,{className:"w-3 h-3"}),"Micro-Expressions"]}),m.jsx("div",{className:"space-y-1.5",children:p.map((e,i)=>m.jsxs(H.div,{initial:{opacity:0,x:-10},animate:{opacity:1,x:0},transition:{delay:i*.05},className:"flex items-start gap-2 text-xs",children:[m.jsx(De,{className:"w-3 h-3 text-primary mt-0.5 flex-shrink-0"}),m.jsx("span",{className:"text-foreground",children:e})]},i))})]}));nt.displayName="MicroExpressions";const it=j.memo(({onReflectionChange:p,onValidationChange:e})=>{const[i,n]=j.useState(""),a=j.useCallback(o=>{const l=o.target.value.replace(/<[^>]*>?/gm,"").replace(/javascript:/gi,"").replace(/data:/gi,"").replace(/vbscript:/gi,"").replace(/on\w+\s*=/gi,"").slice(0,500);n(l),p?.(l),e?.(l.trim().length>0)},[p,e]);return m.jsxs(H.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:.3},className:"bg-gradient-to-br from-purple-50 via-pink-50 to-rose-50 dark:from-purple-900/30 dark:via-pink-900/30 dark:to-rose-900/30 rounded-2xl p-4 sm:p-5 border-2 border-purple-200 dark:border-purple-700 shadow-lg",children:[m.jsxs("div",{className:"flex items-center gap-2.5 mb-3",children:[m.jsx("div",{className:"flex-shrink-0 w-10 h-10 sm:w-9 sm:h-9 rounded-xl bg-gradient-to-br from-purple-200 to-pink-200 dark:from-purple-700 dark:to-pink-700 border-2 border-purple-300 dark:border-purple-600 flex items-center justify-center shadow-md",children:m.jsx(Be,{className:"w-5 h-5 sm:w-4.5 sm:h-4.5 text-purple-700 dark:text-purple-200"})}),m.jsxs("div",{className:"flex-1 min-w-0",children:[m.jsx("h4",{className:"text-base sm:text-sm font-bold text-purple-800 dark:text-purple-200",children:"ðŸ’­ Share Your Thoughts"}),m.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400 leading-tight",children:"What triggered this feeling?"})]})]}),m.jsx("textarea",{value:i,onChange:a,placeholder:"e.g., 'Had a challenging meeting...' or 'Feeling grateful...'",className:"w-full p-3 sm:p-3 rounded-xl bg-white dark:bg-gray-900/50 border-2 border-purple-300 dark:border-purple-600 text-sm text-foreground placeholder:text-purple-400/60 dark:placeholder:text-purple-500/60 focus:border-purple-500 dark:focus:border-purple-400 focus:ring-2 focus:ring-purple-300 dark:focus:ring-purple-700 outline-none resize-none transition-all duration-300 shadow-sm",rows:3,maxLength:500}),m.jsxs("div",{className:"flex justify-between items-center mt-2.5",children:[m.jsx("p",{className:"text-xs text-purple-600 dark:text-purple-400 font-medium",children:"ðŸ’¡ Helps personalize insights"}),m.jsxs("span",{className:"text-xs text-purple-600 dark:text-purple-400 font-bold bg-purple-100 dark:bg-purple-900/50 px-2.5 py-0.5 rounded-full border border-purple-300 dark:border-purple-600",children:[i.length,"/500"]})]})]})});it.displayName="UserReflectionInput";const at=j.memo(({className:p,delay:e=0})=>m.jsx(H.div,{className:`absolute rounded-full blur-3xl pointer-events-none ${p}`,initial:{scale:.8,opacity:0},animate:{scale:[1,1.12,1],opacity:[.08,.15,.08]},transition:{duration:12,repeat:1/0,ease:"easeInOut",delay:e}}));at.displayName="DecorativeBlob";const rt=j.memo(()=>m.jsx("div",{className:"absolute inset-0 overflow-hidden pointer-events-none opacity-[0.015]",children:m.jsxs("svg",{className:"w-full h-full",xmlns:"http://www.w3.org/2000/svg",children:[m.jsx("defs",{children:m.jsx("pattern",{id:"mws-grid",width:"40",height:"40",patternUnits:"userSpaceOnUse",children:m.jsx("path",{d:"M 40 0 L 0 0 0 40",fill:"none",stroke:"currentColor",strokeWidth:"0.5"})})}),m.jsx("rect",{width:"100%",height:"100%",fill:"url(#mws-grid)",className:"text-foreground"})]})}));rt.displayName="GridPattern";let de=null,ke=null,Ce=null,se=null;const st=async()=>(se||(se=Promise.all([oe(()=>import("./index-BdD-LP6G.js"),__vite__mapDeps([0,1,2])),oe(()=>import("./face_mesh-B-RIQy6T.js").then(p=>p.f),__vite__mapDeps([3,1,2])),oe(()=>import("./camera_utils-8lnaEEpH.js").then(p=>p.c),__vite__mapDeps([4,1,2]))]).then(([p,e,i])=>{de=p,ke=e.FaceMesh,Ce=i.Camera}).catch(p=>{throw se=null,p})),se);class ot{constructor(){this.faceMesh=null,this.camera=null,this.isInitialized=!1,this.onResultsCallback=null,this.currentResults=null,this.landmarkHistory=[],this.maxHistoryLength=30}async initialize(){if(!this.isInitialized)try{await st(),await de.ready(),await de.setBackend("webgl"),this.faceMesh=new ke({locateFile:e=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${e}`}),this.faceMesh.setOptions({maxNumFaces:1,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),this.faceMesh.onResults(e=>{this.handleResults(e)}),this.isInitialized=!0,console.log("ðŸ¤– Face Detection Service initialized successfully")}catch(e){throw console.error("âŒ Failed to initialize Face Detection Service:",e),e}}handleResults(e){if(this.currentResults=e,e.multiFaceLandmarks&&e.multiFaceLandmarks.length>0){const i=e.multiFaceLandmarks[0];this.landmarkHistory.push({timestamp:Date.now(),landmarks:i.map(n=>({x:n.x,y:n.y,z:n.z}))}),this.landmarkHistory.length>this.maxHistoryLength&&this.landmarkHistory.shift()}this.onResultsCallback&&this.onResultsCallback(e)}startCamera(e,i){if(!this.isInitialized)throw new Error("Face Detection Service not initialized");this.onResultsCallback=i,this.camera=new Ce(e,{onFrame:async()=>{this.faceMesh&&await this.faceMesh.send({image:e})},width:640,height:480}),this.camera.start(),console.log("ðŸ“¹ Camera started for face detection")}stopCamera(){this.camera&&(this.camera.stop(),this.camera=null),this.onResultsCallback=null,this.currentResults=null,this.landmarkHistory=[],console.log("ðŸ“¹ Camera stopped")}getCurrentResults(){return this.currentResults}getLandmarkHistory(){return this.landmarkHistory}extractFeatures(e){if(!e.multiFaceLandmarks||e.multiFaceLandmarks.length===0)return null;const i=e.multiFaceLandmarks[0];return{leftEye:this.getEyeFeatures(i,"left"),rightEye:this.getEyeFeatures(i,"right"),mouth:this.getMouthFeatures(i),leftBrow:this.getBrowFeatures(i,"left"),rightBrow:this.getBrowFeatures(i,"right"),cheeks:this.getCheekFeatures(i),nose:this.getNoseFeatures(i),faceMetrics:this.getFaceMetrics(i),temporalFeatures:this.getTemporalFeatures()}}getEyeFeatures(e,i){const a=(i==="left"?[33,160,158,133,153,144]:[362,385,387,263,373,380]).map(C=>e[C]),o=this.calculateEyeAspectRatio(a),s=Math.abs(a[1].y-a[5].y),l=Math.abs(a[0].x-a[3].x),g=s/l;return{aspectRatio:o,openness:g,blinkDetected:o<.2,coordinates:a}}getMouthFeatures(e){const n=[61,146,91,181,84,17,314,405,321,375,291,409,270,269,267,0,37,39,40,185].map(z=>e[z]),a=Math.abs(n[0].x-n[10].x),s=Math.abs(n[3].y-n[9].y)/a,l=n[0],g=n[10],C=n[9],y=(l.y+g.y)/2-C.y;return{aspectRatio:s,smileIntensity:y,isSmiling:y>.01,coordinates:n}}getBrowFeatures(e,i){const a=(i==="left"?[70,63,105,66,107]:[336,296,334,293,300]).map(l=>e[l]),o=a.reduce((l,g)=>l+g.y,0)/a.length,s=Math.abs(a[2].x-a[4].x);return{elevation:o,furrowing:s,coordinates:a}}getCheekFeatures(e){const n=[50,101,118,117,119,100,36,137,205,206,207,208,209,210,211,212,213,214,215,216].map(o=>e[o]);return{puffiness:n.reduce((o,s)=>o+s.z,0)/n.length,coordinates:n}}getNoseFeatures(e){const n=[1,2,3,4,5,6,197,195,5,4,45,275].map(o=>e[o]);return{wrinkling:Math.abs(n[0].z-n[6].z),coordinates:n}}getFaceMetrics(e){const i=e.slice(0,234),n=e.slice(234),a=this.calculateFacialSymmetry(i,n),o=e[6],s=e[152],l=Math.atan2(s.y-o.y,s.x-o.x);return{symmetry:a,headTilt:l,faceWidth:Math.abs(e[234].x-e[454].x),faceHeight:Math.abs(e[10].y-e[152].y)}}getTemporalFeatures(){if(this.landmarkHistory.length<2)return null;const e=this.landmarkHistory.slice(-10);return{blinkRate:this.calculateBlinkRate(e),expressionStability:this.calculateExpressionStability(e),microMovements:this.detectMicroMovements(e)}}calculateEyeAspectRatio(e){const i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],l=e[5],g=Math.sqrt(Math.pow(n.x-l.x,2)+Math.pow(n.y-l.y,2)),C=Math.sqrt(Math.pow(a.x-s.x,2)+Math.pow(a.y-s.y,2)),y=Math.sqrt(Math.pow(i.x-o.x,2)+Math.pow(i.y-o.y,2));return y===0?0:(g+C)/(2*y)}calculateFacialSymmetry(e,i){let n=0;const a=Math.min(e.length,i.length);for(let o=0;o<a;o++){const s=e[o],l=i[o],g=Math.sqrt(Math.pow(s.x- -l.x,2)+Math.pow(s.y-l.y,2)+Math.pow(s.z-l.z,2));n+=g}return n/a}calculateBlinkRate(e){let i=0;for(let n=1;n<e.length;n++){const a=e[n-1],o=e[n],s=this.calculateEyeAspectRatio(a.landmarks.slice(33,39)),l=this.calculateEyeAspectRatio(o.landmarks.slice(33,39));s>.25&&l<.2&&i++}return i/(e.length/30)*60}calculateExpressionStability(e){let i=0;for(let n=1;n<e.length;n++){const a=e[n-1].landmarks,o=e[n].landmarks;let s=0;for(let l=0;l<Math.min(a.length,o.length);l++){const g=Math.sqrt(Math.pow(a[l].x-o[l].x,2)+Math.pow(a[l].y-o[l].y,2)+Math.pow(a[l].z-o[l].z,2));s+=g}i+=s/a.length}return i/(e.length-1)}detectMicroMovements(e){const i=[];for(let n=1;n<e.length;n++){const a=e[n-1].landmarks,o=e[n].landmarks;for(let s=0;s<Math.min(a.length,o.length);s++){const l=Math.sqrt(Math.pow(a[s].x-o[s].x,2)+Math.pow(a[s].y-o[s].y,2)+Math.pow(a[s].z-o[s].z,2));l>.001&&l<.01&&i.push({landmark:s,magnitude:l,timestamp:e[n].timestamp})}}return i}dispose(){this.stopCamera(),this.faceMesh&&(this.faceMesh.close(),this.faceMesh=null),this.isInitialized=!1,console.log("ðŸ—‘ï¸ Face Detection Service disposed")}}const ne=new ot;class lt{constructor(){this.emotionHistory=[],this.maxHistoryLength=100,this.baselineFeatures=null,this.isAnalyzing=!1}async initialize(){await ne.initialize(),console.log("ðŸŽ­ Emotion Analysis Service initialized")}async startAnalysis(e,i){this.isAnalyzing=!0,this.emotionHistory=[],this.baselineFeatures=null,e.readyState<2&&await new Promise(n=>{const a=()=>{e.removeEventListener("loadedmetadata",a),n()};e.addEventListener("loadedmetadata",a),setTimeout(n,2e3)}),ne.startCamera(e,n=>{if(this.isAnalyzing){const a=this.analyzeEmotion(n);a&&i&&i(a)}})}stopAnalysis(){this.isAnalyzing=!1,ne.stopCamera()}analyzeEmotion(e){const i=ne.extractFeatures(e);if(!i)return null;if(this.emotionHistory.push({timestamp:Date.now(),features:i,emotionResult:null}),this.emotionHistory.length>this.maxHistoryLength&&this.emotionHistory.shift(),!this.baselineFeatures&&this.emotionHistory.length>=5&&(this.baselineFeatures=this.calculateBaselineFeatures()),!this.baselineFeatures)return console.log("â³ Still collecting baseline features, history length:",this.emotionHistory.length),null;const n=this.classifyEmotion(i);this.emotionHistory.length>0&&(this.emotionHistory[this.emotionHistory.length-1].emotionResult=n);const a=this.analyzeTemporalPatterns(),o=this.calculateConfidence(n,i),s=this.generateExplanations(n,i);return console.log("ðŸŽ¯ Emotion analysis result:",n.primaryEmotion,"confidence:",o),{...n,confidence:o,explanations:s,temporalAnalysis:a,rawFeatures:i}}classifyEmotion(e){const i={facialExpression:this.classifyByFacialExpression(e),microExpressions:this.classifyByMicroExpressions(e),temporalPatterns:this.classifyByTemporalPatterns(),physiologicalSignals:this.classifyByPhysiologicalSignals(e)},n=this.ensembleVoting(i),a=Object.entries(n).sort(([,C],[,y])=>y-C).slice(0,3),o=a[0][0],s=a.slice(1).map(([C])=>C),l=this.mapToValenceArousal(o),g=this.calculateIntensity(e,o);return{primaryEmotion:o,secondaryEmotions:s,valence:l.valence,arousal:l.arousal,intensity:g,emotionScores:n}}classifyByFacialExpression(e){const i={happy:0,sad:0,angry:0,surprised:0,fearful:0,disgusted:0,neutral:0,anxious:0,calm:0};e.mouth.isSmiling&&e.mouth.smileIntensity>.02?(i.happy+=.8,i.calm+=.2):e.mouth.aspectRatio>.5?(i.surprised+=.6,i.fearful+=.3):e.mouth.aspectRatio<.2&&(i.sad+=.7,i.disgusted+=.2),(e.leftEye.blinkDetected||e.rightEye.blinkDetected)&&(i.surprised+=.4),(e.leftEye.openness<.3||e.rightEye.openness<.3)&&(i.anxious+=.5,i.sad+=.3);const n=(e.leftBrow.elevation+e.rightBrow.elevation)/2;n<-.1?(i.sad+=.6,i.anxious+=.3):n>.1&&(i.surprised+=.5,i.fearful+=.3),(e.leftBrow.furrowing+e.rightBrow.furrowing)/2<.05&&(i.angry+=.4,i.anxious+=.3),e.cheeks.puffiness>.1&&(i.angry+=.3,i.surprised+=.2),e.nose.wrinkling>.05&&(i.disgusted+=.6);const o=Object.values(i).reduce((s,l)=>s+l,0);return o>0&&Object.keys(i).forEach(s=>{i[s]=i[s]/o}),i}classifyByMicroExpressions(e){const i={happy:0,sad:0,angry:0,surprised:0,fearful:0,disgusted:0,neutral:0,anxious:0,calm:0},n=ne.getTemporalFeatures();return n&&(n.blinkRate>20&&(i.anxious+=.6,i.fearful+=.3),n.expressionStability>.02&&(i.anxious+=.4,i.sad+=.3),n.microMovements.filter(o=>o.landmark>=33&&o.landmark<=133).length>5&&(i.anxious+=.5,i.sad+=.3)),e.faceMetrics.symmetry>.05&&(i.anxious+=.4,i.sad+=.3),i}classifyByTemporalPatterns(){const e={happy:0,sad:0,angry:0,surprised:0,fearful:0,disgusted:0,neutral:0,anxious:0,calm:0};if(this.emotionHistory.length<5)return e;const i=this.emotionHistory.slice(-10),n=this.calculateEmotionTrends(i);return n.volatility>.3&&(e.surprised+=.4,e.fearful+=.3),n.trend<-.1&&(e.sad+=.5),n.avgArousal>.7&&(e.anxious+=.6),n.avgArousal<.3&&(e.calm+=.4,e.sad+=.3),e}classifyByPhysiologicalSignals(e){const i={happy:0,sad:0,angry:0,surprised:0,fearful:0,disgusted:0,neutral:0,anxious:0,calm:0},n=e.faceMetrics.headTilt;return Math.abs(n)>.3&&(i.surprised+=.3,i.anxious+=.2),e.faceMetrics.symmetry>.08&&(i.anxious+=.4,i.sad+=.3),i}ensembleVoting(e){const i=Object.keys(e.facialExpression),n={};return i.forEach(a=>{const o=e.facialExpression[a]*.4+e.microExpressions[a]*.3+e.temporalPatterns[a]*.2+e.physiologicalSignals[a]*.1;n[a]=o}),n}mapToValenceArousal(e){return{happy:{valence:.8,arousal:.7},sad:{valence:-.7,arousal:-.3},angry:{valence:-.8,arousal:.8},surprised:{valence:.2,arousal:.9},fearful:{valence:-.6,arousal:.8},disgusted:{valence:-.6,arousal:.4},neutral:{valence:0,arousal:0},anxious:{valence:-.4,arousal:.6},calm:{valence:.3,arousal:-.4}}[e]||{valence:0,arousal:0}}calculateIntensity(e,i){let n=0;n+=Math.abs(e.mouth.smileIntensity)*50;const a=(e.leftEye.openness+e.rightEye.openness)/2;n+=(1-a)*20;const o=(e.leftBrow.elevation+e.rightBrow.elevation)/2;return n+=Math.abs(o)*30,n*={happy:1.2,sad:1,angry:1.3,surprised:1.4,fearful:1.3,disgusted:1.1,neutral:.5,anxious:1.1,calm:.7}[i]||1,Math.min(100,Math.max(0,n))}calculateBaselineFeatures(){if(this.emotionHistory.length<5)return null;const e=this.emotionHistory.slice(-10),i={};return Object.keys(e[0].features).forEach(a=>{if(typeof e[0].features[a]=="object"&&e[0].features[a]!==null){const o=Object.keys(e[0].features[a]);i[a]={},o.forEach(s=>{const l=e.map(g=>g.features[a]?.[s]).filter(g=>typeof g=="number");i[a][s]=l.length>0?l.reduce((g,C)=>g+C)/l.length:0})}else{const o=e.map(s=>s.features[a]).filter(s=>typeof s=="number");i[a]=o.length>0?o.reduce((s,l)=>s+l)/o.length:0}}),i}calculateEmotionTrends(e){if(e.length<3)return{trend:0,volatility:0,avgArousal:0};const i=e.map(u=>{if(u.emotionResult)return u.emotionResult;try{return this.classifyEmotion(u.features)}catch{return{valence:0,arousal:0}}}),n=i.map(u=>u.valence||0),a=i.map(u=>u.arousal||0),o=n.length,s=o*(o-1)/2,l=n.reduce((u,d)=>u+d,0),g=n.reduce((u,d,k)=>u+k*d,0),C=o*(o-1)*(2*o-1)/6,y=o>1&&C!==s*s?(o*g-s*l)/(o*C-s*s):0,z=n.reduce((u,d)=>u+d,0)/o,x=n.reduce((u,d)=>u+Math.pow(d-z,2),0)/o,w=Math.sqrt(x),h=a.reduce((u,d)=>u+d,0)/o;return{trend:y,volatility:w,avgArousal:h}}calculateConfidence(e,i){let n=0;i.faceMetrics&&(n+=(1-i.faceMetrics.symmetry)*20);const a=e.intensity/100;n+=a*30;const o=ne.getTemporalFeatures();o&&(n+=(1-o.expressionStability)*25);const s=Math.max(...Object.values(e.emotionScores)),l=Object.values(e.emotionScores).sort((C,y)=>y-C)[1]||0,g=l>0?s/l:10;return n+=Math.min(25,g*5),Math.min(100,Math.max(0,n))}generateExplanations(e,i){const n=[],a=e.primaryEmotion,o=e.confidence;a==="happy"&&i.mouth.isSmiling?n.push("Detected genuine smile with Duchenne markers"):a==="sad"&&i.mouth.aspectRatio<.3?n.push("Noted downturned mouth corners and reduced facial animation"):a==="anxious"&&(i.leftEye.blinkDetected||i.rightEye.blinkDetected)?n.push("Observed rapid blink patterns and elevated brow tension"):a==="surprised"&&i.mouth.aspectRatio>.4&&n.push("Captured widened eye aperture and raised eyebrows"),o>80?n.push("High confidence due to clear facial expression patterns"):o>60?n.push("Moderate confidence with some expression ambiguity"):n.push("Lower confidence - consider retaking scan in better lighting");const s=[];return i.mouth.smileIntensity>.01&&s.push("mouth curvature"),i.leftEye.openness<.5&&s.push("eye aperture"),Math.abs(i.leftBrow.elevation)>.05&&s.push("brow position"),s.length>0&&n.push(`Key indicators: ${s.join(", ")}`),n}analyzeTemporalPatterns(){if(this.emotionHistory.length<5)return null;const e=this.emotionHistory.slice(-20),i=e.map(l=>this.classifyEmotion(l.features)),n=[];for(let l=1;l<i.length;l++)i[l].primaryEmotion!==i[l-1].primaryEmotion&&n.push({from:i[l-1].primaryEmotion,to:i[l].primaryEmotion,timestamp:e[l].timestamp});const a=i.reduce((l,g)=>(l[g.primaryEmotion]=(l[g.primaryEmotion]||0)+1,l),{}),o=Object.entries(a).sort(([,l],[,g])=>g-l)[0][0],s=a[o]/i.length;return{transitions:n,stability:s,dominantEmotion:o,emotionVariability:Object.keys(a).length/i.length}}dispose(){this.stopAnalysis(),this.emotionHistory=[],this.baselineFeatures=null,console.log("ðŸ—‘ï¸ Emotion Analysis Service disposed")}}const Me=new lt,he="intro",wt=({toast:p,maxRescanAttempts:e=2})=>{const[i,n]=j.useState(he),[a,o]=j.useState(null),[s,l]=j.useState(0),[g,C]=j.useState([]),[y,z]=j.useState(0),x=j.useRef(null),w=j.useRef(null),h=j.useCallback(async()=>{try{const M=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:640},height:{ideal:480}}});o(M),n("preview")}catch(M){console.error("Camera access error:",M),p?.({title:"Camera Access Required",description:"Please allow camera access for emotional analysis.",variant:"destructive"})}},[p]),u=j.useCallback(async()=>{try{if(!x.current)throw new Error("Video element not available");const M=document.createElement("canvas"),O=M.getContext("2d");M.width=x.current.videoWidth||640,M.height=x.current.videoHeight||480,O.drawImage(x.current,0,0);const _=M.toDataURL("image/jpeg",.9);return a&&a.getTracks().forEach(A=>A.stop()),n("analyzing"),_}catch(M){console.error("Photo capture failed:",M),p?.({title:"Photo Capture Failed",description:"Unable to capture photo for analysis.",variant:"destructive"}),n(he)}},[a,p]),d=j.useCallback(()=>{Me.stopAnalysis(),w.current&&(clearInterval(w.current),w.current=null),a&&a.getTracks().forEach(M=>M.stop()),o(null),n(he),l(0),C([])},[a]),k=j.useCallback(()=>{y>=e||(z(M=>M+1),d())},[e,d,y]),B=j.useMemo(()=>Math.max(e-y,0),[e,y]),R=B<=0;return j.useEffect(()=>()=>{Me.dispose(),a&&a.getTracks().forEach(M=>M.stop()),w.current&&(clearInterval(w.current),w.current=null)},[a]),{stage:i,setStage:n,stream:a,setStream:o,scanProgress:s,setScanProgress:l,detectedFeatures:g,setDetectedFeatures:C,startScan:h,capturePhoto:u,resetScan:d,handleRescanRequest:k,isRescanDisabled:R,remainingRescans:B,rescanCount:y,videoRef:x,scanIntervalRef:w}},ct=p=>{const e=p.primaryEmotion,i=p.confidence,n=p.valence,a=p.arousal,o=p.intensity,s=p.explanations,l={happy:n>.5&&a>.3?"Genuine Joy":n>.3&&a>.2?"Positive Engagement":"Content Satisfaction",sad:n<-.3&&a<.2?"Deep Melancholy":n<-.1&&a<.3?"Subdued Reflection":"Quiet Contemplation",angry:a>.7&&n<-.2?"Intense Frustration":a>.5&&n<-.1?"Building Tension":"Mild Irritation",surprised:a>.6&&n>.1?"Sudden Amazement":a>.4?"Unexpected Interest":"Mild Curiosity",fearful:a>.6&&n<-.3?"Acute Anxiety":a>.4&&n<-.1?"Underlying Worry":"Subtle Concern",disgusted:n<-.4&&a>.2?"Strong Aversion":n<-.2?"Mild Discomfort":"Subtle Disapproval",neutral:Math.abs(n)<.2&&Math.abs(a)<.3?"Balanced Composure":Math.abs(n)<.3?"Steady Equilibrium":"Measured Neutrality",anxious:a>.5&&n<0?"Heightened Unease":a>.3?"Subtle Restlessness":"Mild Apprehension",calm:a<.2&&n>-.1?"Serene Tranquility":a<.3&&n>-.2?"Peaceful Composure":"Gentle Stillness"},g={happy_high:{icon:"â˜€ï¸",internal:"Bright Sunshine",desc:"Radiant energy and clear emotional skies"},happy_low:{icon:"ðŸŒ¤ï¸",internal:"Gentle Sunshine",desc:"Warm contentment with peaceful clarity"},negative_high:{icon:"â›ˆï¸",internal:"Stormy Turbulence",desc:"Emotional intensity with challenging undercurrents"},negative_low:{icon:"â˜ï¸",internal:"Overcast Calm",desc:"Subdued atmosphere with emotional weight"},neutral:{icon:"â›…",internal:"Balanced Skies",desc:"Steady emotional weather with moderate clarity"}};let C="neutral";n>.2&&a>.4?C="happy_high":n>.1&&a<.4?C="happy_low":n<-.1&&a>.4?C="negative_high":n<0&&a<.4&&(C="negative_low");const y=g[C],x=(({primaryEmotion:P,valence:G,arousal:J,intensity:r,explanations:t=[]})=>{const f=[];let c=0,v=null;const S=["happy","calm","surprised","neutral"].includes(P),E=G<.1,b=J>.55,I=r<35,N=t.some(F=>/tension|tight|furrow|strain|fatigue|micro-twitch|jaw/i.test(F));return S&&E&&(c+=.4,v=v||"emotional fatigue",f.push("Outer expression looks bright, yet valence drops into a heavier range.")),S&&b&&G<.2&&(c+=.25,v=v||"quiet overwhelm",f.push("Physiological arousal spikes while the visible expression stays composed.")),I&&(c+=.2,v=v||"low energy",f.push("Micro-expression intensity is fading, hinting at exhaustion underneath.")),N&&(c+=.25,v=v||"suppressed concern",f.push("Subtle muscular tension is showing up around the eyes or jaw.")),{isMasked:c>=.5,maskScore:Math.min(c,1),hiddenEmotionLabel:v||(E?"subtle sadness":"mixed emotions"),signals:f}})({primaryEmotion:e,valence:n,arousal:a,intensity:o,explanations:s}),w=s.map(P=>P.toLowerCase().includes("mouth")||P.toLowerCase().includes("smile")?"Mouth positioning and curvature":P.toLowerCase().includes("eye")||P.toLowerCase().includes("brow")?"Eye and eyebrow dynamics":P.toLowerCase().includes("muscle")||P.toLowerCase().includes("tension")?"Facial muscle activation patterns":P.toLowerCase().includes("expression")||P.toLowerCase().includes("facial")?"Overall facial expression coherence":"Subtle facial movement indicators").slice(0,4),h=(P,G,J,r,t,f)=>{const c={neutral:["I notice you're carrying yourself with remarkable composure right now. That subtle neutrality in your expression speaks volumes about your emotional resilience - you're neither overwhelmed nor disengaged, but perfectly balanced in this present moment.","Your neutral expression tells me you're in a state of quiet observation. This isn't emotional flatness, but rather a mindful presence that allows you to process your experiences without being swept away by them.","What beautiful emotional equilibrium I see in your face. You're maintaining that perfect balance between engagement and peace, showing me you have excellent self-regulation skills."],happy:["Oh, what a genuine spark of joy I see lighting up your eyes! That authentic happiness isn't just surface-level - it's the kind that radiates from deep within, telling me you're experiencing something truly meaningful right now.","Your smile reaches your eyes in that beautiful way that only comes from real contentment. I can tell this happiness is more than just a fleeting moment - it's a reflection of genuine satisfaction in your life.","I love seeing that authentic joy in your expression! It's the kind of happiness that comes from within, not from external circumstances. You're clearly experiencing something that nourishes your soul."],sad:["I can see there's a gentle sadness touching your heart right now. Your eyes tell me you're processing some deeper emotions, and that's actually a beautiful sign of your emotional depth and capacity for feeling.","Your expression shows me you're in a reflective space, processing emotions that matter to you. This sadness isn't something to push away - it's showing me how deeply you care about the things that touch your life.","I notice that quiet contemplation in your eyes. Sometimes our deepest growth comes from sitting with these tender emotions. You're showing incredible courage by being present with your feelings."],anxious:["I can see there's some tension in your expression that speaks to me of underlying worry. Your eyes tell me you're carrying concerns that are weighing on your mind - and that's completely understandable in our complex world.","Your face shows me you're in a state of heightened alertness, which often comes when we're processing uncertainty. This anxiety is your body's way of trying to protect you, but I can help you find some gentle grounding.","I notice that subtle tension around your eyes that suggests you're carrying some anxiety. It's brave of you to acknowledge these feelings - many people try to hide them. Let's work together to create some calm."],calm:["What beautiful tranquility I see in your expression! Your face radiates that peaceful presence that comes from deep within. This calm isn't emptiness - it's the profound peace of someone who knows how to center themselves.","Your serene expression tells me you're in touch with an inner peace that's quite special. This calm state shows me you have wonderful self-regulation skills and a beautiful capacity for mindfulness.","I love seeing that gentle calm in your eyes. It's the kind of peace that comes from authentic self-acceptance and emotional wisdom. You're clearly someone who knows how to nurture their own well-being."],angry:["I can see there's some frustration or anger present in your expression right now. Your eyes tell me you're feeling strongly about something that matters deeply to you. This passion, when channeled well, can be a tremendous force for positive change.","Your face shows me you're experiencing some intense emotions that need expression. This anger isn't something to fear - it's showing me how much you care about justice, fairness, or the things that matter to your heart.","I notice that intensity in your expression that suggests you're feeling quite strongly about something. This emotional energy can be transformative when we learn to work with it consciously."],surprised:["Oh, I can see a spark of surprise in your eyes! That widened gaze tells me something unexpected has caught your attention. Surprise like this often opens us up to new possibilities and fresh perspectives.","Your expression shows me you're experiencing a moment of genuine surprise. This openness to the unexpected is actually a beautiful quality - it shows you're engaged with life and open to new experiences.","I love seeing that element of surprise in your face! It tells me you're someone who can still be delighted by life's unexpected moments. This wonder is such a precious quality to nurture."],fearful:["I can see there's some fear or concern present in your expression. Your eyes tell me you're navigating something that feels threatening or uncertain. This vulnerability actually shows me how deeply you care about staying safe and protected.","Your face shows me you're in a protective state right now, which is completely natural when we sense potential danger. This fear is your body's wisdom trying to keep you safe - let's honor it while finding some gentle reassurance.","I notice that cautious quality in your expression that suggests you're feeling some fear. It's brave of you to be present with these feelings. Fear often shows us what we most deeply value and want to protect."]},v=c[P]||c.neutral;return v[Math.floor(Math.random()*v.length)]},u=(P,G,J,r,t,f)=>{const c={neutral:["In this beautiful state of balance, you have a wonderful opportunity to deepen your self-awareness. Consider taking a few moments to check in with yourself: What emotions are you holding that might need gentle attention? What strengths are you embodying right now that you can celebrate?","Your current equilibrium is perfect for practicing mindfulness. Try this simple exercise: Place one hand on your heart and one on your belly. As you breathe, notice how your body feels in this moment of calm. This awareness will help you recognize and appreciate your emotional wisdom.","I encourage you to honor this neutral space you're in. Sometimes our most profound insights come when we're neither high nor low, but simply present. What might this balanced state be inviting you to notice about yourself?"],happy:["What a gift to experience this genuine happiness! Consider sharing this positive energy with someone you care about, or channeling it into a creative project. Happiness like yours has the power to uplift not just yourself, but everyone around you.","Your joyful state is perfect for practicing gratitude. Take a moment to reflect: What people, experiences, or qualities in your life are contributing to this happiness? This awareness will help you cultivate more of what brings you joy.","I love seeing this authentic happiness in you! Consider using this positive energy to strengthen your relationships or pursue meaningful goals. When we're in this state, we're most capable of creating positive change in our lives."],sad:["Your willingness to sit with sadness shows such emotional courage. Consider reaching out to a trusted friend or loved one - sometimes sharing our tender feelings with someone who cares about us can provide the gentle support we need.","In moments like these, self-compassion is your greatest ally. Try speaking to yourself as you would to a dear friend experiencing similar feelings. What words of kindness might you offer yourself right now?","This sadness you're experiencing is showing me how deeply you feel and care. Consider engaging in a comforting activity - perhaps wrapping yourself in a warm blanket, listening to soothing music, or spending time in nature. These small acts of self-care can be profoundly healing."],anxious:["Your anxiety is showing me how much you care about doing things well. Consider grounding yourself with this simple technique: Name 5 things you can see, 4 you can touch, 3 you can hear, 2 you can smell, and 1 you can taste. This brings you back to the safety of the present moment.",`I can see you're carrying some worry right now. Consider placing one hand on your heart and reminding yourself: "I am safe in this moment." Anxiety often comes from trying to control the future - this gentle reminder can help you return to the present.`,"Your anxious feelings are completely valid and understandable. Consider breathing deeply: Inhale for 4 counts, hold for 4, exhale for 6. This simple practice can help calm your nervous system and remind you that you have the strength to handle whatever comes."],calm:["Your peaceful state is a beautiful foundation for deeper self-understanding. Consider using this calm to reflect on what practices or people help you maintain this sense of peace. This awareness will help you cultivate more tranquility in your life.","In this serene space, you have a wonderful opportunity for gentle self-inquiry. What practices or relationships help you feel this calm? How might you invite more of these elements into your daily life?","Your calm presence is such a gift to yourself and others. Consider using this peaceful energy to connect deeply with someone you care about, or to engage in a meaningful activity that nourishes your soul."],angry:["Your anger shows me you're someone who cares deeply about justice and fairness. Consider channeling this energy into constructive action - perhaps writing down your feelings, going for a brisk walk, or engaging in a physical activity that helps release the tension.",`I can see you're feeling quite passionate about something right now. Consider taking some deep breaths and asking yourself: "What is this anger trying to protect in me?" Often our anger points to something we deeply value that feels threatened.`,"Your intense feelings are showing me how much you care. Consider finding a healthy way to express this energy - perhaps through creative activity, physical exercise, or having an honest conversation with someone you trust."],surprised:["This moment of surprise is opening you up to new possibilities! Consider staying curious about what this unexpected experience might be inviting you to learn or explore. Sometimes our greatest growth comes from embracing the unexpected.","Your surprised expression tells me you're open to life's possibilities. Consider reflecting on what this surprise might be teaching you about flexibility and embracing change. This openness is a beautiful quality.","I love seeing this element of wonder in your face! Consider using this moment to practice curiosity. What might this surprise be inviting you to notice or explore differently in your life?"],fearful:["Your fear shows me you're someone who deeply values safety and security. Consider grounding yourself by naming what feels safe and supportive in your current environment. This can help remind you that you have resources available to you.","I can see you're in a protective state right now, which is your body's natural response to perceived threat. Consider breathing deeply and reminding yourself of times when you've successfully navigated uncertainty. You have inner strength.","Your cautious expression tells me you're being wise about potential risks. Consider identifying one small, safe step you could take right now. Often our fears feel overwhelming, but breaking them down into manageable actions can restore our sense of agency."]},v=c[P]||c.neutral;return v[Math.floor(Math.random()*v.length)]},d=h(e),k=u(e),R=((P,G,J,r,t,f)=>{const c=[];return P==="happy"&&G>.3?(c.push({title:"Celebrate Your Inner Light",description:"Your genuine happiness is a beautiful gift that radiates outward. Consider sharing this positive energy through a small act of kindness today - perhaps a warm smile to a colleague or a moment of gratitude shared with someone you care about. This not only spreads joy but also deepens your own sense of connection and purpose.",priority:"high",category:"social"}),c.push({title:"Anchor This Joyful State",description:"Take a few moments to reflect on what elements in your life are contributing to this authentic happiness. Is it a sense of accomplishment, meaningful connections, or simply being present? By identifying these sources, you can consciously cultivate more of what brings this light to your life.",priority:"medium",category:"mindfulness"}),c.push({title:"Build on Positive Momentum",description:"Your current positive emotional state is perfect for strengthening relationships or pursuing meaningful goals. Consider reaching out to someone you care about or engaging in an activity that brings you fulfillment. When we're in this state, we're most capable of creating positive change.",priority:"medium",category:"social"}),c.push({title:"Practice Gratitude",description:"Take a moment to acknowledge the people, experiences, or qualities in your life that contribute to this happiness. Consider writing down three things you're grateful for today. This practice can help sustain and amplify your positive emotional state.",priority:"low",category:"mindfulness"})):P==="sad"&&G<-.2?(c.push({title:"Honor Your Emotional Depth",description:"Your capacity to feel deeply, even when it brings sadness, is a profound strength that shows your beautiful sensitivity to life's experiences. Consider creating a small ritual of self-compassion - perhaps placing a hand on your heart and acknowledging that it's okay to feel this way, and that this tenderness is part of what makes you beautifully human.",priority:"high",category:"self-care"}),c.push({title:"Find Gentle Connection",description:"In moments of sadness, reaching out for connection can be incredibly healing. Consider sharing how you're feeling with someone who has shown you care and understanding before. Sometimes just being witnessed in our sadness can bring unexpected comfort and remind us that we're not alone in our experiences.",priority:"medium",category:"social"}),c.push({title:"Create Comforting Rituals",description:"Consider engaging in small, comforting activities that honor your need for gentleness right now. This might include wrapping yourself in a warm blanket, listening to soothing music, spending time in nature, or preparing a nourishing meal. These acts of self-care can be profoundly healing during tender moments.",priority:"medium",category:"self-care"}),c.push({title:"Allow Space for Processing",description:"Give yourself permission to feel this sadness without judgment. Consider journaling about your experience or simply sitting with your emotions. Sometimes our deepest healing comes from allowing ourselves to fully experience and process our feelings rather than pushing them away.",priority:"low",category:"mindfulness"})):P==="anxious"&&J>.4?(c.push({title:"Ground Yourself in the Present",description:"Your anxiety shows how deeply you care about navigating life thoughtfully. Try this simple grounding practice: Name 5 things you can see around you, 4 things you can touch, 3 things you can hear, 2 things you can smell, and 1 you can taste. This brings your awareness back to the safety of the present moment.",priority:"high",category:"mindfulness"}),c.push({title:"Create a Safety Plan",description:"Consider identifying 2-3 small actions you can take when anxiety feels overwhelming. This might include deep breathing, stepping outside for fresh air, or calling a trusted friend. Having these ready tools can help restore your sense of agency and calm.",priority:"medium",category:"self-care"}),c.push({title:"Practice Gentle Breathing",description:"Try the 4-7-8 breathing technique: Inhale quietly through your nose for 4 seconds, hold your breath for 7 seconds, then exhale completely through your mouth for 8 seconds. This can help calm your nervous system and provide immediate relief from anxious feelings.",priority:"medium",category:"mindfulness"}),c.push({title:"Identify Worry Triggers",description:"Take a moment to gently explore what might be contributing to your anxiety. Is there a specific situation or thought pattern that's creating this tension? Sometimes simply naming our worries can help us see them more clearly and find ways to address them.",priority:"low",category:"mindfulness"})):P==="neutral"&&Math.abs(G)<.3?(c.push({title:"Embrace This Balanced Space",description:"Your current state of equilibrium is actually quite special - it's a place of clarity where you're neither overwhelmed nor disengaged. Consider using this balanced energy for a task that requires clear thinking, or simply enjoy this peaceful presence with yourself. Sometimes our most profound insights come in these quiet, centered moments.",priority:"medium",category:"mindfulness"}),c.push({title:"Check In With Your Needs",description:"In this neutral space, you have a wonderful opportunity to tune into what your body and mind might need right now. Are you hungry, thirsty, or needing a change of scenery? Sometimes attending to these basic needs can bring a gentle sense of well-being and care for yourself.",priority:"low",category:"self-care"}),c.push({title:"Practice Mindful Awareness",description:"Use this balanced state to practice being fully present. Notice the sensations in your body, the sounds around you, and your breath. This mindful awareness can help you cultivate a deeper sense of calm and presence in your daily life.",priority:"medium",category:"mindfulness"}),c.push({title:"Reflect on Your Strengths",description:"Take a moment to acknowledge the inner resources and strengths that allow you to maintain this balanced state. What qualities or practices help you stay grounded? This awareness can help you access these resources more easily when life feels more challenging.",priority:"low",category:"self-care"})):P==="calm"&&J<.3?(c.push({title:"Deepen This Peaceful State",description:"Your calm presence is a beautiful gift to yourself and others around you. Consider using this peaceful energy to connect more deeply with someone you care about, or to engage in a creative activity that brings you joy. This tranquility is worth savoring and can become a touchstone for difficult moments.",priority:"medium",category:"mindfulness"}),c.push({title:"Reflect on Your Inner Resources",description:"Take a moment to appreciate the inner strength and wisdom that allow you to access this calm state. What practices or perspectives help you find this peace? This awareness can help you return to this centered place more easily when life feels chaotic.",priority:"low",category:"self-care"}),c.push({title:"Cultivate Deeper Presence",description:"Use this calm state to deepen your mindfulness practice. Consider sitting quietly and observing your thoughts and feelings without judgment. This can help you develop greater emotional resilience and presence in all areas of your life.",priority:"medium",category:"mindfulness"}),c.push({title:"Share Your Peace",description:"Consider how you might share this calm energy with others. Perhaps through a quiet conversation, a supportive presence, or simply by bringing your peaceful awareness to your interactions. Your calm can be a gift to those around you.",priority:"low",category:"social"})):P==="angry"&&J>.5?(c.push({title:"Channel Your Passion Constructively",description:"Your anger shows you care deeply about justice and fairness. Consider channeling this energy into constructive action - perhaps writing down your feelings, going for a brisk walk, or engaging in a physical activity that helps release the tension. This passion, when directed well, can be a tremendous force for positive change in your life and the lives of others.",priority:"high",category:"mindfulness"}),c.push({title:"Explore the Root of This Fire",description:"Take a moment to gently explore what this anger might be protecting or pointing to. Often our strongest emotions are messengers carrying important information about our values and boundaries. This awareness can help transform anger into clarity and purposeful action.",priority:"medium",category:"self-care"}),c.push({title:"Find Healthy Expression",description:"Consider finding a safe way to express this intense energy. This might include physical activity, creative expression, or having an honest conversation with someone you trust. Finding appropriate outlets for strong emotions is an important part of emotional health.",priority:"medium",category:"mindfulness"}),c.push({title:"Practice Self-Understanding",description:"Take some time to understand what this anger is communicating to you. What boundary needs to be set? What value is being violated? What action might you need to take? This understanding can help you respond rather than react.",priority:"low",category:"mindfulness"})):P==="surprised"&&J>.4?(c.push({title:"Embrace This Moment of Wonder",description:"Your surprise shows you're open to life's unexpected gifts and possibilities. Consider staying curious about what this experience might be teaching you about flexibility and embracing change. Sometimes our greatest growth comes from learning to welcome the unexpected with an open heart.",priority:"medium",category:"mindfulness"}),c.push({title:"Reflect on This Awakening",description:"Take a few moments to reflect on what surprised you and why. This awareness can help you notice more of life's small wonders and maintain that beautiful sense of curiosity and openness that makes each day feel fresh and alive.",priority:"low",category:"self-care"}),c.push({title:"Stay Open to Possibilities",description:"Use this moment of surprise as an opportunity to practice flexibility and openness. Consider what new perspectives or opportunities this experience might be opening up for you. Sometimes the most unexpected moments lead to our greatest discoveries.",priority:"medium",category:"mindfulness"}),c.push({title:"Cultivate Curiosity",description:"Let this surprise awaken your sense of wonder and curiosity. Consider approaching the rest of your day with a spirit of openness and discovery. What other unexpected gifts might be waiting for you?",priority:"low",category:"mindfulness"})):P==="fearful"&&G<-.1&&(c.push({title:"Acknowledge Your Courage",description:"Your fear shows you're someone who deeply values safety and security, which speaks to your wisdom and care for yourself. Consider identifying one small, safe step you can take right now. Often our fears feel overwhelming, but breaking them down into manageable actions can restore our sense of agency and peace.",priority:"high",category:"self-care"}),c.push({title:"Find Your Grounding",description:"When fear feels present, grounding practices can be incredibly helpful. Try placing both feet firmly on the ground and taking slow, deep breaths. Remind yourself that you have inner resources and past experiences of successfully navigating uncertainty. You are more capable than you know.",priority:"medium",category:"mindfulness"}),c.push({title:"Build a Support Network",description:"Consider reaching out to trusted friends, family, or colleagues who can provide support during this time. Sometimes sharing our fears with others can help us feel less alone and more supported in facing our challenges.",priority:"medium",category:"social"}),c.push({title:"Practice Self-Reassurance",description:"Take a moment to remind yourself of your past experiences with uncertainty. What strengths have you shown before? What resources do you have available to you now? This self-reassurance can help calm fearful thoughts and restore confidence.",priority:"low",category:"self-care"})),c.length<4&&c.push({title:"Practice Self-Compassion",description:"Whatever you're experiencing right now, consider speaking to yourself with the same kindness and understanding you'd offer to a dear friend in a similar situation. Your feelings are valid, and your presence here shows your commitment to your own well-being. That's something truly worth celebrating.",priority:"medium",category:"self-care"}),c.slice(0,4)})(e,n,a),M=Math.min(10,Math.max(1,Math.round((n+1)*5))),O=Math.min(10,Math.max(1,Math.round((1-Math.abs(a-.5))*8+2))),_=Math.round((M+O)/20*100),A={calm:{title:"Serene Tranquility",tone:"mint",arc:"stabilizing"},happy:{title:"Radiant Bloom",tone:"rose",arc:"ascending"},sad:{title:"Tender Depth",tone:"lilac",arc:"softening"},anxious:{title:"Quiet Storm",tone:"amber",arc:"repairing"},neutral:{title:"Measured Balance",tone:"slate",arc:"balancing"},angry:{title:"Fiery Focus",tone:"crimson",arc:"igniting"}},W=A[e]||A.neutral,X={title:W.title,chapter:`${y.internal} â€¢ ${e}`,narrative:d,arc:W.arc,inflection:x.hiddenEmotionLabel||e,confidence:Math.min(98,Math.max(62,i+(x.isMasked?-8:5))),colorTone:W.tone},ee={presenceScore:M,capacityScore:O,overallReadiness:_,readinessLane:_>=80?"glide":_>=60?"steady":_>=40?"sensitive":"repair",signals:[{label:"Presence",status:M>=7?"clear":M>=5?"foggy":"dense",idea:M>=7?"Channel this clarity into meaningful tasks.":"Protect your first 30 minutes from notifications to ease into the day."},{label:"Capacity",status:O>=7?"charged":O>=5?"oscillating":"drained",idea:O>=6?"Use the surplus energy on creative or collaborative work.":"Schedule a recovery pocket (5-7 mins) to keep your nervous system regulated."}]},Z=_<55||M<5||O<5||x.isMasked,ce={needsSupport:Z,supportLevel:Z?"active":"monitor",suggestedAllies:Z?["Trusted colleague","Mentor/coach"]:["Peer ally","Positive accountability buddy"],message:Z?"This might be the day to ping someone from your circle-every nervous system needs co-regulation sometimes.":"You're in a steady lane. Share your calm energy with someone who might need it today.",storylineContext:X.title},Y={mint:{gradientCss:"linear-gradient(135deg, rgba(236, 252, 203, 0.85) 0%, rgba(224, 242, 254, 0.75) 45%, rgba(255, 255, 255, 0.85) 100%)",glassColor:"rgba(255, 255, 255, 0.9)",borderColor:"rgba(16, 185, 129, 0.35)",accentColor:"#10b981",moodIntent:"soothing"},rose:{gradientCss:"linear-gradient(135deg, rgba(253, 242, 248, 0.92) 0%, rgba(255, 228, 230, 0.85) 42%, rgba(255, 255, 255, 0.9) 100%)",glassColor:"rgba(255, 255, 255, 0.88)",borderColor:"rgba(244, 63, 94, 0.35)",accentColor:"#f43f5e",moodIntent:"warming"},lilac:{gradientCss:"linear-gradient(135deg, rgba(245, 243, 255, 0.92) 0%, rgba(237, 233, 254, 0.85) 50%, rgba(255, 255, 255, 0.9) 100%)",glassColor:"rgba(250, 250, 255, 0.85)",borderColor:"rgba(99, 102, 241, 0.4)",accentColor:"#8b5cf6",moodIntent:"balancing"},amber:{gradientCss:"linear-gradient(135deg, rgba(254, 249, 195, 0.9) 0%, rgba(255, 237, 213, 0.8) 45%, rgba(255, 255, 255, 0.9) 100%)",glassColor:"rgba(255, 255, 255, 0.92)",borderColor:"rgba(251, 191, 36, 0.35)",accentColor:"#f59e0b",moodIntent:"grounding"},slate:{gradientCss:"linear-gradient(135deg, rgba(226, 232, 240, 0.9) 0%, rgba(203, 213, 225, 0.85) 48%, rgba(248, 250, 252, 0.92) 100%)",glassColor:"rgba(248, 250, 252, 0.9)",borderColor:"rgba(100, 116, 139, 0.35)",accentColor:"#64748b",moodIntent:"balancing"},crimson:{gradientCss:"linear-gradient(135deg, rgba(254, 226, 226, 0.9) 0%, rgba(252, 231, 243, 0.85) 48%, rgba(255, 255, 255, 0.92) 100%)",glassColor:"rgba(255, 255, 255, 0.9)",borderColor:"rgba(220, 38, 38, 0.4)",accentColor:"#dc2626",moodIntent:"bright"}},ae={theme:W.tone,gradientCss:(Y[W.tone]||Y.lilac).gradientCss,glassClass:null,glassColor:(Y[W.tone]||Y.lilac).glassColor,borderColor:(Y[W.tone]||Y.lilac).borderColor,accentColor:(Y[W.tone]||Y.lilac).accentColor,density:ee.overallReadiness>=70?"airy":ee.overallReadiness>=45?"balanced":"cozy",badges:[X.title,y.internal,x.isMasked?"masked emotion alert":null].filter(Boolean),animationAnchor:x.isMasked?"fade-in":"fade-up",moodIntent:(Y[W.tone]||Y.lilac).moodIntent},ie=[...(p.secondaryEmotions||[]).slice(0,2).map(P=>({label:P,type:"mood"})),{label:y.internal,type:"weather"},x.isMasked?{label:"inner "+x.hiddenEmotionLabel,type:"insight"}:null,Z?{label:"support recommended",type:"support"}:null].filter(Boolean),re={callToAction:Z?"Consider booking a manual check-in or reaching out to your support contact.":"Document two things fueling this positive rhythm today.",generatedAt:new Date().toISOString()};return{id:`ai_${e}_${Date.now()}`,detectedEmotion:x.isMasked?`${l[e]||e} â€¢ inner ${x.hiddenEmotionLabel}`:l[e]||"Balanced Emotional State",confidence:Math.round(i),icon:y.icon,weatherIcon:y.icon,internalWeather:y.internal,weatherDesc:y.desc,selfreportedEmotions:[e,...p.secondaryEmotions||[]],microExpressions:w,aiAnalysis:`Through careful observation of your facial expressions, I can see you're experiencing a ${e} emotional state. Your eyes and facial muscles tell a story of ${o>70?"intense":o>40?"moderate":"gentle"} emotional expression, with a ${n>.2?"positive":n<-.2?"challenging":"balanced"} emotional tone. This authentic expression reveals so much about your current inner experience.${x.isMasked?` There is also a quiet undertone of ${x.hiddenEmotionLabel} gently asking to be acknowledged.`:""}`,psychologicalInsight:d,personalizedRecommendation:k,presenceCapacity:{estimatedPresence:M,estimatedCapacity:O,reasoning:`AI analysis of emotional dimensions (valence: ${n.toFixed(2)}, arousal: ${a.toFixed(2)}) indicates ${e} state affecting cognitive presence and capacity.`},suggestedActions:R.map(P=>P.title),detailedRecommendations:R,aiDetected:!0,valence:n,arousal:a,intensity:o,explanations:s,temporalAnalysis:p.temporalAnalysis,analysisFlags:x.isMasked?[{type:"masked_emotion",severity:x.maskScore,insights:x.signals}]:[],emotionalStoryline:X,readinessMatrix:ee,supportCompass:ce,displayHints:ae,insightChips:ie,metadata:re}},bt=({toast:p,setStage:e})=>{const[i,n]=j.useState(null),[a,o]=j.useState(null),[s,l]=j.useState(null),g=j.useCallback(async y=>{ze();try{e("analyzing");const x=await(await fetch(y)).blob(),w=new FormData;w.append("image",x,"emotion_capture.jpg");const h=await fetch("https://bemws-production.up.railway.app/api/v1/checkin/emotion/analyze",{method:"POST",body:w});if(!h.ok)throw new Error("Emotion analysis API failed");const u=await h.json(),d=u.data?.emotionResult||u.emotionResult;if(!d)throw new Error("Invalid emotion analysis response format - no emotionResult found");l(d)}catch(z){console.error("Emotion analysis failed:",z),p?.({title:"Analysis Failed",description:"Unable to perform AI emotion analysis. Please try again.",variant:"destructive"}),e("intro")}finally{We()}},[e,p]),C=j.useCallback(()=>{if(s)try{const y=ct(s);y.selectedSupportContact=a,y.isSubmitting=!1,n(y),e("results")}catch(y){console.error("Failed to generate AI analysis:",y),p?.({title:"Analysis Failed",description:"Unable to process AI emotion analysis. Please try again.",variant:"destructive"}),e("intro")}},[s,a,e,p]);return j.useEffect(()=>{if(!s)return;const y=setTimeout(C,100);return()=>clearTimeout(y)},[s,C]),j.useEffect(()=>{n(y=>y&&{...y,selectedSupportContact:a})},[a]),{analysis:i,setAnalysis:n,analyzePhoto:g,selectedSupportContact:a,setSelectedSupportContact:o}},xt=({analysis:p,selectedSupportContact:e,supportContacts:i,toast:n,navigate:a})=>{const[o,s]=j.useState(!1),l=j.useCallback(async()=>{if(!p){n?.({title:"Analysis Missing",description:"Please run the AI scan before completing the check-in.",variant:"destructive"});return}s(!0);try{if(!(localStorage.getItem("auth_token")||localStorage.getItem("token"))){n?.({title:"Login Required",description:"Please log in to save your AI emotion check-in.",variant:"destructive"}),a("/login");return}let C=null;e&&e!=="No Need"&&(C=i.find(d=>d.name===e||d.id===e)?.id||null);const y={detectedEmotion:p.detectedEmotion,confidence:p.confidence||75,selectedMoods:p.selfreportedEmotions||[],details:p.psychologicalInsight||"",presenceLevel:p.presenceCapacity?.estimatedPresence||7,capacityLevel:p.presenceCapacity?.estimatedCapacity||7,selectedSupportContact:e||"No Need",supportContactUserId:C,weatherType:p.internalWeather||p.weatherDesc||"AI Generated Weather",weatherIcon:p.weatherIcon||"â˜€ï¸",weatherDescription:p.weatherDesc||"",aiSummary:p.personalizedRecommendation||"",aiInsights:p.detailedRecommendations||[],aiGenerated:!0,personalizedGreeting:p.personalizedRecommendation||"",needsSupport:(p.presenceCapacity?.estimatedPresence||7)<5||(p.presenceCapacity?.estimatedCapacity||7)<5},w=(await(await oe(async()=>{const{default:u}=await import("./index-D2rZlo4J.js").then(d=>d.bd);return{default:u}},__vite__mapDeps([1,2]))).default.post("/checkin/submit",y)).data,h=w.checkin?.id||w.checkin?._id||w.data?.checkin?.id||w.data?.checkin?._id;a(h?`/emotional-checkin/rate/${h}`:"/emotional-checkin/rate")}catch(g){const C=g.response?.data?.message||g.message||"Unable to save your check-in.";n?.({title:"Save Failed",description:C,variant:"destructive"})}finally{s(!1)}},[p,a,e,i,n]);return{isSubmitting:o,completeCheckin:l}};export{et as A,gt as C,at as D,tt as E,rt as G,ft as H,Ve as I,nt as M,yt as R,Xe as S,it as U,bt as a,xt as b,vt as c,wt as u};
