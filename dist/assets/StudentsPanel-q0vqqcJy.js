import{j as e,r as a,b as Q,e as V,aj as P}from"./index-D0Udg6QN.js";import{S as U}from"./StudentsTable-DHWCmvzz.js";import{Q as E}from"./TeacherDashboardPage-Dt7bwwvB.js";import{e as I,g as D}from"./interventionSelection-Vcld4Os_.js";import{F as B}from"./funnel-UBdx4NpF.js";import{S as H}from"./search-C9bHGcJC.js";import"./users-round-BuAC1fAe.js";import"./teacherGradeUtils-COfj_G-K.js";import"./teacherSegmentUtils-BaJgF7HQ.js";import"./teacherMappingUtils-BLndk_0a.js";import"./shield-check-CKOShQgl.js";import"./arrow-right-CFeM6htQ.js";import"./StatusPills-B9jj_F6J.js";const R=["All","Tier 1","Tier 2","Tier 3"],g=10,q=({activeTier:r,setActiveTier:i,query:n,setQuery:u})=>e.jsxs("div",{className:"rounded-[28px] border border-white/40 bg-white/90 dark:bg-white/5 p-5 flex flex-col gap-4 shadow-[0_10px_32px_rgba(15,23,42,0.12)]","data-aos":"fade-up","data-aos-delay":"40",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(B,{className:"w-4 h-4"}),"Quick filters"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(o=>e.jsx("button",{onClick:()=>i(o),className:`mtss-filter-chip ${r===o?"mtss-filter-chip--active":""}`,"data-aos":"zoom-in","data-aos-delay":"80",children:o},o))}),e.jsxs("div",{className:"relative","data-aos":"fade-up","data-aos-delay":"100",children:[e.jsx(H,{className:"w-4 h-4 absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search kids or boost type...",value:n,onChange:o=>u(o.target.value),className:"w-full pl-11 pr-4 py-2.5 rounded-full bg-white/70 dark:bg-white/10 border border-primary/20 focus:ring-2 focus:ring-primary/40 focus:outline-none placeholder:text-muted-foreground/70 dark:placeholder:text-white/40"})]})]}),z=({visible:r,total:i})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3","data-aos":"fade-up","data-aos-delay":"60",children:[e.jsxs("div",{children:[e.jsx("p",{className:"uppercase text-xs text-muted-foreground tracking-[0.4em]",children:"Crew Roster"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Kids on your radar today"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("strong",{children:r})," of ",i," filtered students"]})]}),K=({visible:r,total:i,onLoadMore:n})=>e.jsx("div",{className:"flex flex-col items-center gap-2 text-xs text-muted-foreground py-3","data-aos":"fade-up","data-aos-delay":"160",children:r<i?e.jsxs("button",{type:"button",onClick:n,className:"px-4 py-2 rounded-full bg-white/80 dark:bg-white/10 border border-primary/30 text-sm font-semibold text-primary shadow-sm hover:-translate-y-0.5 transition",children:["Load 10 more kids (",r,"/",i,")"]}):e.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-200 border border-emerald-200/70 dark:border-emerald-500/30",children:"All kids loaded"})}),O=a.memo(({students:r,TierPill:i,ProgressBadge:n,onRefresh:u})=>{const o=Q(),{toast:m}=V(),[c,S]=a.useState("All"),[b,C]=a.useState(""),[v,y]=a.useState({type:null,student:null}),[T,j]=a.useState(!1),[w,N]=a.useState(g),p=a.useDeferredValue(b.trim().toLowerCase()),d=a.useMemo(()=>r.filter(t=>{const s=I(t.interventions),l=D(s,t.profile,t),x=l?.tier||t.tier,k=c==="All"||x===c;if(!p)return k;const L=s.map(F=>F.label).join(" "),_=`${t.name} ${t.type||""} ${t.grade||""} ${t.className||""} ${l?.label||""} ${L}`.toLowerCase();return k&&_.includes(p)}),[r,c,p]),h=a.useMemo(()=>d.slice(0,Math.min(w,d.length)),[d,w]);a.useEffect(()=>{N(g)},[c,p,r.length]);const M=a.useCallback(t=>{o(`/mtss/student/${t.slug}`)},[o]),$=a.useCallback((t,s)=>y({type:t,student:s}),[]),f=a.useCallback(()=>y({type:null,student:null}),[]),A=a.useCallback(async(t,s)=>{if(!t?.assignmentId){m({title:"No active intervention",description:`${t?.name||"Student"} isn't linked to an active intervention yet.`,variant:"destructive"});return}j(!0);try{const l=s.notes?.trim()||"",x=s.scoreValue!==""?Number(s.scoreValue):void 0;await P(t.assignmentId,{checkIns:[{date:s.date,summary:l||"Quick update",nextSteps:l||void 0,value:Number.isFinite(x)?x:void 0,unit:s.scoreUnit,performed:s.performed==="yes",celebration:s.badge}]}),m({title:"Progress update saved",description:`${t.name}'s update was recorded!`}),f(),u?.()}catch(l){m({title:"Failed to save update",description:l?.response?.data?.message||l.message||"Please try again in a moment.",variant:"destructive"})}finally{j(!1)}},[m,f,u]);return e.jsxs("div",{className:"space-y-6 mtss-theme",children:[e.jsx(q,{activeTier:c,setActiveTier:S,query:b,setQuery:C}),e.jsxs("section",{className:"rounded-[32px] border border-white/40 bg-white/95 dark:bg-slate-900/40 p-6 space-y-4 shadow-[0_14px_48px_rgba(15,23,42,0.14)]","data-aos":"fade-up","data-aos-delay":"80",children:[e.jsx(z,{visible:h.length,total:d.length}),e.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:e.jsx(U,{students:h,TierPill:i,ProgressBadge:n,showActions:!0,onView:M,onUpdate:t=>$("update",t)})}),e.jsx(K,{visible:h.length,total:d.length,onLoadMore:()=>N(t=>Math.min(d.length,t+g))})]}),v.type==="update"&&e.jsx(E,{student:v.student,onClose:f,onSubmit:A,submitting:T})]})});O.displayName="StudentsPanel";export{O as default};
