import{a as v,v as b,u as w,b as g,r as i,N as p,j as e,o as C,m as o,Q as k,W as H}from"./index-BOBGiIRK.js";import{C as h,c as u,a as L,b as P}from"./card-BoAKoozD.js";import{B as j}from"./badge-eENkJ6wW.js";import{s as l}from"./socketService-DemvXjAn.js";import{M as D}from"./message-circle-BeSNgh9U.js";const A=()=>{const y=v(),{userId:N}=b(),m=w(),{user:d}=g(s=>s.auth),{checkinHistory:a}=g(s=>s.checkin),r=N||d?.id,c=i.useMemo(()=>a?(Array.isArray(a)?a:a.data?.checkins||a.checkins||[]).filter(t=>t.userId===r||t.userId?._id===r):[],[a,r]);console.log("EmotionalHistoryPage Debug:",{currentUser:d?.id,targetUserId:r,checkinHistoryLength:a?.data?.checkins?.length||a?.length||0,userCheckinsLength:c.length,checkinHistoryKeys:a?Object.keys(a):[],firstCheckin:c[0]});const n=i.useMemo(()=>c.filter(s=>s.details).map(s=>({id:s._id,date:new Date(s.date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),time:new Date(s.date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),details:s.details,weatherType:s.weatherType,moods:s.selectedMoods||[],presenceLevel:s.presenceLevel,capacityLevel:s.capacityLevel})).sort((s,t)=>new Date(t.date)-new Date(s.date)),[c]);i.useEffect(()=>{if(d&&r){m(p({page:1,limit:50,userId:r})),l.connect(),l.joinPersonal(r);const s=t=>{console.log("Real-time personal check-in update:",t),m(p({page:1,limit:50,userId:r}))};return l.onPersonalNewCheckin(s),()=>{l.offPersonalNewCheckin(s),l.leavePersonal()}}},[m,d,r]);const f=i.useMemo(()=>({hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{staggerChildren:.05}}}),[]),x=i.useMemo(()=>({hidden:{opacity:0,y:6},show:{opacity:1,y:0,transition:{duration:.32}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsx(C,{children:e.jsx("title",{children:"Emotional History â€” MWS APP"})}),e.jsx(o.main,{initial:"hidden",animate:"show",variants:f,className:"relative min-h-dvh w-full px-4 pb-12 pt-6",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs(o.header,{variants:x,className:"mb-6 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>y(-1),"aria-label":"Go back",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border bg-card/40 backdrop-blur-md hover:bg-accent/8 transition-colors duration-300",children:e.jsx(k,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Emotional History"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Reflection & thoughts"})]})]}),e.jsx(o.section,{variants:x,children:n.length>0?e.jsx("div",{className:"space-y-4",children:n.map(s=>e.jsx(h,{className:"glass glass-card",children:e.jsx(u,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(H,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:s.date}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.time})]}),e.jsx(j,{variant:"outline",className:"text-xs",children:s.weatherType})]}),e.jsx("div",{className:"bg-secondary/20 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:s.details})}),s.moods.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.moods.map(t=>e.jsx(j,{variant:"secondary",className:"text-xs",children:t},t))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-foreground/70 pt-2 border-t border-border/50",children:[e.jsxs("span",{children:["Presence: ",s.presenceLevel,"/10"]}),e.jsxs("span",{children:["Capacity: ",s.capacityLevel,"/10"]})]})]})})},s.id))}):e.jsx(h,{className:"glass glass-card",children:e.jsxs(u,{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("h3",{className:"text-lg font-medium mb-2 text-foreground",children:"No History Yet"}),e.jsx("p",{className:"text-foreground/70 text-sm",children:"You haven't completed any emotional check-ins or added reflections yet. Start with daily check-ins to see your history here."})]})})}),n.length>0&&e.jsx(o.section,{variants:x,className:"mt-6",children:e.jsxs(h,{className:"glass glass-card",children:[e.jsx(L,{children:e.jsx(P,{children:"History Summary"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:n.length}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Total Reflections"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.round(n.reduce((s,t)=>s+t.presenceLevel,0)/n.length*10)/10}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Average Presence"})]})]})})]})})]})})]})};export{A as default};
