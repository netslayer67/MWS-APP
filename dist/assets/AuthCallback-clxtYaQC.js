import{a as i,e as g,u as h,r as m,j as d,P as f,g as k,f as u}from"./index-BmFq6O7m.js";const I=()=>{const t=i(),[a]=g(),s=h();return m.useEffect(()=>{(async()=>{try{const e=a.get("token"),o=a.get("user");if(!e||!o){console.error("Missing token or user data"),t("/login?error=missing_data");return}const r=JSON.parse(decodeURIComponent(o));console.log("OAuth login successful:",r.email),localStorage.setItem("token",e),localStorage.setItem("auth_token",e);let c=r;try{const n=await k();c=n?.data?.data?.user||n?.data?.user||r}catch{console.warn("Failed to fetch canonical user via /auth/me, using query user")}localStorage.setItem("auth_user",JSON.stringify(c)),s(u({user:c,token:e})),t("/select-role",{replace:!0});return}catch(e){console.error("Auth callback error:",e),t("/login?error=callback_failed")}})()},[t,a,s]),d.jsx(f,{})};export{I as default};
