import{e as $,r as a,j as e,aS as L,aT as R,aU as U,aV as q,a_ as B,a$ as z,z as V}from"./index-B1azmWwg.js";import{S as H}from"./StudentsTable-BHK1312E.js";import{P as G,T as K}from"./StatusPills-Dg7uUhRE.js";import{k as W}from"./teacherDashboardUtils-CwqoFmsG.js";import{F as Y}from"./funnel-C8KzFS57.js";import{S as Z}from"./shuffle-9CrZb11p.js";import{S as J}from"./search-CaxCeGa8.js";import{U as Q}from"./users-B-1Atc9_.js";import"./interventionUtils-Dp4HTZyD.js";import"./shield-check-DDGHQKx1.js";const X=["teacher","homeroom","subject","special"],ee=[{label:"Tier 2 - Targeted",value:"tier2"},{label:"Tier 3 - Intensive",value:"tier3"}],I=({open:d,onClose:b,students:h=[],mentors:f=[],onAssigned:P})=>{const{toast:N}=$(),r=a.useMemo(()=>{const t=l=>{const u=(l?.jobPosition||"").toLowerCase(),g=(l?.role||"").toLowerCase(),T=Array.isArray(l?.classes)?l.classes.some(s=>(s.role||"").toLowerCase().includes("teacher")):!1;return X.some(s=>u.includes(s))||T||g.includes("teacher")};return f.filter(t)},[f]),o=r.length>0?r:f,[S,_]=a.useState("tier2"),[n,w]=a.useState(()=>o?.[0]?._id||""),[m,j]=a.useState(""),[A,C]=a.useState(""),[x,k]=a.useState(!1),y=a.useMemo(()=>h.map(t=>t.id||t._id),[h]),i=y.length<2||!n||x;a.useEffect(()=>{if(!o?.length){w("");return}o.some(l=>l._id===n)||w(o[0]._id)},[o,n]);const c=async t=>{if(t.preventDefault(),!i){k(!0);try{const l=m?m.split(",").map(u=>u.trim()).filter(Boolean):["Targeted Support"];await W({mentorId:n,studentIds:y,tier:S,focusAreas:l,notes:A}),N({title:"Assignment created",description:"Selected students were assigned to the mentor."}),P?.()}catch(l){N({title:"Failed to assign",description:l?.response?.data?.message||l.message||"Unable to create mentor assignment",variant:"destructive"})}finally{k(!1)}}};return e.jsx(L,{open:d,onOpenChange:t=>!t&&b?.(),children:e.jsxs(R,{className:"max-w-2xl",children:[e.jsxs(U,{children:[e.jsx(q,{children:"Assign selected students"}),e.jsxs(B,{children:["Create a new MTSS assignment for ",e.jsx("strong",{children:h.length})," students. Select a tier and mentor to continue."]})]}),e.jsxs("form",{className:"space-y-4",onSubmit:c,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.4em] text-muted-foreground",children:"Students"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:h.map(t=>e.jsx("span",{className:"px-3 py-1 rounded-full bg-primary/10 text-sm font-semibold text-primary",children:t.name},t.id))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Tier"}),e.jsx("select",{value:S,onChange:t=>_(t.target.value),className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3",children:ee.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Mentor"}),e.jsx("select",{value:n,onChange:t=>w(t.target.value),className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3",disabled:!o.length,children:o.length===0?e.jsx("option",{value:"",children:"No teaching mentors available"}):o.map(t=>e.jsxs("option",{value:t._id,children:[t.name," · ",t.jobPosition||t.role||"Teacher"]},t._id))})]})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Focus areas (comma separated)"}),e.jsx("input",{value:m,onChange:t=>j(t.target.value),placeholder:"Fluency boost, SEL routines",className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3"})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Notes"}),e.jsx("textarea",{value:A,onChange:t=>C(t.target.value),placeholder:"Add optional context for the mentor…",className:"w-full h-24 rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3 resize-none"})]}),e.jsxs(z,{className:"pt-4",children:[e.jsx("button",{type:"button",onClick:b,className:"px-4 py-2 rounded-full border border-border/60 text-sm font-semibold text-foreground dark:text-white",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:i,className:`px-5 py-2.5 rounded-full text-sm font-semibold text-white ${i?"bg-muted cursor-not-allowed opacity-60":"bg-gradient-to-r from-[#22d3ee] to-[#3b82f6] shadow hover:-translate-y-0.5 transition"}`,children:x?"Assigning…":"Create assignment"})]})]})]})})};I.displayName="AdminAssignmentModal";const F=10,O=({filters:d,onFilterChange:b,gradeOptions:h,tierOptions:f,typeOptions:P,mentorOptions:N,filteredStudents:r,allStudents:o,onViewStudent:S,onUpdateStudent:_,selectedIds:n,onToggleSelect:w,onResetSelection:m,mentorDirectory:j,onRefresh:A})=>{const[C,x]=a.useState(!1),[k,y]=a.useState(F),i=a.useRef(null),c=a.useMemo(()=>n?.length?o.filter(s=>n.includes(s.id||s._id)):[],[n,o]);a.useEffect(()=>{y(F)},[r]),a.useEffect(()=>{if(!i.current)return;const s=i.current,M=new IntersectionObserver(E=>{const[D]=E;D.isIntersecting&&y(p=>p>=r.length?p:Math.min(r.length,p+F))},{threshold:.4});return M.observe(s),()=>M.disconnect()},[r.length]);const t=a.useMemo(()=>r.slice(0,Math.min(k,r.length)),[r,k]),l=t.length<r.length,u="w-full px-4 py-3 rounded-2xl bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-sm text-foreground dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-inner shadow-white/40 dark:shadow-none",g=(s,M,E,D,p)=>e.jsx("div",{"data-aos":p?.variant||"fade-up","data-aos-delay":p?.delay||0,"data-aos-duration":"650","data-aos-easing":"ease-out-cubic",children:e.jsx("select",{className:u,value:s,onChange:v=>b(E,v.target.value),children:M.map(v=>e.jsx("option",{value:v,children:D(v)},v))})}),T=c.length<2||j.length===0;return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"glass glass-card mtss-card-surface p-6 rounded-[36px] border border-white/20 bg-gradient-to-br from-[#ecfeff]/90 via-[#fef9c3]/80 to-[#fce7f3]/85 dark:from-white/5 dark:via-white/10 dark:to-white/5 backdrop-blur-2xl","data-aos":"fade-up",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-4",children:[e.jsxs("div",{className:"space-y-1","data-aos":"fade-right","data-aos-duration":"700",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/70 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold text-slate-600 dark:text-white",children:[e.jsx(Y,{className:"w-3.5 h-3.5"}),"Smart filters"]}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-white/60",children:"Blend grade, tier, and mentor filters to spot caseload gaps instantly."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold text-slate-600 dark:text-white/70","data-aos":"fade-left",children:[e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/80 dark:bg-white/5 border border-white/60 dark:border-white/20 backdrop-blur",children:[r.length," matches"]}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/80 dark:bg-white/5 border border-white/60 dark:border-white/20 backdrop-blur",children:[o.length," total roster"]}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/80 dark:bg-white/5 border border-white/60 dark:border-white/20 backdrop-blur flex items-center gap-1",children:[e.jsx(Z,{className:"w-4 h-4"}),"auto-sort ready"]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-5",children:[g(d.grade,h,"grade",s=>s==="all"?"All Grades":s,{variant:"fade-up-right",delay:80}),g(d.tier,f,"tier",s=>s==="all"?"All Tiers":s,{variant:"fade-up",delay:120}),g(d.type,P,"type",s=>s==="all"?"All Types":s,{variant:"fade-up-left",delay:160}),g(d.mentor,N,"mentor",s=>s==="all"?"All Mentors":s,{variant:"zoom-in-up",delay:200}),e.jsxs("div",{className:"relative","data-aos":"fade-down","data-aos-delay":"220","data-aos-duration":"650","data-aos-easing":"ease-out-quart",children:[e.jsx(J,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary/60"}),e.jsx("input",{type:"text",className:`${u} pl-10`,placeholder:"Search students",value:d.query,onChange:s=>b("query",s.target.value)})]})]})]}),e.jsxs("div",{className:"glass glass-card mtss-card-surface p-6 rounded-[36px] border border-white/20 bg-gradient-to-br from-white/90 via-white/70 to-white/60 dark:from-white/10 dark:via-white/5 dark:to-white/5 backdrop-blur-2xl","data-aos":"fade-up","data-aos-delay":"120",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-4",children:[e.jsxs("div",{className:"space-y-1","data-aos":"fade-right","data-aos-delay":"150",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-muted-foreground",children:"Roster"}),e.jsx("h3",{className:"text-2xl font-black text-foreground dark:text-white bg-gradient-to-r from-[#0ea5e9] via-[#8b5cf6] to-[#ec4899] bg-clip-text text-transparent",children:"All students in MTSS"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xl",children:"Liquid glass rows highlight tiers, next updates, and progress streaks so principals can triage faster."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-end","data-aos":"fade-left","data-aos-delay":"180",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto px-4 py-2 rounded-2xl bg-gradient-to-r from-white/90 via-white/70 to-white/50 dark:from-white/10 dark:via-white/5 dark:to-white/0 border border-white/60 dark:border-white/10 shadow-inner shadow-white/40 dark:shadow-none",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-gradient-to-br from-[#f472b6] to-[#facc15] dark:from-[#1d4ed8] dark:to-[#a855f7] text-white flex items-center justify-center shadow-lg shadow-rose-200/60 dark:shadow-none",children:e.jsx(Q,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-sm font-semibold leading-tight text-slate-700 dark:text-white",children:[e.jsxs("span",{className:"block",children:[c.length," selected"]}),e.jsxs("span",{className:"text-xs font-normal text-slate-500 dark:text-white/60",children:[j.length," mentors available"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:m,disabled:c.length===0,className:`flex-1 sm:flex-none px-4 py-2 rounded-full border text-sm font-semibold transition ${c.length===0?"border-white/40 dark:border-white/10 text-slate-400 dark:text-white/30 cursor-not-allowed":"border-white/70 dark:border-white/30 text-foreground dark:text-white bg-white/80 dark:bg-white/5 shadow-inner hover:-translate-y-0.5"}`,children:"Clear selection"}),e.jsxs("button",{disabled:T,onClick:()=>x(!0),className:`flex-1 sm:flex-none px-4 py-2 rounded-full text-sm font-semibold text-white flex items-center justify-center gap-2 transition ${T?"bg-gradient-to-r from-slate-200 to-slate-100 dark:from-white/10 dark:to-white/5 text-slate-400 dark:text-white/40 cursor-not-allowed":"bg-gradient-to-r from-[#34d399] via-[#3b82f6] to-[#a855f7] shadow-lg shadow-primary/30 hover:-translate-y-0.5"}`,children:[e.jsx(V,{className:"w-4 h-4"}),"Assign Selected"]})]})]})]}),e.jsx(H,{students:t,TierPill:K,ProgressBadge:G,showActions:!0,onView:S,onUpdate:_,selectable:!0,selectedIds:n,onSelect:w}),e.jsxs("div",{ref:i,className:"mt-6 flex flex-col items-center gap-2 text-xs font-semibold text-muted-foreground","data-aos":"fade-up","data-aos-delay":"200",children:[e.jsxs("span",{children:["Showing ",t.length," of ",r.length," students"]}),l?e.jsx("span",{className:"px-3 py-1 rounded-full border border-white/50 dark:border-white/20 bg-white/70 dark:bg-white/5 text-[0.7rem] uppercase tracking-[0.3em]",children:"Scroll to load more"}):e.jsx("span",{className:"px-3 py-1 rounded-full border border-emerald-200/50 bg-emerald-50 text-emerald-500 text-[0.7rem] uppercase tracking-[0.3em]",children:"All caught up"})]})]}),C&&e.jsx(I,{open:C,onClose:()=>x(!1),students:c,mentors:j,onAssigned:()=>{m(),x(!1),A?.()}})]})};O.displayName="AdminStudentsPanel";const he=a.memo(O);export{he as default};
