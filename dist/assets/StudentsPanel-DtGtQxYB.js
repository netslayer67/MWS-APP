import{r as a,b as F,e as P,j as e}from"./index-84ghxoiZ.js";import{S as _}from"./StudentsTable-DfopokHk.js";import{Q as I}from"./TeacherDashboardPage-B78lQ0mY.js";import{u as U}from"./teacherDashboardUtils-StyvLZ3_.js";import{e as E,p as B}from"./interventionUtils-Dp4HTZyD.js";import{F as H}from"./funnel-D7Bz1a1b.js";import{S as R}from"./search-BRmL-FJV.js";import"./StatusPills-B4CyIPhn.js";import"./users-round-B2QDRLVg.js";import"./arrow-right-C06gufu-.js";import"./shield-check-Cz4BhPil.js";const q=["All","Tier 1","Tier 2","Tier 3"],f=10,z=({activeTier:r,setActiveTier:i,query:l,setQuery:u})=>e.jsxs("div",{className:"rounded-[28px] border border-white/40 bg-white/90 dark:bg-white/5 p-5 flex flex-col gap-4 shadow-[0_10px_32px_rgba(15,23,42,0.12)]","data-aos":"fade-up","data-aos-delay":"40",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(H,{className:"w-4 h-4"}),"Quick filters"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:q.map(o=>e.jsx("button",{onClick:()=>i(o),className:`mtss-filter-chip ${r===o?"mtss-filter-chip--active":""}`,"data-aos":"zoom-in","data-aos-delay":"80",children:o},o))}),e.jsxs("div",{className:"relative","data-aos":"fade-up","data-aos-delay":"100",children:[e.jsx(R,{className:"w-4 h-4 absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search kids or boost type...",value:l,onChange:o=>u(o.target.value),className:"w-full pl-11 pr-4 py-2.5 rounded-full bg-white/70 dark:bg-white/10 border border-primary/20 focus:ring-2 focus:ring-primary/40 focus:outline-none placeholder:text-muted-foreground/70 dark:placeholder:text-white/40"})]})]}),D=({visible:r,total:i})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3","data-aos":"fade-up","data-aos-delay":"60",children:[e.jsxs("div",{children:[e.jsx("p",{className:"uppercase text-xs text-muted-foreground tracking-[0.4em]",children:"Crew Roster"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Kids on your radar today"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("strong",{children:r})," of ",i," filtered students"]})]}),K=({visible:r,total:i,onLoadMore:l})=>e.jsx("div",{className:"flex flex-col items-center gap-2 text-xs text-muted-foreground py-3","data-aos":"fade-up","data-aos-delay":"160",children:r<i?e.jsxs("button",{type:"button",onClick:l,className:"px-4 py-2 rounded-full bg-white/80 dark:bg-white/10 border border-primary/30 text-sm font-semibold text-primary shadow-sm hover:-translate-y-0.5 transition",children:["Load 10 more kids (",r,"/",i,")"]}):e.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-200 border border-emerald-200/70 dark:border-emerald-500/30",children:"All kids loaded"})}),O=a.memo(({students:r,TierPill:i,ProgressBadge:l,onRefresh:u})=>{const o=F(),{toast:m}=P(),[c,S]=a.useState("All"),[b,C]=a.useState(""),[v,y]=a.useState({type:null,student:null}),[M,j]=a.useState(!1),[w,k]=a.useState(f),p=a.useDeferredValue(b.trim().toLowerCase()),n=a.useMemo(()=>r.filter(t=>{const s=E(t.interventions),x=B(s)?.tier||t.tier,N=c==="All"||x===c;if(!p)return N;const L=s.map(V=>V.label).join(" "),Q=`${t.name} ${t.type||""} ${t.grade||""} ${t.className||""} ${L}`.toLowerCase();return N&&Q.includes(p)}),[r,c,p]),h=a.useMemo(()=>n.slice(0,Math.min(w,n.length)),[n,w]);a.useEffect(()=>{k(f)},[c,p,r.length]);const T=a.useCallback(t=>{o(`/mtss/student/${t.slug}`)},[o]),$=a.useCallback((t,s)=>y({type:t,student:s}),[]),g=a.useCallback(()=>y({type:null,student:null}),[]),A=a.useCallback(async(t,s)=>{if(!t?.assignmentId){m({title:"No active intervention",description:`${t?.name||"Student"} isn't linked to an active intervention yet.`,variant:"destructive"});return}j(!0);try{const d=s.notes?.trim()||"",x=s.scoreValue!==""?Number(s.scoreValue):void 0;await U(t.assignmentId,{checkIns:[{date:s.date,summary:d||"Quick update",nextSteps:d||void 0,value:Number.isFinite(x)?x:void 0,unit:s.scoreUnit,performed:s.performed==="yes",celebration:s.badge}]}),m({title:"Progress update saved",description:`${t.name}'s update was recorded!`}),g(),u?.()}catch(d){m({title:"Failed to save update",description:d?.response?.data?.message||d.message||"Please try again in a moment.",variant:"destructive"})}finally{j(!1)}},[m,g,u]);return e.jsxs("div",{className:"space-y-6 mtss-theme",children:[e.jsx(z,{activeTier:c,setActiveTier:S,query:b,setQuery:C}),e.jsxs("section",{className:"rounded-[32px] border border-white/40 bg-white/95 dark:bg-slate-900/40 p-6 space-y-4 shadow-[0_14px_48px_rgba(15,23,42,0.14)]","data-aos":"fade-up","data-aos-delay":"80",children:[e.jsx(D,{visible:h.length,total:n.length}),e.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:e.jsx(_,{students:h,TierPill:i,ProgressBadge:l,showActions:!0,onView:T,onUpdate:t=>$("update",t)})}),e.jsx(K,{visible:h.length,total:n.length,onLoadMore:()=>k(t=>Math.min(n.length,t+f))})]}),v.type==="update"&&e.jsx(I,{student:v.student,onClose:g,onSubmit:A,submitting:M})]})});O.displayName="StudentsPanel";export{O as default};
