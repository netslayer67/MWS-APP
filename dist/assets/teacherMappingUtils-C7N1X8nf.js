import{c as O,ag as N}from"./index-D2rZlo4J.js";import{n as I,c as D}from"./teacherGradeUtils-COfj_G-K.js";import{S as K}from"./shield-check-DZFn7leu.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 18h.01",key:"lrp35t"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M16 18h.01",key:"kzsmim"}]],ee=O("calendar-days",R);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const E=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],F=O("clipboard-check",E),M=[{key:"active",label:"Active Interventions",sub:"Kids in a boost bubble",icon:K,accent:"from-[#0ea5e9]/90 via-[#818cf8]/85 to-[#34d399]/80"},{key:"due",label:"Updates Due",sub:"Check-ins waiting today",icon:F,accent:"from-[#fcd34d]/90 via-[#fb923c]/85 to-[#38bdf8]/80"},{key:"success",label:"Success Rate",sub:"Kids hitting targets",icon:N,accent:"from-[#22d3ee]/90 via-[#a855f7]/85 to-[#f472b6]/80"}],v=(e,r={month:"short",day:"numeric"})=>{if(!e)return"—";try{return new Intl.DateTimeFormat("en-US",r).format(new Date(e))}catch{return"—"}},_=e=>e?e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""):`student-${Math.random().toString(36).slice(2,6)}`,te=()=>{try{return JSON.parse(localStorage.getItem("auth_user")||"null")}catch{return null}},W=e=>{if(e?.status!=="active")return!1;const r=e?.checkIns?.slice(-1)[0]?.date;return r?(Date.now()-new Date(r).getTime())/(1e3*60*60*24)>=7:!0},P=e=>{if(e.status==="completed")return!0;const r=e.goals||[];if(r.length>0&&r.every(i=>i.completed))return!0;const n=e.targetScore?.value;if(n!=null){const l=(e.checkIns||[]).filter(a=>a.value!=null).slice(-1)[0];if(l&&l.value>=n)return!0}return!1},re=(e=[])=>{const r=e.filter(f=>f.status==="active").length,n=e.filter(W).length,i=e.length||1,l=e.filter(P).length,a=Math.round(l/i*100);return[{...M[0],value:r},{...M[1],value:n},{...M[2],value:`${Number.isFinite(a)?a:0}%`}]},U={active:"On Track",paused:"Needs Attention",completed:"Completed",closed:"Closed"},b={active:4,paused:3,completed:2,closed:1},w={tier1:1,tier2:2,tier3:3},j=e=>{if(!e)return"Tier 2";const r=e.toString().toLowerCase();return r.includes("3")?"Tier 3":r.includes("1")?"Tier 1":"Tier 2"},A=e=>{if(!e)return null;const r=e.toString().toLowerCase();return r.includes("3")?"tier3":r.includes("2")?"tier2":r.includes("1")?"tier1":null},B=e=>e?.focusAreas?.length?e.focusAreas[0]:e?.tier==="tier3"?"Intensive Support":"Literacy & SEL",H=(e,r)=>{const n=[e?.metricLabel,e?.notes,e?.focusAreas?.join(" "),r?.type].filter(Boolean).join(" ").toLowerCase();return/attendance|present|absen/.test(n)?"%":/reading|fluency|literacy|wpm/.test(n)?"wpm":/math|numeracy|accuracy|score/.test(n)?"score":/behavior|sel|conduct|check-in|checkin/.test(n)?"pts":"score"},Y=(e,r)=>{if(!e)return"Ongoing";const n=new Date(e),i=r?new Date(r):new Date,l=Math.max(1,Math.round((i-n)/(1e3*60*60*24*7)));return`${l} wk${l>1?"s":""}`},q=e=>{const r=e?.checkIns?.slice(-1)[0]?.date||e?.startDate;if(!r)return"Awaiting update";const n=new Date(r);return n.setDate(n.getDate()+7),v(n)},J=(e={})=>{const r=e.checkIns||[];if(r.length){const a=r.length;return r.map((f,m)=>{const o=Math.round((m+1)/a*100),s=v(f.date);return{label:s,date:s,reading:o,goal:100,value:o}})}const n=e.goals||[];if(n.length){const a=n.length;let f=0;return n.map((m,o)=>{m.completed&&(f+=1);const s=Math.round(f/a*100),t=m.description||`Goal ${o+1}`;return{label:t,date:t,reading:s,goal:100,value:s}})}const i=e.status==="completed"?100:0,l=v(e.startDate);return[{label:l,date:l,reading:i,goal:100,value:i}]},V=(e={})=>(e.checkIns||[]).slice(-6).reverse().map(r=>({date:v(r.date,{month:"short",day:"numeric",year:"numeric"}),score:"-",notes:r.summary||r.nextSteps||"Check-in recorded"})),oe=(e=[],r="MTSS Mentor")=>{const n=new Map,i=new Map;e.forEach(o=>{const s=B(o),t=j(o.tier),u=A(o.tier)||"tier2",c=o.status||"active",d=q(o),g=J(o),C=V(o),y=o.goals||[],S=y.filter(p=>p.completed).length,k=o._id?.toString?.()||o.id||o.assignmentId||null;(o.studentIds||[]).forEach(p=>{const h=p?._id?.toString?.()||p?.id||p;if(!h)return;if(k){const x=i.get(h)||[];x.some(G=>G.assignmentId===k)||i.set(h,[...x,{assignmentId:k,focus:s,tier:t,tierCode:u,statusKey:c,statusLabel:U[c]||"On Track",metricLabel:o.metricLabel||null}])}const T=I(p?.currentGrade||p?.classes?.[0]?.grade||p?.unit||p?.class||"-"),$=H(o,p),z={id:h,assignmentId:k,slug:p?.slug||_(p?.name),name:p?.name||"Student",grade:T,type:s,tier:t,progress:U[c]||"On Track",nextUpdate:d,statusKey:c,profile:{teacher:r,mentor:o.mentorId?.name||r,type:s,strategy:o.focusAreas?.join(", ")||`Support focus - ${t}`,started:v(o.startDate),duration:Y(o.startDate,o.endDate),baseline:y.length?0:null,current:y.length?S:o.checkIns?.length||(c==="completed"?1:0),target:y.length||Math.max(o.checkIns?.length||1,1),progressUnit:$,chart:g,history:C}},L=n.get(h);(!L||b[c]>b[L.statusKey])&&n.set(h,z)})});const a=Array.from(n.values()).map(o=>{const t=[...i.get(o.id)||[]].sort((u,c)=>{const d=(w[c.tierCode]||0)-(w[u.tierCode]||0);return d!==0?d:(b[c.statusKey]||0)-(b[u.statusKey]||0)});return{...o,assignmentOptions:t}}).sort((o,s)=>b[s.statusKey]-b[o.statusKey]),f=a[0]?.profile?.chart||[],m=a[0]?`${a[0].tier} ${a[0].type}`:null;return{students:a.map(({statusKey:o,...s})=>s),spotlightChart:f,focusLabel:m}},ne=(e=[],r=[],n={allowedGrades:[]})=>{const i=new Map(r.map(t=>[t.id?.toString?.()||t.slug||t.name,t])),l=n.allowedGrades||[],a=n.allowedClasses||[],f=n.strictClassFilter,m=t=>{if(!l.length)return!0;const u=I(t);return l.some(c=>{const d=I(c);return u===d||u.startsWith(d)})},o=t=>{if(!f||!a.length)return!0;if(!t)return!1;const u=D(t);return a.some(c=>{const d=D(c);return u===d||u.endsWith(d)||u.endsWith(`- ${d}`)})},s=e.map(t=>{const u=t.id?.toString?.()||t._id?.toString?.()||t.slug||t.name,c=I(t.grade||t.currentGrade||t.className||"-"),d=D(t.className||t.currentGrade||t.unit);if(!m(c)||!o(d))return null;const g=i.get(u),C=A(t.tier||t.primaryIntervention?.tier||t.profile?.tier),y=A(g?.tier),S=w[C]||0,k=w[y]||0,h=g&&(!S||k>S)?g:t,T=g?.assignmentOptions||[];return{id:u,slug:t.slug||_(t.name),name:t.name,grade:c,className:d||t.className,type:h?.type||t.type||"Universal Supports",tier:h?.tier||t.tier||"Tier 1",progress:h?.progress||t.progress||"Not Assigned",nextUpdate:h?.nextUpdate||t.nextUpdate||"Not scheduled",assignmentId:g?.assignmentId||null,assignmentOptions:T,profile:h?.profile||g?.profile||t.profile,interventions:t.interventions,primaryIntervention:t.primaryIntervention}}).filter(Boolean);return!s.length&&r.length?r:s};export{ee as C,ne as a,re as b,F as c,te as g,oe as m,A as n};
