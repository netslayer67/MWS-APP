import{n as z,p as F,q as M,r,j as e,H as $,o as I,L as D,R as E,W as H,w as U}from"./index-BCPYO0q9.js";import{B as m}from"./button-CfOjSlLb.js";import{C as J,a as L}from"./card-D9OwlOO6.js";import{A as W}from"./AnimatedPage-CEsc5BvP.js";import{D as K}from"./KYCStatusBanner-DeiCvUJd.js";import{N as q}from"./NegotiationModal-CgA3zXPr.js";import{D as X}from"./DepositSheet-BiDVue7G.js";import{E as G}from"./EmptyState-BzZQqx54.js";import{A as Q}from"./arrow-left-I9hWcI9Y.js";import{U as V}from"./user-CR4sEOCX.js";import{C as O}from"./circle-check-DKenfb_p.js";import{C as Y}from"./circle-x-ID5G3qmD.js";import"./shield-check-CDnYePuH.js";import"./info-CrbfdH6x.js";import"./clock-B4oT_F4U.js";import"./arrow-right-DzTc_5tk.js";const Z=.32,_=[{id:"OFF-001",jobId:"JOB-2025-0901-01",jobTitle:"Antar paket kecil",worker:{name:"Rifqi H",rating:4.7,initials:"R"},message:"Siap ambil dalam 15 menit.",amount:25e3,time:"10 m lalu",status:"pending",payment:"cash"},{id:"OFF-002",jobId:"JOB-2025-0831-04",jobTitle:"Bantu pasang galon",worker:{name:"Sinta A",rating:4.9,initials:"S"},message:"Bisa sekarang, lokasi dekat.",amount:18e3,time:"25 m lalu",status:"pending",payment:"wallet"},{id:"OFF-003",jobId:"JOB-2025-0830-02",jobTitle:"Bersih-bersih kamar",worker:{name:"Ucup",rating:4.5,initials:"U"},message:"Perkiraan selesai 2 jam.",amount:65e3,time:"1 jam lalu",status:"accepted",payment:"wallet"}];function v({children:g,className:t=""}){return e.jsx("span",{className:`inline-flex items-center rounded-full px-2 py-0.5 text-[11px] font-medium ${t}`,children:g})}const ee=E.memo(function({offer:t,onAccept:l,onReject:k,onNegotiate:d}){const u=t.status==="accepted";return e.jsx(J,{className:"rounded-2xl border border-border/50 glass-strong hover-card",children:e.jsxs(L,{className:"p-3 sm:p-4",children:[e.jsx("div",{className:"flex items-start justify-between gap-3",children:e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[e.jsx("div",{className:"relative flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-gradient-to-br from-primary to-accent text-primary-foreground ring-1 ring-accent/30 shadow-sm",children:t.worker.initials}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:t.jobTitle}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[t.worker.name," • ★ ",t.worker.rating," • ",t.time]}),e.jsxs("div",{className:"mt-1 flex flex-wrap items-center gap-2",children:[e.jsxs(v,{className:"bg-secondary/30 text-foreground/80",children:[e.jsx(H,{className:"h-3.5 w-3.5 mr-1"}),t.payment==="cash"?"Tunai":"Wallet"]}),u?e.jsxs(v,{className:"bg-emerald-500/15 text-emerald-400 ring-1 ring-emerald-500/20",children:[e.jsx(O,{className:"h-3.5 w-3.5 mr-1"}),"Dipilih"]}):e.jsx(v,{className:"bg-primary/15 text-primary ring-1 ring-primary/25",children:"Tawar"})]})]})]})}),e.jsx("p",{className:"mt-2 text-sm text-foreground/90 leading-snug",children:t.message}),e.jsxs("div",{className:"mt-3 flex items-end justify-between gap-3",children:[e.jsx("div",{className:"text-sm font-bold text-foreground",children:U(t.amount)}),e.jsx("div",{className:"flex gap-2",children:u?e.jsx(m,{size:"sm",className:"rounded-xl bg-gradient-to-r from-primary to-accent text-primary-foreground px-3 py-1.5 text-xs",asChild:!0,children:e.jsx(D,{to:`/job/${t.jobId}/track`,children:"Lacak"})}):e.jsxs(e.Fragment,{children:[e.jsxs(m,{size:"sm",variant:"outline",className:"rounded-xl px-3 py-1.5 text-xs hover:text-accent hover:border-accent",onClick:()=>k(t.id),children:[e.jsx(Y,{className:"h-3.5 w-3.5 mr-1"})," Tolak"]}),e.jsx(m,{size:"sm",variant:"outline",className:"rounded-xl px-3 py-1.5 text-xs hover:text-accent hover:border-accent",onClick:()=>d(t),children:"Negosiasi"}),e.jsxs(m,{size:"sm",className:"rounded-xl bg-primary text-primary-foreground px-3 py-1.5 text-xs hover:bg-primary/90",onClick:()=>l(t.id),children:[e.jsx(O,{className:"h-3.5 w-3.5 mr-1"})," Pilih"]})]})})]})]})})});function je(){const g=z(),{toast:t}=F(),l=M(),[k,d]=r.useState(!1),[u,N]=r.useState({amount:0,jobId:null}),[c,h]=r.useState("all"),[p,j]=r.useState(_),[S,b]=r.useState(!1),[s,P]=r.useState(null),[y,w]=r.useState({}),f=r.useMemo(()=>c==="pending"?p.filter(a=>a.status==="pending"):c==="accepted"?p.filter(a=>a.status==="accepted"):p,[p,c]),T=r.useCallback(a=>{const n=p.find(i=>i.id===a);if(j(i=>i.map(x=>x.id===a?{...x,status:"accepted"}:x)),t({title:"Penawaran dipilih",description:"Pekerja akan segera memulai."}),!n)return;const o=()=>setTimeout(()=>l(`/job/${n.jobId}/track`),10);n.payment==="cash"&&(n.amount||0)>=3e5?(N({amount:n.amount,jobId:n.jobId}),d(!0)):n?.jobId&&o()},[p,t,l]),A=r.useCallback(a=>{j(n=>n.filter(o=>o.id!==a)),t({title:"Penawaran ditolak",description:"Penawaran dihapus dari daftar."})},[t]),R=r.useCallback(a=>{P(a),w(n=>({...n,[a.id]:n[a.id]||[]})),b(!0)},[]),B=r.useCallback((a,n)=>{s&&w(o=>{const i=o[s.id]||[],x={id:Date.now(),amount:Number(a),by:n,status:"pending",createdAt:Date.now()};return{...o,[s.id]:[x,...i]}})},[s]);r.useCallback(()=>{if(!s)return;const a=y[s.id]?.[0]?.amount??s.amount;j(o=>o.map(i=>i.id===s.id?{...i,status:"accepted",amount:a}:i)),b(!1),t({title:"Harga disepakati",description:"Penawaran diterima. Mulai proses."});const n=()=>s.jobId&&setTimeout(()=>l(`/job/${s.jobId}/track`),10);s.payment==="cash"&&(a||0)>=3e5?(N({amount:a,jobId:s.jobId}),d(!0)):n()},[s,y,t,l]);const C={hidden:{opacity:0,y:g?0:12},show:{opacity:1,y:0,transition:{duration:Z}}};return e.jsxs(W,{children:[e.jsx($,{children:e.jsx("title",{children:"Penawaran — Kerjain"})}),e.jsxs("div",{className:"relative mx-auto min-h-dvh w-full max-w-lg px-3 sm:px-4 py-4 sm:py-6",children:[e.jsxs(I.div,{variants:C,initial:"hidden",animate:"show",className:"mb-4 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(D,{to:-1,"aria-label":"Kembali",children:e.jsx(m,{variant:"ghost",size:"icon",className:"rounded-full bg-card/30 backdrop-blur-md hover:bg-card/50 transition-colors duration-300",children:e.jsx(Q,{className:"h-5 w-5 text-foreground"})})}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-base sm:text-lg font-semibold text-foreground",children:"Penawaran"}),e.jsx("p",{className:"text-[11px] sm:text-xs text-muted-foreground",children:"Kelola tawaran untuk pekerjaan Anda"})]})]}),e.jsxs("div",{className:"hidden sm:flex items-center gap-2",children:[e.jsx(m,{variant:"ghost",size:"sm",className:"rounded-full px-2 py-1 text-xs hover:bg-accent/10 hover:text-accent",onClick:()=>h("all"),"aria-pressed":c==="all",children:"Semua"}),e.jsx(m,{variant:"ghost",size:"sm",className:"rounded-full px-2 py-1 text-xs hover:bg-accent/10 hover:text-accent",onClick:()=>h("pending"),"aria-pressed":c==="pending",children:"Menunggu"}),e.jsx(m,{variant:"ghost",size:"sm",className:"rounded-full px-2 py-1 text-xs hover:bg-accent/10 hover:text-accent",onClick:()=>h("accepted"),"aria-pressed":c==="accepted",children:"Dipilih"})]})]}),e.jsx("div",{className:"sm:hidden mb-3 inline-flex w-full rounded-xl bg-card/40 p-1 backdrop-blur-xl ring-1 ring-border",children:[{key:"all",label:"Semua"},{key:"pending",label:"Menunggu"},{key:"accepted",label:"Dipilih"}].map(a=>e.jsx("button",{onClick:()=>h(a.key),"aria-pressed":c===a.key,className:`flex-1 rounded-lg px-3 py-1.5 text-xs font-medium transition-colors duration-300 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 ${c===a.key?"bg-accent text-accent-foreground":"text-muted-foreground hover:text-foreground hover:bg-card/60"}`,children:a.label},a.key))}),e.jsx(I.div,{variants:C,initial:"hidden",animate:"show",children:f.length===0?e.jsx("div",{className:"mt-8",children:e.jsx(G,{icon:e.jsx(V,{className:"h-6 w-6"}),title:"Belum ada penawaran",subtitle:"Penawaran akan muncul di sini."})}):e.jsx("div",{className:"space-y-3",children:f.map(a=>e.jsx(ee,{offer:a,onAccept:T,onReject:A,onNegotiate:R},a.id))})}),e.jsx("div",{className:"mt-4",children:e.jsx(K,{show:f.some(a=>a.payment==="cash"&&a.amount>=3e5),thresholdIDR:3e5,estimateIDR:f.find(a=>a.payment==="cash")?.amount||0,onDeposit:()=>t({title:"Deposit (demo)",description:"Jalankan alur deposit."})})}),s&&e.jsx(q,{isOpen:S,onClose:()=>b(!1),jobFee:s.amount,role:"client",initialOffers:y[s.id]||[],onSendOffer:a=>B(a,"client"),onAccept:a=>{j(o=>o.map(i=>i.id===s.id?{...i,status:"accepted",amount:a?.amount||i.amount}:i)),b(!1),t({title:"Harga disepakati",description:"Penawaran diterima. Mulai proses."});const n=a?.amount||s.amount;s.payment==="cash"&&(n||0)>=3e5?(N({amount:n,jobId:s.jobId}),d(!0)):s.jobId&&setTimeout(()=>l(`/job/${s.jobId}/track`),10)},onReject:()=>{}})]}),e.jsx(X,{open:k,onOpenChange:d,amount:u.amount,onWallet:()=>{d(!1),l("/wallet")},onContinue:()=>{d(!1),u.jobId&&l(`/job/${u.jobId}/track`)}})]})}export{je as default};
