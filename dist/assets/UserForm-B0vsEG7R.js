import{r as c,j as e,at as y,au as C,av as F,aw as E,U as f,m as L,ap as U,Q as T,B as D}from"./index-BeQwOtyQ.js";import{I as o}from"./input-DwpHeulS.js";import{L as i,M as _}from"./label-sGYZoAUB.js";import{S as m,a as h,b as j,c as x,d as r}from"./select-8ieQIdtG.js";import{S as A}from"./save-D1LHQOhS.js";import"./index-CZajb2CL.js";import"./chevron-down-B-g9NK3J.js";const H=c.memo(({user:t,onSubmit:g,onCancel:b})=>{const[a,u]=c.useState({name:"",email:"",username:"",role:"staff",department:"",unit:"",jobLevel:"",jobPosition:"",employmentStatus:"Permanent",joinDate:"",endDate:"",password:"",confirmPassword:""}),[l,w]=c.useState({}),[p,N]=c.useState(!1);c.useEffect(()=>{u(t?{name:t.name||"",email:t.email||"",username:t.username||"",role:t.role||"staff",department:t.department||"",unit:t.unit||"",jobLevel:t.jobLevel||"",jobPosition:t.jobPosition||"",employmentStatus:t.employmentStatus||"Permanent",joinDate:t.joinDate?new Date(t.joinDate).toISOString().split("T")[0]:"",endDate:t.endDate?new Date(t.endDate).toISOString().split("T")[0]:"",password:"",confirmPassword:""}:{name:"",email:"",username:"",role:"staff",department:"",unit:"",jobLevel:"",jobPosition:"",employmentStatus:"Permanent",joinDate:"",endDate:"",password:"",confirmPassword:""})},[t]);const n=(s,d)=>{u(v=>({...v,[s]:d})),l[s]&&w(v=>({...v,[s]:null}))},S=()=>{const s={};a.name.trim()||(s.name="Name is required"),a.email.trim()||(s.email="Email is required"),!t&&!a.password&&(s.password="Password is required"),!t&&a.password!==a.confirmPassword&&(s.confirmPassword="Passwords do not match");const d=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return a.email&&!d.test(a.email)&&(s.email="Invalid email format"),!t&&a.password&&a.password.length<6&&(s.password="Password must be at least 6 characters"),w(s),Object.keys(s).length===0},P=async s=>{if(s.preventDefault(),!!S()){N(!0);try{const d={...a,...t?{}:{password:a.password},password:void 0,confirmPassword:void 0,department:a.department==="not_specified"?null:a.department||null,unit:a.unit==="not_specified"?null:a.unit||null,jobLevel:a.jobLevel==="not_specified"?null:a.jobLevel||null,jobPosition:a.jobPosition||null,joinDate:a.joinDate||null,endDate:a.endDate||null,isActive:!0};t?await g(t._id||t.id,d):await g(d)}catch(d){console.error("Form submission error:",d)}finally{N(!1)}}};return e.jsx(y,{open:!0,onOpenChange:b,children:e.jsxs(C,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(F,{children:e.jsxs(E,{className:"flex items-center",children:[e.jsx(f,{className:"w-5 h-5 mr-2"}),t?"Edit User":"Add New User"]})}),e.jsxs(L.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"name",children:"Full Name *"}),e.jsx(o,{id:"name",value:a.name,onChange:s=>n("name",s.target.value),placeholder:"Enter full name",className:l.name?"border-destructive":""}),l.name&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.name})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"username",children:"Username"}),e.jsx(o,{id:"username",value:a.username,onChange:s=>n("username",s.target.value),placeholder:"Enter username"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(_,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(o,{id:"email",type:"email",value:a.email,onChange:s=>n("email",s.target.value),placeholder:"Enter email address",className:`pl-10 ${l.email?"border-destructive":""}`})]}),l.email&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.email})]}),!t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password *"}),e.jsx(o,{id:"password",type:"password",value:a.password,onChange:s=>n("password",s.target.value),placeholder:"Enter password",className:l.password?"border-destructive":""}),l.password&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.password})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"confirmPassword",children:"Confirm Password *"}),e.jsx(o,{id:"confirmPassword",type:"password",value:a.confirmPassword,onChange:s=>n("confirmPassword",s.target.value),placeholder:"Confirm password",className:l.confirmPassword?"border-destructive":""}),l.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.confirmPassword})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-2"}),"Role & Organization"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"role",children:"Role *"}),e.jsxs(m,{value:a.role,onValueChange:s=>n("role",s),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select role"})}),e.jsxs(x,{children:[e.jsx(r,{value:"student",children:"Student"}),e.jsx(r,{value:"support_staff",children:"Support Staff"}),e.jsx(r,{value:"staff",children:"Staff"}),e.jsx(r,{value:"teacher",children:"Teacher"}),e.jsx(r,{value:"se_teacher",children:"SE Teacher"}),e.jsx(r,{value:"head_unit",children:"Head Unit"}),e.jsx(r,{value:"admin",children:"Admin"}),e.jsx(r,{value:"directorate",children:"Directorate"}),e.jsx(r,{value:"superadmin",children:"Super Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"jobLevel",children:"Job Level"}),e.jsxs(m,{value:a.jobLevel,onValueChange:s=>n("jobLevel",s),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select job level"})}),e.jsxs(x,{children:[e.jsx(r,{value:"not_specified",children:"Not specified"}),e.jsx(r,{value:"Director",children:"Director"}),e.jsx(r,{value:"Head Unit",children:"Head Unit"}),e.jsx(r,{value:"Staff",children:"Staff"}),e.jsx(r,{value:"Teacher",children:"Teacher"}),e.jsx(r,{value:"SE Teacher",children:"SE Teacher"}),e.jsx(r,{value:"Support Staff",children:"Support Staff"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"department",children:"Department"}),e.jsxs(m,{value:a.department,onValueChange:s=>n("department",s),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select department"})}),e.jsxs(x,{children:[e.jsx(r,{value:"not_specified",children:"Not specified"}),e.jsx(r,{value:"Directorate",children:"Directorate"}),e.jsx(r,{value:"Elementary",children:"Elementary"}),e.jsx(r,{value:"Junior High",children:"Junior High"}),e.jsx(r,{value:"Kindergarten",children:"Kindergarten"}),e.jsx(r,{value:"Operational",children:"Operational"}),e.jsx(r,{value:"MAD Lab",children:"MAD Lab"}),e.jsx(r,{value:"Finance",children:"Finance"}),e.jsx(r,{value:"Pelangi",children:"Pelangi"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"unit",children:"Unit"}),e.jsxs(m,{value:a.unit,onValueChange:s=>n("unit",s),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select unit"})}),e.jsxs(x,{children:[e.jsx(r,{value:"not_specified",children:"Not specified"}),e.jsx(r,{value:"Directorate",children:"Directorate"}),e.jsx(r,{value:"Elementary",children:"Elementary"}),e.jsx(r,{value:"Junior High",children:"Junior High"}),e.jsx(r,{value:"Kindergarten",children:"Kindergarten"}),e.jsx(r,{value:"Operational",children:"Operational"}),e.jsx(r,{value:"MAD Lab",children:"MAD Lab"}),e.jsx(r,{value:"Finance",children:"Finance"}),e.jsx(r,{value:"Pelangi",children:"Pelangi"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"jobPosition",children:"Job Position"}),e.jsx(o,{id:"jobPosition",value:a.jobPosition,onChange:s=>n("jobPosition",s.target.value),placeholder:"Enter job position"})]}),(a.role==="teacher"||a.role==="se_teacher")&&e.jsxs("div",{className:"space-y-4 p-4 bg-blue/5 rounded-lg border border-blue/20",children:[e.jsxs("h4",{className:"font-medium text-blue-700 flex items-center",children:[e.jsx(GraduationCap,{className:"w-4 h-4 mr-2"}),"Teaching Assignments"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Teaching assignments can be managed after user creation through the user details modal."})]}),a.role==="head_unit"&&e.jsxs("div",{className:"space-y-4 p-4 bg-purple/5 rounded-lg border border-purple/20",children:[e.jsxs("h4",{className:"font-medium text-purple-700 flex items-center",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Department Leadership"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"As Head Unit, this user will oversee the selected department/unit and its members."}),a.department&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Department:"})," ",a.department,a.unit&&a.unit!==a.department&&e.jsxs("span",{children:[" | ",e.jsx("span",{className:"font-medium",children:"Unit:"})," ",a.unit]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(T,{className:"w-4 h-4 mr-2"}),"Employment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"employmentStatus",children:"Employment Status"}),e.jsxs(m,{value:a.employmentStatus,onValueChange:s=>n("employmentStatus",s),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select status"})}),e.jsxs(x,{children:[e.jsx(r,{value:"Permanent",children:"Permanent"}),e.jsx(r,{value:"Contract",children:"Contract"}),e.jsx(r,{value:"Probation",children:"Probation"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"joinDate",children:"Join Date"}),e.jsx(o,{id:"joinDate",type:"date",value:a.joinDate,onChange:s=>n("joinDate",s.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"endDate",children:"End Date"}),e.jsx(o,{id:"endDate",type:"date",value:a.endDate,onChange:s=>n("endDate",s.target.value)})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[e.jsx(D,{type:"button",variant:"outline",onClick:b,disabled:p,children:"Cancel"}),e.jsx(D,{type:"submit",disabled:p,className:"min-w-24",children:p?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),t?"Update User":"Create User"]})})]})]})]})})});H.displayName="UserForm";export{H as default};
