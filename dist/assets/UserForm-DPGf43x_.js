import{r as c,j as e,m as y,W as C}from"./index-By89xKr2.js";import{B as D}from"./button-CxFXEbtd.js";import{I as o}from"./input-MSmqLRGH.js";import{D as F,a as E,b as L,c as U,L as i,M as T}from"./dialog-DZIhk9tM.js";import{S as m,a as h,b as j,c as x,d as r}from"./select-Bxsj9Vap.js";import{U as f}from"./user-C8RE51YT.js";import{C as _}from"./calendar-BB_Xw2y-.js";import{S as A}from"./save-Di-wYj8u.js";import"./Combination-DVP7oUno.js";import"./chevron-down-Csr-J5s7.js";const H=c.memo(({user:t,onSubmit:g,onCancel:b})=>{const[s,u]=c.useState({name:"",email:"",username:"",role:"staff",department:"",unit:"",jobLevel:"",jobPosition:"",employmentStatus:"Permanent",joinDate:"",endDate:"",password:"",confirmPassword:""}),[l,w]=c.useState({}),[p,N]=c.useState(!1);c.useEffect(()=>{u(t?{name:t.name||"",email:t.email||"",username:t.username||"",role:t.role||"staff",department:t.department||"",unit:t.unit||"",jobLevel:t.jobLevel||"",jobPosition:t.jobPosition||"",employmentStatus:t.employmentStatus||"Permanent",joinDate:t.joinDate?new Date(t.joinDate).toISOString().split("T")[0]:"",endDate:t.endDate?new Date(t.endDate).toISOString().split("T")[0]:"",password:"",confirmPassword:""}:{name:"",email:"",username:"",role:"staff",department:"",unit:"",jobLevel:"",jobPosition:"",employmentStatus:"Permanent",joinDate:"",endDate:"",password:"",confirmPassword:""})},[t]);const n=(a,d)=>{u(v=>({...v,[a]:d})),l[a]&&w(v=>({...v,[a]:null}))},S=()=>{const a={};s.name.trim()||(a.name="Name is required"),s.email.trim()||(a.email="Email is required"),!t&&!s.password&&(a.password="Password is required"),!t&&s.password!==s.confirmPassword&&(a.confirmPassword="Passwords do not match");const d=/^[^\s@]+@[^\s@]+\.[^\s@]+$/;return s.email&&!d.test(s.email)&&(a.email="Invalid email format"),!t&&s.password&&s.password.length<6&&(a.password="Password must be at least 6 characters"),w(a),Object.keys(a).length===0},P=async a=>{if(a.preventDefault(),!!S()){N(!0);try{const d={...s,...t?{}:{password:s.password},password:void 0,confirmPassword:void 0,department:s.department==="not_specified"?null:s.department||null,unit:s.unit==="not_specified"?null:s.unit||null,jobLevel:s.jobLevel==="not_specified"?null:s.jobLevel||null,jobPosition:s.jobPosition||null,joinDate:s.joinDate||null,endDate:s.endDate||null,isActive:!0};t?await g(t._id||t.id,d):await g(d)}catch(d){console.error("Form submission error:",d)}finally{N(!1)}}};return e.jsx(F,{open:!0,onOpenChange:b,children:e.jsxs(E,{className:"max-w-2xl max-h-[90vh] overflow-y-auto",children:[e.jsx(L,{children:e.jsxs(U,{className:"flex items-center",children:[e.jsx(f,{className:"w-5 h-5 mr-2"}),t?"Edit User":"Add New User"]})}),e.jsxs(y.form,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Basic Information"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"name",children:"Full Name *"}),e.jsx(o,{id:"name",value:s.name,onChange:a=>n("name",a.target.value),placeholder:"Enter full name",className:l.name?"border-destructive":""}),l.name&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.name})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"username",children:"Username"}),e.jsx(o,{id:"username",value:s.username,onChange:a=>n("username",a.target.value),placeholder:"Enter username"})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"email",children:"Email Address *"}),e.jsxs("div",{className:"relative",children:[e.jsx(T,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground w-4 h-4"}),e.jsx(o,{id:"email",type:"email",value:s.email,onChange:a=>n("email",a.target.value),placeholder:"Enter email address",className:`pl-10 ${l.email?"border-destructive":""}`})]}),l.email&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.email})]}),!t&&e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"password",children:"Password *"}),e.jsx(o,{id:"password",type:"password",value:s.password,onChange:a=>n("password",a.target.value),placeholder:"Enter password",className:l.password?"border-destructive":""}),l.password&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.password})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"confirmPassword",children:"Confirm Password *"}),e.jsx(o,{id:"confirmPassword",type:"password",value:s.confirmPassword,onChange:a=>n("confirmPassword",a.target.value),placeholder:"Confirm password",className:l.confirmPassword?"border-destructive":""}),l.confirmPassword&&e.jsx("p",{className:"text-sm text-destructive mt-1",children:l.confirmPassword})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),"Role & Organization"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"role",children:"Role *"}),e.jsxs(m,{value:s.role,onValueChange:a=>n("role",a),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select role"})}),e.jsxs(x,{children:[e.jsx(r,{value:"student",children:"Student"}),e.jsx(r,{value:"support_staff",children:"Support Staff"}),e.jsx(r,{value:"staff",children:"Staff"}),e.jsx(r,{value:"teacher",children:"Teacher"}),e.jsx(r,{value:"se_teacher",children:"SE Teacher"}),e.jsx(r,{value:"head_unit",children:"Head Unit"}),e.jsx(r,{value:"admin",children:"Admin"}),e.jsx(r,{value:"directorate",children:"Directorate"}),e.jsx(r,{value:"superadmin",children:"Super Admin"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"jobLevel",children:"Job Level"}),e.jsxs(m,{value:s.jobLevel,onValueChange:a=>n("jobLevel",a),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select job level"})}),e.jsxs(x,{children:[e.jsx(r,{value:"not_specified",children:"Not specified"}),e.jsx(r,{value:"Director",children:"Director"}),e.jsx(r,{value:"Head Unit",children:"Head Unit"}),e.jsx(r,{value:"Staff",children:"Staff"}),e.jsx(r,{value:"Teacher",children:"Teacher"}),e.jsx(r,{value:"SE Teacher",children:"SE Teacher"}),e.jsx(r,{value:"Support Staff",children:"Support Staff"})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"department",children:"Department"}),e.jsxs(m,{value:s.department,onValueChange:a=>n("department",a),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select department"})}),e.jsxs(x,{children:[e.jsx(r,{value:"not_specified",children:"Not specified"}),e.jsx(r,{value:"Directorate",children:"Directorate"}),e.jsx(r,{value:"Elementary",children:"Elementary"}),e.jsx(r,{value:"Junior High",children:"Junior High"}),e.jsx(r,{value:"Kindergarten",children:"Kindergarten"}),e.jsx(r,{value:"Operational",children:"Operational"}),e.jsx(r,{value:"MAD Lab",children:"MAD Lab"}),e.jsx(r,{value:"Finance",children:"Finance"}),e.jsx(r,{value:"Pelangi",children:"Pelangi"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"unit",children:"Unit"}),e.jsxs(m,{value:s.unit,onValueChange:a=>n("unit",a),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select unit"})}),e.jsxs(x,{children:[e.jsx(r,{value:"not_specified",children:"Not specified"}),e.jsx(r,{value:"Directorate",children:"Directorate"}),e.jsx(r,{value:"Elementary",children:"Elementary"}),e.jsx(r,{value:"Junior High",children:"Junior High"}),e.jsx(r,{value:"Kindergarten",children:"Kindergarten"}),e.jsx(r,{value:"Operational",children:"Operational"}),e.jsx(r,{value:"MAD Lab",children:"MAD Lab"}),e.jsx(r,{value:"Finance",children:"Finance"}),e.jsx(r,{value:"Pelangi",children:"Pelangi"})]})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"jobPosition",children:"Job Position"}),e.jsx(o,{id:"jobPosition",value:s.jobPosition,onChange:a=>n("jobPosition",a.target.value),placeholder:"Enter job position"})]}),(s.role==="teacher"||s.role==="se_teacher")&&e.jsxs("div",{className:"space-y-4 p-4 bg-blue/5 rounded-lg border border-blue/20",children:[e.jsxs("h4",{className:"font-medium text-blue-700 flex items-center",children:[e.jsx(GraduationCap,{className:"w-4 h-4 mr-2"}),"Teaching Assignments"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Teaching assignments can be managed after user creation through the user details modal."})]}),s.role==="head_unit"&&e.jsxs("div",{className:"space-y-4 p-4 bg-purple/5 rounded-lg border border-purple/20",children:[e.jsxs("h4",{className:"font-medium text-purple-700 flex items-center",children:[e.jsx(f,{className:"w-4 h-4 mr-2"}),"Department Leadership"]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"As Head Unit, this user will oversee the selected department/unit and its members."}),s.department&&e.jsxs("div",{className:"text-sm",children:[e.jsx("span",{className:"font-medium",children:"Department:"})," ",s.department,s.unit&&s.unit!==s.department&&e.jsxs("span",{children:[" | ",e.jsx("span",{className:"font-medium",children:"Unit:"})," ",s.unit]})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold flex items-center",children:[e.jsx(_,{className:"w-4 h-4 mr-2"}),"Employment Details"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{children:[e.jsx(i,{htmlFor:"employmentStatus",children:"Employment Status"}),e.jsxs(m,{value:s.employmentStatus,onValueChange:a=>n("employmentStatus",a),children:[e.jsx(h,{children:e.jsx(j,{placeholder:"Select status"})}),e.jsxs(x,{children:[e.jsx(r,{value:"Permanent",children:"Permanent"}),e.jsx(r,{value:"Contract",children:"Contract"}),e.jsx(r,{value:"Probation",children:"Probation"})]})]})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"joinDate",children:"Join Date"}),e.jsx(o,{id:"joinDate",type:"date",value:s.joinDate,onChange:a=>n("joinDate",a.target.value)})]}),e.jsxs("div",{children:[e.jsx(i,{htmlFor:"endDate",children:"End Date"}),e.jsx(o,{id:"endDate",type:"date",value:s.endDate,onChange:a=>n("endDate",a.target.value)})]})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 border-t",children:[e.jsx(D,{type:"button",variant:"outline",onClick:b,disabled:p,children:"Cancel"}),e.jsx(D,{type:"submit",disabled:p,className:"min-w-24",children:p?e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2"}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(A,{className:"w-4 h-4 mr-2"}),t?"Update User":"Create User"]})})]})]})]})})});H.displayName="UserForm";export{H as default};
