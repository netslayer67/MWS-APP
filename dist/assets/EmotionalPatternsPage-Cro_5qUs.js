import{a as S,w as B,u as O,b as T,r as j,O as A,j as e,p as U,m as y,T as K,$ as W,V as z,H as G}from"./index-BmFq6O7m.js";import{C as N,a as $,b as D,c as k}from"./card-C4Odj77e.js";import{B as E}from"./badge-B7mK2m5N.js";import{s as C}from"./socketService-DK54WtJ1.js";const X=()=>{const I=S(),{userId:H}=B(),F=O(),{user:f}=T(n=>n.auth),{checkinHistory:h}=T(n=>n.checkin),m=H||f?.id,c=j.useMemo(()=>h?(Array.isArray(h)?h:h.data?.checkins||h.checkins||[]).filter(a=>a.userId===m||a.userId?._id===m):[],[h,m]);console.log("EmotionalPatternsPage Debug:",{currentUser:f?.id,targetUserId:m,checkinHistoryLength:h?.data?.checkins?.length||h?.length||0,userCheckinsLength:c.length,checkinHistoryKeys:h?Object.keys(h):[],firstCheckin:c[0]});const l=j.useMemo(()=>{if(c.length===0)return null;const n=c.reduce((s,t)=>(s[t.weatherType]=(s[t.weatherType]||0)+1,s),{}),a=Object.entries(n).sort(([,s],[,t])=>t-s).slice(0,5),o={};c.forEach(s=>{s.selectedMoods?.forEach(t=>{o[t]=(o[t]||0)+1})});const b=Object.entries(o).sort(([,s],[,t])=>t-s).slice(0,10),p=c.filter(s=>s.capacityLevel<5).length,r=c.filter(s=>s.presenceLevel<5).length,Y=c.filter(s=>s.capacityLevel>=8).length,P=c.filter(s=>s.presenceLevel>=8).length,g=c.slice(0,28),i=g.length>0?{presence:g.reduce((s,t)=>s+t.presenceLevel,0)/g.length,capacity:g.reduce((s,t)=>s+t.capacityLevel,0)/g.length}:null;return{weatherPatterns:a,moodPatterns:b,challenges:{lowCapacityDays:p,lowPresenceDays:r,highCapacityDays:Y,highPresenceDays:P},weeklyAvg:i,totalCheckins:c.length}},[c]),M=j.useMemo(()=>{if(!l)return null;const{challenges:n,weeklyAvg:a,totalCheckins:o,weatherPatterns:b,moodPatterns:p}=l;let r=[];if(o>0){const Y=f?.name||"You";if(r.push(`ðŸŽ¯ ${Y} has completed ${o} emotional check-in${o>1?"s":""} with remarkable consistency. This shows a strong commitment to mental health and self-awareness.`),a){const i=a.presence,s=a.capacity;let t="";i>=8?t=`Your mental presence is exceptional (${i.toFixed(1)}/10) - this shows very high focus and engagement with work and your surroundings.`:i>=6?t=`Your presence is stable (${i.toFixed(1)}/10) with room for improvement. Consider mindfulness techniques to enhance daily focus.`:i>=4?t=`Your presence is moderate (${i.toFixed(1)}/10). This may be related to workload or external factors.`:t=`Your presence needs special attention (${i.toFixed(1)}/10). Consider identifying and addressing the factors affecting it.`,r.push(`ðŸ§  ${t}`);let d="";s>=8?d=`Your energy capacity is very high (${s.toFixed(1)}/10) - this shows exceptional mental resilience and ability to handle challenges well.`:s>=6?d=`Your capacity is good (${s.toFixed(1)}/10) with a solid foundation for productivity.`:s>=4?d=`Your capacity is moderate (${s.toFixed(1)}/10). Consider energy management strategies like regular breaks and good nutrition.`:d=`Your energy capacity needs attention (${s.toFixed(1)}/10). This may indicate fatigue or need for additional support.`,r.push(`âš¡ ${d}`)}if(b&&b.length>0){const i=b[0][0],s=b[0][1]/o*100,t={sunny:`Your emotional weather is dominated by sunny days (${s.toFixed(1)}%), showing consistent optimism and positive energy.`,"light-rain":`You often experience light rain days (${s.toFixed(1)}%), which shows your ability to handle small challenges calmly.`,rainy:`Rainy weather appears quite often (${s.toFixed(1)}%), indicating periods of deep reflection and emotional processing.`,thunderstorms:`Emotional storms appear (${s.toFixed(1)}%), showing high emotional intensity and ability to navigate turbulence.`,windy:`Strong winds often occur (${s.toFixed(1)}%), indicating periods of instability that require grounding.`,snowy:`Snow covers your emotional landscape (${s.toFixed(1)}%), showing a need for warmth and support.`,foggy:`Emotional fog is quite thick (${s.toFixed(1)}%), indicating periods of uncertainty that require clarification.`,cloudy:`Clouds dominate (${s.toFixed(1)}%), showing stable but subdued moods.`};r.push(`ðŸŒ¤ï¸ ${t[i]||`Pola cuaca emosi Anda unik dengan dominasi ${i} (${s.toFixed(1)}%).`}`)}if(p&&p.length>0){const s=p.slice(0,3).map(([u,v])=>{const R=(v/o*100).toFixed(1);return`${u} (${R}%)`}).join(", ");r.push(`ðŸ˜Š Your mood patterns show a strong tendency towards: ${s}. This reflects your unique personality and emotional responses.`);const t=["happy","excited","hopeful","calm","grateful"],d=["anxious","tired","lonely","sad","angry"],x=p.filter(([u])=>t.includes(u)).reduce((u,[,v])=>u+v,0),L=p.filter(([u])=>d.includes(u)).reduce((u,[,v])=>u+v,0);x>L*1.5?r.push(`âœ¨ Deep analysis shows you have a strong positive tendency, with a positive emotions vs challenges ratio of ${(x/L).toFixed(1)}:1. This is a great strength!`):L>x*1.5?r.push("ðŸ” Your emotional patterns show significant periods of challenge. This is an opportunity for resilience development and personal growth."):r.push("âš–ï¸ Your emotional balance is quite good, with healthy variation between positive experiences and challenges. This shows mature emotional intelligence.")}const P=n.lowCapacityDays+n.lowPresenceDays,g=n.highCapacityDays+n.highPresenceDays;if(P>g?r.push(`ðŸ“Š Challenge analysis shows you experience more days with low performance (${P} vs ${g} high days). This may be related to sleep patterns, nutrition, or workload. Recommendation: Review your daily routine and consider consulting with mental health professionals.`):g>o*.6&&r.push(`ðŸ† Your emotional performance is outstanding! ${g} days with high capacity/presence from ${o} total check-ins shows exceptional mental resilience. Continue the practices that support your well-being.`),o>=7){const i=c.slice(0,7),s=i.reduce((d,x)=>d+x.presenceLevel,0)/i.length,t=i.reduce((d,x)=>d+x.capacityLevel,0)/i.length;s<a?.presence-1?r.push("ðŸ”® Prediction: Your presence has decreased in the last week. This may be an early signal for intervention - consider additional rest or relaxation techniques."):t>a?.capacity+1&&r.push("ðŸ“ˆ Positive trend detected! Your capacity is increasing. Analysis shows your practices are effective - continue!")}r.push(`ðŸ’¡ Personal Recommendation: Based on your unique patterns, focus on ${n.lowCapacityDays>n.lowPresenceDays?"energy management":"focus improvement"} to optimize your emotional performance.`),o>=14&&r.push(`ðŸŒ± Growth Insight: With ${o} check-ins, you have built a solid foundation for mental health. Continue this consistency to see more meaningful long-term patterns.`)}return r},[l,f?.name]);j.useEffect(()=>{if(f&&m){F(A({page:1,limit:50,userId:m})),C.connect(),C.joinPersonal(m);const n=a=>{console.log("Real-time personal check-in update:",a),F(A({page:1,limit:50,userId:m}))};return C.onPersonalNewCheckin(n),()=>{C.offPersonalNewCheckin(n),C.leavePersonal()}}},[F,f,m]);const q=j.useMemo(()=>({hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{staggerChildren:.1}}}),[]),w=j.useMemo(()=>({hidden:{opacity:0,y:6},show:{opacity:1,y:0,transition:{duration:.32}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsx(U,{children:e.jsx("title",{children:"Pola Emosi â€” Kerjain"})}),e.jsx(y.main,{initial:"hidden",animate:"show",variants:q,className:"relative min-h-dvh w-full px-4 pb-12 pt-6",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs(y.header,{variants:w,className:"mb-6 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>I(-1),"aria-label":"Kembali",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border bg-card/40 backdrop-blur-md hover:bg-accent/8 transition-colors duration-300",children:e.jsx(K,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Emotional Patterns"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Insights & patterns"})]})]}),l?e.jsxs(e.Fragment,{children:[e.jsx(y.section,{variants:w,children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx($,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(W,{className:"w-5 h-5"}),"Emotional Weather Patterns"]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:l.weatherPatterns.map(([n,a])=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(E,{variant:"outline",className:"text-foreground border-foreground/30",children:n}),e.jsxs("span",{className:"text-sm text-foreground/80",children:[(a/l.totalCheckins*100).toFixed(1),"% of total"]})]}),e.jsxs("span",{className:"text-sm font-medium text-foreground",children:[a," kali"]})]},n))})})]})}),e.jsx(y.section,{variants:w,className:"mt-6",children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx($,{children:e.jsx(D,{children:"Mood Patterns"})}),e.jsx(k,{children:e.jsx("div",{className:"flex flex-wrap gap-2",children:l.moodPatterns.map(([n,a])=>e.jsxs(E,{variant:"secondary",className:"text-sm text-foreground bg-secondary/80 border-secondary-foreground/30",children:[n," (",a,")"]},n))})})]})}),e.jsx(y.section,{variants:w,className:"mt-6",children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx($,{children:e.jsx(D,{children:"Challenge Patterns"})}),e.jsx(k,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-red-50 dark:bg-red-950/30 rounded-lg border border-red-200 dark:border-red-800/30",children:[e.jsx("div",{className:"text-xl font-bold text-red-700 dark:text-red-400",children:l.challenges.lowCapacityDays}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Low Capacity Days"})]}),e.jsxs("div",{className:"text-center p-3 bg-orange-50 dark:bg-orange-950/30 rounded-lg border border-orange-200 dark:border-orange-800/30",children:[e.jsx("div",{className:"text-xl font-bold text-orange-700 dark:text-orange-400",children:l.challenges.lowPresenceDays}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Low Presence Days"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 dark:bg-green-950/30 rounded-lg border border-green-200 dark:border-green-800/30",children:[e.jsx("div",{className:"text-xl font-bold text-green-700 dark:text-green-400",children:l.challenges.highCapacityDays}),e.jsx("div",{className:"text-xs text-foreground/70",children:"High Capacity Days"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 dark:bg-blue-950/30 rounded-lg border border-blue-200 dark:border-blue-800/30",children:[e.jsx("div",{className:"text-xl font-bold text-blue-700 dark:text-blue-400",children:l.challenges.highPresenceDays}),e.jsx("div",{className:"text-xs text-foreground/70",children:"High Presence Days"})]})]})})]})}),e.jsx(y.section,{variants:w,className:"mt-6",children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx($,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(z,{className:"w-5 h-5"}),"AI Insights"]})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-3",children:M.map((n,a)=>e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full mt-2 flex-shrink-0"}),e.jsx("p",{className:"text-sm text-foreground/80",children:n})]},a))})})]})})]}):e.jsx(y.section,{variants:w,children:e.jsx(N,{className:"glass glass-card",children:e.jsxs(k,{className:"text-center py-12",children:[e.jsx(G,{className:"w-16 h-16 mx-auto mb-4 text-foreground/30"}),e.jsx("h3",{className:"text-lg font-medium mb-2 text-foreground",children:"Belum Ada Data Pola"}),e.jsx("p",{className:"text-foreground/70 text-sm",children:"You haven't completed enough emotional check-ins to analyze patterns. Perform regular check-ins to see insights into your emotional patterns."})]})})})]})})]})};export{X as default};
