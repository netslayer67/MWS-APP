import{b,N as w,a as C,d as j,r as l,a2 as y,j as e,z as k,m,F as H,a4 as L}from"./index-C4XCgjPq.js";import{C as u,a as g,b as P,c as M}from"./card-VjJJTKbJ.js";import{B as f}from"./badge-BVe2bCoF.js";import{s as d}from"./socketService-B4WowktR.js";import{n as c}from"./id-BI_6IGNA.js";import{M as D}from"./message-circle-CtGw0AxY.js";const U=()=>{const N=b(),{userId:p}=w(),x=C(),{user:n}=j(s=>s.auth),{checkinHistory:t}=j(s=>s.checkin),r=l.useMemo(()=>c(p)||c(n)||c(n?.id)||c(n?._id),[p,n]),o=l.useMemo(()=>!t||!r?[]:(Array.isArray(t)?t:t.data?.checkins||t.checkins||[]).filter(a=>c(a.userId)===r),[t,r]);console.log("EmotionalHistoryPage Debug:",{currentUser:c(n),targetUserId:r,checkinHistoryLength:t?.data?.checkins?.length||t?.length||0,userCheckinsLength:o.length,checkinHistoryKeys:t?Object.keys(t):[],firstCheckin:o[0]});const i=l.useMemo(()=>o.filter(s=>s.details).map(s=>({id:s._id,date:new Date(s.date).toLocaleDateString("id-ID",{weekday:"long",year:"numeric",month:"long",day:"numeric"}),time:new Date(s.date).toLocaleTimeString("id-ID",{hour:"2-digit",minute:"2-digit"}),details:s.details,weatherType:s.weatherType,moods:s.selectedMoods||[],presenceLevel:s.presenceLevel,capacityLevel:s.capacityLevel})).sort((s,a)=>new Date(a.date)-new Date(s.date)),[o]);l.useEffect(()=>{if(n&&r){x(y({page:1,limit:50,userId:r})),d.connect(),d.joinPersonal(r);const s=a=>{console.log("Real-time personal check-in update:",a),x(y({page:1,limit:50,userId:r}))};return d.onPersonalNewCheckin(s),()=>{d.offPersonalNewCheckin(s),d.leavePersonal()}}},[x,n,r]);const v=l.useMemo(()=>({hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{staggerChildren:.05}}}),[]),h=l.useMemo(()=>({hidden:{opacity:0,y:6},show:{opacity:1,y:0,transition:{duration:.32}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsx(k,{children:e.jsx("title",{children:"Emotional History â€” MWS APP"})}),e.jsx(m.main,{initial:"hidden",animate:"show",variants:v,className:"relative min-h-dvh w-full px-4 pb-12 pt-6",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs(m.header,{variants:h,className:"mb-6 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>N(-1),"aria-label":"Go back",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border bg-card/40 backdrop-blur-md hover:bg-accent/8 transition-colors duration-300",children:e.jsx(H,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Emotional History"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Reflection & thoughts"})]})]}),e.jsx(m.section,{variants:h,children:i.length>0?e.jsx("div",{className:"space-y-4",children:i.map(s=>e.jsx(u,{className:"glass glass-card",children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(L,{className:"w-4 h-4 text-muted-foreground"}),e.jsx("span",{className:"text-sm font-medium text-foreground",children:s.date}),e.jsx("span",{className:"text-xs text-muted-foreground",children:s.time})]}),e.jsx(f,{variant:"outline",className:"text-xs",children:s.weatherType})]}),e.jsx("div",{className:"bg-secondary/20 rounded-lg p-3",children:e.jsx("p",{className:"text-sm text-foreground leading-relaxed",children:s.details})}),s.moods.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1",children:s.moods.map(a=>e.jsx(f,{variant:"secondary",className:"text-xs",children:a},a))}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-foreground/70 pt-2 border-t border-border/50",children:[e.jsxs("span",{children:["Presence: ",s.presenceLevel,"/10"]}),e.jsxs("span",{children:["Capacity: ",s.capacityLevel,"/10"]})]})]})})},s.id))}):e.jsx(u,{className:"glass glass-card",children:e.jsxs(g,{className:"text-center py-12",children:[e.jsx(D,{className:"w-16 h-16 mx-auto mb-4 text-muted-foreground/50"}),e.jsx("h3",{className:"text-lg font-medium mb-2 text-foreground",children:"No History Yet"}),e.jsx("p",{className:"text-foreground/70 text-sm",children:"You haven't completed any emotional check-ins or added reflections yet. Start with daily check-ins to see your history here."})]})})}),i.length>0&&e.jsx(m.section,{variants:h,className:"mt-6",children:e.jsxs(u,{className:"glass glass-card",children:[e.jsx(P,{children:e.jsx(M,{children:"History Summary"})}),e.jsx(g,{children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:i.length}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Total Reflections"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:Math.round(i.reduce((s,a)=>s+a.presenceLevel,0)/i.length*10)/10}),e.jsx("div",{className:"text-xs text-foreground/70",children:"Average Presence"})]})]})})]})})]})})]})};export{U as default};
