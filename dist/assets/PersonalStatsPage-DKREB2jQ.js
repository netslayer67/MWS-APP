import{a as L,w as D,u as H,b as v,r as d,O as p,j as e,p as I,m as x,T as E,V as f}from"./index-BmFq6O7m.js";import{C as N,a as y,b,c as k}from"./card-C4Odj77e.js";import{B as C}from"./badge-B7mK2m5N.js";import{P as w}from"./progress-BT_WPLCg.js";import{s as o}from"./socketService-DK54WtJ1.js";const R=()=>{const P=L(),{userId:M}=D(),g=H(),{user:m}=v(s=>s.auth),{checkinHistory:n}=v(s=>s.checkin),r=M||m?.id,c=d.useMemo(()=>n?(Array.isArray(n)?n:n.data?.checkins||n.checkins||[]).filter(a=>a.userId===r||a.userId?._id===r):[],[n,r]);console.log("PersonalStatsPage Debug:",{currentUser:m?.id,targetUserId:r,checkinHistoryLength:n?.data?.checkins?.length||n?.length||0,userCheckinsLength:c.length,checkinHistoryKeys:n?Object.keys(n):[],firstCheckin:c[0]});const t=d.useMemo(()=>{if(c.length===0)return null;const s=c.slice(0,7),a=s.reduce((l,i)=>l+i.presenceLevel,0)/s.length,h=s.reduce((l,i)=>l+i.capacityLevel,0)/s.length,j={};s.forEach(l=>{l.selectedMoods?.forEach(i=>{j[i]=(j[i]||0)+1})});const A=Object.entries(j).sort(([,l],[,i])=>i-l).slice(0,3);return{avgPresence:Math.round(a*10)/10,avgCapacity:Math.round(h*10)/10,topMoods:A,checkinCount:s.length,trend:a>6?"improving":a<4?"concerning":"stable"}},[c]);d.useEffect(()=>{if(m&&r){g(p({page:1,limit:50,userId:r})),o.connect(),o.joinPersonal(r);const s=a=>{console.log("Real-time personal check-in update:",a),g(p({page:1,limit:50,userId:r}))};return o.onPersonalNewCheckin(s),()=>{o.offPersonalNewCheckin(s),o.leavePersonal()}}},[g,m,r]);const S=d.useMemo(()=>({hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{staggerChildren:.1}}}),[]),u=d.useMemo(()=>({hidden:{opacity:0,y:6},show:{opacity:1,y:0,transition:{duration:.32}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsx("title",{children:"Personal Stats â€” MWS APP"})}),e.jsx(x.main,{initial:"hidden",animate:"show",variants:S,className:"relative min-h-dvh w-full px-4 pb-12 pt-6",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs(x.header,{variants:u,className:"mb-6 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>P(-1),"aria-label":"Go back",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border bg-card/40 backdrop-blur-md hover:bg-accent/8 transition-colors duration-300",children:e.jsx(E,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Personal Stats"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Summary of your emotional wellness"})]})]}),e.jsx(x.section,{variants:u,children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx(y,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(f,{className:"w-5 h-5"}),"My Stats"]})}),e.jsxs(k,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:c.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"20 check-ins"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:t?.avgPresence||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Presence (7d)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:t?.avgCapacity||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Capacity (7d)"})]})]}),t&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(f,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Weekly Trends:"}),e.jsx(C,{variant:t.trend==="improving"?"default":t.trend==="concerning"?"destructive":"secondary",children:t.trend==="improving"?"Improving":t.trend==="concerning"?"Needs Attention":"Stable"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Presence Level"}),e.jsxs("span",{children:[t.avgPresence,"/10"]})]}),e.jsx(w,{value:t.avgPresence*10,className:"h-3"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Capacity Level"}),e.jsxs("span",{children:[t.avgCapacity,"/10"]})]}),e.jsx(w,{value:t.avgCapacity*10,className:"h-3"})]})]}),t.topMoods.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("span",{className:"font-medium text-sm",children:"Most Common Moods (7 days):"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:t.topMoods.map(([s,a])=>e.jsxs(C,{variant:"outline",className:"text-sm",children:[s," (",a,")"]},s))})]})]})]})]})}),e.jsx(x.section,{variants:u,className:"mt-6",children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx(y,{children:e.jsx(b,{children:"Monthly Summary"})}),e.jsx(k,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-secondary/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:c.filter(s=>{const a=new Date(s.date),h=new Date;return a.getMonth()===h.getMonth()&&a.getFullYear()===h.getFullYear()}).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Check-ins This Month"})]}),e.jsxs("div",{className:"text-center p-4 bg-secondary/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>s.presenceLevel>=7).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"High Presence Days"})]})]})})})]})})]})})]})};export{R as default};
