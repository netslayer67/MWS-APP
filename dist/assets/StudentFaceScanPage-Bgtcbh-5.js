import{r as i,j as e,w as H,A as z,m as $,n as E,b as L,e as Y,a as U,d as P,o as q,H as K,p as V}from"./index-D2rZlo4J.js";import{A as _}from"./AnimatedPage-HlQBp-G1.js";import{C as O,E as B,M as Q,H as W,U as X,R as G,c as I,u as J,a as Z,b as ee,I as te,S as re,A as se}from"./useCheckinSubmission-DHLsco5U.js";import{S as ae}from"./StudentSupportSelector-C9FaELyn.js";import{C as oe}from"./circle-alert-B-8sHbjZ.js";import{A as ne}from"./arrow-up-right-BBTwd8OE.js";import"./brain-DBN6rPTE.js";import"./camera-DHu_mxui.js";import"./eye-_f8Do5l9.js";import"./zap-krYSk9az.js";import"./graduation-cap-B0k_5Gxt.js";import"./circle-check-DcTRw1UX.js";const M={happy:{hero:"from-amber-400 via-yellow-300 to-orange-400",card:"from-amber-50 to-orange-50 dark:from-amber-900/20 dark:to-orange-900/20",accent:"text-amber-600 dark:text-amber-400",border:"border-amber-200 dark:border-amber-700/40"},calm:{hero:"from-emerald-400 via-teal-300 to-cyan-400",card:"from-emerald-50 to-cyan-50 dark:from-emerald-900/20 dark:to-cyan-900/20",accent:"text-emerald-600 dark:text-emerald-400",border:"border-emerald-200 dark:border-emerald-700/40"},sad:{hero:"from-blue-400 via-indigo-400 to-sky-500",card:"from-blue-50 to-indigo-50 dark:from-blue-900/20 dark:to-indigo-900/20",accent:"text-blue-600 dark:text-blue-400",border:"border-blue-200 dark:border-blue-700/40"},anxious:{hero:"from-purple-400 via-violet-400 to-indigo-500",card:"from-purple-50 to-violet-50 dark:from-purple-900/20 dark:to-violet-900/20",accent:"text-purple-600 dark:text-purple-400",border:"border-purple-200 dark:border-purple-700/40"},angry:{hero:"from-red-400 via-rose-400 to-pink-500",card:"from-red-50 to-rose-50 dark:from-red-900/20 dark:to-rose-900/20",accent:"text-red-600 dark:text-red-400",border:"border-red-200 dark:border-red-700/40"},neutral:{hero:"from-slate-400 via-gray-400 to-zinc-500",card:"from-slate-50 to-gray-50 dark:from-slate-900/20 dark:to-gray-900/20",accent:"text-slate-600 dark:text-slate-400",border:"border-slate-200 dark:border-slate-700/40"},default:{hero:"from-violet-400 via-purple-400 to-pink-500",card:"from-violet-50 to-pink-50 dark:from-violet-900/20 dark:to-pink-900/20",accent:"text-violet-600 dark:text-violet-400",border:"border-violet-200 dark:border-violet-700/40"}},ie=t=>{const r=(t?.detectedEmotion||"").toLowerCase();return r.includes("happ")||r.includes("joy")||r.includes("genuine")?"happy":r.includes("calm")||r.includes("peace")||r.includes("serene")?"calm":r.includes("sad")||r.includes("depress")||r.includes("suppress")?"sad":r.includes("anxi")||r.includes("stress")||r.includes("worried")?"anxious":r.includes("anger")||r.includes("angry")||r.includes("frustrat")?"angry":r.includes("neutral")||r.includes("focused")?"neutral":"default"},le=t=>({presenceScore:t?.presenceCapacity?.estimatedPresence||7,capacityScore:t?.presenceCapacity?.estimatedCapacity||7,overallReadiness:Math.round(((t?.presenceCapacity?.estimatedPresence||7)+(t?.presenceCapacity?.estimatedCapacity||7))/2*10),readinessLane:"steady",signals:[]}),F=i.memo(({analysis:t,onReset:r,onComplete:f,onSupportChange:u,isRescanDisabled:c=!1,remainingRescans:p=0,maxRescans:o=2})=>{const[h,S]=i.useState(!1),[C,j]=i.useState(!1),R=c?"Rescan quota exhausted.":`Remaining rescans: ${p}/${o}`,l=t?.readinessMatrix||le(t),w=ie(t),s=M[w]||M.default,b=t?.emotionalStoryline||{title:t?.detectedEmotion||"Mindful Awareness",chapter:t?.internalWeather||"Balanced Skies",narrative:t?.psychologicalInsight||"You're doing great! Keep checking in with yourself."},m=t?.psychologicalInsight||b.narrative,g=t?.icon,k=t?.confidence??70,A=t?.insightChips||[],x=(t?.detailedRecommendations||[]).slice(0,3);return e.jsxs("section",{className:"w-full max-w-[1600px] mx-auto px-3 sm:px-6 lg:px-8 py-4 sm:py-8 space-y-4 sm:space-y-6",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 sm:gap-5 items-start",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center sm:items-start gap-3 sm:gap-4 flex-1 w-full",children:[e.jsx("div",{className:`w-16 h-16 sm:w-20 sm:h-20 rounded-2xl bg-gradient-to-br ${s.hero} flex items-center justify-center shadow-xl`,children:g?e.jsx("span",{className:"text-3xl sm:text-5xl",children:g}):e.jsx(O,{className:"w-8 h-8 sm:w-10 sm:h-10 text-white"})}),e.jsxs("div",{className:"flex-1 text-center sm:text-left w-full",children:[e.jsxs("p",{className:`text-xs font-semibold ${s.accent} mb-1 flex items-center justify-center sm:justify-start gap-2`,children:[e.jsx("span",{className:"w-1.5 h-1.5 rounded-full bg-current"}),b.chapter]}),e.jsx("h1",{className:"text-2xl sm:text-3xl lg:text-4xl font-black text-foreground mb-2",children:b.title}),e.jsx("p",{className:"text-sm sm:text-base text-foreground/70 font-medium mb-3 leading-relaxed",children:m}),e.jsxs("div",{className:"flex flex-wrap gap-1.5 justify-center sm:justify-start",children:[e.jsxs("span",{className:`px-2.5 py-1 text-xs font-bold rounded-full bg-gradient-to-r ${s.card} ${s.accent} ${s.border} border`,children:[k,"% Confidence"]}),A.slice(0,3).map((a,d)=>e.jsx("span",{className:"px-2.5 py-1 text-xs font-bold rounded-full bg-gray-100 dark:bg-gray-800 text-gray-600 dark:text-gray-300 border border-gray-200 dark:border-gray-700",children:a.label},`${a.label}-${d}`))]})]})]}),e.jsxs("div",{className:`w-full lg:w-56 bg-gradient-to-br ${s.hero} rounded-2xl p-4 sm:p-5 text-white shadow-xl`,children:[e.jsx("p",{className:"text-xs font-semibold opacity-90 mb-1",children:"Overall Readiness"}),e.jsxs("p",{className:"text-4xl sm:text-5xl font-black mb-1",children:[l.overallReadiness,"%"]}),e.jsxs("p",{className:"text-xs opacity-85 leading-snug capitalize",children:[l.readinessLane," mode"]})]})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-2 sm:gap-3",children:[e.jsxs("div",{className:`backdrop-blur-xl bg-gradient-to-br ${s.card} border ${s.border} rounded-xl p-3 sm:p-4`,children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-1",children:"Presence"}),e.jsxs("p",{className:"text-xl sm:text-2xl font-black text-foreground",children:[l.presenceScore,"/10"]})]}),e.jsxs("div",{className:`backdrop-blur-xl bg-gradient-to-br ${s.card} border ${s.border} rounded-xl p-3 sm:p-4`,children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-1",children:"Capacity"}),e.jsxs("p",{className:"text-xl sm:text-2xl font-black text-foreground",children:[l.capacityScore,"/10"]})]}),e.jsxs("div",{className:`backdrop-blur-xl bg-gradient-to-br ${s.card} border ${s.border} rounded-xl p-3 sm:p-4`,children:[e.jsx("p",{className:"text-[10px] font-bold text-muted-foreground uppercase tracking-wider mb-1",children:"Lane"}),e.jsx("p",{className:"text-xl sm:text-2xl font-black text-foreground capitalize",children:l.readinessLane})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(B,{emotions:t?.selfreportedEmotions||[]}),e.jsx(Q,{expressions:t?.microExpressions||[]})]}),x.length>0&&e.jsxs("div",{className:`backdrop-blur-xl bg-gradient-to-br ${s.card} border ${s.border} rounded-2xl p-4 sm:p-5`,children:[e.jsxs("div",{className:"flex items-center gap-2 mb-3",children:[e.jsx(H,{className:`w-4 h-4 ${s.accent}`}),e.jsx("h3",{className:"text-sm font-bold text-foreground",children:"Tips For You"})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 sm:gap-3",children:x.map((a,d)=>e.jsxs("div",{className:"bg-white/60 dark:bg-white/5 border border-white/50 dark:border-white/10 rounded-xl p-3",children:[e.jsx("p",{className:"text-xs font-bold text-foreground mb-1",children:a.title}),e.jsx("p",{className:"text-[11px] text-muted-foreground leading-relaxed",children:a.description})]},d))})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(W,{className:`w-5 h-5 ${s.accent}`}),e.jsx("h2",{className:"text-lg sm:text-xl font-bold text-foreground",children:"Support & Reflection"})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-4",children:[e.jsx(ae,{supportContact:t?.selectedSupportContact||"",onSupportChange:a=>u?.(a)}),e.jsx(X,{onReflectionChange:a=>{t&&(t.userReflection=a)},onValidationChange:S})]})]}),e.jsx(z,{children:C&&!h&&e.jsx($.div,{initial:{opacity:0,y:-15,scale:.97},animate:{opacity:1,y:0,scale:1},exit:{opacity:0,y:-15,scale:.97},transition:{duration:.25},className:"bg-gradient-to-br from-amber-50 via-orange-50 to-rose-50 dark:from-amber-900/30 dark:via-orange-900/30 dark:to-rose-900/30 border-2 border-amber-300 dark:border-amber-600 rounded-2xl p-4 shadow-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"flex-shrink-0 w-9 h-9 rounded-xl bg-gradient-to-br from-amber-300 to-orange-300 dark:from-amber-700 dark:to-orange-700 flex items-center justify-center",children:e.jsx(oe,{className:"w-4 h-4 text-amber-700 dark:text-amber-200"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-bold text-amber-800 dark:text-amber-200 mb-0.5",children:"Don't forget to share your thoughts!"}),e.jsx("p",{className:"text-xs text-amber-700 dark:text-amber-300 leading-relaxed",children:"Your reflection helps us understand your experience better. Please take a moment to share what triggered this feeling."})]})]})})}),e.jsxs("div",{className:`bg-gradient-to-br ${s.hero} rounded-2xl p-5 sm:p-7 text-white shadow-xl`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold opacity-90 mb-0.5",children:"ACTION CENTER"}),e.jsx("h2",{className:"text-xl sm:text-2xl font-black",children:"Finalize Session"})]}),e.jsx(ne,{className:"w-6 h-6 opacity-50"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 mb-3",children:[e.jsx("button",{onClick:c?void 0:r,disabled:c,className:E("py-3.5 sm:py-4 rounded-xl text-sm font-bold transition-all duration-300",c?"cursor-not-allowed opacity-40 bg-white/20 text-white/50":"bg-white/20 hover:bg-white/30 text-white backdrop-blur-sm border border-white/30 active:scale-95"),children:e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Scan Again"})]})}),e.jsx("button",{onClick:()=>{if(!h){j(!0),setTimeout(()=>j(!1),5e3);return}const a=3e3,d=Date.now()+a,v={startVelocity:30,spread:360,ticks:60,zIndex:9999},N=(n,D)=>Math.random()*(D-n)+n,y=setInterval(()=>{if(Date.now()>d)return clearInterval(y);const n=50*((d-Date.now())/a);I({...v,particleCount:n,origin:{x:N(.1,.3),y:Math.random()-.2}}),I({...v,particleCount:n,origin:{x:N(.7,.9),y:Math.random()-.2}})},250);t&&(t.isSubmitting=!0),setTimeout(()=>f(),500)},disabled:t?.isSubmitting,className:E("py-3.5 sm:py-4 rounded-xl text-sm font-bold transition-all duration-300",t?.isSubmitting?"bg-white/40 cursor-wait":h?"bg-white text-gray-800 hover:bg-white/95 active:scale-95":"bg-white/50 text-white/70 cursor-not-allowed"),children:t?.isSubmitting?e.jsxs("div",{className:"flex items-center justify-center gap-2",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-600/30 border-t-gray-600 rounded-full animate-spin"}),e.jsx("span",{children:"Processing..."})]}):e.jsx("span",{children:"Complete Session"})})]}),e.jsx("p",{className:"text-xs text-center text-white/70",children:R})]})]})});F.displayName="StudentResultsSection";const T=2,de=i.memo(()=>{const t=L(),{toast:r}=Y(),f=U(),{contacts:u}=P(n=>n.support),{isAuthenticated:c}=P(n=>n.auth),p=i.useRef(!1),{stage:o,setStage:h,videoRef:S,scanProgress:C,detectedFeatures:j,startScan:R,capturePhoto:l,handleRescanRequest:w,isRescanDisabled:s,remainingRescans:b}=J({toast:r,maxRescanAttempts:T}),{analysis:m,setAnalysis:g,analyzePhoto:k,selectedSupportContact:A,setSelectedSupportContact:x}=Z({toast:r,setStage:h}),{isSubmitting:a,completeCheckin:d}=ee({analysis:m,selectedSupportContact:A,supportContacts:u,toast:r,navigate:t}),v=i.useCallback(async()=>{const n=await l();n&&await k(n)},[k,l]),N=i.useCallback(()=>{g(null),x(null),w()},[w,g,x]);i.useEffect(()=>{u.length===0&&c&&f(q())},[f,c,u.length]),i.useEffect(()=>{o==="results"&&m&&s&&!p.current&&(p.current=!0,r({title:"Rescan Quota Exhausted",description:"You have used all AI rescan quota (2x). Please proceed with check-in or save this analysis result.",variant:"destructive"})),s||(p.current=!1)},[m,s,o,r]);const y=m?{...m,isSubmitting:a}:null;return e.jsxs(_,{children:[e.jsx(K,{children:e.jsx("title",{children:"AI Emotional Check-in - Student"})}),e.jsxs("div",{className:"relative min-h-screen bg-background text-foreground overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none overflow-hidden",children:[e.jsx("div",{className:"absolute -top-32 -left-32 w-80 h-80 bg-gradient-to-br from-pink-300/25 to-purple-300/25 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute -bottom-32 -right-32 w-80 h-80 bg-gradient-to-br from-sky-300/25 to-indigo-300/25 rounded-full blur-3xl"}),e.jsx("div",{className:"absolute top-1/3 left-1/2 w-64 h-64 bg-gradient-to-br from-amber-200/20 to-emerald-200/20 rounded-full blur-3xl"})]}),e.jsx("div",{className:"relative z-10 flex min-h-screen items-center justify-center p-4 sm:p-6 lg:p-8",children:e.jsxs($.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.4,ease:[.22,1,.36,1]},className:`w-full ${o==="results"?"max-w-[1600px]":"max-w-md"}`,role:"main","aria-label":"AI Emotional Analysis - Student",children:[e.jsx("div",{className:`relative ${o==="results"?"":"backdrop-blur-xl bg-white/60 dark:bg-white/5 border border-white/40 dark:border-white/10 rounded-2xl p-6"}`,children:e.jsxs(z,{mode:"wait",children:[o==="intro"&&e.jsx(te,{onStartScan:R}),(o==="preview"||o==="scanning")&&e.jsx(re,{videoRef:S,scanProgress:C,detectedFeatures:j,onTakePhoto:v,stage:o}),o==="analyzing"&&e.jsx(se,{}),o==="results"&&y&&e.jsx(F,{analysis:y,onReset:N,onComplete:d,onSupportChange:x,isRescanDisabled:s,remainingRescans:b,maxRescans:T})]})}),e.jsx($.div,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},className:"mt-6 text-center",children:e.jsxs("p",{className:"text-xs text-muted-foreground flex items-center justify-center gap-1.5",children:[e.jsx(V,{className:"w-3 h-3"}),"Your wellbeing is our priority"]})})]})})]})]})});de.displayName="StudentFaceScanPage";export{de as default};
