import{u as R,a as B,r as m,j as e,H as I,m as N,L as U,X as O,s as k}from"./index-zefzTZ5i.js";import{B as y}from"./button-DfqIb62V.js";import{C as _,a as X}from"./card-DG0Wpfa9.js";import{L as b}from"./label-BV6fP-ew.js";import{A as H}from"./AnimatedPage-DGD4kKvc.js";import{T as K}from"./textarea-CpMr2Etz.js";import{A as Y}from"./arrow-left-C-szwS9B.js";import{T as q}from"./triangle-alert-BAkQwOeU.js";import{S as G}from"./send-B2IBxfrW.js";const L=["image/jpeg","image/png","image/webp","application/pdf"],E=5*1024*1024,S=2e3,T=a=>a<1024?`${a} B`:a<1024*1024?`${Math.round(a/1024)} KB`:`${Math.round(a/(1024*1024))} MB`,J=a=>{const d=a.toLowerCase().split(".");if(d.length<=2)return!1;const c=d[d.length-1];return d.slice(0,-1).some(i=>["php","exe","sh","bat","js","html"].includes(i))&&["png","jpg","jpeg","webp","pdf"].includes(c)};function ne(){const{toast:a}=R(),j=B(),[d]=m.useState("JOB-123-XYZ"),[c,h]=m.useState(""),[i,u]=m.useState([]),[g,v]=m.useState(!1),D=m.useRef(null),p=c.length,F=m.useMemo(()=>p>=10&&p<=S&&!g,[p,g]),M=t=>L.includes(t.type)?t.size>E?`Ukuran maksimum ${T(E)} — file ${t.name} terlalu besar`:J(t.name)?`Ekstensi file mencurigakan: ${t.name}`:null:`Tipe file tidak didukung: ${t.name}`,z=t=>{const l=Array.from(t||[]),s=[];for(const r of l){const n=M(r);if(n){a({title:"File tidak valid",description:n,variant:"destructive"});continue}if(i.find(w=>w.name===r.name&&w.size===r.size))continue;const f=r.type.startsWith("image/")?URL.createObjectURL(r):null;s.push({id:`${Date.now()}-${Math.random().toString(36).slice(2,9)}`,file:r,name:r.name,size:r.size,type:r.type,preview:f,progress:0})}s.length&&u(r=>[...r,...s])},C=t=>{z(t.target.files),t.target.value=""},P=t=>{u(l=>(l.forEach(s=>{s.id===t&&s.preview&&URL.revokeObjectURL(s.preview)}),l.filter(s=>s.id!==t)))};m.useEffect(()=>()=>{i.forEach(t=>t.preview&&URL.revokeObjectURL(t.preview))},[i]);const $=(t,l)=>new Promise((s,r)=>{const n=new XMLHttpRequest,o=new FormData;o.append("jobId",d),o.append("description",k(c)),o.append("file",t.file),n.open("POST","/api/disputes"),n.upload.onprogress=x=>{if(x.lengthComputable){const f=Math.round(x.loaded/x.total*100);l(f)}},n.onload=()=>{n.status===200?s(n.response):r(new Error("Upload gagal"))},n.onerror=()=>r(new Error("Network error")),n.send(o)}),A=async t=>{if(t.preventDefault(),k(c).length<10){a({title:"Deskripsi terlalu singkat",description:"Minimal 10 karakter."});return}v(!0);try{await Promise.all(i.map(s=>$(s,r=>{u(n=>n.map(o=>o.id===s.id?{...o,progress:r}:o))}))),a({title:"Laporan terkirim",description:"Tim kami akan meninjau laporan dalam 1×24 jam."}),h(""),u([]),setTimeout(()=>j(-1),1200)}catch(s){console.error(s),a({title:"Gagal mengirim",description:s.message,variant:"destructive"}),v(!1)}};return e.jsxs(H,{children:[e.jsx(I,{children:e.jsx("title",{children:"Ajukan Sengketa — Kerjain"})}),e.jsxs("div",{className:"relative min-h-dvh w-full px-3 py-4 sm:px-4 sm:py-6",children:[e.jsxs(N.div,{initial:{opacity:0,y:-12},animate:{opacity:1,y:0},transition:{duration:.3},className:"mb-4 flex items-center gap-2",children:[e.jsx(U,{to:-1,children:e.jsx(y,{variant:"ghost",size:"icon",className:"rounded-full bg-card/40 backdrop-blur-md ring-1 ring-border text-muted-foreground hover:text-accent-foreground hover:bg-accent/12 transition-colors duration-300",children:e.jsx(Y,{className:"h-4 w-4"})})}),e.jsxs("h1",{className:"text-base sm:text-lg font-semibold text-foreground flex items-center gap-2",children:[e.jsx("span",{className:"text-accent",children:"⚑"})," Laporkan Masalah"]})]}),e.jsx(_,{className:"rounded-2xl sm:rounded-3xl border border-border/40 bg-card/50 shadow-xl backdrop-blur-xl",children:e.jsxs(X,{className:"p-4 sm:p-6 space-y-4",children:[e.jsxs("div",{className:"flex items-start gap-3 rounded-xl border border-destructive/40 bg-destructive/10 p-3 sm:p-4",children:[e.jsx(q,{className:"h-5 w-5 sm:h-6 sm:w-6 text-destructive mt-1"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-destructive text-sm sm:text-base",children:"Penting"}),e.jsx("p",{className:"text-xs sm:text-sm text-muted-foreground",children:"Jelaskan masalah dengan jelas. Lampirkan bukti bila ada."})]})]}),e.jsxs("form",{onSubmit:A,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx(b,{className:"text-xs text-muted-foreground",children:"ID Pekerjaan"}),e.jsx("p",{className:"mt-1 rounded-md bg-background/40 px-3 py-1 font-mono text-xs sm:text-sm text-foreground/80",children:d})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xs text-muted-foreground",children:"Detail Masalah"}),e.jsx(K,{rows:4,required:!0,value:c,sanitize:"strong",onChange:t=>h(t.target.value),className:"mt-1 text-xs sm:text-sm",placeholder:"Contoh: Pekerja tidak menyelesaikan..."}),e.jsxs("p",{className:"mt-1 text-right text-[10px] sm:text-xs text-muted-foreground",children:[p,"/",S]})]}),e.jsxs("div",{children:[e.jsx(b,{className:"text-xs text-muted-foreground",children:"Lampiran Bukti"}),e.jsxs("div",{className:"mt-2 flex items-center gap-2",children:[e.jsx("input",{ref:D,type:"file",accept:L.join(","),onChange:C,multiple:!0,className:"hidden",id:"file-upload"}),e.jsx("label",{htmlFor:"file-upload",className:"cursor-pointer flex items-center justify-center rounded-xl bg-card/40 backdrop-blur-xl border border-border/40 shadow px-3 py-1.5 text-xs sm:text-sm font-medium text-foreground transition duration-300 hover:bg-accent/20 hover:text-accent-foreground active:scale-[0.97]",children:"Pilih File"}),e.jsx("span",{className:"text-xs sm:text-sm text-muted-foreground",children:i.length>0?`${i.length} file`:"Tidak ada file"})]}),i.length>0&&e.jsx("div",{className:"mt-2 space-y-2",children:i.map(t=>e.jsxs("div",{className:"flex items-center gap-2 rounded-xl border border-border/40 bg-background/40 backdrop-blur-md p-2 shadow",children:[t.preview?e.jsx("img",{src:t.preview,alt:t.name,className:"h-10 w-10 object-cover rounded-md"}):e.jsx("div",{className:"h-10 w-10 flex items-center justify-center rounded-md bg-secondary/30 text-[10px] font-semibold",children:"PDF"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-xs sm:text-sm font-medium text-foreground truncate",children:t.name}),e.jsx("p",{className:"text-[10px] sm:text-xs text-muted-foreground",children:T(t.size)}),t.progress>0&&e.jsx("div",{className:"mt-1 h-1 w-full rounded bg-muted overflow-hidden",children:e.jsx(N.div,{initial:{width:0},animate:{width:`${t.progress}%`},transition:{duration:.3,ease:"easeOut"},className:"h-1 rounded bg-primary"})})]}),e.jsx("button",{type:"button",onClick:()=>P(t.id),className:"text-destructive hover:opacity-80 transition",children:e.jsx(O,{className:"h-3 w-3 sm:h-4 sm:w-4"})})]},t.id))})]}),e.jsxs(y,{type:"submit",size:"lg",className:"w-full rounded-xl bg-primary font-semibold text-primary-foreground hover:bg-primary/90 transition duration-300",disabled:!F,children:[g?"Mengirim...":"Kirim Laporan",e.jsx(G,{className:"ml-2 h-4 w-4 sm:h-5 sm:w-5"})]})]})]})})]})]})}export{ne as default};
