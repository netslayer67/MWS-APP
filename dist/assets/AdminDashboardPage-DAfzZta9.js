const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverviewPanel-B-L-wOkD.js","assets/index-D_pgSSHA.js","assets/index-B1w4tANX.css","assets/AdminStudentsPanel-6raLjk9r.js","assets/StudentsTable-DHdprzmu.js","assets/StatusPills-CM_78s-j.js","assets/teacherDashboardUtils-BY5GUVZJ.js","assets/shield-check-D61s1X1s.js","assets/funnel-B8EtD1S9.js","assets/shuffle-8D6dP5X7.js","assets/search-CKNIqOMr.js","assets/users-D4gyIltF.js","assets/AdminMentorsPanel-8NvCM5if.js","assets/AdminAnalyticsPanel-DkB1GIWm.js"])))=>i.map(i=>d[i]);
import{c as ee,ae as te,a6 as de,S as ue,z as me,d as se,r as n,b as he,e as fe,j as l,m as pe,_ as F}from"./index-D_pgSSHA.js";import{B as ae}from"./building-2-ELibQC9Y.js";import{U as oe,C as ge}from"./users-round-CpRwWBqu.js";import{U as re}from"./user-check-DgExHlKw.js";import{s as D}from"./socketService-B4WowktR.js";import{d as K,a as be,n as J,c as ye,f as ve,h as Se}from"./teacherDashboardUtils-BY5GUVZJ.js";import{A as we}from"./arrow-up-right-CBjLur6D.js";import{M as xe}from"./minus-DD5Db7im.js";import"./shield-check-D61s1X1s.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Me=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],ke=ee("arrow-down-right",Me);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ae=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],Ce=ee("layout-dashboard",Ae),Te=[{key:"overview",label:"System Overview",icon:Ce},{key:"students",label:"All Students",icon:oe},{key:"mentors",label:"Manage Mentors",icon:re},{key:"analytics",label:"Analytics Lab",icon:ge}],X={badgeIcon:ae,badgeLabel:"Admin / Principal",badgeCaption:"",heading:"",subheading:""},_e={tier:me,interventions:ue,activity:de,mentor:oe,stats:te},Z={"Tier 1":1,"Tier 2":2,"Tier 3":3},ne=s=>{if(!s)return"-";try{return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(s))}catch{return"-"}},je=[{key:"students",label:"Students in MTSS",caption:"Across all tiers",accent:"from-[#ff80b5] via-[#f472b6] to-[#c084fc]",icon:ae},{key:"mentors",label:"Active Mentors",caption:"Teachers & specialists",accent:"from-[#fcd34d] via-[#fb923c] to-[#f87171]",icon:re},{key:"success",label:"Success Rate",caption:"Meeting intervention goals",accent:"from-[#6ee7b7] via-[#34d399] to-[#10b981]",icon:te}],Ie=(s=0,a=0,e=0)=>je.map(o=>o.key==="students"?{...o,value:s}:o.key==="mentors"?{...o,value:a}:{...o,value:`${e}%`}),Ne=(s,a=[])=>{const e=a.length;return{totalStudents:s?.total||e,tierBreakdown:s?.tierBreakdown?.length?s.tierBreakdown:[{label:"Tier 1",count:e,description:`${e} students`}],interventions:s?.interventions?.length?s.interventions.slice(0,5):[{label:"Universal Supports",count:e}]}},Re=(s=[])=>{const a={},e={};s.forEach(t=>{const d=t.tier||t.profile?.tier||"Tier 1";a[d]=(a[d]||0)+1;const f=t.type||t.profile?.type;f&&(e[f]=(e[f]||0)+1)});const o=Object.entries(a).map(([t,d])=>({label:t,count:d,description:`${d} students`})).sort((t,d)=>(Z[t.label]||99)-(Z[d.label]||99)),r=Object.entries(e).map(([t,d])=>({label:t,count:d})).sort((t,d)=>d.count-t.count);return{total:s.length,tierBreakdown:o,interventions:r}},De=(s=[])=>{const a={};s.forEach(o=>{const r=o.type||"Universal Supports",t=a[r]||{total:0,success:0};t.total+=1,["On Track","Completed"].includes(o.progress)&&(t.success+=1),a[r]=t});const e=["from-[#a78bfa] to-[#6366f1]","from-[#f472b6] to-[#fb7185]","from-[#34d399] to-[#10b981]","from-[#22d3ee] to-[#3b82f6]","from-[#fcd34d] to-[#f97316]"];return Object.entries(a).map(([o,r],t)=>({label:o,value:r.total?Math.round(r.success/r.total*100):0,gradient:e[t%e.length]})).sort((o,r)=>r.value-o.value)},Ee=s=>{const a=new Date(s),e=new Date(a.getFullYear(),0,1),o=Math.floor((a-e)/864e5),r=Math.ceil((o+e.getDay()+1)/7);return`${a.getFullYear()}-${r}`},Le=(s=[])=>{if(!s.length)return{met:"",support:""};const a=600,e=200,o=Math.max(s.length-1,1),r=t=>s.map((d,f)=>{const y=f/o*a,x=e-(d[t]||0)/100*e;return`${f===0?"M":"L"}${y},${x}`}).join(" ");return{met:r("met"),support:r("support")}},Pe=(s=[])=>{const a=new Map;s.forEach(r=>{const t=r.updatedAt||r.startDate||r.createdAt;if(!t)return;const d=new Date(t),f=Ee(d);a.has(f)||a.set(f,{total:0,success:0,date:d});const y=a.get(f);y.total+=1,["active","completed"].includes(r.status)&&(y.success+=1)});const o=Array.from(a.values()).sort((r,t)=>r.date-t.date).slice(-6).map(r=>{const t=r.total?Math.round(r.success/r.total*100):0;return{label:ne(r.date),met:t,support:Math.max(0,100-t)}});return{trendData:o,trendPaths:Le(o)}},$e=(s=[])=>{const a=new Map;return s.forEach(e=>{const o=e.mentorId?.name||"Unassigned Mentor";a.has(o)||a.set(o,{name:o,focusAreas:new Set,caseload:0,success:0,total:0});const r=a.get(o);r.total+=1,r.caseload+=e.studentIds?.length||0,e.focusAreas?.length&&e.focusAreas.forEach(t=>r.focusAreas.add(t)),["completed","active"].includes(e.status)&&(r.success+=1)}),Array.from(a.values()).map(e=>({name:e.name,caseload:e.caseload,focus:e.focusAreas.size?Array.from(e.focusAreas).slice(0,2).join(", "):"Tiered Supports",trend:e.total?`${Math.round(e.success/e.total*100)}% success`:"New mentor"})).sort((e,o)=>o.caseload-e.caseload).slice(0,3)},Oe=(s=[])=>{const a=new Map;return s.forEach(e=>{const o=e.mentorId?._id?.toString?.()||null,r=e.mentorId?.email||null,t=o||r||e.mentorId?.name||"unassigned";a.has(t)||a.set(t,{id:o,email:r,name:e.mentorId?.name||"Unassigned",role:e.mentorId?.jobPosition||e.mentorId?.role||"Mentor",students:0,total:0,completed:0});const d=a.get(t);d.students+=e.studentIds?.length||0,d.total+=1,e.status==="completed"&&(d.completed+=1)}),Array.from(a.values()).map(e=>({_id:e.id,email:e.email,name:e.name,role:e.role,activeStudents:e.students,successRate:e.total?`${Math.round(e.completed/e.total*100)}%`:"0%"})).sort((e,o)=>o.activeStudents-e.activeStudents)},Ge=(s=[])=>{const a={};return s.forEach(e=>{(e.focusAreas||[]).forEach(o=>{a[o]=(a[o]||0)+1})}),Object.entries(a).sort((e,o)=>o[1]-e[1]).slice(0,4).map(([e,o])=>({label:e,value:`${o} active`}))},Ue=(s=[])=>{const a=s.filter(r=>["On Track","Completed"].includes(r.progress)).length,e=s.filter(r=>r.progress==="Needs Attention").length,o=Math.max(0,s.length-a-e);return[{label:"Improved",detail:`${a} students`,accent:"text-emerald-500",icon:we},{label:"Needs Support",detail:`${e} students`,accent:"text-rose-500",icon:ke},{label:"Stable",detail:`${o} students`,accent:"text-sky-500",icon:xe}]},ze=(s=[])=>{const a=[];return s.forEach(e=>{const o=e.studentIds?.[0]?.name||"Student group",r=e.mentorId?.name||"Mentor team",t=e.checkIns?.slice(-1)[0];t?a.push({date:t.date,student:o,mentor:r,activity:t.summary||"Progress update recorded"}):a.push({date:e.updatedAt||e.startDate||e.createdAt,student:o,mentor:r,activity:`Status updated to ${e.status}`})}),a.filter(e=>e.date).sort((e,o)=>new Date(o.date)-new Date(e.date)).slice(0,6).map(e=>({...e,date:ne(e.date)}))},Be=(s=[])=>{if(!s.length)return 0;const a=s.filter(e=>e.status==="completed").length;return Math.round(a/s.length*100)},Fe=650,Ve=()=>{const{user:s}=se(i=>i.auth),[a,e]=n.useState([]),[o,r]=n.useState(null),[t,d]=n.useState([]),[f,y]=n.useState([]),[x,k]=n.useState(!0),[E,I]=n.useState(null),h=n.useMemo(()=>K(s),[s]),A=n.useMemo(()=>be(h),[h]),C=n.useCallback((i={})=>{if(!h.allowedGrades.length)return!0;const u=J(i.grade||i.currentGrade||i.className||i.unit||i.classes?.[0]?.grade);return h.allowedGrades.includes(u)},[h]),M=n.useCallback((i={})=>{const u=J(i.grade||i.currentGrade||i.className||i.unit||i.classes?.[0]?.grade);return{...i,grade:u||i.grade,className:i.className||i.currentGrade||i.unit||i.classes?.[0]?.grade}},[]),N=n.useCallback((i=[])=>{i.length&&e(u=>{const g=new Map(u.map(p=>[p.id||p._id,p]));return i.forEach(p=>{if(!C(p))return;const v=p.id||p._id;if(!v)return;const w=g.get(v)||{};g.set(v,{...w,...M(p)})}),Array.from(g.values()).sort((p,v)=>p.name.localeCompare(v.name))})},[M,C]),T=n.useCallback((i,u)=>{u?._id&&d(g=>{const p=g.findIndex(w=>w._id===u._id);if(i==="deleted"){if(p===-1)return g;const w=[...g];return w.splice(p,1),w}if(p===-1)return[...g,u];const v=[...g];return v[p]=u,v})},[]),m=n.useCallback((i={})=>{if(!h.allowedGrades.length&&!h.unit)return!0;const u=K(i);return h.allowedGrades.length&&u.allowedGrades?.length&&u.allowedGrades.some(g=>h.allowedGrades.includes(g))?!0:h.unit&&i.unit?i.unit.toLowerCase()===h.unit.toLowerCase():!h.allowedGrades.length},[h]),c=n.useCallback(async()=>{k(!0),I(null);try{const i={};h.unit&&(i.unit=h.unit);const u={limit:Fe};h.unit&&(u.unit=h.unit),A.length&&(u.grade=A.join(","));const[g,p,v]=await Promise.all([ye(u),ve(),Se(i)]),w=g.students||[],O=(h.allowedGrades.length?w.filter(C):w).map(M),Q=new Set(O.map(B=>B.id?.toString?.()||B._id?.toString?.()).filter(Boolean)),ce=(p.assignments||[]).filter(B=>Q.size?(B.studentIds||[]).some(Y=>{const W=Y?._id?.toString?.()||Y?.id?.toString?.();return W?Q.has(W):!1}):!0),le=(v.mentors||[]).filter(m);e(O),r(Re(O)),d(ce),y(le)}catch(i){I(i?.response?.data?.message||i.message||"Failed to load MTSS dashboard data")}finally{k(!1)}},[A,m,h.allowedGrades.length,M,C]);n.useEffect(()=>{c()},[c]),n.useEffect(()=>{if(!s?.id&&!s?._id)return;D.connect(),D.joinMtssAdmin();const i=g=>{N(g?.students||[])},u=({action:g,assignment:p})=>{T(g||"updated",p)};return D.onMtssStudentsChanged(i),D.onMtssAssignment(u),()=>{D.offMtssStudentsChanged(i),D.offMtssAssignment(u),D.leaveMtssAdmin()}},[s,N,T]);const b=n.useMemo(()=>f?.length?f.length:new Set(t.map(u=>u.mentorId?._id||u.mentorId)).size,[f,t]),S=n.useMemo(()=>Be(t),[t]),_=n.useMemo(()=>Ie(a.length,b,S),[a.length,b,S]),j=n.useMemo(()=>Ne(o,a),[o,a]),R=n.useMemo(()=>De(a),[a]),{trendData:L,trendPaths:P}=n.useMemo(()=>Pe(t),[t]),$=n.useMemo(()=>$e(t),[t]),G=n.useMemo(()=>Oe(t),[t]),U=n.useMemo(()=>Ge(t),[t]),z=n.useMemo(()=>Ue(a),[a]),V=n.useMemo(()=>ze(t),[t]);return{students:a,assignments:t,mentors:f,statCards:_,systemSnapshot:j,successByType:R,trendData:L,trendPaths:P,mentorSpotlights:$,mentorRoster:G,strategyHighlights:U,tierMovement:z,recentActivity:V,loading:x,error:E,refresh:c}},H=(s=[],a)=>{const e=new Set;return s.forEach(o=>{const r=o[a];r&&e.add(r)}),["all",...Array.from(e)]},He=(s=[])=>{const a=he(),{toast:e}=fe(),[o,r]=n.useState("overview"),[t,d]=n.useState({grade:"all",tier:"all",type:"all",mentor:"all",query:""}),[f,y]=n.useState([]),x=n.useMemo(()=>{const m=t.query.trim().toLowerCase();return s.filter(c=>{const b=t.grade==="all"||c.grade===t.grade,S=t.tier==="all"||c.tier===t.tier,_=t.type==="all"||c.type===t.type,j=c.mentor||c.profile?.mentor,R=Array.isArray(c.teachers)&&c.teachers.length?c.teachers:Array.isArray(c.profile?.teacherRoster)&&c.profile.teacherRoster.length?c.profile.teacherRoster:j?[j]:[],L=t.mentor==="all"||R.includes(t.mentor),P=!m||c.name?.toLowerCase().includes(m)||c.type?.toLowerCase().includes(m)||j?.toLowerCase().includes(m)||R.some($=>$.toLowerCase().includes(m));return b&&S&&_&&L&&P})},[s,t]),k=n.useMemo(()=>H(s,"grade"),[s]),E=n.useMemo(()=>H(s,"tier"),[s]),I=n.useMemo(()=>H(s,"type"),[s]),h=n.useMemo(()=>{const m=new Set;return s.forEach(c=>{const b=Array.isArray(c.teachers)&&c.teachers.length?c.teachers:Array.isArray(c.profile?.teacherRoster)&&c.profile.teacherRoster.length?c.profile.teacherRoster:[];if(b.length){b.forEach(_=>m.add(_));return}const S=c.mentor||c.profile?.mentor;S&&m.add(S)}),["all",...Array.from(m)]},[s]),A=n.useCallback((m,c)=>{d(b=>({...b,[m]:c}))},[]),C=n.useCallback(m=>{const c=m.id||m._id;c&&y(b=>b.includes(c)?b.filter(S=>S!==c):[...b,c])},[]),M=n.useCallback(()=>y([]),[]);n.useEffect(()=>{y(m=>m.filter(c=>s.some(b=>(b.id||b._id)===c)))},[s]);const N=n.useCallback(m=>{a(`/mtss/student/${m.slug}`)},[a]),T=n.useCallback(m=>{e({title:"Mentor nudged",description:`Flagged ${m.name}'s plan for a system review.`})},[e]);return{activeTab:o,setActiveTab:r,filters:t,handleFilterChange:A,filteredStudents:x,gradeOptions:k,tierOptions:E,typeOptions:I,mentorOptions:h,selectedIds:f,toggleSelection:C,resetSelection:M,handleViewStudent:N,handleQuickUpdate:T}},ie=({heroCard:s,tabs:a,activeTab:e,onTabChange:o})=>{const r=s.badgeIcon;return l.jsxs("div",{className:"space-y-4","data-aos":"fade-up",children:[l.jsxs("div",{className:"inline-flex items-center gap-3 px-5 py-2 rounded-full bg-gradient-to-r from-white/90 via-white/70 to-white/50 dark:from-white/10 dark:via-white/5 dark:to-white/5 backdrop-blur-xl shadow-lg border border-white/60 dark:border-white/10",children:[l.jsx(r,{className:"w-5 h-5 text-rose-500"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.5em] text-muted-foreground",children:s.badgeLabel}),l.jsx("p",{className:"text-sm font-semibold text-slate-700 dark:text-white",children:s.badgeCaption})]})]}),l.jsx("div",{"data-aos":"fade-up","data-aos-delay":"100",children:l.jsx("h1",{className:"text-4xl md:text-5xl font-black tracking-tight bg-gradient-to-r from-[#ef4444] via-[#f472b6] to-[#2563eb] dark:from-[#fbbf24] dark:via-[#22d3ee] dark:to-[#a78bfa] bg-clip-text text-transparent drop-shadow-[0_8px_20px_rgba(15,23,42,0.35)]",style:{WebkitTextStroke:"0.6px rgba(15,23,42,0.35)"},children:s.heading})}),l.jsx("div",{className:"flex flex-wrap gap-3 pt-2","data-aos":"zoom-in","data-aos-delay":"150",children:a.map(t=>{const d=t.icon,f=e===t.key;return l.jsxs("button",{onClick:()=>o(t.key),className:`px-5 py-3 rounded-full border backdrop-blur-xl font-semibold text-sm flex items-center gap-2 transition shadow-lg relative overflow-hidden group ${f?"bg-gradient-to-r from-[#ffe29f] via-[#ffa99f] to-[#ff719a] text-[#5b0f45] border-white/70 shadow-[0_10px_30px_rgba(255,113,154,0.35)]":"bg-gradient-to-r from-white/85 via-white/70 to-white/55 border-white/70 text-slate-600 dark:from-white/10 dark:via-white/5 dark:to-white/5 dark:text-white/80 hover:border-white/90"}`,children:[l.jsx("span",{"aria-hidden":"true",className:`absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition pointer-events-none ${f?"bg-white/10":"bg-white/30 dark:bg-white/10"}`}),l.jsx(d,{className:"w-4 h-4"}),l.jsx("span",{className:"relative",children:t.label})]},t.key)})})]})};ie.displayName="AdminHeroSection";const qe=n.memo(ie),Qe=n.lazy(()=>F(()=>import("./AdminOverviewPanel-B-L-wOkD.js"),__vite__mapDeps([0,1,2]))),Ye=n.lazy(()=>F(()=>import("./AdminStudentsPanel-6raLjk9r.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),We=n.lazy(()=>F(()=>import("./AdminMentorsPanel-8NvCM5if.js"),__vite__mapDeps([12,1,2]))),Ke=n.lazy(()=>F(()=>import("./AdminAnalyticsPanel-DkB1GIWm.js"),__vite__mapDeps([13,1,2]))),Je=()=>l.jsx("div",{className:"glass glass-card p-8 text-center text-muted-foreground animate-pulse",children:"Loading dashboard..."}),Xe=n.memo(()=>{const{user:s}=se(u=>u.auth),a={male:"Mr.",female:"Ms."},e=u=>a[u?.toLowerCase?.()]||"",{students:o,statCards:r,systemSnapshot:t,recentActivity:d,mentorSpotlights:f,mentorRoster:y,mentors:x,successByType:k,trendData:E,trendPaths:I,strategyHighlights:h,tierMovement:A,loading:C,error:M,refresh:N}=Ve(),{activeTab:T,setActiveTab:m,filters:c,handleFilterChange:b,filteredStudents:S,gradeOptions:_,tierOptions:j,typeOptions:R,mentorOptions:L,handleViewStudent:P,handleQuickUpdate:$,selectedIds:G,toggleSelection:U,resetSelection:z}=He(o),V=n.useMemo(()=>{const u=s?.username||s?.name||"MTSS Admin",g=e(s?.gender),p=g?`${g} ${u}`:u,v=[`Cheers ${p}, let's guide today's MTSS glow.`,`${p}, keep the joyful momentum alive today.`,`${p}, another day to uplift every grade.`],w=new Date,q=v[(w.getDate()+w.getMonth())%v.length],O=s?.jobPosition||s?.unit||X.badgeCaption||"Principal dashboard";return{...X,badgeCaption:O,heading:q,subheading:"Oversee joyful MTSS momentum with live caseloads, mentors, and progress signals."}},[s]),i=n.useMemo(()=>{switch(T){case"overview":return l.jsx(Qe,{statCards:r,systemSnapshot:t,recentActivity:d,mentorSpotlights:f,icons:_e});case"students":return l.jsx(Ye,{filters:c,onFilterChange:b,gradeOptions:_,tierOptions:j,typeOptions:R,mentorOptions:L,filteredStudents:S,allStudents:o,onViewStudent:P,onUpdateStudent:$,selectedIds:G,onToggleSelect:U,onResetSelection:z,mentorDirectory:x,onRefresh:N});case"mentors":return l.jsx(We,{mentorRoster:y,mentorDirectory:x});case"analytics":return l.jsx(Ke,{successByType:k,trendPaths:I,trendData:E,strategyHighlights:h,tierMovement:A});default:return null}},[T,c,_,j,R,L,S,b,P,$,G,U,z,y,x,r,t,d,f,k,E,I,h,A]);return l.jsxs("div",{className:"mtss-theme mtss-animated-bg min-h-screen relative overflow-hidden",children:[l.jsx("div",{className:"mtss-bg-overlay"}),l.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[l.jsx("div",{className:"absolute -top-20 left-0 w-96 h-96 bg-[#ff80b5]/30 blur-[180px]"}),l.jsx("div",{className:"absolute top-40 right-0 w-80 h-80 bg-[#60a5fa]/30 blur-[180px]"}),l.jsx("div",{className:"absolute bottom-0 left-1/3 w-96 h-96 bg-[#fcd34d]/20 blur-[180px]"})]}),l.jsxs("div",{className:"relative z-20 container-tight py-12 lg:py-16 text-foreground dark:text-white space-y-10",children:[l.jsx(pe.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},"data-aos":"fade-up",children:l.jsx(qe,{heroCard:V,tabs:Te,activeTab:T,onTabChange:m})}),(C||M)&&l.jsxs("div",{className:"rounded-2xl border border-border/50 bg-white/70 dark:bg-white/10 px-4 py-3 flex items-center justify-between gap-4 text-sm text-muted-foreground",children:[l.jsx("span",{children:M||"Syncing MTSS data..."}),M&&l.jsx("button",{onClick:N,className:"text-primary font-semibold hover:underline",children:"Retry"})]}),l.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:l.jsx(n.Suspense,{fallback:l.jsx(Je,{}),children:i})})]})]})});Xe.displayName="AdminDashboardPage";export{Xe as default};
