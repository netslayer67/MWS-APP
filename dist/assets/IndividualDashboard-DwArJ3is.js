import{r as n,a as G,d as M,a3 as Z,j as e,G as K,a4 as O,a5 as ee,a6 as Q,H as se,b as te,K as ae,N as re,m as E,U as R,F as ne,a7 as ie,a8 as le}from"./index-4xPcSaBT.js";import{C as p,a as f,b as U,c as A}from"./card-BRI2ukRD.js";import{B as S}from"./badge-DixmBEPN.js";import{P as V}from"./progress-Ct5XaQmQ.js";import{M as de}from"./message-circle-DNLpiTzo.js";const Y=n.memo(({selectedUser:N,targetUserId:h})=>{const T=G(),{user:r}=M(s=>s.auth),{checkinHistory:o}=M(s=>s.checkin),l=n.useMemo(()=>N||(h?{id:h}:r||null),[N,h,r]),j=n.useMemo(()=>l?.id?.toString()||l?._id?.toString()||h?.toString()||r?._id?.toString()||r?.id?.toString()||"",[l,h,r]);n.useEffect(()=>{j&&T(Z({page:1,limit:100,userId:j}))},[T,j]);const a=n.useMemo(()=>{if(!j||!o)return[];const s=o.data||o;return Array.isArray(s)?s:s.checkins||[]},[j,o]),c=n.useMemo(()=>{if(a.length===0)return null;const s=a.slice(0,7),m=s.reduce((g,x)=>g+x.presenceLevel,0)/s.length,y=s.reduce((g,x)=>g+x.capacityLevel,0)/s.length,v={};s.forEach(g=>{g.selectedMoods?.forEach(x=>{v[x]=(v[x]||0)+1})});const I=Object.entries(v).sort(([,g],[,x])=>x-g).slice(0,3);return{avgPresence:Math.round(m*10)/10,avgCapacity:Math.round(y*10)/10,topMoods:I,checkinCount:s.length,trend:m>6?"improving":m<4?"concerning":"stable"}},[a]),C=n.useMemo(()=>a.filter(s=>s.details).slice(0,5).map(s=>({date:new Date(s.date).toLocaleDateString(),details:s.details,weatherType:s.weatherType,moods:s.selectedMoods})),[a]);return l?a.length===0?e.jsx(p,{children:e.jsxs(f,{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/30 flex items-center justify-center mx-auto mb-6",children:e.jsx(K,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Individual User Analytics"}),e.jsx("p",{className:"text-muted-foreground text-base leading-relaxed",children:`${l?.name||"This user"} belum memiliki catatan check-in emosional.`}),e.jsx("div",{className:"mt-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-primary font-medium",children:"Tip: Dorong pengguna ini untuk melakukan check-in pertama mereka agar dapat memantau kesejahteraan emosionalnya."})})]})}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs(p,{children:[e.jsxs(U,{children:[e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(O,{className:"w-5 h-5"}),l.name]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detailed emotional wellness analysis for this user"})]}),e.jsxs(f,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-primary",children:a.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Total Check-ins"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:c?.avgPresence||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Presence"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:c?.avgCapacity||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Avg Capacity"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-purple-600",children:a.filter(s=>s.aiAnalysis?.needsSupport).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Support Flags"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("h4",{className:"font-medium mb-3 flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4"}),"Latest Check-in"]}),a[0]&&e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:new Date(a[0].date).toLocaleDateString()}),e.jsx(S,{variant:"outline",className:"text-xs",children:a[0].weatherType})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:["Presence: ",e.jsxs("span",{className:"font-medium",children:[a[0].presenceLevel,"/10"]})]}),e.jsxs("div",{children:["Capacity: ",e.jsxs("span",{className:"font-medium",children:[a[0].capacityLevel,"/10"]})]})]}),a[0].selectedMoods?.length>0&&e.jsx("div",{className:"mt-2 flex gap-1",children:a[0].selectedMoods.slice(0,3).map(s=>e.jsx(S,{variant:"secondary",className:"text-xs",children:s},s))})]})]})]})]}),e.jsxs(p,{children:[e.jsx(U,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Weekly Wellness Snapshot"]})}),e.jsxs(f,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Presence trend"}),e.jsxs("span",{children:[c?.avgPresence||0,"/10"]})]}),e.jsx(V,{value:(c?.avgPresence||0)*10,className:"h-2"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center justify-between text-xs text-muted-foreground mb-1",children:[e.jsx("span",{children:"Capacity trend"}),e.jsxs("span",{children:[c?.avgCapacity||0,"/10"]})]}),e.jsx(V,{value:(c?.avgCapacity||0)*10,className:"h-2"})]})]}),c?.topMoods?.length>0&&e.jsxs("div",{className:"pt-2",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground mb-2 flex items-center gap-2",children:[e.jsx(se,{className:"w-3.5 h-3.5"}),"Dominant moods this week"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:c.topMoods.map(([s,m])=>e.jsxs(S,{variant:"outline",className:"text-xs",children:[s," - ",m,"x"]},s))})]})]})]}),C.length>0&&e.jsxs(p,{children:[e.jsx(U,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-5 h-5"}),"Recent Reflections"]})}),e.jsx(f,{className:"space-y-4",children:C.map((s,m)=>e.jsxs("div",{className:"p-3 rounded-lg border border-border/40 bg-card/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:s.date}),s.weatherType&&e.jsx(S,{variant:"outline",className:"text-xs",children:s.weatherType})]}),e.jsx("p",{className:"text-sm text-muted-foreground leading-relaxed",children:s.details}),s.moods?.length>0&&e.jsx("div",{className:"mt-2 flex flex-wrap gap-1",children:s.moods.map(y=>e.jsx(S,{variant:"secondary",className:"text-xs",children:y},y))})]},m))})]})]}):e.jsx(p,{children:e.jsxs(f,{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/30 flex items-center justify-center mx-auto mb-6",children:e.jsx(K,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Individual User Analytics"}),e.jsx("p",{className:"text-muted-foreground text-base leading-relaxed",children:"Unable to load the requested user report. Please try again from the dashboard."})]})})});Y.displayName="IndividualView";const ce=n.memo(()=>{const N=G(),h=te(),T=ae(),{userId:r}=re(),{user:o}=M(t=>t.auth),{checkinHistory:l}=M(t=>t.checkin),{users:j}=M(t=>t.users),[a,c]=n.useState(null),[C,s]=n.useState(!1),[m,y]=n.useState([]),[v,I]=n.useState(!1),[g,x]=n.useState(null),[_,z]=n.useState(null),B=T.state?.user,b=o?.role==="head_unit";n.useEffect(()=>{if(!b)return;let t=!0;return(async()=>{I(!0),x(null);try{const d=await ie();if(!t)return;const w=d?.data?.data?.users||d?.data?.users||d?.users||[];y(w)}catch(d){if(!t)return;console.error("Failed to fetch unit members for head unit view:",d),x("Tidak dapat memuat anggota unit. Coba lagi nanti.")}finally{t&&I(!1)}})(),()=>{t=!1}},[b]),n.useEffect(()=>{let t=!0;return(async()=>{if(z(null),!r){o&&t&&c(o),s(!1);return}if(b&&v)return;if(s(!0),B&&t){c(B),s(!1);return}if(b){const u=r?.toString(),k=m.find(q=>(q?.id?.toString()||q?._id?.toString())===u);k&&t?c(k):t&&(c(null),z("Anda hanya dapat melihat laporan anggota dalam unit Anda.")),s(!1);return}const d=r?.toString(),w=j.find(u=>(u?.id?.toString()||u?._id?.toString())===d);if(w&&t){c(w),s(!1);return}try{const u=await N(le(r)).unwrap();if(!t)return;const k=u?.user||u?.data?.user||u?.data||u;k&&c(k)}catch(u){t&&console.error("Error loading targeted user for individual dashboard:",u)}finally{t&&s(!1)}})(),()=>{t=!1}},[r,B,j,o,N,b,m,v]);const D=n.useMemo(()=>r?.toString()||a?.id?.toString()||a?._id?.toString()||o?.id?.toString()||o?._id?.toString()||null,[r,a,o]),P=n.useMemo(()=>l?Array.isArray(l)?l:Array.isArray(l?.data?.checkins)?l.data.checkins:Array.isArray(l?.data)?l.data:Array.isArray(l?.checkins)?l.checkins:[]:[],[l]),$=n.useMemo(()=>m?.length?[...m].sort((t,i)=>{const d=(t?.name||"").toLowerCase(),w=(i?.name||"").toLowerCase();return d.localeCompare(w)}):[],[m]),J=n.useMemo(()=>r?.toString()||a?.id?.toString()||a?._id?.toString()||"",[r,a]),L=n.useMemo(()=>P.length?D?P.filter(t=>{const i=t?.userId?.toString()||t?.user?._id?.toString()||t?.user?.id?.toString()||null;return!i||i===D}):P:[],[P,D]),H=n.useMemo(()=>{if(!L.length)return null;let t=0,i=0;return L.forEach(d=>{Number(d?.presenceLevel)>=7&&(t+=1),Number(d?.capacityLevel)>=7&&(i+=1)}),{total:L.length,highPresence:t,highCapacity:i}},[L]),X=()=>{h("/emotional-checkin/dashboard")},F=()=>{h("/emotional-wellness")},W=t=>{if(!t?.gender)return t?.name||"User";const i=t.gender==="male"?"Mr.":t.gender==="female"?"Ms.":"",d=t.username||t.name||"User";return i?`${i} ${d}`:d};return e.jsxs("div",{className:"min-h-screen text-foreground relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-gold/5"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_30%_20%,rgba(120,119,198,0.1),transparent_50%)]"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-full h-full bg-[radial-gradient(circle_at_70%_80%,rgba(255,215,0,0.05),transparent_50%)]"}),e.jsxs("div",{className:"relative z-10 container-tight py-4 md:py-6",children:[e.jsxs(E.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(R,{variant:"ghost",onClick:r?F:X,className:"flex items-center gap-2 hover:bg-primary/10",children:[e.jsx(ne,{className:"w-4 h-4"}),r?"Back to My Dashboard":"Back to Main Dashboard"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-gold bg-clip-text text-transparent",children:r?"User Report":"Individual Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:r?"Detailed emotional wellness report":"Your personal emotional wellness overview"})]})]}),e.jsx(p,{className:"glass glass-card border-primary/20",children:e.jsx(f,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary to-gold flex items-center justify-center",children:e.jsx(O,{className:"w-6 h-6 text-primary-foreground"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:r?`Report for ${W(a)}`:`Welcome back, ${W(o)}!`}),e.jsx("p",{className:"text-muted-foreground",children:r?"Detailed emotional wellness analysis for this user":"Here's your comprehensive emotional wellness analysis"})]})]})})})]}),b&&e.jsx(E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{duration:.4,delay:.1},className:"mb-6",children:e.jsxs(p,{className:"glass glass-card border-primary/10",children:[e.jsxs(U,{children:[e.jsx(A,{className:"text-base md:text-lg",children:"Anggota Unit Anda"}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Pilih anggota unit untuk melihat laporan emosional personal mereka."})]}),e.jsx(f,{children:v?e.jsx("div",{className:"flex flex-wrap gap-2",children:Array.from({length:6}).map((t,i)=>e.jsx("div",{className:"h-9 w-32 rounded-lg bg-muted/40 animate-pulse"},i))}):$.length>0?e.jsx("div",{className:"flex flex-wrap gap-2 max-h-40 overflow-auto",children:$.map(t=>{const i=t?.id||t?._id,d=i?.toString()===J;return e.jsx(R,{size:"sm",variant:d?"default":"outline",className:"justify-start",onClick:()=>h(`/emotional-wellness/${i}`,{state:{user:t}}),children:t.name},i)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:g||"Belum ada anggota unit yang terdaftar."})})]})}),_&&r&&!C&&e.jsx("div",{className:"mb-6",children:e.jsx(p,{className:"border-destructive/30 bg-destructive/5",children:e.jsxs(f,{className:"py-5",children:[e.jsx("p",{className:"text-sm text-destructive mb-3",children:_}),e.jsx(R,{variant:"outline",size:"sm",onClick:F,children:"Kembali ke laporan saya"})]})})}),(a||!r&&o&&!_)&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsx(Y,{selectedUser:a,targetUserId:D})}),a&&!C&&!_&&e.jsx(E.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"mt-6",children:e.jsxs(p,{className:"glass glass-card",children:[e.jsx(U,{children:e.jsxs(A,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Quick Summary"]})}),e.jsx(f,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:H?.total??0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Check-ins"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:H?.highPresence??0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"High Presence Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:H?.highCapacity??0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"High Capacity Days"})]})]})})]})})]})]})});ce.displayName="IndividualDashboard";export{ce as default};
