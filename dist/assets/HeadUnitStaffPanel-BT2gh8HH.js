import{r as l,b as P,j as e,a1 as H,a6 as R,J as v}from"./index-B1azmWwg.js";import{C as y,b,c as w,a as C}from"./card-DVFJaSRr.js";import{B as p}from"./badge-BAzUtRgg.js";import{I as _}from"./input-Dgeu6Z6d.js";import{U as z}from"./UserDetailModal-BaAMb3rk.js";import{U as u}from"./users-B-1Atc9_.js";import{C as B}from"./clock-BMQNi798.js";import{T as S}from"./EmotionalCheckinDashboard-BgIvxYSM.js";import{S as E}from"./search-CaxCeGa8.js";import{A as L}from"./arrow-up-right-C6mLKXiu.js";import"./CategoricalChart-aA7aERj5.js";import"./LineChart-BHCfHX5b.js";import"./ActivePoints-MEc8OUnh.js";import"./ErrorBarContext-GazER3Rh.js";import"./CartesianChart-DWkmeYzH.js";import"./YAxis-CrMYB_2R.js";import"./socketService-B4WowktR.js";import"./funnel-C8KzFS57.js";import"./building-DjCxFMqI.js";import"./shield-check-DDGHQKx1.js";const h=1440*60*1e3,F=s=>{if(!s)return"No activity yet";const r=new Date(s),o=Date.now()-r.getTime();if(o<h)return"Today";if(o<h*2)return"Yesterday";const c=Math.floor(o/h);return`${c} day${c!==1?"s":""} ago`},k=s=>typeof s!="number"||Number.isNaN(s)?"–":`${Math.round(s*10)/10}/10`,Y=l.memo(({staff:s=[],summary:r,isDirectorate:o=!1})=>{const c=P(),[m,T]=l.useState(""),[M,D]=l.useState(null),[U,g]=l.useState(!1),x=l.useMemo(()=>{if(r)return{total:r.totalMembers??s.length,activeToday:r.activeToday??0,flagged:r.flaggedMembers??0,submissions:r.submittedInPeriod??0};const t=new Date().toISOString().split("T")[0],a=s.filter(i=>{const N=i.lastCheckin?.date;if(!N)return!1;const j=new Date(N);return j.setHours(0,0,0,0),j.toISOString().split("T")[0]===t}).length,n=s.filter(i=>i.lastCheckin?.needsSupport||(i.periodSummary?.needsSupportDays||0)>0).length,d=s.filter(i=>(i.periodSummary?.submissions||0)>0).length;return{total:s.length,activeToday:a,flagged:n,submissions:d}},[s,r]),A=l.useMemo(()=>{if(!m.trim())return[...s].sort((a,n)=>{const d=a.lastCheckin?.date?new Date(a.lastCheckin.date).getTime():0;return(n.lastCheckin?.date?new Date(n.lastCheckin.date).getTime():0)-d});const t=m.trim().toLowerCase();return s.filter(a=>`${a.name} ${a.email||""} ${a.department||""} ${a.unit||""}`.toLowerCase().includes(t)).sort((a,n)=>{const d=a.lastCheckin?.date?new Date(a.lastCheckin.date).getTime():0;return(n.lastCheckin?.date?new Date(n.lastCheckin.date).getTime():0)-d})},[s,m]),O=l.useCallback(t=>{D({...t,department:t.department||t.unit||"Unit",lastCheckin:t.lastCheckin||null,periodSummary:t.periodSummary||null}),g(!0)},[]),$=l.useCallback(()=>g(!1),[]),f=o?"Organization Wellness Explorer":"Team Members Overview",I=o?"View any staff member’s emotional check-ins and insights.":"Monitor your unit members with real-time insights.";return s.length?e.jsxs(e.Fragment,{children:[e.jsxs(y,{className:"glass glass-card",children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-primary"}),f]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:I})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(u,{className:"w-3.5 h-3.5"})," Total Members"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:x.total})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(B,{className:"w-3.5 h-3.5"})," Active Today"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:x.activeToday})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," Recent Submissions"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:x.submissions})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(S,{className:"w-3.5 h-3.5 text-red-500"})," Needs Support"]}),e.jsx("p",{className:"text-2xl font-semibold text-red-500 mt-1",children:x.flagged})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(_,{value:m,onChange:t=>T(t.target.value),placeholder:o?"Search staff by name, role, unit, or department...":"Search by name, department, or unit...",className:"pl-9 bg-card/60 border-border/60"}),e.jsx(E,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"})]})}),e.jsx("div",{className:"space-y-3 max-h-[28rem] overflow-auto pr-1",children:A.map(t=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3 p-3 border border-border/40 rounded-xl bg-card/30 hover:bg-card/60 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[t.role," - ",t.department||t.unit||"No unit"]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground mt-1",children:["Last check-in: ",F(t.lastCheckin?.date)]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs(p,{variant:"outline",className:"bg-emerald-500/10 text-emerald-500 border-emerald-500/30",children:["Presence ",k(t.periodSummary?.avgPresence??t.overallAvgPresence)]}),e.jsxs(p,{variant:"outline",className:"bg-blue-500/10 text-blue-500 border-blue-500/30",children:["Capacity ",k(t.periodSummary?.avgCapacity??t.overallAvgCapacity)]}),t.lastCheckin?.needsSupport&&e.jsxs(p,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-3 h-3"})," Needs support"]}),t.periodSummary?.submissions>0&&e.jsxs(p,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(R,{className:"w-3 h-3"})," ",t.periodSummary.submissions," in period"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>O(t),className:"flex items-center gap-1",children:["Quick view ",e.jsx(L,{className:"w-3.5 h-3.5"})]}),e.jsx(v,{variant:"secondary",size:"sm",onClick:()=>c(`/emotional-wellness/${t.id||t._id}`,{state:{user:t}}),children:"Full report"})]})]},t.id||t._id||t.email))})]})]}),e.jsx(z,{user:M,isOpen:U,onClose:$})]}):e.jsxs(y,{className:"glass glass-card",children:[e.jsx(b,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-primary"}),f]})}),e.jsx(C,{className:"text-center py-10 text-muted-foreground",children:e.jsx("p",{children:"No staff with check-in data yet."})})]})});Y.displayName="HeadUnitStaffPanel";export{Y as default};
