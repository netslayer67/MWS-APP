import{b as i,f as u,a as g,r as h,j as m,P as b,g as f,h as p,i as k,k as A}from"./index-D-EiwK_h.js";const S=()=>{const r=i(),[t]=u(),l=g();return h.useEffect(()=>{(async()=>{try{const s=t.get("token"),c=t.get("user");if(!s||!c){console.error("Missing token or user data"),r("/login?error=missing_data");return}const o=JSON.parse(decodeURIComponent(c));console.log("ğŸ” OAuth login successful for:",o.email),console.log("ğŸ“Š Initial user data from backend:",o),localStorage.setItem("token",s),localStorage.setItem("auth_token",s);let a=o;try{const e=await f();console.log("ğŸ” Backend /auth/me response:",e),e?.data?.data?.user?a=e.data.data.user:e?.data?.user?a=e.data.user:e?.data&&(a=e.data),console.log("âœ… Canonical user from database:",a)}catch(e){console.warn("âš ï¸ Failed to fetch canonical user via /auth/me:",e),console.log("ğŸ“‹ Using user data from OAuth callback:",o)}a.role||(console.warn("âš ï¸ User missing role field, using query data as fallback"),a={...o,...a});const d=p(a),n=k(a);console.log("ğŸ¯ Role validation for dashboard access:",{userRole:a.role,dashboardRole:d,delegatedFrom:a.dashboardAccess?.delegatedFromName||a.dashboardAccess?.delegatedFromEmail||null,hasDashboardAccess:n,department:a.department,unit:a.unit}),localStorage.setItem("auth_user",JSON.stringify(a)),l(A({user:a,token:s})),console.log("ğŸ“± User state updated in Redux"),console.log("ğŸ¯ Expected dashboard access:",n?"YES":"NO"),r("/support-hub",{replace:!0})}catch(s){console.error("Auth callback error:",s),r("/login?error=callback_failed")}})()},[r,t,l]),m.jsx(b,{})};export{S as default};
