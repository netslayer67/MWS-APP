const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverviewPanel-DJMAnBYE.js","assets/index-C2UXQ8jH.js","assets/index-DsfoYZKM.css","assets/AdminStudentsPanel-BrIW_Jef.js","assets/StudentsTable-CvPrdVIu.js","assets/StatusPills-GbhvPgSH.js","assets/mtssService-BJ4S8av5.js","assets/search-B6bavH_W.js","assets/users-C5NPhcJm.js","assets/AdminMentorsPanel-bUEHrMeH.js","assets/AdminAnalyticsPanel-Dt1-FM__.js"])))=>i.map(i=>d[i]);
import{c as U,ac as F,a4 as Q,S as Y,x as K,d as G,r,b as W,e as J,j as c,m as X,_ as O}from"./index-C2UXQ8jH.js";import{U as B,C as Z}from"./users-round-DCUniJlR.js";import{U as z}from"./user-check-BZDp_6jY.js";import{B as H}from"./building-2-LqSCiKr3.js";import{s as _}from"./socketService-B4WowktR.js";import{a as ee,f as te,b as se}from"./mtssService-BJ4S8av5.js";import{A as oe}from"./arrow-up-right-CVa5tkfO.js";import{M as ae}from"./minus-sgzq3nme.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],re=U("arrow-down-right",ne);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],ie=U("layout-dashboard",ce),le=[{key:"overview",label:"System Overview",icon:ie},{key:"students",label:"All Students",icon:B},{key:"mentors",label:"Manage Mentors",icon:z},{key:"analytics",label:"Analytics Lab",icon:Z}],de={badgeIcon:H,badgeLabel:"Admin / Principal",badgeCaption:"Oversee joyful MTSS momentum",heading:"Multi-Tiered System Dashboard",subheading:"Assign mentors, scan analytics, and celebrate every intervention glow in one playful glass workspace."},ue={tier:K,interventions:Y,activity:Q,mentor:B,stats:F},V=t=>{if(!t)return"-";try{return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(t))}catch{return"-"}},me=[{key:"students",label:"Students in MTSS",caption:"Across all tiers",accent:"from-[#ff80b5] via-[#f472b6] to-[#c084fc]",icon:H},{key:"mentors",label:"Active Mentors",caption:"Teachers & specialists",accent:"from-[#fcd34d] via-[#fb923c] to-[#f87171]",icon:z},{key:"success",label:"Success Rate",caption:"Meeting intervention goals",accent:"from-[#6ee7b7] via-[#34d399] to-[#10b981]",icon:F}],he=(t=0,s=0,e=0)=>me.map(o=>o.key==="students"?{...o,value:t}:o.key==="mentors"?{...o,value:s}:{...o,value:`${e}%`}),pe=(t,s=[])=>{const e=s.length;return{totalStudents:t?.total||e,tierBreakdown:t?.tierBreakdown?.length?t.tierBreakdown:[{label:"Tier 1",count:e,description:`${e} students`}],interventions:t?.interventions?.length?t.interventions.slice(0,5):[{label:"Universal Supports",count:e}]}},fe=(t=[])=>{const s={};t.forEach(o=>{const n=o.type||"Universal Supports",a=s[n]||{total:0,success:0};a.total+=1,["On Track","Completed"].includes(o.progress)&&(a.success+=1),s[n]=a});const e=["from-[#a78bfa] to-[#6366f1]","from-[#f472b6] to-[#fb7185]","from-[#34d399] to-[#10b981]","from-[#22d3ee] to-[#3b82f6]","from-[#fcd34d] to-[#f97316]"];return Object.entries(s).map(([o,n],a)=>({label:o,value:n.total?Math.round(n.success/n.total*100):0,gradient:e[a%e.length]})).sort((o,n)=>n.value-o.value)},ge=t=>{const s=new Date(t),e=new Date(s.getFullYear(),0,1),o=Math.floor((s-e)/864e5),n=Math.ceil((o+e.getDay()+1)/7);return`${s.getFullYear()}-${n}`},be=(t=[])=>{if(!t.length)return{met:"",support:""};const s=600,e=200,o=Math.max(t.length-1,1),n=a=>t.map((f,u)=>{const b=u/o*s,x=e-(f[a]||0)/100*e;return`${u===0?"M":"L"}${b},${x}`}).join(" ");return{met:n("met"),support:n("support")}},ye=(t=[])=>{const s=new Map;t.forEach(n=>{const a=n.updatedAt||n.startDate||n.createdAt;if(!a)return;const f=new Date(a),u=ge(f);s.has(u)||s.set(u,{total:0,success:0,date:f});const b=s.get(u);b.total+=1,["active","completed"].includes(n.status)&&(b.success+=1)});const o=Array.from(s.values()).sort((n,a)=>n.date-a.date).slice(-6).map(n=>{const a=n.total?Math.round(n.success/n.total*100):0;return{label:V(n.date),met:a,support:Math.max(0,100-a)}});return{trendData:o,trendPaths:be(o)}},xe=(t=[])=>{const s=new Map;return t.forEach(e=>{const o=e.mentorId?.name||"Unassigned Mentor";s.has(o)||s.set(o,{name:o,focusAreas:new Set,caseload:0,success:0,total:0});const n=s.get(o);n.total+=1,n.caseload+=e.studentIds?.length||0,e.focusAreas?.length&&e.focusAreas.forEach(a=>n.focusAreas.add(a)),["completed","active"].includes(e.status)&&(n.success+=1)}),Array.from(s.values()).map(e=>({name:e.name,caseload:e.caseload,focus:e.focusAreas.size?Array.from(e.focusAreas).slice(0,2).join(", "):"Tiered Supports",trend:e.total?`${Math.round(e.success/e.total*100)}% success`:"New mentor"})).sort((e,o)=>o.caseload-e.caseload).slice(0,3)},ve=(t=[])=>{const s=new Map;return t.forEach(e=>{const o=e.mentorId?._id||e.mentorId?.name||"unassigned";s.has(o)||s.set(o,{name:e.mentorId?.name||"Unassigned",role:e.mentorId?.jobPosition||e.mentorId?.role||"Mentor",students:0,total:0,completed:0});const n=s.get(o);n.students+=e.studentIds?.length||0,n.total+=1,e.status==="completed"&&(n.completed+=1)}),Array.from(s.values()).map(e=>({name:e.name,role:e.role,activeStudents:e.students,successRate:e.total?`${Math.round(e.completed/e.total*100)}%`:"0%"})).sort((e,o)=>o.activeStudents-e.activeStudents)},Se=(t=[])=>{const s={};return t.forEach(e=>{(e.focusAreas||[]).forEach(o=>{s[o]=(s[o]||0)+1})}),Object.entries(s).sort((e,o)=>o[1]-e[1]).slice(0,4).map(([e,o])=>({label:e,value:`${o} active`}))},we=(t=[])=>{const s=t.filter(n=>["On Track","Completed"].includes(n.progress)).length,e=t.filter(n=>n.progress==="Needs Attention").length,o=Math.max(0,t.length-s-e);return[{label:"Improved",detail:`${s} students`,accent:"text-emerald-500",icon:oe},{label:"Needs Support",detail:`${e} students`,accent:"text-rose-500",icon:re},{label:"Stable",detail:`${o} students`,accent:"text-sky-500",icon:ae}]},Me=(t=[])=>{const s=[];return t.forEach(e=>{const o=e.studentIds?.[0]?.name||"Student group",n=e.mentorId?.name||"Mentor team",a=e.checkIns?.slice(-1)[0];a?s.push({date:a.date,student:o,mentor:n,activity:a.summary||"Progress update recorded"}):s.push({date:e.updatedAt||e.startDate||e.createdAt,student:o,mentor:n,activity:`Status updated to ${e.status}`})}),s.filter(e=>e.date).sort((e,o)=>new Date(o.date)-new Date(e.date)).slice(0,6).map(e=>({...e,date:V(e.date)}))},Ae=(t=[])=>{if(!t.length)return 0;const s=t.filter(e=>e.status==="completed").length;return Math.round(s/t.length*100)},ke=650,je=()=>{const{user:t}=G(d=>d.auth),[s,e]=r.useState([]),[o,n]=r.useState(null),[a,f]=r.useState([]),[u,b]=r.useState([]),[x,A]=r.useState(!0),[T,D]=r.useState(null),v=r.useCallback((d=[])=>{d.length&&e(h=>{const g=new Map(h.map(p=>[p.id||p._id,p]));return d.forEach(p=>{const M=p.id||p._id;if(!M)return;const P=g.get(M)||{};g.set(M,{...P,...p})}),Array.from(g.values()).sort((p,M)=>p.name.localeCompare(M.name))})},[]),S=r.useCallback((d,h)=>{h?._id&&f(g=>{const p=g.findIndex(P=>P._id===h._id);if(d==="deleted"){if(p===-1)return g;const P=[...g];return P.splice(p,1),P}if(p===-1)return[...g,h];const M=[...g];return M[p]=h,M})},[]),y=r.useCallback(async()=>{A(!0),D(null);try{const[d,h,g]=await Promise.all([ee({limit:ke}),te(),se()]);e(d.students||[]),n(d.summary||null),f(h.assignments||[]),b(g.mentors||[])}catch(d){D(d?.response?.data?.message||d.message||"Failed to load MTSS dashboard data")}finally{A(!1)}},[]);r.useEffect(()=>{y()},[y]),r.useEffect(()=>{if(!t?.id&&!t?._id)return;_.connect(),_.joinMtssAdmin();const d=g=>{v(g?.students||[])},h=({action:g,assignment:p})=>{S(g||"updated",p)};return _.onMtssStudentsChanged(d),_.onMtssAssignment(h),()=>{_.offMtssStudentsChanged(d),_.offMtssAssignment(h),_.leaveMtssAdmin()}},[t,v,S]);const I=r.useMemo(()=>u?.length?u.length:new Set(a.map(h=>h.mentorId?._id||h.mentorId)).size,[u,a]),k=r.useMemo(()=>Ae(a),[a]),N=r.useMemo(()=>he(s.length,I,k),[s.length,I,k]),l=r.useMemo(()=>pe(o,s),[o,s]),i=r.useMemo(()=>fe(s),[s]),{trendData:m,trendPaths:w}=r.useMemo(()=>ye(a),[a]),C=r.useMemo(()=>xe(a),[a]),j=r.useMemo(()=>ve(a),[a]),E=r.useMemo(()=>Se(a),[a]),R=r.useMemo(()=>we(s),[s]),L=r.useMemo(()=>Me(a),[a]);return{students:s,assignments:a,mentors:u,statCards:N,systemSnapshot:l,successByType:i,trendData:m,trendPaths:w,mentorSpotlights:C,mentorRoster:j,strategyHighlights:E,tierMovement:R,recentActivity:L,loading:x,error:T,refresh:y}},$=(t=[],s)=>{const e=new Set;return t.forEach(o=>{const n=o[s];n&&e.add(n)}),["all",...Array.from(e)]},_e=(t=[])=>{const s=W(),{toast:e}=J(),[o,n]=r.useState("overview"),[a,f]=r.useState({grade:"all",tier:"all",type:"all",mentor:"all",query:""}),[u,b]=r.useState([]),x=r.useMemo(()=>{const l=a.query.trim().toLowerCase();return t.filter(i=>{const m=a.grade==="all"||i.grade===a.grade,w=a.tier==="all"||i.tier===a.tier,C=a.type==="all"||i.type===a.type,j=i.mentor||i.profile?.mentor,E=a.mentor==="all"||j===a.mentor,R=!l||i.name?.toLowerCase().includes(l)||i.type?.toLowerCase().includes(l)||j?.toLowerCase().includes(l);return m&&w&&C&&E&&R})},[t,a]),A=r.useMemo(()=>$(t,"grade"),[t]),T=r.useMemo(()=>$(t,"tier"),[t]),D=r.useMemo(()=>$(t,"type"),[t]),v=r.useMemo(()=>{const l=new Set;return t.forEach(i=>{const m=i.mentor||i.profile?.mentor;m&&l.add(m)}),["all",...Array.from(l)]},[t]),S=r.useCallback((l,i)=>{f(m=>({...m,[l]:i}))},[]),y=r.useCallback(l=>{const i=l.id||l._id;i&&b(m=>m.includes(i)?m.filter(w=>w!==i):[...m,i])},[]),I=r.useCallback(()=>b([]),[]);r.useEffect(()=>{b(l=>l.filter(i=>t.some(m=>(m.id||m._id)===i)))},[t]);const k=r.useCallback(l=>{s(`/mtss/student/${l.slug}`)},[s]),N=r.useCallback(l=>{e({title:"Mentor nudged",description:`Flagged ${l.name}'s plan for a system review.`})},[e]);return{activeTab:o,setActiveTab:n,filters:a,handleFilterChange:S,filteredStudents:x,gradeOptions:A,tierOptions:T,typeOptions:D,mentorOptions:v,selectedIds:u,toggleSelection:y,resetSelection:I,handleViewStudent:k,handleQuickUpdate:N}},q=({heroCard:t,tabs:s,activeTab:e,onTabChange:o})=>{const n=t.badgeIcon;return c.jsxs("div",{className:"space-y-4",children:[c.jsxs("div",{className:"inline-flex items-center gap-3 px-5 py-2 rounded-full bg-white/80 dark:bg-white/10 backdrop-blur-xl shadow-lg",children:[c.jsx(n,{className:"w-5 h-5 text-rose-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.5em] text-muted-foreground",children:t.badgeLabel}),c.jsx("p",{className:"text-sm font-semibold",children:t.badgeCaption})]})]}),c.jsxs("div",{children:[c.jsx("h1",{className:"text-4xl md:text-5xl font-black tracking-tight",children:t.heading}),c.jsx("p",{className:"text-base md:text-lg text-muted-foreground dark:text-white/80 mt-2",children:t.subheading})]}),c.jsx("div",{className:"flex flex-wrap gap-3 pt-2",children:s.map(a=>{const f=a.icon,u=e===a.key;return c.jsxs("button",{onClick:()=>o(a.key),className:`px-5 py-3 rounded-full border backdrop-blur-xl font-semibold text-sm flex items-center gap-2 transition shadow-lg ${u?"bg-gradient-to-r from-[#ffe29f] via-[#ffa99f] to-[#ff719a] text-[#831843] border-white/60 shadow-[0_10px_30px_rgba(255,113,154,0.45)]":"bg-white/25 text-white border-white/30 hover:bg-white/40 hover:text-rose-100"}`,children:[c.jsx(f,{className:"w-4 h-4"}),a.label]},a.key)})})]})};q.displayName="AdminHeroSection";const Te=r.memo(q),De=r.lazy(()=>O(()=>import("./AdminOverviewPanel-DJMAnBYE.js"),__vite__mapDeps([0,1,2]))),Ie=r.lazy(()=>O(()=>import("./AdminStudentsPanel-BrIW_Jef.js"),__vite__mapDeps([3,1,2,4,5,6,7,8]))),Ne=r.lazy(()=>O(()=>import("./AdminMentorsPanel-bUEHrMeH.js"),__vite__mapDeps([9,1,2,6,7]))),Ce=r.lazy(()=>O(()=>import("./AdminAnalyticsPanel-Dt1-FM__.js"),__vite__mapDeps([10,1,2]))),Ee=()=>c.jsx("div",{className:"glass glass-card p-8 text-center text-muted-foreground animate-pulse",children:"Loading dashboard..."}),Re=r.memo(()=>{const{students:t,statCards:s,systemSnapshot:e,recentActivity:o,mentorSpotlights:n,mentorRoster:a,mentors:f,successByType:u,trendData:b,trendPaths:x,strategyHighlights:A,tierMovement:T,loading:D,error:v,refresh:S}=je(),{activeTab:y,setActiveTab:I,filters:k,handleFilterChange:N,filteredStudents:l,gradeOptions:i,tierOptions:m,typeOptions:w,mentorOptions:C,handleViewStudent:j,handleQuickUpdate:E,selectedIds:R,toggleSelection:L,resetSelection:d}=_e(t),h=r.useMemo(()=>{switch(y){case"overview":return c.jsx(De,{statCards:s,systemSnapshot:e,recentActivity:o,mentorSpotlights:n,icons:ue});case"students":return c.jsx(Ie,{filters:k,onFilterChange:N,gradeOptions:i,tierOptions:m,typeOptions:w,mentorOptions:C,filteredStudents:l,allStudents:t,onViewStudent:j,onUpdateStudent:E,selectedIds:R,onToggleSelect:L,onResetSelection:d,mentorDirectory:f,onRefresh:S});case"mentors":return c.jsx(Ne,{mentorRoster:a,mentorDirectory:f,students:t,onRefresh:S});case"analytics":return c.jsx(Ce,{successByType:u,trendPaths:x,trendData:b,strategyHighlights:A,tierMovement:T});default:return null}},[y,k,i,m,w,C,l,N,j,E,R,L,d,a,f,s,e,o,n,u,b,x,A,T]);return c.jsxs("div",{className:"mtss-theme mtss-animated-bg min-h-screen relative overflow-hidden",children:[c.jsx("div",{className:"mtss-bg-overlay"}),c.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[c.jsx("div",{className:"absolute -top-20 left-0 w-96 h-96 bg-[#ff80b5]/30 blur-[180px]"}),c.jsx("div",{className:"absolute top-40 right-0 w-80 h-80 bg-[#60a5fa]/30 blur-[180px]"}),c.jsx("div",{className:"absolute bottom-0 left-1/3 w-96 h-96 bg-[#fcd34d]/20 blur-[180px]"})]}),c.jsxs("div",{className:"relative z-20 container-tight py-12 lg:py-16 text-foreground dark:text-white space-y-10",children:[c.jsx(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},"data-aos":"fade-up",children:c.jsx(Te,{heroCard:de,tabs:le,activeTab:y,onTabChange:I})}),(D||v)&&c.jsxs("div",{className:"rounded-2xl border border-border/50 bg-white/70 dark:bg-white/10 px-4 py-3 flex items-center justify-between gap-4 text-sm text-muted-foreground",children:[c.jsx("span",{children:v||"Syncing MTSS data..."}),v&&c.jsx("button",{onClick:S,className:"text-primary font-semibold hover:underline",children:"Retry"})]}),c.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:c.jsx(r.Suspense,{fallback:c.jsx(Ee,{}),children:h})})]})]})});Re.displayName="AdminDashboardPage";export{Re as default};
