const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverviewPanel-vJOb-rsu.js","assets/index-Cnj6MzVP.js","assets/index-DD5EX_zQ.css","assets/AdminStudentsPanel-CDixn46y.js","assets/StudentsTable-CZZq8iQ9.js","assets/StatusPills-DZ7PzKBN.js","assets/mtssService-uugoVs1o.js","assets/funnel-BafKO4fe.js","assets/shuffle-M-K5aEnU.js","assets/search-B1o0cIR0.js","assets/users-Bgn_lGp2.js","assets/AdminMentorsPanel-B6TnALXa.js","assets/AdminAnalyticsPanel-DuO6oxhd.js"])))=>i.map(i=>d[i]);
import{c as U,ac as F,a4 as Q,S as Y,x as K,d as G,r,b as W,e as J,j as c,m as X,_ as O}from"./index-Cnj6MzVP.js";import{U as B,C as Z}from"./users-round-_8ZJK5LM.js";import{U as z}from"./user-check-BaxstMl0.js";import{B as H}from"./building-2-ro5EnQau.js";import{s as _}from"./socketService-B4WowktR.js";import{a as ee,f as te,b as se}from"./mtssService-uugoVs1o.js";import{A as ae}from"./arrow-up-right-DCLYwhtO.js";import{M as oe}from"./minus-B6iwwJeP.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ne=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],re=U("arrow-down-right",ne);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],ie=U("layout-dashboard",ce),le=[{key:"overview",label:"System Overview",icon:ie},{key:"students",label:"All Students",icon:B},{key:"mentors",label:"Manage Mentors",icon:z},{key:"analytics",label:"Analytics Lab",icon:Z}],de={badgeIcon:H,badgeLabel:"Admin / Principal",badgeCaption:"Oversee joyful MTSS momentum",heading:"Multi-Tiered System Dashboard",subheading:"Assign mentors, scan analytics, and celebrate every intervention glow in one playful glass workspace."},ue={tier:K,interventions:Y,activity:Q,mentor:B,stats:F},V=t=>{if(!t)return"-";try{return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(t))}catch{return"-"}},me=[{key:"students",label:"Students in MTSS",caption:"Across all tiers",accent:"from-[#ff80b5] via-[#f472b6] to-[#c084fc]",icon:H},{key:"mentors",label:"Active Mentors",caption:"Teachers & specialists",accent:"from-[#fcd34d] via-[#fb923c] to-[#f87171]",icon:z},{key:"success",label:"Success Rate",caption:"Meeting intervention goals",accent:"from-[#6ee7b7] via-[#34d399] to-[#10b981]",icon:F}],he=(t=0,a=0,e=0)=>me.map(o=>o.key==="students"?{...o,value:t}:o.key==="mentors"?{...o,value:a}:{...o,value:`${e}%`}),pe=(t,a=[])=>{const e=a.length;return{totalStudents:t?.total||e,tierBreakdown:t?.tierBreakdown?.length?t.tierBreakdown:[{label:"Tier 1",count:e,description:`${e} students`}],interventions:t?.interventions?.length?t.interventions.slice(0,5):[{label:"Universal Supports",count:e}]}},fe=(t=[])=>{const a={};t.forEach(o=>{const n=o.type||"Universal Supports",s=a[n]||{total:0,success:0};s.total+=1,["On Track","Completed"].includes(o.progress)&&(s.success+=1),a[n]=s});const e=["from-[#a78bfa] to-[#6366f1]","from-[#f472b6] to-[#fb7185]","from-[#34d399] to-[#10b981]","from-[#22d3ee] to-[#3b82f6]","from-[#fcd34d] to-[#f97316]"];return Object.entries(a).map(([o,n],s)=>({label:o,value:n.total?Math.round(n.success/n.total*100):0,gradient:e[s%e.length]})).sort((o,n)=>n.value-o.value)},ge=t=>{const a=new Date(t),e=new Date(a.getFullYear(),0,1),o=Math.floor((a-e)/864e5),n=Math.ceil((o+e.getDay()+1)/7);return`${a.getFullYear()}-${n}`},be=(t=[])=>{if(!t.length)return{met:"",support:""};const a=600,e=200,o=Math.max(t.length-1,1),n=s=>t.map((d,u)=>{const b=u/o*a,y=e-(d[s]||0)/100*e;return`${u===0?"M":"L"}${b},${y}`}).join(" ");return{met:n("met"),support:n("support")}},ye=(t=[])=>{const a=new Map;t.forEach(n=>{const s=n.updatedAt||n.startDate||n.createdAt;if(!s)return;const d=new Date(s),u=ge(d);a.has(u)||a.set(u,{total:0,success:0,date:d});const b=a.get(u);b.total+=1,["active","completed"].includes(n.status)&&(b.success+=1)});const o=Array.from(a.values()).sort((n,s)=>n.date-s.date).slice(-6).map(n=>{const s=n.total?Math.round(n.success/n.total*100):0;return{label:V(n.date),met:s,support:Math.max(0,100-s)}});return{trendData:o,trendPaths:be(o)}},ve=(t=[])=>{const a=new Map;return t.forEach(e=>{const o=e.mentorId?.name||"Unassigned Mentor";a.has(o)||a.set(o,{name:o,focusAreas:new Set,caseload:0,success:0,total:0});const n=a.get(o);n.total+=1,n.caseload+=e.studentIds?.length||0,e.focusAreas?.length&&e.focusAreas.forEach(s=>n.focusAreas.add(s)),["completed","active"].includes(e.status)&&(n.success+=1)}),Array.from(a.values()).map(e=>({name:e.name,caseload:e.caseload,focus:e.focusAreas.size?Array.from(e.focusAreas).slice(0,2).join(", "):"Tiered Supports",trend:e.total?`${Math.round(e.success/e.total*100)}% success`:"New mentor"})).sort((e,o)=>o.caseload-e.caseload).slice(0,3)},xe=(t=[])=>{const a=new Map;return t.forEach(e=>{const o=e.mentorId?._id?.toString?.()||null,n=e.mentorId?.email||null,s=o||n||e.mentorId?.name||"unassigned";a.has(s)||a.set(s,{id:o,email:n,name:e.mentorId?.name||"Unassigned",role:e.mentorId?.jobPosition||e.mentorId?.role||"Mentor",students:0,total:0,completed:0});const d=a.get(s);d.students+=e.studentIds?.length||0,d.total+=1,e.status==="completed"&&(d.completed+=1)}),Array.from(a.values()).map(e=>({_id:e.id,email:e.email,name:e.name,role:e.role,activeStudents:e.students,successRate:e.total?`${Math.round(e.completed/e.total*100)}%`:"0%"})).sort((e,o)=>o.activeStudents-e.activeStudents)},we=(t=[])=>{const a={};return t.forEach(e=>{(e.focusAreas||[]).forEach(o=>{a[o]=(a[o]||0)+1})}),Object.entries(a).sort((e,o)=>o[1]-e[1]).slice(0,4).map(([e,o])=>({label:e,value:`${o} active`}))},Se=(t=[])=>{const a=t.filter(n=>["On Track","Completed"].includes(n.progress)).length,e=t.filter(n=>n.progress==="Needs Attention").length,o=Math.max(0,t.length-a-e);return[{label:"Improved",detail:`${a} students`,accent:"text-emerald-500",icon:ae},{label:"Needs Support",detail:`${e} students`,accent:"text-rose-500",icon:re},{label:"Stable",detail:`${o} students`,accent:"text-sky-500",icon:oe}]},Me=(t=[])=>{const a=[];return t.forEach(e=>{const o=e.studentIds?.[0]?.name||"Student group",n=e.mentorId?.name||"Mentor team",s=e.checkIns?.slice(-1)[0];s?a.push({date:s.date,student:o,mentor:n,activity:s.summary||"Progress update recorded"}):a.push({date:e.updatedAt||e.startDate||e.createdAt,student:o,mentor:n,activity:`Status updated to ${e.status}`})}),a.filter(e=>e.date).sort((e,o)=>new Date(o.date)-new Date(e.date)).slice(0,6).map(e=>({...e,date:V(e.date)}))},ke=(t=[])=>{if(!t.length)return 0;const a=t.filter(e=>e.status==="completed").length;return Math.round(a/t.length*100)},Ae=650,je=()=>{const{user:t}=G(m=>m.auth),[a,e]=r.useState([]),[o,n]=r.useState(null),[s,d]=r.useState([]),[u,b]=r.useState([]),[y,x]=r.useState(!0),[T,C]=r.useState(null),w=r.useCallback((m=[])=>{m.length&&e(p=>{const g=new Map(p.map(f=>[f.id||f._id,f]));return m.forEach(f=>{const k=f.id||f._id;if(!k)return;const P=g.get(k)||{};g.set(k,{...P,...f})}),Array.from(g.values()).sort((f,k)=>f.name.localeCompare(k.name))})},[]),S=r.useCallback((m,p)=>{p?._id&&d(g=>{const f=g.findIndex(P=>P._id===p._id);if(m==="deleted"){if(f===-1)return g;const P=[...g];return P.splice(f,1),P}if(f===-1)return[...g,p];const k=[...g];return k[f]=p,k})},[]),v=r.useCallback(async()=>{x(!0),C(null);try{const[m,p,g]=await Promise.all([ee({limit:Ae}),te(),se()]);e(m.students||[]),n(m.summary||null),d(p.assignments||[]),b(g.mentors||[])}catch(m){C(m?.response?.data?.message||m.message||"Failed to load MTSS dashboard data")}finally{x(!1)}},[]);r.useEffect(()=>{v()},[v]),r.useEffect(()=>{if(!t?.id&&!t?._id)return;_.connect(),_.joinMtssAdmin();const m=g=>{w(g?.students||[])},p=({action:g,assignment:f})=>{S(g||"updated",f)};return _.onMtssStudentsChanged(m),_.onMtssAssignment(p),()=>{_.offMtssStudentsChanged(m),_.offMtssAssignment(p),_.leaveMtssAdmin()}},[t,w,S]);const I=r.useMemo(()=>u?.length?u.length:new Set(s.map(p=>p.mentorId?._id||p.mentorId)).size,[u,s]),A=r.useMemo(()=>ke(s),[s]),N=r.useMemo(()=>he(a.length,I,A),[a.length,I,A]),l=r.useMemo(()=>pe(o,a),[o,a]),i=r.useMemo(()=>fe(a),[a]),{trendData:h,trendPaths:M}=r.useMemo(()=>ye(s),[s]),D=r.useMemo(()=>ve(s),[s]),j=r.useMemo(()=>xe(s),[s]),E=r.useMemo(()=>we(s),[s]),R=r.useMemo(()=>Se(a),[a]),L=r.useMemo(()=>Me(s),[s]);return{students:a,assignments:s,mentors:u,statCards:N,systemSnapshot:l,successByType:i,trendData:h,trendPaths:M,mentorSpotlights:D,mentorRoster:j,strategyHighlights:E,tierMovement:R,recentActivity:L,loading:y,error:T,refresh:v}},$=(t=[],a)=>{const e=new Set;return t.forEach(o=>{const n=o[a];n&&e.add(n)}),["all",...Array.from(e)]},_e=(t=[])=>{const a=W(),{toast:e}=J(),[o,n]=r.useState("overview"),[s,d]=r.useState({grade:"all",tier:"all",type:"all",mentor:"all",query:""}),[u,b]=r.useState([]),y=r.useMemo(()=>{const l=s.query.trim().toLowerCase();return t.filter(i=>{const h=s.grade==="all"||i.grade===s.grade,M=s.tier==="all"||i.tier===s.tier,D=s.type==="all"||i.type===s.type,j=i.mentor||i.profile?.mentor,E=s.mentor==="all"||j===s.mentor,R=!l||i.name?.toLowerCase().includes(l)||i.type?.toLowerCase().includes(l)||j?.toLowerCase().includes(l);return h&&M&&D&&E&&R})},[t,s]),x=r.useMemo(()=>$(t,"grade"),[t]),T=r.useMemo(()=>$(t,"tier"),[t]),C=r.useMemo(()=>$(t,"type"),[t]),w=r.useMemo(()=>{const l=new Set;return t.forEach(i=>{const h=i.mentor||i.profile?.mentor;h&&l.add(h)}),["all",...Array.from(l)]},[t]),S=r.useCallback((l,i)=>{d(h=>({...h,[l]:i}))},[]),v=r.useCallback(l=>{const i=l.id||l._id;i&&b(h=>h.includes(i)?h.filter(M=>M!==i):[...h,i])},[]),I=r.useCallback(()=>b([]),[]);r.useEffect(()=>{b(l=>l.filter(i=>t.some(h=>(h.id||h._id)===i)))},[t]);const A=r.useCallback(l=>{a(`/mtss/student/${l.slug}`)},[a]),N=r.useCallback(l=>{e({title:"Mentor nudged",description:`Flagged ${l.name}'s plan for a system review.`})},[e]);return{activeTab:o,setActiveTab:n,filters:s,handleFilterChange:S,filteredStudents:y,gradeOptions:x,tierOptions:T,typeOptions:C,mentorOptions:w,selectedIds:u,toggleSelection:v,resetSelection:I,handleViewStudent:A,handleQuickUpdate:N}},q=({heroCard:t,tabs:a,activeTab:e,onTabChange:o})=>{const n=t.badgeIcon;return c.jsxs("div",{className:"space-y-4","data-aos":"fade-up",children:[c.jsxs("div",{className:"inline-flex items-center gap-3 px-5 py-2 rounded-full bg-gradient-to-r from-white/90 via-white/70 to-white/50 dark:from-white/10 dark:via-white/5 dark:to-white/5 backdrop-blur-xl shadow-lg border border-white/60 dark:border-white/10",children:[c.jsx(n,{className:"w-5 h-5 text-rose-500"}),c.jsxs("div",{children:[c.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.5em] text-muted-foreground",children:t.badgeLabel}),c.jsx("p",{className:"text-sm font-semibold text-slate-700 dark:text-white",children:t.badgeCaption})]})]}),c.jsxs("div",{"data-aos":"fade-up","data-aos-delay":"100",children:[c.jsx("h1",{className:"text-4xl md:text-5xl font-black tracking-tight text-slate-900 dark:text-white",children:t.heading}),c.jsx("p",{className:"text-base md:text-lg text-slate-600 dark:text-white/80 mt-2",children:t.subheading})]}),c.jsx("div",{className:"flex flex-wrap gap-3 pt-2","data-aos":"zoom-in","data-aos-delay":"150",children:a.map(s=>{const d=s.icon,u=e===s.key;return c.jsxs("button",{onClick:()=>o(s.key),className:`px-5 py-3 rounded-full border backdrop-blur-xl font-semibold text-sm flex items-center gap-2 transition shadow-lg relative overflow-hidden group ${u?"bg-gradient-to-r from-[#ffe29f] via-[#ffa99f] to-[#ff719a] text-[#5b0f45] border-white/70 shadow-[0_10px_30px_rgba(255,113,154,0.35)]":"bg-gradient-to-r from-white/85 via-white/70 to-white/55 border-white/70 text-slate-600 dark:from-white/10 dark:via-white/5 dark:to-white/5 dark:text-white/80 hover:border-white/90"}`,children:[c.jsx("span",{"aria-hidden":"true",className:`absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition pointer-events-none ${u?"bg-white/10":"bg-white/30 dark:bg-white/10"}`}),c.jsx(d,{className:"w-4 h-4"}),c.jsx("span",{className:"relative",children:s.label})]},s.key)})})]})};q.displayName="AdminHeroSection";const Te=r.memo(q),Ce=r.lazy(()=>O(()=>import("./AdminOverviewPanel-vJOb-rsu.js"),__vite__mapDeps([0,1,2]))),Ie=r.lazy(()=>O(()=>import("./AdminStudentsPanel-CDixn46y.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10]))),Ne=r.lazy(()=>O(()=>import("./AdminMentorsPanel-B6TnALXa.js"),__vite__mapDeps([11,1,2,6,9]))),De=r.lazy(()=>O(()=>import("./AdminAnalyticsPanel-DuO6oxhd.js"),__vite__mapDeps([12,1,2]))),Ee=()=>c.jsx("div",{className:"glass glass-card p-8 text-center text-muted-foreground animate-pulse",children:"Loading dashboard..."}),Re=r.memo(()=>{const{students:t,statCards:a,systemSnapshot:e,recentActivity:o,mentorSpotlights:n,mentorRoster:s,mentors:d,successByType:u,trendData:b,trendPaths:y,strategyHighlights:x,tierMovement:T,loading:C,error:w,refresh:S}=je(),{activeTab:v,setActiveTab:I,filters:A,handleFilterChange:N,filteredStudents:l,gradeOptions:i,tierOptions:h,typeOptions:M,mentorOptions:D,handleViewStudent:j,handleQuickUpdate:E,selectedIds:R,toggleSelection:L,resetSelection:m}=_e(t),p=r.useMemo(()=>{switch(v){case"overview":return c.jsx(Ce,{statCards:a,systemSnapshot:e,recentActivity:o,mentorSpotlights:n,icons:ue});case"students":return c.jsx(Ie,{filters:A,onFilterChange:N,gradeOptions:i,tierOptions:h,typeOptions:M,mentorOptions:D,filteredStudents:l,allStudents:t,onViewStudent:j,onUpdateStudent:E,selectedIds:R,onToggleSelect:L,onResetSelection:m,mentorDirectory:d,onRefresh:S});case"mentors":return c.jsx(Ne,{mentorRoster:s,mentorDirectory:d,students:t,onRefresh:S});case"analytics":return c.jsx(De,{successByType:u,trendPaths:y,trendData:b,strategyHighlights:x,tierMovement:T});default:return null}},[v,A,i,h,M,D,l,N,j,E,R,L,m,s,d,a,e,o,n,u,b,y,x,T]);return c.jsxs("div",{className:"mtss-theme mtss-animated-bg min-h-screen relative overflow-hidden",children:[c.jsx("div",{className:"mtss-bg-overlay"}),c.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[c.jsx("div",{className:"absolute -top-20 left-0 w-96 h-96 bg-[#ff80b5]/30 blur-[180px]"}),c.jsx("div",{className:"absolute top-40 right-0 w-80 h-80 bg-[#60a5fa]/30 blur-[180px]"}),c.jsx("div",{className:"absolute bottom-0 left-1/3 w-96 h-96 bg-[#fcd34d]/20 blur-[180px]"})]}),c.jsxs("div",{className:"relative z-20 container-tight py-12 lg:py-16 text-foreground dark:text-white space-y-10",children:[c.jsx(X.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},"data-aos":"fade-up",children:c.jsx(Te,{heroCard:de,tabs:le,activeTab:v,onTabChange:I})}),(C||w)&&c.jsxs("div",{className:"rounded-2xl border border-border/50 bg-white/70 dark:bg-white/10 px-4 py-3 flex items-center justify-between gap-4 text-sm text-muted-foreground",children:[c.jsx("span",{children:w||"Syncing MTSS data..."}),w&&c.jsx("button",{onClick:S,className:"text-primary font-semibold hover:underline",children:"Retry"})]}),c.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:c.jsx(r.Suspense,{fallback:c.jsx(Ee,{}),children:p})})]})]})});Re.displayName="AdminDashboardPage";export{Re as default};
