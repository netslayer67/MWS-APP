import{r as l,a as L,u as _,b as j,Q as $,j as e,U as P,B,q as F,T as H,V as z,x as R,m as I,W as q,Y as Q}from"./index-lpRWoASH.js";import{C as w,a as E,b as T,c as U}from"./card-BaYfutPz.js";import{S as W,a as Y,b as O,c as G,d as J}from"./select-CpJSNt86.js";import{B as A}from"./badge-Bn4tkwop.js";import"./progress-DC0gZlTA.js";import{E as K}from"./eye-D_BYxpZy.js";import"./index-DkVq32a8.js";import"./chevron-down-DTSZYwmu.js";import"./check-CEhz4DPE.js";const V=l.memo(({selectedUser:v,onUserSelect:k,selectedPeriod:d,loading:N})=>{const y=L(),x=_(),{users:n}=j(s=>s.users),{user:b}=j(s=>s.auth),{checkinHistory:g}=j(s=>s.checkin),[c,S]=l.useState(v?.id||""),[C,D]=l.useState([]);l.useEffect(()=>{n.length===0&&(async()=>{let o=[],h=1,f=!0;for(;f;)try{const u=await x(H({page:h,limit:100,isActive:!0})).unwrap(),r=u.users||[];if(o=[...o,...r],f=u.pagination&&u.pagination.hasNext,h++,h>100)break}catch(u){console.error("Error fetching users page:",h,u);try{if(b?.role==="head_unit"){const r=await z(),m=r.data?.data?.users||r.data?.users||[];D(m)}}catch(r){console.error("Failed to fetch unit members fallback:",r)}break}o.length>0&&console.log(`Fetched ${o.length} total users`)})()},[x,n.length]),l.useEffect(()=>{c&&x($({page:1,limit:100,userId:c}))},[x,c]);const p=n.length>0?n:C,M=s=>{S(s);const o=p.find(h=>h.id===s);k(o)},a=l.useMemo(()=>{if(!c||!g)return[];const s=g.data||g;return Array.isArray(s)?s:s.checkins||[]},[c,g]),t=l.useMemo(()=>{if(a.length===0)return null;const s=a.slice(0,7),o=s.reduce((r,m)=>r+m.presenceLevel,0)/s.length,h=s.reduce((r,m)=>r+m.capacityLevel,0)/s.length,f={};s.forEach(r=>{r.selectedMoods?.forEach(m=>{f[m]=(f[m]||0)+1})});const u=Object.entries(f).sort(([,r],[,m])=>m-r).slice(0,3);return{avgPresence:Math.round(o*10)/10,avgCapacity:Math.round(h*10)/10,topMoods:u,checkinCount:s.length,trend:o>6?"improving":o<4?"concerning":"stable"}},[a]);l.useMemo(()=>a.filter(s=>s.details).slice(0,5).map(s=>({date:new Date(s.date).toLocaleDateString(),details:s.details,weatherType:s.weatherType,moods:s.selectedMoods})),[a]);const i=p.find(s=>s.id===c);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(w,{children:[e.jsx(E,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),"Select User for Individual Analysis"]})}),e.jsx(U,{children:e.jsxs(W,{value:c,onValueChange:M,children:[e.jsx(Y,{className:"w-full bg-card/50 border-border/50 hover:bg-card/70 transition-colors",children:e.jsx(O,{placeholder:"Choose a user to analyze..."})}),e.jsx(G,{className:"max-h-80 overflow-y-auto bg-card/95 backdrop-blur-sm border-border/50",children:p.length>0?p.map(s=>e.jsx(J,{value:s.id||s._id,className:"hover:bg-primary/10 focus:bg-primary/10 cursor-pointer py-3 px-3",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("span",{className:"font-medium text-foreground text-sm",children:s.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.role," ",s.department&&`â€¢ ${s.department}`," ",s.unit&&`â€¢ ${s.unit}`]})]})},s.id||s._id)):e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:e.jsx("p",{children:"No users available"})})})]})})]}),i&&a.length>0&&e.jsx(e.Fragment,{children:e.jsxs(w,{children:[e.jsx(E,{children:e.jsxs(T,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"w-5 h-5"}),i.name]}),e.jsxs(B,{variant:"outline",size:"sm",onClick:()=>y(`/emotional-wellness/${c}`),className:"flex items-center gap-2",children:[e.jsx(K,{className:"w-4 h-4"}),"View Full Report"]})]})}),e.jsxs(U,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-primary",children:a.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Check-ins"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:t?.avgPresence||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Presence"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:t?.avgCapacity||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Capacity"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-purple-600",children:a.filter(s=>s.aiAnalysis?.needsSupport).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Support Flags"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Latest Check-in"}),a[0]&&e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:new Date(a[0].date).toLocaleDateString()}),e.jsx(A,{variant:"outline",className:"text-xs",children:a[0].weatherType})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:["Presence: ",e.jsxs("span",{className:"font-medium",children:[a[0].presenceLevel,"/10"]})]}),e.jsxs("div",{children:["Capacity: ",e.jsxs("span",{className:"font-medium",children:[a[0].capacityLevel,"/10"]})]})]}),a[0].selectedMoods?.length>0&&e.jsx("div",{className:"mt-2 flex gap-1",children:a[0].selectedMoods.slice(0,3).map(s=>e.jsx(A,{variant:"secondary",className:"text-xs",children:s},s))})]})]})]})]})}),(!c||a.length===0)&&e.jsx(w,{children:e.jsxs(U,{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/30 flex items-center justify-center mx-auto mb-6",children:e.jsx(F,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Individual User Analytics"}),e.jsx("p",{className:"text-muted-foreground text-base leading-relaxed",children:c?`${i?.name||"Selected user"} hasn't completed any emotional check-ins yet.`:"Select a user from the dropdown above to view their comprehensive emotional wellness report, including check-in history, AI analysis insights, and personalized recommendations."}),e.jsx("div",{className:"mt-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-primary font-medium",children:"ðŸ“Š Access detailed individual reports to provide targeted support and track progress over time."})})]})})]})});V.displayName="IndividualView";const X=l.memo(()=>{const v=_(),k=L(),{userId:d}=R(),{user:N}=j(t=>t.auth),{checkinHistory:y}=j(t=>t.checkin),{users:x}=j(t=>t.users),[n,b]=l.useState(null),[g,c]=l.useState("week"),[S,C]=l.useState(!1);l.useEffect(()=>{if(x.length>0){if(d){const t=x.find(i=>i.id===d);t&&b(t)}else if(N){const t=x.find(i=>i.id===N.id);t&&b(t)}}},[N,x,d]),l.useEffect(()=>{(async()=>{C(!0);try{await Promise.all([v(H()),v($({page:1,limit:100}))])}catch(i){console.error("Error loading dashboard data:",i)}finally{C(!1)}})()},[v]);const D=t=>{b(t)},p=()=>{k("/emotional-checkin/dashboard")},M=()=>{k("/emotional-wellness")},a=t=>{if(!t?.gender)return t?.name||"User";const i=t.gender==="male"?"Mr.":t.gender==="female"?"Ms.":"",s=t.username||t.name||"User";return i?`${i} ${s}`:s};return e.jsxs("div",{className:"min-h-screen text-foreground relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-gold/5"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_30%_20%,rgba(120,119,198,0.1),transparent_50%)]"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-full h-full bg-[radial-gradient(circle_at_70%_80%,rgba(255,215,0,0.05),transparent_50%)]"}),e.jsxs("div",{className:"relative z-10 container-tight py-4 md:py-6",children:[e.jsxs(I.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(B,{variant:"ghost",onClick:d?M:p,className:"flex items-center gap-2 hover:bg-primary/10",children:[e.jsx(q,{className:"w-4 h-4"}),d?"Back to My Dashboard":"Back to Main Dashboard"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-gold bg-clip-text text-transparent",children:d?"User Report":"Individual Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d?"Detailed emotional wellness report":"Your personal emotional wellness overview"})]})]}),e.jsx(w,{className:"glass glass-card border-primary/20",children:e.jsx(U,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary to-gold flex items-center justify-center",children:e.jsx(P,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:d?`Report for ${a(n)}`:`Welcome back, ${a(N)}!`}),e.jsx("p",{className:"text-muted-foreground",children:d?"Detailed emotional wellness analysis for this user":"Here's your comprehensive emotional wellness analysis"})]})]})})})]}),e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsx(V,{selectedUser:n,onUserSelect:D,selectedPeriod:g,loading:S,isPersonalView:!0})}),n&&e.jsx(I.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"mt-6",children:e.jsxs(w,{className:"glass glass-card",children:[e.jsx(E,{children:e.jsxs(T,{className:"flex items-center gap-2",children:[e.jsx(Q,{className:"w-5 h-5"}),"Quick Summary"]})}),e.jsx(U,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:y?.filter(t=>t.userId===n.id).length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Check-ins"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:y?.filter(t=>t.userId===n.id&&t.presenceLevel>=7).length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"High Presence Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:y?.filter(t=>t.userId===n.id&&t.capacityLevel>=7).length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"High Capacity Days"})]})]})})]})})]})]})});X.displayName="IndividualDashboard";export{X as default};
