import{r as a,j as e,H as M,b as P}from"./index-D_pgSSHA.js";import{m as u}from"./utils-NGAVZCJh.js";import{F as C}from"./frown-D3lKQtIk.js";import{M as b}from"./meh-BGB14Kjn.js";import{S as L}from"./smile-BtwjqAYM.js";import{T as I}from"./EmotionalCheckinDashboard-yCXUTvFK.js";import{B as _}from"./brain-Cvgpeatm.js";import{U as A}from"./users-D4gyIltF.js";import"./socketService-B4WowktR.js";import"./funnel-B8EtD1S9.js";import"./building-keooJTOS.js";import"./shield-check-D61s1X1s.js";const y=a.memo(({mood:r,size:p="w-5 h-5"})=>{const x=u[r]||u.okay,g={happy:L,excited:M,okay:b,sad:C}[r]||b;return e.jsx(g,{className:`${p} text-${x.color}`})});y.displayName="MoodIcon";const m=10,j=a.memo(({users:r=[],title:p="Users Needing Support",icon:x=I,userType:g="users",showMood:N=!0,showMetrics:v=!0})=>{const w=P(),[t,h]=a.useState(1);a.useEffect(()=>h(1),[r]);const n=a.useMemo(()=>r?.map(s=>{const c=s.presenceLevel||0,i=s.capacityLevel||0,l=s.aiAnalysis||{},o=[];return c<4&&o.push("Low presence level"),i<4&&o.push("Low capacity level"),l.needsSupport&&o.push("AI detected support need"),l.emotionalInstability&&o.push("Emotional instability detected"),l.trendDecline&&o.push("Declining trend"),l.historicalPatterns?.consistentLowPresence&&o.push("Consistently low presence"),l.historicalPatterns?.increasingSupportNeeds&&o.push("Increasing support requests"),{id:s.id||s._id,name:s.name,mood:s.mood||"neutral",grade:s.classes?.[0]?.grade||s.grade||"-",role:s.role,department:s.department,lastCheckin:s.lastCheckin||(s.submittedAt?new Date(s.submittedAt).toLocaleDateString():"—"),presenceLevel:c,capacityLevel:i,weatherType:s.weatherType,selectedMoods:s.selectedMoods||[],aiReason:o.join(", "),raw:s}})||[],[r]),d=Math.max(1,Math.ceil(n.length/m));a.useEffect(()=>{t>d&&h(d)},[t,d]);const k=a.useMemo(()=>{const s=(t-1)*m;return n.slice(s,s+m)},[n,t]),f=a.useCallback(s=>h(Math.min(Math.max(1,s),d)),[d]),S=n.length>m;return n.length?e.jsxs("div",{className:"glass glass-card transition-colors duration-200 border border-border/60","data-aos":"fade-up","data-aos-delay":"90",children:[e.jsx("div",{className:"glass__refract"}),e.jsx("div",{className:"glass__refract--soft"}),e.jsx("div",{className:"glass__noise"}),e.jsxs("div",{className:"relative z-10 p-4 md:p-6 space-y-5",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-xl bg-rose-100 dark:bg-rose-900/30 border border-rose-200/80 text-rose-600 dark:text-rose-200 flex items-center justify-center",children:e.jsx(x,{className:"w-4 h-4","aria-hidden":"true"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[11px] uppercase tracking-[0.35em] text-muted-foreground",children:p}),e.jsxs("h2",{className:"text-base md:text-lg font-semibold text-foreground",children:[g==="students"?"Students":"People"," needing support"]})]})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-rose-100 dark:bg-rose-900/20 text-rose-700 dark:text-rose-200 border border-rose-200/70 w-fit",children:n.length})]}),e.jsx("p",{className:"text-xs md:text-sm text-muted-foreground",children:"Teacher/Staff/Student that might need you to check-in with them"}),e.jsx("div",{className:"space-y-3",children:k.map((s,c)=>e.jsxs("div",{className:"rounded-2xl border border-border/70 bg-white/70 dark:bg-slate-900/40 shadow-sm text-sm flex flex-col gap-3 p-3.5 sm:p-4","data-aos":"fade-up","data-aos-delay":110+c*35,children:[e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[N&&e.jsx(y,{mood:s.mood,size:"w-6 h-6 flex-shrink-0"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("button",{className:"font-semibold text-foreground text-left truncate hover:text-primary/80",onClick:()=>w(`/emotional-wellness/${s.raw?.userId||s.id}`),children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[s.role," • ",s.department||s.grade||"—"]})]})]}),e.jsx("span",{className:"text-xs px-2 py-1 rounded-full bg-muted/20 text-muted-foreground",children:s.lastCheckin})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-2 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"rounded-lg bg-rose-50 dark:bg-rose-900/10 px-3 py-1.5",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Presence:"})," ",s.presenceLevel,"/10"]}),e.jsxs("div",{className:"rounded-lg bg-sky-50 dark:bg-sky-900/10 px-3 py-1.5",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Capacity:"})," ",s.capacityLevel,"/10"]}),e.jsxs("div",{className:"rounded-lg bg-emerald-50 dark:bg-emerald-900/10 px-3 py-1.5",children:[e.jsx("span",{className:"font-medium text-foreground",children:"Weather:"})," ",s.weatherType||"-"]})]}),s.aiReason&&e.jsxs("div",{className:"flex items-start gap-2 text-xs text-blue-700 dark:text-blue-300 bg-blue-50 dark:bg-blue-900/10 border border-blue-200/70 rounded-xl px-3 py-2",children:[e.jsx(_,{className:"w-4 h-4 mt-0.5 flex-shrink-0"}),e.jsx("span",{children:s.aiReason})]}),v&&s.selectedMoods?.length>0&&e.jsx("div",{className:"flex flex-wrap gap-1 text-[11px] text-muted-foreground",children:s.selectedMoods.slice(0,4).map(i=>e.jsx("span",{className:"px-2 py-0.5 rounded-full bg-muted/20 text-muted-foreground",children:i},i))})]},s.id||s.name))}),S&&e.jsxs("div",{className:"pt-1 flex items-center justify-between text-xs text-muted-foreground",children:[e.jsx("button",{type:"button",onClick:()=>f(t-1),disabled:t===1,className:"px-3 py-1.5 rounded-full border border-border hover:border-primary hover:text-primary disabled:opacity-50 transition",children:"Previous"}),e.jsxs("span",{children:["Page ",t," of ",d]}),e.jsx("button",{type:"button",onClick:()=>f(t+1),disabled:t===d,className:"px-3 py-1.5 rounded-full border border-border hover:border-primary hover:text-primary disabled:opacity-50 transition",children:"Next"})]})]})]}):null});j.displayName="FlaggedUsers";const E=a.memo(r=>e.jsx(j,{...r,title:"Students Needing Support",userType:"students",icon:A}));E.displayName="FlaggedStudents";export{E as FlaggedStudents,j as default};
