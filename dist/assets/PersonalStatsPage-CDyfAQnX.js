import{b as D,B as H,a as I,d as f,r as o,V as N,j as e,q as E,m as g,$ as T,Z as y}from"./index-D2DJgSv6.js";import{C as b,b as k,c as C,a as P}from"./card-hBajXUq1.js";import{B as w}from"./badge-C0U14s1I.js";import{P as M}from"./progress-B5RA-Q1x.js";import{s as h}from"./socketService-DK54WtJ1.js";import{n as m}from"./id-BI_6IGNA.js";const W=()=>{const S=D(),{userId:p}=H(),u=I(),{user:l}=f(s=>s.auth),{checkinHistory:n}=f(s=>s.checkin),r=o.useMemo(()=>m(p)||m(l)||m(l?.id)||m(l?._id),[p,l]),c=o.useMemo(()=>!n||!r?[]:(Array.isArray(n)?n:n.data?.checkins||n.checkins||[]).filter(a=>m(a.userId)===r),[n,r]);console.log("PersonalStatsPage Debug:",{currentUser:m(l),targetUserId:r,checkinHistoryLength:n?.data?.checkins?.length||n?.length||0,userCheckinsLength:c.length,checkinHistoryKeys:n?Object.keys(n):[],firstCheckin:c[0]});const t=o.useMemo(()=>{if(c.length===0)return null;const s=c.slice(0,7),a=s.reduce((d,i)=>d+i.presenceLevel,0)/s.length,x=s.reduce((d,i)=>d+i.capacityLevel,0)/s.length,v={};s.forEach(d=>{d.selectedMoods?.forEach(i=>{v[i]=(v[i]||0)+1})});const L=Object.entries(v).sort(([,d],[,i])=>i-d).slice(0,3);return{avgPresence:Math.round(a*10)/10,avgCapacity:Math.round(x*10)/10,topMoods:L,checkinCount:s.length,trend:a>6?"improving":a<4?"concerning":"stable"}},[c]);o.useEffect(()=>{if(l&&r){u(N({page:1,limit:50,userId:r})),h.connect(),h.joinPersonal(r);const s=a=>{console.log("Real-time personal check-in update:",a),u(N({page:1,limit:50,userId:r}))};return h.onPersonalNewCheckin(s),()=>{h.offPersonalNewCheckin(s),h.leavePersonal()}}},[u,l,r]);const A=o.useMemo(()=>({hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{staggerChildren:.1}}}),[]),j=o.useMemo(()=>({hidden:{opacity:0,y:6},show:{opacity:1,y:0,transition:{duration:.32}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsx(E,{children:e.jsx("title",{children:"Personal Stats â€” MWS APP"})}),e.jsx(g.main,{initial:"hidden",animate:"show",variants:A,className:"relative min-h-dvh w-full px-4 pb-12 pt-6",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs(g.header,{variants:j,className:"mb-6 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>S(-1),"aria-label":"Go back",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border bg-card/40 backdrop-blur-md hover:bg-accent/8 transition-colors duration-300",children:e.jsx(T,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Personal Stats"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Summary of your emotional wellness"})]})]}),e.jsx(g.section,{variants:j,children:e.jsxs(b,{className:"glass glass-card",children:[e.jsx(k,{children:e.jsxs(C,{className:"flex items-center gap-2",children:[e.jsx(y,{className:"w-5 h-5"}),"My Stats"]})}),e.jsxs(P,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:c.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total check-ins"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:t?.avgPresence||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Presence (7d)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:t?.avgCapacity||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Capacity (7d)"})]})]}),t&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(y,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Weekly Trends:"}),e.jsx(w,{variant:t.trend==="improving"?"default":t.trend==="concerning"?"destructive":"secondary",children:t.trend==="improving"?"Improving":t.trend==="concerning"?"Needs Attention":"Stable"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Presence Level"}),e.jsxs("span",{children:[t.avgPresence,"/10"]})]}),e.jsx(M,{value:t.avgPresence*10,className:"h-3"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Capacity Level"}),e.jsxs("span",{children:[t.avgCapacity,"/10"]})]}),e.jsx(M,{value:t.avgCapacity*10,className:"h-3"})]})]}),t.topMoods.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("span",{className:"font-medium text-sm",children:"Most Common Moods (7 days):"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:t.topMoods.map(([s,a])=>e.jsxs(w,{variant:"outline",className:"text-sm",children:[s," (",a,")"]},s))})]})]})]})]})}),e.jsx(g.section,{variants:j,className:"mt-6",children:e.jsxs(b,{className:"glass glass-card",children:[e.jsx(k,{children:e.jsx(C,{children:"Monthly Summary"})}),e.jsx(P,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-secondary/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:c.filter(s=>{const a=new Date(s.date),x=new Date;return a.getMonth()===x.getMonth()&&a.getFullYear()===x.getFullYear()}).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Check-ins This Month"})]}),e.jsxs("div",{className:"text-center p-4 bg-secondary/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>s.presenceLevel>=7).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"High Presence Days"})]})]})})})]})})]})})]})};export{W as default};
