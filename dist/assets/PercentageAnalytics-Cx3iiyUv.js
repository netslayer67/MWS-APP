import{r as w,b as se,C as l,j as e,$ as y}from"./index-DcybHeOi.js";import te from"./ExportButton-D06t80f0.js";import{U as re}from"./UserListModal-D4p7gMMG.js";import{c as ae,f as $}from"./analyticsHelpers-CSR5MBQA.js";import{T as x}from"./EmotionalCheckinDashboard-BD_-4_VV.js";import{T as ie}from"./target-Ch-ME1U-.js";import{U as oe}from"./users-_2hYyMjF.js";import{C as ne}from"./clock-DlMinTbS.js";import{R as I}from"./CategoricalChart-CADNFipI.js";import{P as O,a as T}from"./PieChart-C9qrXJY7.js";import{C as W}from"./tooltipContext-CGDN20fW.js";import"./circle-alert-cL1sgD06.js";import"./cloud-SIZG4UWw.js";import"./smile-D0epxeoC.js";import"./socketService-B4WowktR.js";import"./funnel-7EYNfR1c.js";import"./building-B9gHd1Sc.js";import"./shield-check-K0Cq4BX6.js";const le=w.memo(({data:i={},period:d})=>{const z=se(),[n,c]=w.useState({isOpen:!1,title:"",users:[],totalUsers:0,type:""}),s=w.useMemo(()=>{if(!i)return null;const t=i.totalUsers||0,a=i.totalCheckins||0,B=i.submissionRate||0,C=Array.isArray(i.periodTimeline)?i.periodTimeline:[],G=i.periodLengthDays||C.length||0,K=ae(C,G,d),h=Math.max(K,1),g=t*h,H=g>0?Math.min(100,Math.round(a/g*100)):0,p=Array.isArray(i.flaggedUsers)?i.flaggedUsers:[],m=new Map;p.forEach(r=>{const o=r?.userId?._id||r?.userId||r?.email||r?.name||r?.id||null;if(!o)return;const L=o.toString();m.has(L)||m.set(L,r)});const u=(m.size>0?Array.from(m.values()):p).length,f=t>0?Math.min(100,Math.round(u/t*100)):0,J=Math.max(0,100-f),Q=Math.max(0,t-u),k=i.moodDistribution||{},V=i.aiMoodIndicators||{},U=Object.values(k).reduce((r,o)=>r+o,0),j=Object.entries(k).map(([r,o])=>({mood:r.charAt(0).toUpperCase()+r.slice(1),count:o,percentage:U>0?Math.round(o/U*100):0,isAIGenerated:V[r]||r.includes("ai")||r.includes("AI")||r.includes("detected")})).sort((r,o)=>o.percentage-r.percentage),P=i.weatherDistribution||{},X=i.aiWeatherIndicators||{},M=Object.values(P).reduce((r,o)=>r+o,0),Y=Object.entries(P).map(([r,o])=>({weather:r.charAt(0).toUpperCase()+r.slice(1),count:o,percentage:M>0?Math.round(o/M*100):0,isAIGenerated:X[r]||r.includes("ai")||r.includes("AI")||r.includes("pattern")||r.includes("analyzed")})).sort((r,o)=>o.percentage-r.percentage),A=i.unitBreakdown||[],R=A.reduce((r,o)=>r+(o.submitted||0),0),Z=A.map(r=>({unit:r.unit||"Unknown",count:r.submitted||0,percentage:R>0?Math.round(r.submitted/R*100):0})).sort((r,o)=>o.percentage-r.percentage),b=[],N=[],v=f;v>20&&b.push({type:"high",title:"High Support Need",message:`${v.toFixed(1)}% (${u} people) indicated they need support. Consider proactive outreach.`,icon:x,color:"text-red-500"}),j.some(r=>["sad","anxious","overwhelmed"].includes(r.mood.toLowerCase()))&&b.push({type:"medium",title:"Emotional Well-being Concerns",message:"Negative mood patterns detected. Monitor closely and consider additional support resources.",icon:x,color:"text-yellow-500"}),v<10&&N.push({title:"Strong Team Resilience",message:"Low support requests indicate good overall team well-being.",icon:l,color:"text-green-500"}),j.some(r=>["happy","excited","calm"].includes(r.mood.toLowerCase()))&&N.push({title:"Positive Team Dynamics",message:"Strong presence of positive moods suggests healthy team environment.",icon:l,color:"text-green-500"});const S=Array.isArray(i.notSubmittedUsers)?i.notSubmittedUsers:[],ee=S.length||Math.max(0,t-Math.round(a/h));return{participationRate:H,rawSubmissionRate:B,flaggedPercentage:f,readinessPercentage:J,moodPercentages:j,weatherPercentages:Y,unitPercentages:Z,totalUsers:t,totalCheckins:a,flaggedUsersCount:u,flaggedUserRecords:p,riskFactors:b,positiveIndicators:N,moodLists:i.moodLists||{},weatherLists:i.weatherLists||{},unitLists:i.unitLists||{},notSubmittedUsers:S,notSubmittedCount:ee,workdayCount:h,expectedSubmissions:g,readinessUserCount:Q}},[i,d]),F=t=>{c({isOpen:!0,title:`${t.mood} Mood Users`,users:s.moodLists[t.mood.toLowerCase()]||[],totalUsers:s.totalCheckins,type:"mood"})},D=t=>{c({isOpen:!0,title:`${t.weather} Weather Users`,users:s.weatherLists[t.weather.toLowerCase()]||[],totalUsers:s.totalCheckins,type:"weather"})},E=t=>{c({isOpen:!0,title:`${t.unit} Unit Users`,users:s.unitLists[t.unit.toLowerCase()]||[],totalUsers:s.totalCheckins,type:"unit"})},_=()=>{s&&z("/emotional-checkin/not-submitted",{state:{snapshot:{totalUsers:s.totalUsers,totalCheckins:s.totalCheckins,notSubmittedUsers:s.notSubmittedUsers,notSubmittedCount:s.notSubmittedCount,expectedSubmissions:s.expectedSubmissions,workdayCount:s.workdayCount,participationRate:s.participationRate,period:d}}})},q=()=>{c({isOpen:!1,title:"",users:[],totalUsers:0,type:""})};return s?e.jsxs("div",{className:"glass glass-card transition-all duration-300",children:[e.jsx("div",{className:"glass__refract"}),e.jsx("div",{className:"glass__noise"}),e.jsxs("div",{className:"relative z-10 p-4 md:p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"w-4 h-4 text-primary"}),e.jsx("h2",{className:"text-base md:text-lg font-semibold text-foreground",children:"Overview Analytics"})]}),e.jsx(te,{period:d})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6",children:[e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-border/40 backdrop-blur-sm cursor-pointer hover:bg-card/60 transition-colors",onClick:_,title:"Click to see users who haven't submitted yet",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Participation Rate"}),e.jsx(oe,{className:"w-4 h-4 text-emerald-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[s.participationRate,"%"]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500 ease-out",style:{width:`${s.participationRate}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[$(s.totalCheckins)," submissions "," Â· "," expected ",$(s.expectedSubmissions)]}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:["Normalized across ",s.workdayCount===1?"today":`${s.workdayCount} workdays`]}),e.jsx("p",{className:"text-xs text-blue-600 mt-1 font-medium",children:"Click to view not submitted users"})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-border/40 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Emotional Readiness"}),e.jsx(y,{className:"w-4 h-4 text-emerald-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[s.readinessPercentage,"%"]}),e.jsx("div",{className:"w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-emerald-500 to-emerald-400 transition-all duration-500 ease-out",style:{width:`${s.readinessPercentage}%`}})}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.readinessUserCount," of ",s.totalUsers," users ready"]})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-white/20 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Top Mood"}),e.jsx(y,{className:"w-4 h-4 text-blue-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[s.moodPercentages[0]?.percentage||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:s.moodPercentages[0]?.mood||"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.moodPercentages[0]?.count||0," responses"]}),s.moodPercentages[0]?.count===0&&e.jsx("div",{className:"mt-2 w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gray-400 to-gray-300 w-full"})})]}),e.jsxs("div",{className:"p-4 rounded-lg bg-card/40 border border-border/40 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium text-foreground",children:"Top Weather"}),e.jsx(y,{className:"w-4 h-4 text-purple-500"})]}),e.jsxs("div",{className:"text-2xl font-bold text-foreground mb-1",children:[s.weatherPercentages[0]?.percentage||0,"%"]}),e.jsx("p",{className:"text-sm text-muted-foreground capitalize",children:s.weatherPercentages[0]?.weather||"N/A"}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[s.weatherPercentages[0]?.count||0," responses"]}),s.weatherPercentages[0]?.count===0&&e.jsx("div",{className:"mt-2 w-full bg-muted/30 rounded-full h-2 overflow-hidden",children:e.jsx("div",{className:"h-full bg-gradient-to-r from-gray-400 to-gray-300 w-full"})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(x,{className:"w-4 h-4 text-red-500"}),"Risk Factors"]}),e.jsx("div",{className:"space-y-2",children:s.riskFactors?.length>0?s.riskFactors.slice(0,2).map((t,a)=>e.jsx("div",{className:"p-3 bg-red-50 border border-red-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(x,{className:`w-4 h-4 mt-0.5 ${t.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.message})]})]})},a)):e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4 text-green-500"}),e.jsx("p",{className:"text-sm text-green-700",children:"No significant risk factors detected"})]})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-semibold text-foreground mb-3 flex items-center gap-2",children:[e.jsx(l,{className:"w-4 h-4 text-green-500"}),"Positive Indicators"]}),e.jsx("div",{className:"space-y-2",children:s.positiveIndicators?.length>0?s.positiveIndicators.slice(0,2).map((t,a)=>e.jsx("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(l,{className:`w-4 h-4 mt-0.5 ${t.color}`}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium text-foreground",children:t.title}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:t.message})]})]})},a)):e.jsx("div",{className:"p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ne,{className:"w-4 h-4 text-yellow-500"}),e.jsx("p",{className:"text-sm text-yellow-700",children:"Monitoring for positive indicators"})]})})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Mood Distribution"}),e.jsx("div",{className:"h-48",children:e.jsx(I,{width:"100%",height:"100%",children:e.jsx(O,{children:e.jsx(T,{data:s.moodPercentages.slice(0,5),cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"count",onClick:(t,a)=>F(s.moodPercentages.slice(0,5)[a]),style:{cursor:"pointer"},children:s.moodPercentages.slice(0,5).map((t,a)=>e.jsx(W,{fill:`hsl(${a*60}, 70%, 50%)`,style:{cursor:"pointer"}},`mood-${a}`))})})})}),e.jsx("div",{className:"mt-2 space-y-1",children:s.moodPercentages.slice(0,5).map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*60}, 70%, 50%)`}}),e.jsxs("span",{className:"text-foreground capitalize",children:[t.mood,t.isAIGenerated&&e.jsx("span",{className:"ml-1 text-xs text-blue-600 font-medium",children:"(AI)"})]})]}),e.jsxs("span",{className:"text-muted-foreground",children:[t.percentage,"% (",t.count,")"]})]},t.mood))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Weather Distribution"}),e.jsx("div",{className:"h-48",children:e.jsx(I,{width:"100%",height:"100%",children:e.jsx(O,{children:e.jsx(T,{data:s.weatherPercentages.slice(0,5),cx:"50%",cy:"50%",innerRadius:40,outerRadius:80,paddingAngle:2,dataKey:"count",onClick:(t,a)=>D(s.weatherPercentages.slice(0,5)[a]),style:{cursor:"pointer"},children:s.weatherPercentages.slice(0,5).map((t,a)=>e.jsx(W,{fill:`hsl(${a*45+180}, 70%, 50%)`,style:{cursor:"pointer"}},`weather-${a}`))})})})}),e.jsx("div",{className:"mt-2 space-y-1",children:s.weatherPercentages.slice(0,5).map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*45+180}, 70%, 50%)`}}),e.jsxs("span",{className:"text-foreground capitalize",children:[t.weather,t.isAIGenerated&&e.jsx("span",{className:"ml-1 text-xs text-blue-600 font-medium",children:"(AI)"})]})]}),e.jsxs("span",{className:"text-muted-foreground",children:[t.percentage,"% (",t.count,")"]})]},t.weather))})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-semibold text-foreground mb-3",children:"Unit Distribution"}),e.jsx("div",{className:"space-y-2",children:s.unitPercentages.slice(0,5).map((t,a)=>e.jsxs("div",{className:"flex items-center justify-between cursor-pointer hover:bg-muted/20 p-1 rounded transition-colors",onClick:()=>E(t),children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:`hsl(${a*72+90}, 70%, 50%)`}}),e.jsx("span",{className:"text-sm text-foreground capitalize",children:t.unit})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-16 bg-muted/30 rounded-full h-1.5 overflow-hidden",children:e.jsx("div",{className:"h-full bg-accent transition-all duration-500 ease-out",style:{width:`${t.percentage}%`}})}),e.jsxs("span",{className:"text-xs text-muted-foreground w-8 text-right",children:[t.percentage,"%"]})]})]},t.unit))})]})]})]}),e.jsx(re,{isOpen:n.isOpen,onClose:q,title:n.title,users:n.users,totalUsers:n.totalUsers,type:n.type})]}):null});le.displayName="PercentageAnalytics";export{le as default};
