const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverviewPanel-Dsc-o6QL.js","assets/index-D-EiwK_h.js","assets/index-Dl2AnsQb.css","assets/AdminStudentsPanel-Dn8QYdhi.js","assets/StudentsTable-D9-oy8oY.js","assets/StatusPills-DwA6HrHU.js","assets/teacherDashboardUtils-Bkr1WZ6W.js","assets/shield-check-DRs9tJTL.js","assets/funnel-CdPmx85V.js","assets/shuffle-CyHNVuL8.js","assets/search-BOWZ9Ge8.js","assets/users-kByYNgMh.js","assets/AdminMentorsPanel-BbfuDixs.js","assets/AdminAnalyticsPanel-DnbZSZys.js"])))=>i.map(i=>d[i]);
import{c as B,ac as G,a4 as W,S as J,x as X,d as Z,r as n,b as ee,e as te,j as i,m as se,_ as $}from"./index-D-EiwK_h.js";import{U as H,C as ae}from"./users-round-Ds6cCV_E.js";import{U as V}from"./user-check-BjThF9X5.js";import{B as q}from"./building-2-CIsUQ9Aq.js";import{s as T}from"./socketService-B4WowktR.js";import{d as oe,n as z,a as re,f as ne,e as ce}from"./teacherDashboardUtils-Bkr1WZ6W.js";import{A as ie}from"./arrow-up-right-CET1nr_d.js";import{M as le}from"./minus-CGOCBVu0.js";import"./shield-check-DRs9tJTL.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],ue=B("arrow-down-right",de);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],he=B("layout-dashboard",me),pe=[{key:"overview",label:"System Overview",icon:he},{key:"students",label:"All Students",icon:H},{key:"mentors",label:"Manage Mentors",icon:V},{key:"analytics",label:"Analytics Lab",icon:ae}],fe={badgeIcon:q,badgeLabel:"Admin / Principal",badgeCaption:"Oversee joyful MTSS momentum",heading:"Multi-Tiered System Dashboard",subheading:""},ge={tier:X,interventions:J,activity:W,mentor:H,stats:G},Q=t=>{if(!t)return"-";try{return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(t))}catch{return"-"}},be=[{key:"students",label:"Students in MTSS",caption:"Across all tiers",accent:"from-[#ff80b5] via-[#f472b6] to-[#c084fc]",icon:q},{key:"mentors",label:"Active Mentors",caption:"Teachers & specialists",accent:"from-[#fcd34d] via-[#fb923c] to-[#f87171]",icon:V},{key:"success",label:"Success Rate",caption:"Meeting intervention goals",accent:"from-[#6ee7b7] via-[#34d399] to-[#10b981]",icon:G}],ye=(t=0,a=0,e=0)=>be.map(o=>o.key==="students"?{...o,value:t}:o.key==="mentors"?{...o,value:a}:{...o,value:`${e}%`}),ve=(t,a=[])=>{const e=a.length;return{totalStudents:t?.total||e,tierBreakdown:t?.tierBreakdown?.length?t.tierBreakdown:[{label:"Tier 1",count:e,description:`${e} students`}],interventions:t?.interventions?.length?t.interventions.slice(0,5):[{label:"Universal Supports",count:e}]}},xe=(t=[])=>{const a={};t.forEach(o=>{const r=o.type||"Universal Supports",s=a[r]||{total:0,success:0};s.total+=1,["On Track","Completed"].includes(o.progress)&&(s.success+=1),a[r]=s});const e=["from-[#a78bfa] to-[#6366f1]","from-[#f472b6] to-[#fb7185]","from-[#34d399] to-[#10b981]","from-[#22d3ee] to-[#3b82f6]","from-[#fcd34d] to-[#f97316]"];return Object.entries(a).map(([o,r],s)=>({label:o,value:r.total?Math.round(r.success/r.total*100):0,gradient:e[s%e.length]})).sort((o,r)=>r.value-o.value)},we=t=>{const a=new Date(t),e=new Date(a.getFullYear(),0,1),o=Math.floor((a-e)/864e5),r=Math.ceil((o+e.getDay()+1)/7);return`${a.getFullYear()}-${r}`},Se=(t=[])=>{if(!t.length)return{met:"",support:""};const a=600,e=200,o=Math.max(t.length-1,1),r=s=>t.map((m,h)=>{const b=h/o*a,w=e-(m[s]||0)/100*e;return`${h===0?"M":"L"}${b},${w}`}).join(" ");return{met:r("met"),support:r("support")}},Me=(t=[])=>{const a=new Map;t.forEach(r=>{const s=r.updatedAt||r.startDate||r.createdAt;if(!s)return;const m=new Date(s),h=we(m);a.has(h)||a.set(h,{total:0,success:0,date:m});const b=a.get(h);b.total+=1,["active","completed"].includes(r.status)&&(b.success+=1)});const o=Array.from(a.values()).sort((r,s)=>r.date-s.date).slice(-6).map(r=>{const s=r.total?Math.round(r.success/r.total*100):0;return{label:Q(r.date),met:s,support:Math.max(0,100-s)}});return{trendData:o,trendPaths:Se(o)}},ke=(t=[])=>{const a=new Map;return t.forEach(e=>{const o=e.mentorId?.name||"Unassigned Mentor";a.has(o)||a.set(o,{name:o,focusAreas:new Set,caseload:0,success:0,total:0});const r=a.get(o);r.total+=1,r.caseload+=e.studentIds?.length||0,e.focusAreas?.length&&e.focusAreas.forEach(s=>r.focusAreas.add(s)),["completed","active"].includes(e.status)&&(r.success+=1)}),Array.from(a.values()).map(e=>({name:e.name,caseload:e.caseload,focus:e.focusAreas.size?Array.from(e.focusAreas).slice(0,2).join(", "):"Tiered Supports",trend:e.total?`${Math.round(e.success/e.total*100)}% success`:"New mentor"})).sort((e,o)=>o.caseload-e.caseload).slice(0,3)},Ae=(t=[])=>{const a=new Map;return t.forEach(e=>{const o=e.mentorId?._id?.toString?.()||null,r=e.mentorId?.email||null,s=o||r||e.mentorId?.name||"unassigned";a.has(s)||a.set(s,{id:o,email:r,name:e.mentorId?.name||"Unassigned",role:e.mentorId?.jobPosition||e.mentorId?.role||"Mentor",students:0,total:0,completed:0});const m=a.get(s);m.students+=e.studentIds?.length||0,m.total+=1,e.status==="completed"&&(m.completed+=1)}),Array.from(a.values()).map(e=>({_id:e.id,email:e.email,name:e.name,role:e.role,activeStudents:e.students,successRate:e.total?`${Math.round(e.completed/e.total*100)}%`:"0%"})).sort((e,o)=>o.activeStudents-e.activeStudents)},je=(t=[])=>{const a={};return t.forEach(e=>{(e.focusAreas||[]).forEach(o=>{a[o]=(a[o]||0)+1})}),Object.entries(a).sort((e,o)=>o[1]-e[1]).slice(0,4).map(([e,o])=>({label:e,value:`${o} active`}))},_e=(t=[])=>{const a=t.filter(r=>["On Track","Completed"].includes(r.progress)).length,e=t.filter(r=>r.progress==="Needs Attention").length,o=Math.max(0,t.length-a-e);return[{label:"Improved",detail:`${a} students`,accent:"text-emerald-500",icon:ie},{label:"Needs Support",detail:`${e} students`,accent:"text-rose-500",icon:ue},{label:"Stable",detail:`${o} students`,accent:"text-sky-500",icon:le}]},Te=(t=[])=>{const a=[];return t.forEach(e=>{const o=e.studentIds?.[0]?.name||"Student group",r=e.mentorId?.name||"Mentor team",s=e.checkIns?.slice(-1)[0];s?a.push({date:s.date,student:o,mentor:r,activity:s.summary||"Progress update recorded"}):a.push({date:e.updatedAt||e.startDate||e.createdAt,student:o,mentor:r,activity:`Status updated to ${e.status}`})}),a.filter(e=>e.date).sort((e,o)=>new Date(o.date)-new Date(e.date)).slice(0,6).map(e=>({...e,date:Q(e.date)}))},Ce=(t=[])=>{if(!t.length)return 0;const a=t.filter(e=>e.status==="completed").length;return Math.round(a/t.length*100)},Ne=650,Ie=()=>{const{user:t}=Z(c=>c.auth),[a,e]=n.useState([]),[o,r]=n.useState(null),[s,m]=n.useState([]),[h,b]=n.useState([]),[w,M]=n.useState(!0),[C,N]=n.useState(null),y=n.useMemo(()=>oe(t),[t]),S=n.useCallback((c={})=>{if(!y.allowedGrades.length)return!0;const f=z(c.grade||c.currentGrade||c.className||c.unit||c.classes?.[0]?.grade);return y.allowedGrades.includes(f)},[y]),v=n.useCallback((c={})=>{const f=z(c.grade||c.currentGrade||c.className||c.unit||c.classes?.[0]?.grade);return{...c,grade:f||c.grade,className:c.className||c.currentGrade||c.unit||c.classes?.[0]?.grade}},[]),I=n.useCallback((c=[])=>{c.length&&e(f=>{const g=new Map(f.map(u=>[u.id||u._id,u]));return c.forEach(u=>{if(!S(u))return;const x=u.id||u._id;if(!x)return;const R=g.get(x)||{};g.set(x,{...R,...v(u)})}),Array.from(g.values()).sort((u,x)=>u.name.localeCompare(x.name))})},[v,S]),j=n.useCallback((c,f)=>{f?._id&&m(g=>{const u=g.findIndex(R=>R._id===f._id);if(c==="deleted"){if(u===-1)return g;const R=[...g];return R.splice(u,1),R}if(u===-1)return[...g,f];const x=[...g];return x[u]=f,x})},[]),k=n.useCallback(async()=>{M(!0),N(null);try{const[c,f,g]=await Promise.all([re({limit:Ne}),ne(),ce()]),u=c.students||[],x=y.allowedGrades.length?u.filter(S):u;e(x.map(v)),r(c.summary||null),m(f.assignments||[]),b(g.mentors||[])}catch(c){N(c?.response?.data?.message||c.message||"Failed to load MTSS dashboard data")}finally{M(!1)}},[y.allowedGrades.length,v,S]);n.useEffect(()=>{k()},[k]),n.useEffect(()=>{if(!t?.id&&!t?._id)return;T.connect(),T.joinMtssAdmin();const c=g=>{I(g?.students||[])},f=({action:g,assignment:u})=>{j(g||"updated",u)};return T.onMtssStudentsChanged(c),T.onMtssAssignment(f),()=>{T.offMtssStudentsChanged(c),T.offMtssAssignment(f),T.leaveMtssAdmin()}},[t,I,j]);const d=n.useMemo(()=>h?.length?h.length:new Set(s.map(f=>f.mentorId?._id||f.mentorId)).size,[h,s]),l=n.useMemo(()=>Ce(s),[s]),p=n.useMemo(()=>ye(a.length,d,l),[a.length,d,l]),A=n.useMemo(()=>ve(o,a),[o,a]),D=n.useMemo(()=>xe(a),[a]),{trendData:_,trendPaths:E}=n.useMemo(()=>Me(s),[s]),L=n.useMemo(()=>ke(s),[s]),P=n.useMemo(()=>Ae(s),[s]),O=n.useMemo(()=>je(s),[s]),U=n.useMemo(()=>_e(a),[a]),K=n.useMemo(()=>Te(s),[s]);return{students:a,assignments:s,mentors:h,statCards:p,systemSnapshot:A,successByType:D,trendData:_,trendPaths:E,mentorSpotlights:L,mentorRoster:P,strategyHighlights:O,tierMovement:U,recentActivity:K,loading:w,error:C,refresh:k}},F=(t=[],a)=>{const e=new Set;return t.forEach(o=>{const r=o[a];r&&e.add(r)}),["all",...Array.from(e)]},De=(t=[])=>{const a=ee(),{toast:e}=te(),[o,r]=n.useState("overview"),[s,m]=n.useState({grade:"all",tier:"all",type:"all",mentor:"all",query:""}),[h,b]=n.useState([]),w=n.useMemo(()=>{const d=s.query.trim().toLowerCase();return t.filter(l=>{const p=s.grade==="all"||l.grade===s.grade,A=s.tier==="all"||l.tier===s.tier,D=s.type==="all"||l.type===s.type,_=l.mentor||l.profile?.mentor,E=s.mentor==="all"||_===s.mentor,L=!d||l.name?.toLowerCase().includes(d)||l.type?.toLowerCase().includes(d)||_?.toLowerCase().includes(d);return p&&A&&D&&E&&L})},[t,s]),M=n.useMemo(()=>F(t,"grade"),[t]),C=n.useMemo(()=>F(t,"tier"),[t]),N=n.useMemo(()=>F(t,"type"),[t]),y=n.useMemo(()=>{const d=new Set;return t.forEach(l=>{const p=l.mentor||l.profile?.mentor;p&&d.add(p)}),["all",...Array.from(d)]},[t]),S=n.useCallback((d,l)=>{m(p=>({...p,[d]:l}))},[]),v=n.useCallback(d=>{const l=d.id||d._id;l&&b(p=>p.includes(l)?p.filter(A=>A!==l):[...p,l])},[]),I=n.useCallback(()=>b([]),[]);n.useEffect(()=>{b(d=>d.filter(l=>t.some(p=>(p.id||p._id)===l)))},[t]);const j=n.useCallback(d=>{a(`/mtss/student/${d.slug}`)},[a]),k=n.useCallback(d=>{e({title:"Mentor nudged",description:`Flagged ${d.name}'s plan for a system review.`})},[e]);return{activeTab:o,setActiveTab:r,filters:s,handleFilterChange:S,filteredStudents:w,gradeOptions:M,tierOptions:C,typeOptions:N,mentorOptions:y,selectedIds:h,toggleSelection:v,resetSelection:I,handleViewStudent:j,handleQuickUpdate:k}},Y=({heroCard:t,tabs:a,activeTab:e,onTabChange:o})=>{const r=t.badgeIcon;return i.jsxs("div",{className:"space-y-4","data-aos":"fade-up",children:[i.jsxs("div",{className:"inline-flex items-center gap-3 px-5 py-2 rounded-full bg-gradient-to-r from-white/90 via-white/70 to-white/50 dark:from-white/10 dark:via-white/5 dark:to-white/5 backdrop-blur-xl shadow-lg border border-white/60 dark:border-white/10",children:[i.jsx(r,{className:"w-5 h-5 text-rose-500"}),i.jsxs("div",{children:[i.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.5em] text-muted-foreground",children:t.badgeLabel}),i.jsx("p",{className:"text-sm font-semibold text-slate-700 dark:text-white",children:t.badgeCaption})]})]}),i.jsxs("div",{"data-aos":"fade-up","data-aos-delay":"100",children:[i.jsx("h1",{className:"text-4xl md:text-5xl font-black tracking-tight text-slate-900 dark:text-white",children:t.heading}),i.jsx("p",{className:"text-base md:text-lg text-slate-600 dark:text-white/80 mt-2",children:t.subheading})]}),i.jsx("div",{className:"flex flex-wrap gap-3 pt-2","data-aos":"zoom-in","data-aos-delay":"150",children:a.map(s=>{const m=s.icon,h=e===s.key;return i.jsxs("button",{onClick:()=>o(s.key),className:`px-5 py-3 rounded-full border backdrop-blur-xl font-semibold text-sm flex items-center gap-2 transition shadow-lg relative overflow-hidden group ${h?"bg-gradient-to-r from-[#ffe29f] via-[#ffa99f] to-[#ff719a] text-[#5b0f45] border-white/70 shadow-[0_10px_30px_rgba(255,113,154,0.35)]":"bg-gradient-to-r from-white/85 via-white/70 to-white/55 border-white/70 text-slate-600 dark:from-white/10 dark:via-white/5 dark:to-white/5 dark:text-white/80 hover:border-white/90"}`,children:[i.jsx("span",{"aria-hidden":"true",className:`absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition pointer-events-none ${h?"bg-white/10":"bg-white/30 dark:bg-white/10"}`}),i.jsx(m,{className:"w-4 h-4"}),i.jsx("span",{className:"relative",children:s.label})]},s.key)})})]})};Y.displayName="AdminHeroSection";const Ee=n.memo(Y),Le=n.lazy(()=>$(()=>import("./AdminOverviewPanel-Dsc-o6QL.js"),__vite__mapDeps([0,1,2]))),Re=n.lazy(()=>$(()=>import("./AdminStudentsPanel-Dn8QYdhi.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),Pe=n.lazy(()=>$(()=>import("./AdminMentorsPanel-BbfuDixs.js"),__vite__mapDeps([12,1,2]))),Oe=n.lazy(()=>$(()=>import("./AdminAnalyticsPanel-DnbZSZys.js"),__vite__mapDeps([13,1,2]))),$e=()=>i.jsx("div",{className:"glass glass-card p-8 text-center text-muted-foreground animate-pulse",children:"Loading dashboard..."}),Ue=n.memo(()=>{const{students:t,statCards:a,systemSnapshot:e,recentActivity:o,mentorSpotlights:r,mentorRoster:s,mentors:m,successByType:h,trendData:b,trendPaths:w,strategyHighlights:M,tierMovement:C,loading:N,error:y,refresh:S}=Ie(),{activeTab:v,setActiveTab:I,filters:j,handleFilterChange:k,filteredStudents:d,gradeOptions:l,tierOptions:p,typeOptions:A,mentorOptions:D,handleViewStudent:_,handleQuickUpdate:E,selectedIds:L,toggleSelection:P,resetSelection:O}=De(t),U=n.useMemo(()=>{switch(v){case"overview":return i.jsx(Le,{statCards:a,systemSnapshot:e,recentActivity:o,mentorSpotlights:r,icons:ge});case"students":return i.jsx(Re,{filters:j,onFilterChange:k,gradeOptions:l,tierOptions:p,typeOptions:A,mentorOptions:D,filteredStudents:d,allStudents:t,onViewStudent:_,onUpdateStudent:E,selectedIds:L,onToggleSelect:P,onResetSelection:O,mentorDirectory:m,onRefresh:S});case"mentors":return i.jsx(Pe,{mentorRoster:s,mentorDirectory:m});case"analytics":return i.jsx(Oe,{successByType:h,trendPaths:w,trendData:b,strategyHighlights:M,tierMovement:C});default:return null}},[v,j,l,p,A,D,d,k,_,E,L,P,O,s,m,a,e,o,r,h,b,w,M,C]);return i.jsxs("div",{className:"mtss-theme mtss-animated-bg min-h-screen relative overflow-hidden",children:[i.jsx("div",{className:"mtss-bg-overlay"}),i.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[i.jsx("div",{className:"absolute -top-20 left-0 w-96 h-96 bg-[#ff80b5]/30 blur-[180px]"}),i.jsx("div",{className:"absolute top-40 right-0 w-80 h-80 bg-[#60a5fa]/30 blur-[180px]"}),i.jsx("div",{className:"absolute bottom-0 left-1/3 w-96 h-96 bg-[#fcd34d]/20 blur-[180px]"})]}),i.jsxs("div",{className:"relative z-20 container-tight py-12 lg:py-16 text-foreground dark:text-white space-y-10",children:[i.jsx(se.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},"data-aos":"fade-up",children:i.jsx(Ee,{heroCard:fe,tabs:pe,activeTab:v,onTabChange:I})}),(N||y)&&i.jsxs("div",{className:"rounded-2xl border border-border/50 bg-white/70 dark:bg-white/10 px-4 py-3 flex items-center justify-between gap-4 text-sm text-muted-foreground",children:[i.jsx("span",{children:y||"Syncing MTSS data..."}),y&&i.jsx("button",{onClick:S,className:"text-primary font-semibold hover:underline",children:"Retry"})]}),i.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:i.jsx(n.Suspense,{fallback:i.jsx($e,{}),children:U})})]})]})});Ue.displayName="AdminDashboardPage";export{Ue as default};
