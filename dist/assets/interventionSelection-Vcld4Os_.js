const l={tier1:"Tier 1",tier2:"Tier 2",tier3:"Tier 3"},f=[{key:"SEL",label:"SEL",accent:"from-[#f472b6]/20 to-[#fb7185]/30 text-rose-600"},{key:"ENGLISH",label:"English",accent:"from-[#bfdbfe]/40 to-[#93c5fd]/50 text-sky-600"},{key:"MATH",label:"Math",accent:"from-[#bbf7d0]/40 to-[#86efac]/50 text-emerald-600"},{key:"BEHAVIOR",label:"Behavior",accent:"from-[#fed7aa]/50 to-[#fdba74]/50 text-amber-600"},{key:"ATTENDANCE",label:"Attendance",accent:"from-[#ddd6fe]/50 to-[#c4b5fd]/50 text-indigo-600"}],p=new Map(f.map(r=>[r.key,r])),c={tier1:1,tier2:2,tier3:3},C={monitoring:"Monitoring",active:"Active",paused:"Paused",closed:"Closed"},m=[{key:"ATTENDANCE",pattern:/attendance|absen|present|presence/i},{key:"BEHAVIOR",pattern:/behavior|behaviour|conduct|discipline/i},{key:"MATH",pattern:/math|mathematics|numeracy|algebra|geometry/i},{key:"ENGLISH",pattern:/english|ela|literacy|reading|writing|fluency/i},{key:"SEL",pattern:/sel|social|emotional|wellbeing|well-being/i}],y=r=>{if(!r)return"tier1";const n=r.toString().trim().toLowerCase();if(l[n])return n;const t=n.replace(/\s+/g,"");return l[t]?t:"tier1"},T=r=>{if(!r)return"monitoring";const n=r.toString().trim().toLowerCase();return C[n]?n:"monitoring"},k=r=>{if(!r)return null;const n=r.toString().trim(),t=n.toUpperCase();if(p.has(t))return t;const e=n.toLowerCase(),a=f.find(o=>o.label.toLowerCase()===e);if(a)return a.key;const i=m.find(o=>o.pattern.test(e));return i?i.key:null},E=(r=[])=>{const n=new Map;return Array.isArray(r)&&r.forEach(t=>{const e=t?.type?.toString().toUpperCase();e&&p.has(e)&&n.set(e,t)}),f.map(t=>{const e=n.get(t.key)||{},a=e.tierCode?y(e.tierCode):y(e.tier),i=!!(e.type||e.tier||e.tierCode||e.status==="active"||e.hasData);return{type:t.key,label:t.label,accent:t.accent,tierCode:a,tier:l[a],status:T(e.status),strategies:Array.isArray(e.strategies)?e.strategies.filter(Boolean):[],notes:e.notes||"",updatedAt:e.updatedAt,updatedBy:e.updatedBy,history:Array.isArray(e.history)?e.history:[],hasData:i}})},S=(r=[])=>{if(!r.length)return null;const n=r.filter(t=>t.tierCode!=="tier1").sort((t,e)=>c[e.tierCode]-c[t.tierCode]);return n.length?n[0]:r[0]},h=(r=[],n={})=>{if(!r.length)return null;const t=r.filter(a=>a.hasData&&(a.tierCode==="tier2"||a.tierCode==="tier3"));return t.length?t.sort((a,i)=>{const o=c[i.tierCode]-c[a.tierCode];if(o!==0)return o;const s=a.currentValue??n?.current??100,b=i.currentValue??n?.current??100;return s-b})[0]:null},A=(r=[],n={},t={})=>{const e=h(r,n),a=t?.tier||n?.tier||"",i=t?.type||n?.type||"",o=y(a),s=k(i),d=o!=="tier1"&&(s||i)?(()=>{const u=(s?p.get(s):null)?.label||i||"Focused Support";return{mode:"focused",intervention:{type:s||"SEL",label:u,tierCode:o,tier:l[o]},tier:l[o],tierCode:o,label:u,strategy:t?.profile?.strategy||n?.strategy||null}})():null;if(e){if(d){const g=c[e.tierCode]||0;if((c[o]||0)>g)return d}return{mode:"focused",intervention:e,tier:e.tier,tierCode:e.tierCode,label:e.label,strategy:e.strategies?.[0]||null}}return d||{mode:"universal",intervention:null,tier:"Tier 1",tierCode:"tier1",label:"Universal"}};export{E as e,A as g,S as p};
