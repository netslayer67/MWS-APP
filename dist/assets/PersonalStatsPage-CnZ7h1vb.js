import{a as S,u as A,b as j,r as l,O as v,j as e,o as T,m,V as D,T as p}from"./index-BeQwOtyQ.js";import{C as N,a as f,b as y,c as b}from"./card-D-goIzvr.js";import{B as C}from"./badge-CKD0dT5b.js";import{P as w}from"./progress-DgT_-UGw.js";import{s as d}from"./socketService-CrK7Ga1g.js";const I=()=>{const P=S(),x=A(),{user:i}=j(s=>s.auth),{checkinHistory:h}=j(s=>s.checkin),c=l.useMemo(()=>h?h.filter(s=>s.userId===i?.id):[],[h,i?.id]),t=l.useMemo(()=>{if(c.length===0)return null;const s=c.slice(0,7),a=s.reduce((r,n)=>r+n.presenceLevel,0)/s.length,o=s.reduce((r,n)=>r+n.capacityLevel,0)/s.length,u={};s.forEach(r=>{r.selectedMoods?.forEach(n=>{u[n]=(u[n]||0)+1})});const M=Object.entries(u).sort(([,r],[,n])=>n-r).slice(0,3);return{avgPresence:Math.round(a*10)/10,avgCapacity:Math.round(o*10)/10,topMoods:M,checkinCount:s.length,trend:a>6?"improving":a<4?"concerning":"stable"}},[c]);l.useEffect(()=>{if(i){x(v({page:1,limit:50})),d.connect(),d.joinPersonal(i.id);const s=a=>{console.log("Real-time personal check-in update:",a),x(v({page:1,limit:50}))};return d.onPersonalNewCheckin(s),()=>{d.offPersonalNewCheckin(s),d.leavePersonal()}}},[x,i]);const k=l.useMemo(()=>({hidden:{opacity:0,y:8},show:{opacity:1,y:0,transition:{staggerChildren:.1}}}),[]),g=l.useMemo(()=>({hidden:{opacity:0,y:6},show:{opacity:1,y:0,transition:{duration:.32}}}),[]);return e.jsxs(e.Fragment,{children:[e.jsx(T,{children:e.jsx("title",{children:"Personal Stats â€” MWS APP"})}),e.jsx(m.main,{initial:"hidden",animate:"show",variants:k,className:"relative min-h-dvh w-full px-4 pb-12 pt-6",children:e.jsxs("div",{className:"mx-auto max-w-md",children:[e.jsxs(m.header,{variants:g,className:"mb-6 flex items-center gap-3",children:[e.jsx("button",{onClick:()=>P(-1),"aria-label":"Go back",className:"inline-flex h-10 w-10 items-center justify-center rounded-full border border-border bg-card/40 backdrop-blur-md hover:bg-accent/8 transition-colors duration-300",children:e.jsx(D,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h1",{className:"text-lg font-semibold text-foreground",children:"Personal Stats"}),e.jsx("p",{className:"mt-0.5 text-xs text-muted-foreground",children:"Summary of your emotional wellness"})]})]}),e.jsx(m.section,{variants:g,children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx(f,{children:e.jsxs(y,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5"}),"Statistics Summary"]})}),e.jsxs(b,{children:[e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-primary",children:c.length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Check-ins"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-green-600",children:t?.avgPresence||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Presence (7d)"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-3xl font-bold text-blue-600",children:t?.avgCapacity||"N/A"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Average Capacity (7d)"})]})]}),t&&e.jsxs("div",{className:"mt-6",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-4",children:[e.jsx(p,{className:"w-4 h-4"}),e.jsx("span",{className:"font-medium",children:"Weekly Trends:"}),e.jsx(C,{variant:t.trend==="improving"?"default":t.trend==="concerning"?"destructive":"secondary",children:t.trend==="improving"?"Improving":t.trend==="concerning"?"Needs Attention":"Stable"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Presence Level"}),e.jsxs("span",{children:[t.avgPresence,"/10"]})]}),e.jsx(w,{value:t.avgPresence*10,className:"h-3"})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between text-sm mb-2",children:[e.jsx("span",{children:"Capacity Level"}),e.jsxs("span",{children:[t.avgCapacity,"/10"]})]}),e.jsx(w,{value:t.avgCapacity*10,className:"h-3"})]})]}),t.topMoods.length>0&&e.jsxs("div",{className:"mt-6",children:[e.jsx("span",{className:"font-medium text-sm",children:"Most Common Moods (7 days):"}),e.jsx("div",{className:"flex flex-wrap gap-2 mt-3",children:t.topMoods.map(([s,a])=>e.jsxs(C,{variant:"outline",className:"text-sm",children:[s," (",a,")"]},s))})]})]})]})]})}),e.jsx(m.section,{variants:g,className:"mt-6",children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx(f,{children:e.jsx(y,{children:"Monthly Summary"})}),e.jsx(b,{children:e.jsx("div",{className:"space-y-4",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"text-center p-4 bg-secondary/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:c.filter(s=>{const a=new Date(s.date),o=new Date;return a.getMonth()===o.getMonth()&&a.getFullYear()===o.getFullYear()}).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Check-ins This Month"})]}),e.jsxs("div",{className:"text-center p-4 bg-secondary/20 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:c.filter(s=>s.presenceLevel>=7).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"High Presence Days"})]})]})})})]})})]})})]})};export{I as default};
