import{r as n,a as P,u as E,b as v,N as T,j as e,U as S,B as A,p as $,O as L,v as B,m as k,Q as H,T as V}from"./index-BOBGiIRK.js";import{C as N,a as U,b as D,c as y}from"./card-BoAKoozD.js";import{S as F,a as z,b as R,c as O,d as Q}from"./select-6KhwP7PN.js";import{B as I}from"./badge-eENkJ6wW.js";import"./progress-Cq2wBF3Y.js";import{E as q}from"./eye-BHCWo64k.js";import"./index-DLzj8dFT.js";import"./chevron-down-CtET1gus.js";import"./check-Ui3xxLLN.js";const _=n.memo(({selectedUser:g,onUserSelect:b,selectedPeriod:d,loading:p})=>{const f=P(),m=E(),{users:l}=v(s=>s.users),{checkinHistory:h}=v(s=>s.checkin),[c,M]=n.useState(g?.id||"");n.useEffect(()=>{l.length===0&&(async()=>{let i=[],t=1,r=!0;for(;r;)try{const o=await m(L({page:t,limit:100,isActive:!0})).unwrap(),x=o.users||[];if(i=[...i,...x],r=o.pagination&&o.pagination.hasNext,t++,t>100)break}catch(o){console.error("Error fetching users page:",t,o);break}i.length>0&&console.log(`Fetched ${i.length} total users`)})()},[m,l.length]),n.useEffect(()=>{c&&m(T({page:1,limit:100,userId:c}))},[m,c]);const C=s=>{M(s);const i=l.find(t=>t.id===s);b(i)},a=n.useMemo(()=>{if(!c||!h)return[];const s=h.data||h;return Array.isArray(s)?s:s.checkins||[]},[c,h]),w=n.useMemo(()=>{if(a.length===0)return null;const s=a.slice(0,7),i=s.reduce((x,u)=>x+u.presenceLevel,0)/s.length,t=s.reduce((x,u)=>x+u.capacityLevel,0)/s.length,r={};s.forEach(x=>{x.selectedMoods?.forEach(u=>{r[u]=(r[u]||0)+1})});const o=Object.entries(r).sort(([,x],[,u])=>u-x).slice(0,3);return{avgPresence:Math.round(i*10)/10,avgCapacity:Math.round(t*10)/10,topMoods:o,checkinCount:s.length,trend:i>6?"improving":i<4?"concerning":"stable"}},[a]);n.useMemo(()=>a.filter(s=>s.details).slice(0,5).map(s=>({date:new Date(s.date).toLocaleDateString(),details:s.details,weatherType:s.weatherType,moods:s.selectedMoods})),[a]);const j=l.find(s=>s.id===c);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs(N,{children:[e.jsx(U,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),"Select User for Individual Analysis"]})}),e.jsx(y,{children:e.jsxs(F,{value:c,onValueChange:C,children:[e.jsx(z,{className:"w-full bg-card/50 border-border/50 hover:bg-card/70 transition-colors",children:e.jsx(R,{placeholder:"Choose a user to analyze..."})}),e.jsx(O,{className:"max-h-80 overflow-y-auto bg-card/95 backdrop-blur-sm border-border/50",children:l.length>0?l.map(s=>e.jsx(Q,{value:s.id||s._id,className:"hover:bg-primary/10 focus:bg-primary/10 cursor-pointer py-3 px-3",children:e.jsxs("div",{className:"flex flex-col w-full",children:[e.jsx("span",{className:"font-medium text-foreground text-sm",children:s.name}),e.jsxs("span",{className:"text-xs text-muted-foreground",children:[s.role," ",s.department&&`â€¢ ${s.department}`," ",s.unit&&`â€¢ ${s.unit}`]})]})},s.id||s._id)):e.jsx("div",{className:"py-6 text-center text-muted-foreground",children:e.jsx("p",{children:"No users available"})})})]})})]}),j&&a.length>0&&e.jsx(e.Fragment,{children:e.jsxs(N,{children:[e.jsx(U,{children:e.jsxs(D,{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(S,{className:"w-5 h-5"}),j.name]}),e.jsxs(A,{variant:"outline",size:"sm",onClick:()=>f(`/emotional-wellness/${c}`),className:"flex items-center gap-2",children:[e.jsx(q,{className:"w-4 h-4"}),"View Full Report"]})]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-4",children:[e.jsxs("div",{className:"text-center p-3 bg-primary/5 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-primary",children:a.length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Check-ins"})]}),e.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-green-600",children:w?.avgPresence||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Presence"})]}),e.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-blue-600",children:w?.avgCapacity||0}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Capacity"})]}),e.jsxs("div",{className:"text-center p-3 bg-purple-50 rounded-lg",children:[e.jsx("div",{className:"text-xl font-bold text-purple-600",children:a.filter(s=>s.aiAnalysis?.needsSupport).length}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Support Flags"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Latest Check-in"}),a[0]&&e.jsxs("div",{className:"bg-muted/30 p-3 rounded-lg",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:new Date(a[0].date).toLocaleDateString()}),e.jsx(I,{variant:"outline",className:"text-xs",children:a[0].weatherType})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:["Presence: ",e.jsxs("span",{className:"font-medium",children:[a[0].presenceLevel,"/10"]})]}),e.jsxs("div",{children:["Capacity: ",e.jsxs("span",{className:"font-medium",children:[a[0].capacityLevel,"/10"]})]})]}),a[0].selectedMoods?.length>0&&e.jsx("div",{className:"mt-2 flex gap-1",children:a[0].selectedMoods.slice(0,3).map(s=>e.jsx(I,{variant:"secondary",className:"text-xs",children:s},s))})]})]})]})]})}),(!c||a.length===0)&&e.jsx(N,{children:e.jsxs(y,{className:"text-center py-16",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-muted/30 flex items-center justify-center mx-auto mb-6",children:e.jsx($,{className:"w-10 h-10 text-muted-foreground"})}),e.jsx("h3",{className:"text-xl font-semibold mb-3",children:"Individual User Analytics"}),e.jsx("p",{className:"text-muted-foreground text-base leading-relaxed",children:c?`${j?.name||"Selected user"} hasn't completed any emotional check-ins yet.`:"Select a user from the dropdown above to view their comprehensive emotional wellness report, including check-in history, AI analysis insights, and personalized recommendations."}),e.jsx("div",{className:"mt-6 p-4 bg-primary/5 border border-primary/20 rounded-lg",children:e.jsx("p",{className:"text-sm text-primary font-medium",children:"ðŸ“Š Access detailed individual reports to provide targeted support and track progress over time."})})]})})]})});_.displayName="IndividualView";const W=n.memo(()=>{const g=E(),b=P(),{userId:d}=B(),{user:p}=v(t=>t.auth),{checkinHistory:f}=v(t=>t.checkin),{users:m}=v(t=>t.users),[l,h]=n.useState(null),[c,M]=n.useState("week"),[C,a]=n.useState(!1);n.useEffect(()=>{if(m.length>0){if(d){const t=m.find(r=>r.id===d);t&&h(t)}else if(p){const t=m.find(r=>r.id===p.id);t&&h(t)}}},[p,m,d]),n.useEffect(()=>{(async()=>{a(!0);try{await Promise.all([g(L()),g(T({page:1,limit:100}))])}catch(r){console.error("Error loading dashboard data:",r)}finally{a(!1)}})()},[g]);const w=t=>{h(t)},j=()=>{b("/emotional-checkin/dashboard")},s=()=>{b("/emotional-wellness")},i=t=>{if(!t?.gender)return t?.name||"User";const r=t.gender==="male"?"Mr.":t.gender==="female"?"Ms.":"",o=t.username||t.name||"User";return r?`${r} ${o}`:o};return e.jsxs("div",{className:"min-h-screen text-foreground relative overflow-hidden",children:[e.jsx("div",{className:"absolute inset-0 bg-gradient-to-br from-primary/5 via-transparent to-gold/5"}),e.jsx("div",{className:"absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_30%_20%,rgba(120,119,198,0.1),transparent_50%)]"}),e.jsx("div",{className:"absolute bottom-0 right-0 w-full h-full bg-[radial-gradient(circle_at_70%_80%,rgba(255,215,0,0.05),transparent_50%)]"}),e.jsxs("div",{className:"relative z-10 container-tight py-4 md:py-6",children:[e.jsxs(k.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},className:"mb-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs(A,{variant:"ghost",onClick:d?s:j,className:"flex items-center gap-2 hover:bg-primary/10",children:[e.jsx(H,{className:"w-4 h-4"}),d?"Back to My Dashboard":"Back to Main Dashboard"]})}),e.jsxs("div",{className:"text-right",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold bg-gradient-to-r from-primary to-gold bg-clip-text text-transparent",children:d?"User Report":"Individual Dashboard"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d?"Detailed emotional wellness report":"Your personal emotional wellness overview"})]})]}),e.jsx(N,{className:"glass glass-card border-primary/20",children:e.jsx(y,{className:"p-6",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-gradient-to-br from-primary to-gold flex items-center justify-center",children:e.jsx(S,{className:"w-6 h-6 text-white"})}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold",children:d?`Report for ${i(l)}`:`Welcome back, ${i(p)}!`}),e.jsx("p",{className:"text-muted-foreground",children:d?"Detailed emotional wellness analysis for this user":"Here's your comprehensive emotional wellness analysis"})]})]})})})]}),e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:e.jsx(_,{selectedUser:l,onUserSelect:w,selectedPeriod:c,loading:C,isPersonalView:!0})}),l&&e.jsx(k.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},className:"mt-6",children:e.jsxs(N,{className:"glass glass-card",children:[e.jsx(U,{children:e.jsxs(D,{className:"flex items-center gap-2",children:[e.jsx(V,{className:"w-5 h-5"}),"Quick Summary"]})}),e.jsx(y,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:f?.filter(t=>t.userId===l.id).length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Check-ins"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:f?.filter(t=>t.userId===l.id&&t.presenceLevel>=7).length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"High Presence Days"})]}),e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f?.filter(t=>t.userId===l.id&&t.capacityLevel>=7).length||0}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"High Capacity Days"})]})]})})]})})]})]})});W.displayName="IndividualDashboard";export{W as default};
