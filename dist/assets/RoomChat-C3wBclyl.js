import{r,j as e,m as n,E as w,u as k,b as N,H as S,R as E}from"./index-DVtOTvNj.js";import{B as x}from"./button-BN4cSQqQ.js";import{I as T}from"./input-BkmNWvG1.js";import{A as C}from"./arrow-left-jQ8uUXRx.js";import{P as M}from"./paperclip-BbmV_5yT.js";import{S as A}from"./send-B_xGDRuF.js";const D={initial:{x:"100%",opacity:0,scale:.98},in:{x:0,opacity:1,scale:1},out:{x:"100%",opacity:0,scale:.98}},H={type:"spring",stiffness:260,damping:25};function K({children:a,onSwipeBack:s}){const[o,i]=r.useState(!0);return r.useEffect(()=>{const l=setTimeout(()=>i(!1),3e3);return()=>clearTimeout(l)},[]),e.jsxs(n.div,{className:"relative h-full w-full",initial:"initial",animate:"in",exit:"out",variants:D,transition:H,drag:"x",dragConstraints:{left:0,right:0},dragElastic:.2,onDragEnd:(l,u)=>{u.offset.x>100&&s?.()},children:[a,o&&e.jsx(n.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},exit:{opacity:0},transition:{duration:.4},className:"absolute top-3 left-1/2 -translate-x-1/2 rounded-full bg-black/70 px-3 py-1 text-xs text-white shadow-md",children:"ðŸ‘‰ Swipe kanan untuk kembali"})]})}const R=[{id:1,name:"Budi Santoso",initials:"B",online:!0},{id:2,name:"Citra Dewi",initials:"C",online:!1},{id:3,name:"Andi W.",initials:"A",online:!1}],B=[{id:1,sender:"other",text:"Halo, saya sudah di jalan menuju lokasi Anda.",time:"10:30"},{id:2,sender:"me",text:"Oke, ditunggu ya. Kalau sudah dekat kabari.",time:"10:31"},{id:3,sender:"other",text:"Siap!",time:"10:31"}],h=(a="",s=800)=>String(a||"").replace(/<[^>]*>/g,"").replace(/\b(?:https?:|mailto:|ftp:|javascript:)[^\s]*/gi,"").replace(/https?:\/\/[^\s]+/gi,"").replace(/\s{2,}/g," ").trim().slice(0,s),$=()=>{const a=new Date;return`${String(a.getHours()).padStart(2,"0")}:${String(a.getMinutes()).padStart(2,"0")}`},z=E.memo(({msg:a})=>{const s=a.sender==="me";return e.jsx("div",{className:`flex ${s?"justify-end":"justify-start"}`,children:e.jsxs("div",{className:`max-w-[78%] px-3 sm:px-4 py-1.5 sm:py-2 rounded-2xl transition-colors duration-300 shadow-sm text-sm ${s?"rounded-br-none bg-primary text-primary-foreground":"rounded-bl-none bg-card/70 text-foreground border border-border/40"}`,children:[e.jsx("p",{className:"leading-relaxed break-words",children:a.text}),e.jsx("p",{className:"mt-0.5 text-[10px] sm:text-[11px] text-right text-muted-foreground",children:a.time})]})})});function q(){const{id:a}=w(),s=k(),o=N(),i=r.useMemo(()=>R.find(t=>String(t.id)===String(a)),[a]);r.useEffect(()=>{i||s("/worker/chat",{replace:!0})},[i,s]);const[l,u]=r.useState(B),[d,p]=r.useState(""),[b,f]=r.useState(!1),c=r.useRef(null),g=r.useCallback(t=>{t&&t.preventDefault();const m=h(d,600);if(!m)return;const j={id:Date.now(),sender:"me",text:m,time:$()};f(!0),u(v=>[...v,j]),p(""),setTimeout(()=>f(!1),400)},[d]);if(r.useEffect(()=>{if(c.current){const t=setTimeout(()=>{c.current.scrollTo({top:c.current.scrollHeight,behavior:"smooth"})},80);return()=>clearTimeout(t)}},[l]),!i)return null;const y=o?{}:{initial:{opacity:0,y:-12},animate:{opacity:1,y:0},transition:{duration:.32}};return e.jsxs(K,{onSwipeBack:()=>s("/worker/chat"),children:[e.jsx(S,{children:e.jsxs("title",{children:["Chat dengan ",i.name," â€” Kerjain"]})}),e.jsxs("div",{className:"relative mx-auto flex h-dvh max-w-lg flex-col",children:[e.jsxs(n.header,{...y,className:"flex items-center gap-3 border-b border-border/50 bg-background/70 px-3 sm:px-4 py-2 sm:py-3 backdrop-blur-xl",children:[e.jsx(x,{variant:"ghost",size:"icon",className:"rounded-full hover:bg-accent/20 hover:text-accent transition-colors duration-300",onClick:()=>s("/worker/chat"),"aria-label":"Kembali",children:e.jsx(C,{className:"h-5 w-5"})}),e.jsxs("div",{className:"flex items-center gap-2 sm:gap-3",children:[e.jsxs("div",{className:"relative flex h-9 w-9 sm:h-10 sm:w-10 items-center justify-center rounded-full bg-gradient-to-br from-primary to-accent text-xs sm:text-sm font-semibold text-primary-foreground",children:[i.initials,i.online&&e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 block h-2.5 w-2.5 sm:h-3 sm:w-3 rounded-full bg-emerald-400 ring-2 ring-background"})]}),e.jsxs("div",{className:"min-w-0",children:[e.jsx("h1",{className:"truncate text-sm sm:text-base font-semibold text-foreground",children:i.name}),e.jsx("p",{className:`text-xs ${i.online?"text-emerald-400":"text-muted-foreground"}`,children:i.online?"Online":"Offline"})]})]})]}),e.jsx(n.div,{ref:c,className:"flex-1 overflow-y-auto px-3 sm:px-4 py-3 sm:py-5 space-y-3 sm:space-y-4",children:l.map((t,m)=>e.jsx(n.div,{initial:o?{}:{opacity:0,y:8},animate:o?{}:{opacity:1,y:0},transition:{duration:.3,delay:m*.02},children:e.jsx(z,{msg:t})},t.id))}),e.jsxs(n.form,{onSubmit:g,className:"flex items-center gap-2 border-t border-border/50 bg-background/70 px-2 sm:px-3 py-2 backdrop-blur-xl",children:[e.jsx(x,{variant:"ghost",size:"icon",type:"button",className:"rounded-full hover:bg-accent/20 hover:text-accent transition-colors duration-300","aria-label":"Lampirkan file",children:e.jsx(M,{className:"h-5 w-5"})}),e.jsx(T,{"aria-label":"Ketik pesan",placeholder:"Tulis pesan...",value:d,onChange:t=>p(h(t.target.value,600)),className:"flex-1 rounded-full border border-border/40 bg-card/60 text-xs sm:text-sm text-foreground placeholder:text-muted-foreground focus-visible:ring-2 focus-visible:ring-accent/40 transition-all duration-300",onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),g())}}),e.jsx(x,{size:"icon",type:"submit",disabled:b||!d.trim(),className:"rounded-full bg-primary hover:bg-primary/90 transition-colors duration-300 shadow-md disabled:opacity-50","aria-label":"Kirim pesan",children:e.jsx(A,{className:"h-5 w-5 text-primary-foreground"})})]})]})]})}export{q as default};
