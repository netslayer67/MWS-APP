import{d as L,r as a,V as M,j as e,W as D}from"./index-BH3Cl4N6.js";import{S as E}from"./search-zLCWd0QM.js";import{U as w}from"./users-B5Gpu3uh.js";import{C as U}from"./circle-check-BF9AV8cm.js";import{T as $}from"./triangle-alert-BJauSFh7.js";const k=(t="")=>t.toString().replace(/_/g," ").trim().replace(/\s+/g," ").replace(/\b\w/g,d=>d.toUpperCase()),G=(t=[])=>{if(!Array.isArray(t))return[];const d=t.map(l=>{const o=l?.grade||"",n=l?.className||"";return o&&n?`${o} - ${n}`:o||n||""}).filter(Boolean);return Array.from(new Set(d))},O=()=>{const{user:t}=L(s=>s.auth),d=a.useMemo(()=>new Date().toISOString().split("T")[0],[]),[l,o]=a.useState(d),[n,C]=a.useState(""),[g,h]=a.useState(!0),[b,y]=a.useState(""),[m,T]=a.useState(null),j=a.useMemo(()=>G(t?.classes),[t?.classes]),N=a.useMemo(()=>{const s=(t?.gender||"").toLowerCase();return s==="male"||s==="m"?"Mr.":s==="female"||s==="f"?"Ms.":""},[t?.gender]),v=a.useMemo(()=>{const s=(t?.username||"").trim();return s||(t?.name||"").split(",")[0]?.trim()||"Teacher"},[t?.name,t?.username]),u=a.useCallback(async()=>{h(!0),y("");try{const s=await M(l),r=s?.data?.data||s?.data||null;T(r)}catch(s){y(s?.response?.data?.message||"Failed to load student check-ins.")}finally{h(!1)}},[l]);a.useEffect(()=>{u()},[u]);const c=m?.stats||{totalStudents:0,submittedToday:0,notSubmitted:0,needsSupport:0},i=Array.isArray(m?.students)?m.students:[],x=n.trim().toLowerCase(),p=a.useMemo(()=>x?i.filter(s=>[s?.name,s?.email,s?.currentGrade,s?.className,s?.nickname].filter(Boolean).some(r=>r.toLowerCase().includes(x))):i,[x,i]);return e.jsx("div",{className:"min-h-screen text-foreground relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10 container-tight py-6",children:[e.jsxs("div",{className:"glass glass-card p-5 md:p-6 mb-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-start md:justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:"Student Daily Check-in"}),e.jsxs("h1",{className:"text-2xl md:text-3xl font-semibold text-foreground",children:["Hi ",N?`${N} ${v}`:v,", here is today's class pulse."]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"Showing check-ins for your assigned class scope."})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(D,{className:"w-4 h-4 text-primary"}),e.jsx("span",{children:l})]})]}),j.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-4",children:j.map(s=>e.jsx("span",{className:"px-3 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:s},s))})]}),e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3 mb-5",children:[e.jsxs("div",{className:"relative w-full lg:max-w-xs",children:[e.jsx(E,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{value:n,onChange:s=>C(s.target.value),placeholder:"Search students, class, or email",className:"w-full pl-9 pr-3 py-2 rounded-lg border border-border bg-background/80 text-sm focus:outline-none focus:ring-2 focus:ring-primary/40"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"date",value:l,onChange:s=>o(s.target.value),className:"rounded-lg border border-border bg-background/80 px-3 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-primary/40"}),e.jsx("button",{type:"button",onClick:u,className:"rounded-lg bg-primary/90 text-white px-4 py-2 text-sm font-medium hover:bg-primary transition-colors",children:"Refresh"})]})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mb-6",children:[{label:"Total Students",value:c.totalStudents,icon:w},{label:"Submitted Today",value:c.submittedToday,icon:U},{label:"Needs Support",value:c.needsSupport,icon:$},{label:"Not Submitted",value:c.notSubmitted,icon:w}].map(s=>e.jsxs("div",{className:"glass glass-card p-4 flex items-center gap-3",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-primary/10 flex items-center justify-center",children:e.jsx(s.icon,{className:"w-5 h-5 text-primary"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:s.label}),e.jsx("p",{className:"text-2xl font-semibold text-foreground",children:s.value})]})]},s.label))}),e.jsxs("div",{className:"glass glass-card p-5",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Student check-ins"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",p.length," of ",i.length," students."]})]}),g&&e.jsx("p",{className:"text-xs text-muted-foreground",children:"Loading latest check-ins..."})]}),b&&e.jsx("div",{className:"rounded-lg border border-destructive/40 bg-destructive/10 p-4 text-sm text-destructive mb-4",children:b}),!g&&p.length===0&&e.jsx("div",{className:"p-6 rounded-lg border border-dashed border-muted text-center text-sm text-muted-foreground",children:"No students found for this class scope."}),e.jsx("div",{className:"space-y-3",children:p.map(s=>{const r=s.checkin,f=Array.isArray(r?.selectedMoods)?r.selectedMoods:[],A=r?.aiAnalysis?.needsSupport;return e.jsx("div",{className:"p-4 rounded-xl border border-border/70 bg-card/40 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:s.name||s.nickname||"Unnamed student"}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[s.currentGrade||"Grade"," â€¢ ",s.className||"Class"]}),s.email&&e.jsx("p",{className:"text-xs text-muted-foreground",children:s.email})]}),e.jsx("div",{className:"flex flex-wrap items-center gap-2",children:r?e.jsxs(e.Fragment,{children:[e.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-emerald-100 text-emerald-700",children:k(r.weatherType||"Check-in")}),e.jsxs("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-sky-100 text-sky-700",children:["P ",r.presenceLevel??"-"," / C ",r.capacityLevel??"-"]}),A&&e.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-rose-100 text-rose-700",children:"Needs support"}),f.slice(0,3).map(S=>e.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-primary/10 text-primary",children:k(S)},S)),f.length>3&&e.jsxs("span",{className:"text-xs text-muted-foreground",children:["+",f.length-3," more"]})]}):e.jsx("span",{className:"px-2.5 py-1 rounded-full text-xs font-medium bg-amber-100 text-amber-700",children:"Not submitted"})})]})},s.id)})})]})]})})};export{O as default};
