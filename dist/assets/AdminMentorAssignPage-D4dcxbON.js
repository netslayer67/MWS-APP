import{N as V,K as W,b as H,e as J,r as a,j as e,L as R,F as z,q as Q}from"./index-BAvDP42J.js";import{d as X,n as Y,j as Z,e as ee,k as te}from"./teacherDashboardUtils-J3i_RWGW.js";import{S as se}from"./search-DUKK0aNk.js";import"./shield-check-CKrMDfjh.js";const ae=650,y=[{label:"Tier 2 - Targeted",value:"tier2"},{label:"Tier 3 - Intensive",value:"tier3"}],re=()=>{const{mentorId:b}=V(),l=W(),m=H(),{toast:x}=J(),[r,S]=a.useState(()=>l.state?.mentor||null),[i,O]=a.useState([]),[h,M]=a.useState("tier2"),[g,C]=a.useState(""),[d,T]=a.useState([]),[f,L]=a.useState(""),[A,_]=a.useState(""),[$,F]=a.useState(!0),[w,G]=a.useState(!1),[E,j]=a.useState(null),[I,P]=a.useState(10);a.useEffect(()=>{T([]),C(""),L(""),_(""),M("tier2"),P(10)},[b]),a.useEffect(()=>{l.state?.mentor&&S(l.state.mentor)},[l.state]),a.useEffect(()=>{let t=!1;return(async()=>{F(!0),j(null);try{const[o,q]=await Promise.all([Z(),ee({limit:ae})]);if(t)return;const p=(o?.mentors||[]).find(n=>(n._id||n.id||"").toString()===b)||l.state?.mentor||null;p?S(p):j("Mentor not found or not registered.");const k=(q?.students||[]).slice().sort((n,D)=>(n.name||"").localeCompare(D.name||""));O(k)}catch(o){if(t)return;j(o?.response?.data?.message||o.message||"Failed to load MTSS data.")}finally{t||F(!1)}})(),()=>{t=!0}},[b,l.state]);const c=a.useMemo(()=>X(r||{}),[r]),v=a.useMemo(()=>{const t=g.trim().toLowerCase();return i.filter(s=>{const o=Y(s.grade||s.currentGrade||s.className||s.type||"");if(!(!c.allowedGrades.length||c.allowedGrades.includes(o)))return!1;if(!t)return!0;const p=s.name?.toLowerCase()||"",k=o.toLowerCase(),n=(s.className||"").toLowerCase();return p.includes(t)||k.includes(t)||n.includes(t)})},[i,g,c.allowedGrades]),N=a.useMemo(()=>v.slice(0,I),[v,I]),u=a.useMemo(()=>i.filter(t=>d.includes(t.id||t._id)),[i,d]),B=t=>{T(s=>s.includes(t)?s.filter(o=>o!==t):[...s,t])},K=async t=>{if(t.preventDefault(),!r?._id){x({title:"Mentor not ready",description:"We could not find mentor data for this assignment.",variant:"destructive"});return}if(d.length<2){x({title:"Select at least two students",description:"MTSS Tier 2 thrives on tight-knit groups, so add another student to keep it collaborative.",variant:"destructive"});return}G(!0);try{const s=f?f.split(",").map(o=>o.trim()).filter(Boolean):[];await te({mentorId:r._id,studentIds:d,tier:h,focusAreas:s,notes:A.trim()}),x({title:"New caseload created",description:`Paired ${r.name} with ${d.length} students.`}),m("/mtss/admin")}catch(s){x({title:"Failed to save assignment",description:s?.response?.data?.message||s.message||"A server error occurred.",variant:"destructive"})}finally{G(!1)}},U=()=>e.jsxs("div",{className:"max-w-5xl mx-auto space-y-8","data-aos":"fade-up","data-aos-delay":"120",children:[e.jsxs("button",{type:"button",onClick:()=>m("/mtss/admin"),className:"inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-[#d8b4fe]/90 via-[#fbcfe8]/90 to-[#fde68a]/90 dark:from-[#312e81]/80 dark:via-[#4c1d95]/80 dark:to-[#083344]/80 px-4 py-2 text-sm font-semibold text-slate-700 dark:text-white shadow-lg shadow-rose-200/40 dark:shadow-none hover:-translate-y-0.5 transition duration-300","data-aos":"fade-right",children:[e.jsx(z,{className:"w-4 h-4"}),"Back to Mentor Squad"]}),e.jsxs("div",{className:"relative overflow-hidden rounded-[34px] border border-white/40 dark:border-white/10 bg-gradient-to-br from-white/95 via-white/70 to-white/40 dark:from-slate-900/80 dark:via-slate-900/60 dark:to-slate-900/45 shadow-[0_35px_120px_rgba(15,23,42,0.35)] backdrop-blur-3xl p-6 sm:p-10 space-y-8",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute -top-16 -right-12 w-56 h-56 bg-gradient-to-br from-[#f472b6]/40 via-[#fcd34d]/30 to-transparent blur-3xl"}),e.jsx("div",{className:"absolute -bottom-10 left-8 w-48 h-48 bg-gradient-to-br from-[#22d3ee]/35 via-transparent to-transparent blur-3xl"})]}),e.jsxs("div",{className:"relative space-y-4","data-aos":"fade-up","data-aos-delay":"200",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-[#c7d2fe] via-[#fbcfe8] to-[#fecdd3] text-xs font-semibold text-slate-700 dark:text-white shadow-inner",children:[e.jsx(Q,{className:"w-4 h-4 text-rose-500"}),"Assign Students"]}),e.jsxs("div",{className:"flex flex-wrap items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-14 h-14 rounded-3xl bg-white/80 text-slate-900 font-black flex items-center justify-center shadow-inner shadow-white/40",children:r?.name?.split(" ").map(t=>t[0]).slice(0,2).join("")||"??"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-black text-slate-900 dark:text-white",children:r?.name||"Mentor"}),e.jsx("p",{className:"text-sm font-semibold text-slate-600 dark:text-white/70",children:r?.jobPosition||r?.role||"Teacher"})]})]}),e.jsxs("div",{className:"ml-auto text-right text-xs uppercase tracking-[0.35em] text-slate-500 dark:text-white/60",children:[e.jsx("p",{children:"Tier focus"}),e.jsx("p",{className:"text-base font-black tracking-normal text-slate-900 dark:text-white",children:y.find(t=>t.value===h)?.label})]})]}),e.jsx("p",{className:"text-sm text-slate-600 dark:text-white/70 max-w-2xl",children:"Select at least two students to keep the small-group energy collaborative. Focus areas and notes stay optional so the flow remains light but intentional."}),e.jsxs("p",{className:"text-xs font-semibold text-slate-500 dark:text-white/60",children:["Caseload scope: ",c.allowedGrades.length?c.allowedGrades.join(", "):r?.unit||"All Grades"]}),e.jsxs("div",{className:"grid gap-3 sm:grid-cols-3","data-aos":"fade-up","data-aos-delay":"240",children:[e.jsxs("div",{className:"rounded-2xl bg-white/80 dark:bg-white/5 border border-white/60 dark:border-white/10 px-4 py-3 shadow-inner",children:[e.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.3em] text-slate-500 dark:text-white/60",children:"Selected"}),e.jsx("p",{className:"text-2xl font-black text-slate-900 dark:text-white",children:d.length})]}),e.jsxs("div",{className:"rounded-2xl bg-gradient-to-r from-[#e0f2fe] via-[#ecfeff] to-[#fef3c7] dark:from-[#0d2538] dark:via-[#13213c] dark:to-[#2a1a3f] border border-white/60 dark:border-white/10 px-4 py-3 shadow-inner",children:[e.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.3em] text-slate-500 dark:text-white/60",children:"Tier"}),e.jsx("p",{className:"text-lg font-black text-slate-900 dark:text-white",children:y.find(t=>t.value===h)?.label})]}),e.jsxs("div",{className:"rounded-2xl bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 px-4 py-3 shadow-inner",children:[e.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.3em] text-slate-500 dark:text-white/60",children:"Focus Area"}),e.jsx("p",{className:"text-xs font-bold text-slate-700 dark:text-white line-clamp-1",children:f||"Fluency boost, SEL routines"})]})]})]}),e.jsxs("form",{onSubmit:K,className:"space-y-6","data-aos":"fade-up","data-aos-delay":"260",children:[e.jsxs("div",{className:"grid gap-4 sm:grid-cols-[1.2fr_0.8fr]",children:[e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsxs("span",{className:"flex items-center justify-between text-[11px] uppercase tracking-[0.3em] text-muted-foreground",children:["Tier ",e.jsx("span",{className:"text-[10px] text-rose-500",children:"Required"})]}),e.jsx("select",{value:h,onChange:t=>M(t.target.value),className:"w-full rounded-2xl border border-border/50 bg-white/95 dark:bg-white/10 px-4 py-3 focus:ring-2 focus:ring-primary/40 shadow-inner",children:y.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsxs("span",{className:"flex items-center justify-between text-[11px] uppercase tracking-[0.3em] text-muted-foreground",children:["Focus areas ",e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full border border-border/40 text-muted-foreground",children:"Optional"})]}),e.jsx("input",{value:f,onChange:t=>L(t.target.value),placeholder:"Fluency boost, SEL routines",className:"w-full rounded-2xl border border-border/50 bg-white/95 dark:bg-white/10 px-4 py-3 focus:ring-2 focus:ring-primary/40 shadow-inner"})]})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsxs("span",{className:"flex items-center justify-between text-[11px] uppercase tracking-[0.3em] text-muted-foreground",children:["Notes ",e.jsx("span",{className:"text-[10px] px-2 py-0.5 rounded-full border border-border/40 text-muted-foreground",children:"Optional"})]}),e.jsx("textarea",{value:A,onChange:t=>_(t.target.value),placeholder:"Add optional context, routines, or student highlights...",className:"w-full h-28 rounded-2xl border border-border/50 bg-white/95 dark:bg-white/10 px-4 py-3 resize-none focus:ring-2 focus:ring-primary/40 shadow-inner"})]}),u.length>0&&e.jsxs("div",{className:"rounded-[24px] bg-gradient-to-r from-[#ecfeff]/90 via-[#fef9c3]/80 to-[#fce7f3]/80 dark:from-white/10 dark:via-white/5 dark:to-white/5 border border-white/60 dark:border-white/10 p-4 flex flex-wrap gap-2 text-sm","data-aos":"fade-up","data-aos-delay":"320",children:[u.slice(0,6).map(t=>e.jsx("span",{className:"px-3 py-1 rounded-full bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/20 text-foreground dark:text-white",children:t.name},t.id||t._id)),u.length>6&&e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/70 dark:bg-white/10 border border-white/40 dark:border-white/20 text-muted-foreground",children:["+",u.length-6," more"]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-semibold text-foreground dark:text-white",children:"Select at least two students for this caseload"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Scroll gently — students load 10 at a time for smoother performance."})]}),e.jsxs("div",{className:"relative w-full sm:w-72",children:[e.jsx(se,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:g,onChange:t=>C(t.target.value),placeholder:"Search name, grade, or class...",className:"w-full pl-10 pr-4 py-2.5 rounded-full border border-border/60 bg-white/95 dark:bg-white/10 text-sm focus:ring-2 focus:ring-primary/40"})]})]}),e.jsx("div",{className:"max-h-[360px] overflow-y-auto rounded-[28px] border border-white/60 dark:border-white/10 bg-gradient-to-br from-white/95 via-[#fdf2f8]/80 to-[#ecfeff]/80 dark:from-slate-900/80 dark:via-slate-900/60 dark:to-slate-900/40 p-5 space-y-3 custom-scroll backdrop-blur-xl","data-aos":"fade-up","data-aos-delay":"360",children:i.length?e.jsxs(e.Fragment,{children:[N.map((t,s)=>e.jsxs("label",{className:"flex items-start gap-3 text-sm text-foreground dark:text-white cursor-pointer rounded-2xl border border-white/60 dark:border-white/10 bg-white/85 dark:bg-white/5 px-3 py-2 shadow-sm hover:border-primary/40 transition","data-aos":"fade-up","data-aos-delay":380+s*20,children:[e.jsx("input",{type:"checkbox",checked:d.includes(t.id||t._id),onChange:()=>B(t.id||t._id),className:"mt-1 rounded border-border/60 accent-primary w-4 h-4"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold",children:t.name}),e.jsxs("p",{className:"text-xs text-muted-foreground",children:[t.grade||"No grade"," · ",t.className||t.type||"MTSS"]})]})]},t.id||t._id)),!N.length&&e.jsx("p",{className:"text-sm text-muted-foreground text-center py-6",children:"No students match the search."}),N.length<v.length&&e.jsx("button",{type:"button",onClick:()=>P(t=>t+10),className:"w-full text-sm font-semibold text-primary px-4 py-3 rounded-2xl border border-primary/30 bg-white/70 dark:bg-white/10 hover:bg-white transition",children:"Load 10 more students"})]}):e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 gap-3 text-sm font-semibold text-muted-foreground",children:[e.jsx(R,{className:"w-5 h-5 animate-spin text-primary"}),e.jsx("p",{children:"Fetching roster..."}),e.jsx("p",{className:"text-xs text-muted-foreground/80",children:"Scroll softly - students load in micro-batches."})]})})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:justify-end",children:[e.jsx("button",{type:"button",onClick:()=>m("/mtss/admin"),className:"px-4 py-2 rounded-full border border-border/60 text-sm font-semibold text-foreground dark:text-white bg-white/80 dark:bg-white/5 hover:shadow",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:w||d.length<2,className:`px-6 py-2.5 rounded-full text-sm font-semibold text-white transition ${w||d.length<2?"bg-muted cursor-not-allowed opacity-60":"bg-gradient-to-r from-[#22d3ee] via-[#3b82f6] to-[#a855f7] shadow-xl hover:-translate-y-0.5"}`,children:w?"Assigning...":"Assign Selected"})]})]})]})]});return $?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#e0f2fe] via-[#fdf2f8] to-[#fefce8]",children:e.jsxs("div",{className:"flex flex-col items-center gap-3 text-sm font-semibold text-slate-600",children:[e.jsx(R,{className:"w-8 h-8 animate-spin text-primary"}),e.jsx("span",{children:"Loading mentor & student data..."})]})}):E||!r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-[#e0f2fe] via-[#fdf2f8] to-[#fefce8] p-4",children:e.jsxs("div",{className:"max-w-md w-full rounded-3xl border border-white/40 bg-white/90 shadow-xl p-6 text-center space-y-4",children:[e.jsx("p",{className:"text-lg font-semibold text-destructive",children:E||"Mentor not found."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Please head back to the dashboard and try another mentor."}),e.jsxs("button",{type:"button",onClick:()=>m("/mtss/admin"),className:"inline-flex items-center justify-center gap-2 px-4 py-2 rounded-full bg-gradient-to-r from-[#22d3ee] via-[#3b82f6] to-[#a855f7] text-white font-semibold",children:[e.jsx(z,{className:"w-4 h-4"}),"Go back"]})]})}):e.jsxs("div",{className:"min-h-screen relative overflow-hidden px-4 py-8 sm:px-6 lg:px-10 bg-gradient-to-br from-[#dbeafe] via-[#fdf2f8] to-[#fef9c3] dark:from-[#0f172a] dark:via-[#111827] dark:to-[#1e1b4b]",children:[e.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[e.jsx("div",{className:"absolute -top-32 left-4 w-64 h-64 bg-[#a5b4fc]/30 blur-[160px]"}),e.jsx("div",{className:"absolute top-10 right-10 w-72 h-72 bg-[#f472b6]/25 blur-[180px]"}),e.jsx("div",{className:"absolute bottom-0 left-1/3 w-80 h-80 bg-[#fde68a]/30 blur-[180px]"})]}),e.jsx("div",{className:"relative z-10",children:U()})]})};re.displayName="AdminMentorAssignPage";export{re as default};
