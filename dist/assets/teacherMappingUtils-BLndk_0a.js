import{n as v,c as T}from"./teacherGradeUtils-COfj_G-K.js";import{S as U}from"./shield-check-CKOShQgl.js";import{c as G,am as x}from"./index-D0Udg6QN.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _=[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"m9 14 2 2 4-4",key:"df797q"}]],$=G("clipboard-check",_),k=[{key:"active",label:"Active Interventions",sub:"Kids in a boost bubble",icon:U,accent:"from-[#0ea5e9]/90 via-[#818cf8]/85 to-[#34d399]/80"},{key:"due",label:"Updates Due",sub:"Check-ins waiting today",icon:$,accent:"from-[#fcd34d]/90 via-[#fb923c]/85 to-[#38bdf8]/80"},{key:"success",label:"Success Rate",sub:"Kids hitting targets",icon:x,accent:"from-[#22d3ee]/90 via-[#a855f7]/85 to-[#f472b6]/80"}],S=(e,r={month:"short",day:"numeric"})=>{if(!e)return"—";try{return new Intl.DateTimeFormat("en-US",r).format(new Date(e))}catch{return"—"}},M=e=>e?e.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)+/g,""):`student-${Math.random().toString(36).slice(2,6)}`,Y=()=>{try{return JSON.parse(localStorage.getItem("auth_user")||"null")}catch{return null}},z=e=>{if(e?.status!=="active")return!1;const r=e?.checkIns?.slice(-1)[0]?.date;return r?(Date.now()-new Date(r).getTime())/(1e3*60*60*24)>=7:!0},q=(e=[])=>{const r=e.filter(n=>n.status==="active").length,a=e.filter(z).length,h=e.reduce((n,s)=>n+(s.goals?.length||0),0),c=e.reduce((n,s)=>n+(s.goals?.filter(t=>t.completed).length||0),0),d=h||e.length||1,f=e.filter(n=>n.status==="completed").length,o=Math.round((c||f)/d*100);return[{...k[0],value:r},{...k[1],value:a},{...k[2],value:`${Number.isFinite(o)?o:0}%`}]},N={active:"On Track",paused:"Needs Attention",completed:"Completed",closed:"Closed"},b={active:4,paused:3,completed:2,closed:1},A={tier1:1,tier2:2,tier3:3},R=e=>{if(!e)return"Tier 2";const r=e.toString().toLowerCase();return r.includes("3")?"Tier 3":r.includes("1")?"Tier 1":"Tier 2"},L=e=>{if(!e)return null;const r=e.toString().toLowerCase();return r.includes("3")?"tier3":r.includes("2")?"tier2":r.includes("1")?"tier1":null},E=e=>e?.focusAreas?.length?e.focusAreas[0]:e?.tier==="tier3"?"Intensive Support":"Literacy & SEL",K=(e,r)=>{const a=[e?.metricLabel,e?.notes,e?.focusAreas?.join(" "),r?.type].filter(Boolean).join(" ").toLowerCase();return/attendance|present|absen/.test(a)?"%":/reading|fluency|literacy|wpm/.test(a)?"wpm":/math|numeracy|accuracy|score/.test(a)?"score":/behavior|sel|conduct|check-in|checkin/.test(a)?"pts":"score"},O=(e,r)=>{if(!e)return"Ongoing";const a=new Date(e),h=r?new Date(r):new Date,c=Math.max(1,Math.round((h-a)/(1e3*60*60*24*7)));return`${c} wk${c>1?"s":""}`},F=e=>{const r=e?.checkIns?.slice(-1)[0]?.date||e?.startDate;if(!r)return"Awaiting update";const a=new Date(r);return a.setDate(a.getDate()+7),S(a)},W=(e={})=>{const r=e.checkIns||[];if(r.length){const d=r.length;return r.map((f,o)=>{const n=Math.round((o+1)/d*100),s=S(f.date);return{label:s,date:s,reading:n,goal:100,value:n}})}const a=e.goals||[];if(a.length){const d=a.length;let f=0;return a.map((o,n)=>{o.completed&&(f+=1);const s=Math.round(f/d*100),t=o.description||`Goal ${n+1}`;return{label:t,date:t,reading:s,goal:100,value:s}})}const h=e.status==="completed"?100:0,c=S(e.startDate);return[{label:c,date:c,reading:h,goal:100,value:h}]},B=(e={})=>(e.checkIns||[]).slice(-6).reverse().map(r=>({date:S(r.date,{month:"short",day:"numeric",year:"numeric"}),score:"-",notes:r.summary||r.nextSteps||"Check-in recorded"})),J=(e=[],r="MTSS Mentor")=>{const a=new Map;e.forEach(o=>{const n=E(o),s=R(o.tier),t=o.status||"active",i=F(o),m=W(o),u=B(o),p=o.goals||[],w=p.filter(l=>l.completed).length;(o.studentIds||[]).forEach(l=>{const g=l?._id?.toString?.()||l?.id||l;if(!g)return;const I=v(l?.currentGrade||l?.classes?.[0]?.grade||l?.unit||l?.class||"-"),C=K(o,l),y={id:g,assignmentId:o._id?.toString?.()||null,slug:l?.slug||M(l?.name),name:l?.name||"Student",grade:I,type:n,tier:s,progress:N[t]||"On Track",nextUpdate:i,statusKey:t,profile:{teacher:r,mentor:o.mentorId?.name||r,type:n,strategy:o.focusAreas?.join(", ")||`Support focus - ${s}`,started:S(o.startDate),duration:O(o.startDate,o.endDate),baseline:p.length?0:null,current:p.length?w:o.checkIns?.length||(t==="completed"?1:0),target:p.length||Math.max(o.checkIns?.length||1,1),progressUnit:C,chart:m,history:u}},D=a.get(g);(!D||b[t]>b[D.statusKey])&&a.set(g,y)})});const c=Array.from(a.values()).sort((o,n)=>b[n.statusKey]-b[o.statusKey]),d=c[0]?.profile?.chart||[],f=c[0]?`${c[0].tier} ${c[0].type}`:null;return{students:c.map(({statusKey:o,...n})=>n),spotlightChart:d,focusLabel:f}},V=(e=[],r=[],a={allowedGrades:[]})=>{const h=new Map(r.map(t=>[t.id?.toString?.()||t.slug||t.name,t])),c=a.allowedGrades||[],d=a.allowedClasses||[],f=a.strictClassFilter,o=t=>{if(!c.length)return!0;const i=v(t);return c.some(m=>{const u=v(m);return i===u||i.startsWith(u)})},n=t=>{if(!f||!d.length)return!0;if(!t)return!1;const i=T(t);return d.some(m=>{const u=T(m);return i===u||i.endsWith(u)||i.endsWith(`- ${u}`)})},s=e.map(t=>{const i=t.id?.toString?.()||t._id?.toString?.()||t.slug||t.name,m=v(t.grade||t.currentGrade||t.className||"-"),u=T(t.className||t.currentGrade||t.unit);if(!o(m)||!n(u))return null;const p=h.get(i),w=L(t.tier||t.primaryIntervention?.tier||t.profile?.tier),l=L(p?.tier),g=A[w]||0,I=A[l]||0,y=p&&(!g||I>g)?p:t;return{id:i,slug:t.slug||M(t.name),name:t.name,grade:m,className:u||t.className,type:y?.type||t.type||"Universal Supports",tier:y?.tier||t.tier||"Tier 1",progress:y?.progress||t.progress||"Not Assigned",nextUpdate:y?.nextUpdate||t.nextUpdate||"Not scheduled",assignmentId:p?.assignmentId||null,profile:y?.profile||p?.profile||t.profile,interventions:t.interventions,primaryIntervention:t.primaryIntervention}}).filter(Boolean);return!s.length&&r.length?r:s};export{$ as C,V as a,q as b,Y as g,J as m};
