import{r as l,a as O,j as e,Y as $,a1 as I,B as N}from"./index-lpRWoASH.js";import{C as j,a as v,b,c as y}from"./card-BaYfutPz.js";import{B as x}from"./badge-Bn4tkwop.js";import{I as P}from"./input-B7gluzXv.js";import{U as B}from"./UserDetailModal-Dw0SuV8c.js";import{U as p}from"./users-Bk-irvpv.js";import{C as H}from"./clock-CkPma-0U.js";import{T as w}from"./EmotionalCheckinDashboard-BWW5RXon.js";import{S as R}from"./search-BJ8NIKDf.js";import{A as L}from"./arrow-up-right-DyRC3fBt.js";import"./CategoricalChart-T9oqzxIZ.js";import"./CartesianChart-DFBKULpu.js";import"./ActivePoints-BzrjVRsr.js";import"./ErrorBarContext-B3ZzexYS.js";import"./socketService-DK54WtJ1.js";import"./funnel-BllHDuJc.js";import"./building-ovHGgiTz.js";const u=1440*60*1e3,Y=t=>{if(!t)return"No activity yet";const r=new Date(t),d=Date.now()-r.getTime();if(d<u)return"Today";if(d<u*2)return"Yesterday";const o=Math.floor(d/u);return`${o} day${o!==1?"s":""} ago`},C=t=>typeof t!="number"||Number.isNaN(t)?"–":`${Math.round(t*10)/10}/10`,z=l.memo(({staff:t=[],summary:r})=>{const d=O(),[o,S]=l.useState(""),[k,T]=l.useState(null),[M,h]=l.useState(!1),m=l.useMemo(()=>{if(r)return{total:r.totalMembers??t.length,activeToday:r.activeToday??0,flagged:r.flaggedMembers??0,submissions:r.submittedInPeriod??0};const s=new Date().toISOString().split("T")[0],a=t.filter(n=>{const g=n.lastCheckin?.date;if(!g)return!1;const f=new Date(g);return f.setHours(0,0,0,0),f.toISOString().split("T")[0]===s}).length,i=t.filter(n=>n.lastCheckin?.needsSupport||(n.periodSummary?.needsSupportDays||0)>0).length,c=t.filter(n=>(n.periodSummary?.submissions||0)>0).length;return{total:t.length,activeToday:a,flagged:i,submissions:c}},[t,r]),D=l.useMemo(()=>{if(!o.trim())return[...t].sort((a,i)=>{const c=a.lastCheckin?.date?new Date(a.lastCheckin.date).getTime():0;return(i.lastCheckin?.date?new Date(i.lastCheckin.date).getTime():0)-c});const s=o.trim().toLowerCase();return t.filter(a=>`${a.name} ${a.email||""} ${a.department||""} ${a.unit||""}`.toLowerCase().includes(s)).sort((a,i)=>{const c=a.lastCheckin?.date?new Date(a.lastCheckin.date).getTime():0;return(i.lastCheckin?.date?new Date(i.lastCheckin.date).getTime():0)-c})},[t,o]),U=l.useCallback(s=>{T({...s,department:s.department||s.unit||"Unit",lastCheckin:s.lastCheckin||null,periodSummary:s.periodSummary||null}),h(!0)},[]),A=l.useCallback(()=>h(!1),[]);return t.length?e.jsxs(e.Fragment,{children:[e.jsxs(j,{className:"glass glass-card",children:[e.jsx(v,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-primary"}),"Team Members Overview"]})}),e.jsxs(y,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(p,{className:"w-3.5 h-3.5"})," Total Members"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:m.total})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(H,{className:"w-3.5 h-3.5"})," Active Today"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:m.activeToday})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx($,{className:"w-3.5 h-3.5"})," Recent Submissions"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:m.submissions})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(w,{className:"w-3.5 h-3.5 text-red-500"})," Needs Support"]}),e.jsx("p",{className:"text-2xl font-semibold text-red-500 mt-1",children:m.flagged})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(P,{value:o,onChange:s=>S(s.target.value),placeholder:"Search by name, department, or unit...",className:"pl-9 bg-card/60 border-border/60"}),e.jsx(R,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"})]})}),e.jsx("div",{className:"space-y-3 max-h-[28rem] overflow-auto pr-1",children:D.map(s=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3 p-3 border border-border/40 rounded-xl bg-card/30 hover:bg-card/60 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[s.role," • ",s.department||s.unit||"No unit"]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground mt-1",children:["Last check-in: ",Y(s.lastCheckin?.date)]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs(x,{variant:"outline",className:"bg-emerald-500/10 text-emerald-500 border-emerald-500/30",children:["Presence ",C(s.periodSummary?.avgPresence??s.overallAvgPresence)]}),e.jsxs(x,{variant:"outline",className:"bg-blue-500/10 text-blue-500 border-blue-500/30",children:["Capacity ",C(s.periodSummary?.avgCapacity??s.overallAvgCapacity)]}),s.lastCheckin?.needsSupport&&e.jsxs(x,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(w,{className:"w-3 h-3"})," Needs support"]}),s.periodSummary?.submissions>0&&e.jsxs(x,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(I,{className:"w-3 h-3"})," ",s.periodSummary.submissions," in period"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(N,{variant:"ghost",size:"sm",onClick:()=>U(s),className:"flex items-center gap-1",children:["Quick view ",e.jsx(L,{className:"w-3.5 h-3.5"})]}),e.jsx(N,{variant:"secondary",size:"sm",onClick:()=>d(`/emotional-wellness/${s.id}`),children:"Full report"})]})]},s.id))})]})]}),e.jsx(B,{user:k,isOpen:M,onClose:A})]}):e.jsxs(j,{className:"glass glass-card",children:[e.jsx(v,{children:e.jsxs(b,{className:"flex items-center gap-2",children:[e.jsx(p,{className:"w-5 h-5 text-primary"}),"Team Members Overview"]})}),e.jsx(y,{className:"text-center py-10 text-muted-foreground",children:e.jsx("p",{children:"No team members with check-in data yet."})})]})});z.displayName="HeadUnitStaffPanel";export{z as default};
