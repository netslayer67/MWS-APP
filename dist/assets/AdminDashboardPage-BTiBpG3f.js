const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AdminOverviewPanel-DshkJSA8.js","assets/index-DcybHeOi.js","assets/index-CJQ2ExeA.css","assets/AdminStudentsPanel-mivZdaRs.js","assets/StudentsTable-C1NjD7AP.js","assets/StatusPills-Dyx589k7.js","assets/teacherDashboardUtils-DMNGSgDv.js","assets/shield-check-K0Cq4BX6.js","assets/funnel-7EYNfR1c.js","assets/shuffle-CP7zj1Lu.js","assets/search-CybY9qxe.js","assets/users-_2hYyMjF.js","assets/AdminMentorsPanel-NrLDOxNw.js","assets/AdminAnalyticsPanel-XXXugYUM.js"])))=>i.map(i=>d[i]);
import{c as q,ac as Q,a4 as se,S as ae,x as oe,d as W,r as n,b as re,e as ne,j as l,m as ce,_ as F}from"./index-DcybHeOi.js";import{B as Y}from"./building-2-BvwNiPHn.js";import{U as K,C as ie}from"./users-round-CyjgFHlH.js";import{U as J}from"./user-check-CAj_q8i3.js";import{s as R}from"./socketService-B4WowktR.js";import{d as le,n as H,a as de,f as ue,e as me}from"./teacherDashboardUtils-DMNGSgDv.js";import{A as he}from"./arrow-up-right-C7M1S5uP.js";import{M as pe}from"./minus-Djia8y0S.js";import"./shield-check-K0Cq4BX6.js";/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fe=[["path",{d:"m7 7 10 10",key:"1fmybs"}],["path",{d:"M17 7v10H7",key:"6fjiku"}]],ge=q("arrow-down-right",fe);/**
 * @license lucide-react v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const be=[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]],ye=q("layout-dashboard",be),ve=[{key:"overview",label:"System Overview",icon:ye},{key:"students",label:"All Students",icon:K},{key:"mentors",label:"Manage Mentors",icon:J},{key:"analytics",label:"Analytics Lab",icon:ie}],V={badgeIcon:Y,badgeLabel:"Admin / Principal",badgeCaption:"",heading:"",subheading:""},xe={tier:oe,interventions:ae,activity:se,mentor:K,stats:Q},X=t=>{if(!t)return"-";try{return new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric"}).format(new Date(t))}catch{return"-"}},Se=[{key:"students",label:"Students in MTSS",caption:"Across all tiers",accent:"from-[#ff80b5] via-[#f472b6] to-[#c084fc]",icon:Y},{key:"mentors",label:"Active Mentors",caption:"Teachers & specialists",accent:"from-[#fcd34d] via-[#fb923c] to-[#f87171]",icon:J},{key:"success",label:"Success Rate",caption:"Meeting intervention goals",accent:"from-[#6ee7b7] via-[#34d399] to-[#10b981]",icon:Q}],we=(t=0,a=0,e=0)=>Se.map(o=>o.key==="students"?{...o,value:t}:o.key==="mentors"?{...o,value:a}:{...o,value:`${e}%`}),Me=(t,a=[])=>{const e=a.length;return{totalStudents:t?.total||e,tierBreakdown:t?.tierBreakdown?.length?t.tierBreakdown:[{label:"Tier 1",count:e,description:`${e} students`}],interventions:t?.interventions?.length?t.interventions.slice(0,5):[{label:"Universal Supports",count:e}]}},ke=(t=[])=>{const a={};t.forEach(o=>{const r=o.type||"Universal Supports",s=a[r]||{total:0,success:0};s.total+=1,["On Track","Completed"].includes(o.progress)&&(s.success+=1),a[r]=s});const e=["from-[#a78bfa] to-[#6366f1]","from-[#f472b6] to-[#fb7185]","from-[#34d399] to-[#10b981]","from-[#22d3ee] to-[#3b82f6]","from-[#fcd34d] to-[#f97316]"];return Object.entries(a).map(([o,r],s)=>({label:o,value:r.total?Math.round(r.success/r.total*100):0,gradient:e[s%e.length]})).sort((o,r)=>r.value-o.value)},Ae=t=>{const a=new Date(t),e=new Date(a.getFullYear(),0,1),o=Math.floor((a-e)/864e5),r=Math.ceil((o+e.getDay()+1)/7);return`${a.getFullYear()}-${r}`},Ce=(t=[])=>{if(!t.length)return{met:"",support:""};const a=600,e=200,o=Math.max(t.length-1,1),r=s=>t.map((p,h)=>{const b=h/o*a,x=e-(p[s]||0)/100*e;return`${h===0?"M":"L"}${b},${x}`}).join(" ");return{met:r("met"),support:r("support")}},_e=(t=[])=>{const a=new Map;t.forEach(r=>{const s=r.updatedAt||r.startDate||r.createdAt;if(!s)return;const p=new Date(s),h=Ae(p);a.has(h)||a.set(h,{total:0,success:0,date:p});const b=a.get(h);b.total+=1,["active","completed"].includes(r.status)&&(b.success+=1)});const o=Array.from(a.values()).sort((r,s)=>r.date-s.date).slice(-6).map(r=>{const s=r.total?Math.round(r.success/r.total*100):0;return{label:X(r.date),met:s,support:Math.max(0,100-s)}});return{trendData:o,trendPaths:Ce(o)}},je=(t=[])=>{const a=new Map;return t.forEach(e=>{const o=e.mentorId?.name||"Unassigned Mentor";a.has(o)||a.set(o,{name:o,focusAreas:new Set,caseload:0,success:0,total:0});const r=a.get(o);r.total+=1,r.caseload+=e.studentIds?.length||0,e.focusAreas?.length&&e.focusAreas.forEach(s=>r.focusAreas.add(s)),["completed","active"].includes(e.status)&&(r.success+=1)}),Array.from(a.values()).map(e=>({name:e.name,caseload:e.caseload,focus:e.focusAreas.size?Array.from(e.focusAreas).slice(0,2).join(", "):"Tiered Supports",trend:e.total?`${Math.round(e.success/e.total*100)}% success`:"New mentor"})).sort((e,o)=>o.caseload-e.caseload).slice(0,3)},Te=(t=[])=>{const a=new Map;return t.forEach(e=>{const o=e.mentorId?._id?.toString?.()||null,r=e.mentorId?.email||null,s=o||r||e.mentorId?.name||"unassigned";a.has(s)||a.set(s,{id:o,email:r,name:e.mentorId?.name||"Unassigned",role:e.mentorId?.jobPosition||e.mentorId?.role||"Mentor",students:0,total:0,completed:0});const p=a.get(s);p.students+=e.studentIds?.length||0,p.total+=1,e.status==="completed"&&(p.completed+=1)}),Array.from(a.values()).map(e=>({_id:e.id,email:e.email,name:e.name,role:e.role,activeStudents:e.students,successRate:e.total?`${Math.round(e.completed/e.total*100)}%`:"0%"})).sort((e,o)=>o.activeStudents-e.activeStudents)},Ne=(t=[])=>{const a={};return t.forEach(e=>{(e.focusAreas||[]).forEach(o=>{a[o]=(a[o]||0)+1})}),Object.entries(a).sort((e,o)=>o[1]-e[1]).slice(0,4).map(([e,o])=>({label:e,value:`${o} active`}))},Ie=(t=[])=>{const a=t.filter(r=>["On Track","Completed"].includes(r.progress)).length,e=t.filter(r=>r.progress==="Needs Attention").length,o=Math.max(0,t.length-a-e);return[{label:"Improved",detail:`${a} students`,accent:"text-emerald-500",icon:he},{label:"Needs Support",detail:`${e} students`,accent:"text-rose-500",icon:ge},{label:"Stable",detail:`${o} students`,accent:"text-sky-500",icon:pe}]},De=(t=[])=>{const a=[];return t.forEach(e=>{const o=e.studentIds?.[0]?.name||"Student group",r=e.mentorId?.name||"Mentor team",s=e.checkIns?.slice(-1)[0];s?a.push({date:s.date,student:o,mentor:r,activity:s.summary||"Progress update recorded"}):a.push({date:e.updatedAt||e.startDate||e.createdAt,student:o,mentor:r,activity:`Status updated to ${e.status}`})}),a.filter(e=>e.date).sort((e,o)=>new Date(o.date)-new Date(e.date)).slice(0,6).map(e=>({...e,date:X(e.date)}))},Re=(t=[])=>{if(!t.length)return 0;const a=t.filter(e=>e.status==="completed").length;return Math.round(a/t.length*100)},Ee=650,Le=()=>{const{user:t}=W(i=>i.auth),[a,e]=n.useState([]),[o,r]=n.useState(null),[s,p]=n.useState([]),[h,b]=n.useState([]),[x,A]=n.useState(!0),[E,N]=n.useState(null),S=n.useMemo(()=>le(t),[t]),M=n.useCallback((i={})=>{if(!S.allowedGrades.length)return!0;const m=H(i.grade||i.currentGrade||i.className||i.unit||i.classes?.[0]?.grade);return S.allowedGrades.includes(m)},[S]),C=n.useCallback((i={})=>{const m=H(i.grade||i.currentGrade||i.className||i.unit||i.classes?.[0]?.grade);return{...i,grade:m||i.grade,className:i.className||i.currentGrade||i.unit||i.classes?.[0]?.grade}},[]),_=n.useCallback((i=[])=>{i.length&&e(m=>{const g=new Map(m.map(d=>[d.id||d._id,d]));return i.forEach(d=>{if(!M(d))return;const y=d.id||d._id;if(!y)return;const w=g.get(y)||{};g.set(y,{...w,...C(d)})}),Array.from(g.values()).sort((d,y)=>d.name.localeCompare(y.name))})},[C,M]),I=n.useCallback((i,m)=>{m?._id&&p(g=>{const d=g.findIndex(w=>w._id===m._id);if(i==="deleted"){if(d===-1)return g;const w=[...g];return w.splice(d,1),w}if(d===-1)return[...g,m];const y=[...g];return y[d]=m,y})},[]),k=n.useCallback(async()=>{A(!0),N(null);try{const[i,m,g]=await Promise.all([de({limit:Ee}),ue(),me()]),d=i.students||[],y=S.allowedGrades.length?d.filter(M):d;e(y.map(C)),r(i.summary||null),p(m.assignments||[]),b(g.mentors||[])}catch(i){N(i?.response?.data?.message||i.message||"Failed to load MTSS dashboard data")}finally{A(!1)}},[S.allowedGrades.length,C,M]);n.useEffect(()=>{k()},[k]),n.useEffect(()=>{if(!t?.id&&!t?._id)return;R.connect(),R.joinMtssAdmin();const i=g=>{_(g?.students||[])},m=({action:g,assignment:d})=>{I(g||"updated",d)};return R.onMtssStudentsChanged(i),R.onMtssAssignment(m),()=>{R.offMtssStudentsChanged(i),R.offMtssAssignment(m),R.leaveMtssAdmin()}},[t,_,I]);const u=n.useMemo(()=>h?.length?h.length:new Set(s.map(m=>m.mentorId?._id||m.mentorId)).size,[h,s]),c=n.useMemo(()=>Re(s),[s]),f=n.useMemo(()=>we(a.length,u,c),[a.length,u,c]),v=n.useMemo(()=>Me(o,a),[o,a]),j=n.useMemo(()=>ke(a),[a]),{trendData:T,trendPaths:D}=n.useMemo(()=>_e(s),[s]),L=n.useMemo(()=>je(s),[s]),P=n.useMemo(()=>Te(s),[s]),$=n.useMemo(()=>Ne(s),[s]),O=n.useMemo(()=>Ie(a),[a]),U=n.useMemo(()=>De(s),[s]);return{students:a,assignments:s,mentors:h,statCards:f,systemSnapshot:v,successByType:j,trendData:T,trendPaths:D,mentorSpotlights:L,mentorRoster:P,strategyHighlights:$,tierMovement:O,recentActivity:U,loading:x,error:E,refresh:k}},z=(t=[],a)=>{const e=new Set;return t.forEach(o=>{const r=o[a];r&&e.add(r)}),["all",...Array.from(e)]},Pe=(t=[])=>{const a=re(),{toast:e}=ne(),[o,r]=n.useState("overview"),[s,p]=n.useState({grade:"all",tier:"all",type:"all",mentor:"all",query:""}),[h,b]=n.useState([]),x=n.useMemo(()=>{const u=s.query.trim().toLowerCase();return t.filter(c=>{const f=s.grade==="all"||c.grade===s.grade,v=s.tier==="all"||c.tier===s.tier,j=s.type==="all"||c.type===s.type,T=c.mentor||c.profile?.mentor,D=Array.isArray(c.teachers)&&c.teachers.length?c.teachers:Array.isArray(c.profile?.teacherRoster)&&c.profile.teacherRoster.length?c.profile.teacherRoster:T?[T]:[],L=s.mentor==="all"||D.includes(s.mentor),P=!u||c.name?.toLowerCase().includes(u)||c.type?.toLowerCase().includes(u)||T?.toLowerCase().includes(u)||D.some($=>$.toLowerCase().includes(u));return f&&v&&j&&L&&P})},[t,s]),A=n.useMemo(()=>z(t,"grade"),[t]),E=n.useMemo(()=>z(t,"tier"),[t]),N=n.useMemo(()=>z(t,"type"),[t]),S=n.useMemo(()=>{const u=new Set;return t.forEach(c=>{const f=Array.isArray(c.teachers)&&c.teachers.length?c.teachers:Array.isArray(c.profile?.teacherRoster)&&c.profile.teacherRoster.length?c.profile.teacherRoster:[];if(f.length){f.forEach(j=>u.add(j));return}const v=c.mentor||c.profile?.mentor;v&&u.add(v)}),["all",...Array.from(u)]},[t]),M=n.useCallback((u,c)=>{p(f=>({...f,[u]:c}))},[]),C=n.useCallback(u=>{const c=u.id||u._id;c&&b(f=>f.includes(c)?f.filter(v=>v!==c):[...f,c])},[]),_=n.useCallback(()=>b([]),[]);n.useEffect(()=>{b(u=>u.filter(c=>t.some(f=>(f.id||f._id)===c)))},[t]);const I=n.useCallback(u=>{a(`/mtss/student/${u.slug}`)},[a]),k=n.useCallback(u=>{e({title:"Mentor nudged",description:`Flagged ${u.name}'s plan for a system review.`})},[e]);return{activeTab:o,setActiveTab:r,filters:s,handleFilterChange:M,filteredStudents:x,gradeOptions:A,tierOptions:E,typeOptions:N,mentorOptions:S,selectedIds:h,toggleSelection:C,resetSelection:_,handleViewStudent:I,handleQuickUpdate:k}},Z=({heroCard:t,tabs:a,activeTab:e,onTabChange:o})=>{const r=t.badgeIcon;return l.jsxs("div",{className:"space-y-4","data-aos":"fade-up",children:[l.jsxs("div",{className:"inline-flex items-center gap-3 px-5 py-2 rounded-full bg-gradient-to-r from-white/90 via-white/70 to-white/50 dark:from-white/10 dark:via-white/5 dark:to-white/5 backdrop-blur-xl shadow-lg border border-white/60 dark:border-white/10",children:[l.jsx(r,{className:"w-5 h-5 text-rose-500"}),l.jsxs("div",{children:[l.jsx("p",{className:"text-[0.6rem] uppercase tracking-[0.5em] text-muted-foreground",children:t.badgeLabel}),l.jsx("p",{className:"text-sm font-semibold text-slate-700 dark:text-white",children:t.badgeCaption})]})]}),l.jsx("div",{"data-aos":"fade-up","data-aos-delay":"100",children:l.jsx("h1",{className:"text-4xl md:text-5xl font-black tracking-tight bg-gradient-to-r from-[#ef4444] via-[#f472b6] to-[#2563eb] dark:from-[#fbbf24] dark:via-[#22d3ee] dark:to-[#a78bfa] bg-clip-text text-transparent drop-shadow-[0_8px_20px_rgba(15,23,42,0.35)]",style:{WebkitTextStroke:"0.6px rgba(15,23,42,0.35)"},children:t.heading})}),l.jsx("div",{className:"flex flex-wrap gap-3 pt-2","data-aos":"zoom-in","data-aos-delay":"150",children:a.map(s=>{const p=s.icon,h=e===s.key;return l.jsxs("button",{onClick:()=>o(s.key),className:`px-5 py-3 rounded-full border backdrop-blur-xl font-semibold text-sm flex items-center gap-2 transition shadow-lg relative overflow-hidden group ${h?"bg-gradient-to-r from-[#ffe29f] via-[#ffa99f] to-[#ff719a] text-[#5b0f45] border-white/70 shadow-[0_10px_30px_rgba(255,113,154,0.35)]":"bg-gradient-to-r from-white/85 via-white/70 to-white/55 border-white/70 text-slate-600 dark:from-white/10 dark:via-white/5 dark:to-white/5 dark:text-white/80 hover:border-white/90"}`,children:[l.jsx("span",{"aria-hidden":"true",className:`absolute inset-0 rounded-full opacity-0 group-hover:opacity-100 transition pointer-events-none ${h?"bg-white/10":"bg-white/30 dark:bg-white/10"}`}),l.jsx(p,{className:"w-4 h-4"}),l.jsx("span",{className:"relative",children:s.label})]},s.key)})})]})};Z.displayName="AdminHeroSection";const $e=n.memo(Z),Oe=n.lazy(()=>F(()=>import("./AdminOverviewPanel-DshkJSA8.js"),__vite__mapDeps([0,1,2]))),Ue=n.lazy(()=>F(()=>import("./AdminStudentsPanel-mivZdaRs.js"),__vite__mapDeps([3,1,2,4,5,6,7,8,9,10,11]))),Fe=n.lazy(()=>F(()=>import("./AdminMentorsPanel-NrLDOxNw.js"),__vite__mapDeps([12,1,2]))),ze=n.lazy(()=>F(()=>import("./AdminAnalyticsPanel-XXXugYUM.js"),__vite__mapDeps([13,1,2]))),Be=()=>l.jsx("div",{className:"glass glass-card p-8 text-center text-muted-foreground animate-pulse",children:"Loading dashboard..."}),Ge=n.memo(()=>{const{user:t}=W(d=>d.auth),a={male:"Mr.",female:"Ms."},e=d=>a[d?.toLowerCase?.()]||"",{students:o,statCards:r,systemSnapshot:s,recentActivity:p,mentorSpotlights:h,mentorRoster:b,mentors:x,successByType:A,trendData:E,trendPaths:N,strategyHighlights:S,tierMovement:M,loading:C,error:_,refresh:I}=Le(),{activeTab:k,setActiveTab:u,filters:c,handleFilterChange:f,filteredStudents:v,gradeOptions:j,tierOptions:T,typeOptions:D,mentorOptions:L,handleViewStudent:P,handleQuickUpdate:$,selectedIds:O,toggleSelection:U,resetSelection:i}=Pe(o),m=n.useMemo(()=>{const d=t?.username||t?.name||"MTSS Admin",y=e(t?.gender),w=y?`${y} ${d}`:d,B=[`Cheers ${w}, let's guide today's MTSS glow.`,`${w}, keep the joyful momentum alive today.`,`${w}, another day to uplift every grade.`],G=new Date,ee=B[(G.getDate()+G.getMonth())%B.length],te=t?.jobPosition||t?.unit||V.badgeCaption||"Principal dashboard";return{...V,badgeCaption:te,heading:ee,subheading:"Oversee joyful MTSS momentum with live caseloads, mentors, and progress signals."}},[t]),g=n.useMemo(()=>{switch(k){case"overview":return l.jsx(Oe,{statCards:r,systemSnapshot:s,recentActivity:p,mentorSpotlights:h,icons:xe});case"students":return l.jsx(Ue,{filters:c,onFilterChange:f,gradeOptions:j,tierOptions:T,typeOptions:D,mentorOptions:L,filteredStudents:v,allStudents:o,onViewStudent:P,onUpdateStudent:$,selectedIds:O,onToggleSelect:U,onResetSelection:i,mentorDirectory:x,onRefresh:I});case"mentors":return l.jsx(Fe,{mentorRoster:b,mentorDirectory:x});case"analytics":return l.jsx(ze,{successByType:A,trendPaths:N,trendData:E,strategyHighlights:S,tierMovement:M});default:return null}},[k,c,j,T,D,L,v,f,P,$,O,U,i,b,x,r,s,p,h,A,E,N,S,M]);return l.jsxs("div",{className:"mtss-theme mtss-animated-bg min-h-screen relative overflow-hidden",children:[l.jsx("div",{className:"mtss-bg-overlay"}),l.jsxs("div",{className:"absolute inset-0 pointer-events-none",children:[l.jsx("div",{className:"absolute -top-20 left-0 w-96 h-96 bg-[#ff80b5]/30 blur-[180px]"}),l.jsx("div",{className:"absolute top-40 right-0 w-80 h-80 bg-[#60a5fa]/30 blur-[180px]"}),l.jsx("div",{className:"absolute bottom-0 left-1/3 w-96 h-96 bg-[#fcd34d]/20 blur-[180px]"})]}),l.jsxs("div",{className:"relative z-20 container-tight py-12 lg:py-16 text-foreground dark:text-white space-y-10",children:[l.jsx(ce.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},"data-aos":"fade-up",children:l.jsx($e,{heroCard:m,tabs:ve,activeTab:k,onTabChange:u})}),(C||_)&&l.jsxs("div",{className:"rounded-2xl border border-border/50 bg-white/70 dark:bg-white/10 px-4 py-3 flex items-center justify-between gap-4 text-sm text-muted-foreground",children:[l.jsx("span",{children:_||"Syncing MTSS data..."}),_&&l.jsx("button",{onClick:I,className:"text-primary font-semibold hover:underline",children:"Retry"})]}),l.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:l.jsx(n.Suspense,{fallback:l.jsx(Be,{}),children:g})})]})]})});Ge.displayName="AdminDashboardPage";export{Ge as default};
