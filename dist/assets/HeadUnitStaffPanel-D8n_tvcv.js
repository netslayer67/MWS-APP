import{r as l,b as P,j as e,T as B,a0 as H,B as v}from"./index-D_E2vwAx.js";import{C as y,b,c as w,a as C}from"./card-_pPj3ZL_.js";import{B as p}from"./badge-DAdsJ7QP.js";import{I as R}from"./input-9_LRA2hK.js";import{U as _}from"./UserDetailModal-BfeGcaiR.js";import{U as u}from"./users-DmkyOMF8.js";import{C as z}from"./clock-Du653Vj-.js";import{T as S}from"./EmotionalCheckinDashboard-PCcjj1yq.js";import{S as E}from"./search-oVlao2ZN.js";import{A as L}from"./arrow-up-right-DnOrDqxm.js";import"./CategoricalChart-DvBpKlV4.js";import"./CartesianChart-Dram2fxr.js";import"./ActivePoints-DAK62Kra.js";import"./ErrorBarContext-DFHBb1NA.js";import"./socketService-DK54WtJ1.js";import"./funnel-DB0BkbIy.js";import"./building-CdKqS5MF.js";const h=1440*60*1e3,F=t=>{if(!t)return"No activity yet";const r=new Date(t),o=Date.now()-r.getTime();if(o<h)return"Today";if(o<h*2)return"Yesterday";const c=Math.floor(o/h);return`${c} day${c!==1?"s":""} ago`},k=t=>typeof t!="number"||Number.isNaN(t)?"–":`${Math.round(t*10)/10}/10`,Y=l.memo(({staff:t=[],summary:r,isDirectorate:o=!1})=>{const c=P(),[m,T]=l.useState(""),[M,D]=l.useState(null),[U,g]=l.useState(!1),x=l.useMemo(()=>{if(r)return{total:r.totalMembers??t.length,activeToday:r.activeToday??0,flagged:r.flaggedMembers??0,submissions:r.submittedInPeriod??0};const s=new Date().toISOString().split("T")[0],a=t.filter(i=>{const N=i.lastCheckin?.date;if(!N)return!1;const j=new Date(N);return j.setHours(0,0,0,0),j.toISOString().split("T")[0]===s}).length,n=t.filter(i=>i.lastCheckin?.needsSupport||(i.periodSummary?.needsSupportDays||0)>0).length,d=t.filter(i=>(i.periodSummary?.submissions||0)>0).length;return{total:t.length,activeToday:a,flagged:n,submissions:d}},[t,r]),A=l.useMemo(()=>{if(!m.trim())return[...t].sort((a,n)=>{const d=a.lastCheckin?.date?new Date(a.lastCheckin.date).getTime():0;return(n.lastCheckin?.date?new Date(n.lastCheckin.date).getTime():0)-d});const s=m.trim().toLowerCase();return t.filter(a=>`${a.name} ${a.email||""} ${a.department||""} ${a.unit||""}`.toLowerCase().includes(s)).sort((a,n)=>{const d=a.lastCheckin?.date?new Date(a.lastCheckin.date).getTime():0;return(n.lastCheckin?.date?new Date(n.lastCheckin.date).getTime():0)-d})},[t,m]),O=l.useCallback(s=>{D({...s,department:s.department||s.unit||"Unit",lastCheckin:s.lastCheckin||null,periodSummary:s.periodSummary||null}),g(!0)},[]),$=l.useCallback(()=>g(!1),[]),f=o?"Organization Wellness Explorer":"Team Members Overview",I=o?"View any staff member’s emotional check-ins and insights.":"Monitor your unit members with real-time insights.";return t.length?e.jsxs(e.Fragment,{children:[e.jsxs(y,{className:"glass glass-card",children:[e.jsxs(b,{children:[e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-primary"}),f]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:I})]}),e.jsxs(C,{children:[e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3 mb-4",children:[e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(u,{className:"w-3.5 h-3.5"})," Total Members"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:x.total})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(z,{className:"w-3.5 h-3.5"})," Active Today"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:x.activeToday})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(B,{className:"w-3.5 h-3.5"})," Recent Submissions"]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground mt-1",children:x.submissions})]}),e.jsxs("div",{className:"p-4 bg-card/40 border border-border/40 rounded-xl",children:[e.jsxs("p",{className:"text-xs uppercase tracking-wide text-muted-foreground flex items-center gap-1",children:[e.jsx(S,{className:"w-3.5 h-3.5 text-red-500"})," Needs Support"]}),e.jsx("p",{className:"text-2xl font-semibold text-red-500 mt-1",children:x.flagged})]})]}),e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(R,{value:m,onChange:s=>T(s.target.value),placeholder:o?"Search staff by name, role, unit, or department...":"Search by name, department, or unit...",className:"pl-9 bg-card/60 border-border/60"}),e.jsx(E,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"})]})}),e.jsx("div",{className:"space-y-3 max-h-[28rem] overflow-auto pr-1",children:A.map(s=>e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center gap-3 p-3 border border-border/40 rounded-xl bg-card/30 hover:bg-card/60 transition-colors",children:[e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("p",{className:"text-sm font-semibold text-foreground truncate",children:s.name}),e.jsxs("p",{className:"text-xs text-muted-foreground truncate",children:[s.role," - ",s.department||s.unit||"No unit"]}),e.jsxs("p",{className:"text-[11px] text-muted-foreground mt-1",children:["Last check-in: ",F(s.lastCheckin?.date)]})]}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 text-xs",children:[e.jsxs(p,{variant:"outline",className:"bg-emerald-500/10 text-emerald-500 border-emerald-500/30",children:["Presence ",k(s.periodSummary?.avgPresence??s.overallAvgPresence)]}),e.jsxs(p,{variant:"outline",className:"bg-blue-500/10 text-blue-500 border-blue-500/30",children:["Capacity ",k(s.periodSummary?.avgCapacity??s.overallAvgCapacity)]}),s.lastCheckin?.needsSupport&&e.jsxs(p,{variant:"destructive",className:"flex items-center gap-1",children:[e.jsx(S,{className:"w-3 h-3"})," Needs support"]}),s.periodSummary?.submissions>0&&e.jsxs(p,{variant:"secondary",className:"flex items-center gap-1",children:[e.jsx(H,{className:"w-3 h-3"})," ",s.periodSummary.submissions," in period"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(v,{variant:"ghost",size:"sm",onClick:()=>O(s),className:"flex items-center gap-1",children:["Quick view ",e.jsx(L,{className:"w-3.5 h-3.5"})]}),e.jsx(v,{variant:"secondary",size:"sm",onClick:()=>c(`/emotional-wellness/${s.id||s._id}`,{state:{user:s}}),children:"Full report"})]})]},s.id||s._id||s.email))})]})]}),e.jsx(_,{user:M,isOpen:U,onClose:$})]}):e.jsxs(y,{className:"glass glass-card",children:[e.jsx(b,{children:e.jsxs(w,{className:"flex items-center gap-2",children:[e.jsx(u,{className:"w-5 h-5 text-primary"}),f]})}),e.jsx(C,{className:"text-center py-10 text-muted-foreground",children:e.jsx("p",{children:"No staff with check-in data yet."})})]})});Y.displayName="HeadUnitStaffPanel";export{Y as default};
