import{e as F,r as o,j as e,a_ as O,a$ as I,b0 as R,b1 as $,b7 as B,b8 as L,ac as U,w as q}from"./index-B1rSvVjj.js";import{F as H}from"./funnel-BBwpUQlz.js";import{S as z}from"./shuffle-DdIVAaq3.js";import{S as V}from"./search-xoxB2D8c.js";import{S as G}from"./StudentsTable-Dhb8vXgm.js";import{P as K,T as W}from"./StatusPills-itge4cy0.js";import{U as Y}from"./users-CGzGoKTC.js";import"./interventionSelection-Vcld4Os_.js";import"./eye-vvhvhBva.js";const Z=["teacher","homeroom","subject","special"],J=[{label:"Tier 2 - Targeted",value:"tier2"},{label:"Tier 3 - Intensive",value:"tier3"}],_=({open:n,onClose:m,students:d=[],mentors:x=[],onAssigned:b})=>{const{toast:p}=F(),a=o.useMemo(()=>{const t=l=>{const A=(l?.jobPosition||"").toLowerCase(),k=(l?.role||"").toLowerCase(),M=Array.isArray(l?.classes)?l.classes.some(C=>(C.role||"").toLowerCase().includes("teacher")):!1;return Z.some(C=>A.includes(C))||M||k.includes("teacher")};return x.filter(t)},[x]),r=a.length>0?a:x,[u,i]=o.useState("tier2"),[s,g]=o.useState(()=>r?.[0]?._id||""),[c,f]=o.useState(""),[w,h]=o.useState(""),[y,v]=o.useState(!1),N=o.useMemo(()=>d.map(t=>t.id||t._id),[d]),j=N.length<2||!s||y;o.useEffect(()=>{if(!r?.length){g("");return}r.some(l=>l._id===s)||g(r[0]._id)},[r,s]);const S=async t=>{if(t.preventDefault(),!j){v(!0);try{const l=c?c.split(",").map(A=>A.trim()).filter(Boolean):["Targeted Support"];await U({mentorId:s,studentIds:N,tier:u,focusAreas:l,notes:w}),p({title:"Assignment created",description:"Selected students were assigned to the mentor."}),b?.()}catch(l){p({title:"Failed to assign",description:l?.response?.data?.message||l.message||"Unable to create mentor assignment",variant:"destructive"})}finally{v(!1)}}};return e.jsx(O,{open:n,onOpenChange:t=>!t&&m?.(),children:e.jsxs(I,{className:"max-w-2xl",children:[e.jsxs(R,{children:[e.jsx($,{children:"Assign selected students"}),e.jsxs(B,{children:["Create a new MTSS assignment for ",e.jsx("strong",{children:d.length})," students. Select a tier and mentor to continue."]})]}),e.jsxs("form",{className:"space-y-4",onSubmit:S,children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-xs uppercase tracking-[0.4em] text-muted-foreground",children:"Students"}),e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:d.map(t=>e.jsx("span",{className:"px-3 py-1 rounded-full bg-primary/10 text-sm font-semibold text-primary",children:t.name},t.id))})]}),e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Tier"}),e.jsx("select",{value:u,onChange:t=>i(t.target.value),className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3",children:J.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Mentor"}),e.jsx("select",{value:s,onChange:t=>g(t.target.value),className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3",disabled:!r.length,children:r.length===0?e.jsx("option",{value:"",children:"No teaching mentors available"}):r.map(t=>e.jsxs("option",{value:t._id,children:[t.name," · ",t.jobPosition||t.role||"Teacher"]},t._id))})]})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Focus areas (comma separated)"}),e.jsx("input",{value:c,onChange:t=>f(t.target.value),placeholder:"Fluency boost, SEL routines",className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3"})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Notes"}),e.jsx("textarea",{value:w,onChange:t=>h(t.target.value),placeholder:"Add optional context for the mentor…",className:"w-full h-24 rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3 resize-none"})]}),e.jsxs(L,{className:"pt-4",children:[e.jsx("button",{type:"button",onClick:m,className:"px-4 py-2 rounded-full border border-border/60 text-sm font-semibold text-foreground dark:text-white",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:j,className:`px-5 py-2.5 rounded-full text-sm font-semibold text-white ${j?"bg-muted cursor-not-allowed opacity-60":"bg-gradient-to-r from-[#22d3ee] to-[#3b82f6] shadow hover:-translate-y-0.5 transition"}`,children:y?"Assigning…":"Create assignment"})]})]})]})})};_.displayName="AdminAssignmentModal";const Q=({filters:n,onFilterChange:m,gradeOptions:d,tierOptions:x,typeOptions:b,mentorOptions:p,filteredCount:a,totalCount:r})=>{const u="w-full px-4 py-3 rounded-2xl bg-white/80 dark:bg-white/10 border border-white/60 dark:border-white/10 text-sm text-foreground dark:text-white focus:outline-none focus:ring-2 focus:ring-primary/50 shadow-inner shadow-white/40 dark:shadow-none",i=(s,g,c,f,w)=>e.jsx("div",{"data-aos":w?.variant||"fade-up","data-aos-delay":w?.delay||0,"data-aos-duration":"650","data-aos-easing":"ease-out-cubic",children:e.jsx("select",{className:u,value:s,onChange:h=>m(c,h.target.value),children:g.map(h=>e.jsx("option",{value:h,children:f(h)},h))})});return e.jsxs("div",{className:"glass glass-card mtss-card-surface p-6 rounded-[36px] border border-white/20 bg-gradient-to-br from-[#ecfeff]/90 via-[#fef9c3]/80 to-[#fce7f3]/85 dark:from-white/5 dark:via-white/10 dark:to-white/5 backdrop-blur-2xl","data-aos":"fade-up",children:[e.jsxs("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between mb-4",children:[e.jsxs("div",{className:"space-y-1","data-aos":"fade-right","data-aos-duration":"700",children:[e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-white/70 dark:bg-white/10 border border-white/60 dark:border-white/10 text-xs font-semibold text-slate-600 dark:text-white",children:[e.jsx(H,{className:"w-3.5 h-3.5"}),"Smart filters"]}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-white/60",children:"Blend grade, tier, and mentor filters to spot caseload gaps instantly."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2 text-xs font-semibold text-slate-600 dark:text-white/70","data-aos":"fade-left",children:[e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/80 dark:bg-white/5 border border-white/60 dark:border-white/20 backdrop-blur",children:[a," matches"]}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/80 dark:bg-white/5 border border-white/60 dark:border-white/20 backdrop-blur",children:[r," total roster"]}),e.jsxs("span",{className:"px-3 py-1 rounded-full bg-white/80 dark:bg-white/5 border border-white/60 dark:border-white/20 backdrop-blur flex items-center gap-1",children:[e.jsx(z,{className:"w-4 h-4"}),"auto-sort ready"]})]})]}),e.jsxs("div",{className:"grid gap-4 lg:grid-cols-5",children:[i(n.grade,d,"grade",s=>s==="all"?"All Grades":s,{variant:"fade-up-right",delay:80}),i(n.tier,x,"tier",s=>s==="all"?"All Tiers":s,{variant:"fade-up",delay:120}),i(n.type,b,"type",s=>s==="all"?"All Types":s,{variant:"fade-up-left",delay:160}),i(n.mentor,p,"mentor",s=>s==="all"?"All Mentors":s,{variant:"zoom-in-up",delay:200}),e.jsxs("div",{className:"relative","data-aos":"fade-down","data-aos-delay":"220","data-aos-duration":"650","data-aos-easing":"ease-out-quart",children:[e.jsx(V,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-primary/60"}),e.jsx("input",{type:"text",className:`${u} pl-10`,placeholder:"Search students",value:n.query,onChange:s=>m("query",s.target.value)})]})]})]})},X=({visibleStudents:n,filteredCount:m,selectedCount:d,mentorCount:x,onResetSelection:b,onOpenAssign:p,disableAssignment:a,selectedIds:r,onToggleSelect:u,onViewStudent:i,onUpdateStudent:s,loadMoreRef:g,hasMoreStudents:c})=>e.jsxs("div",{className:"glass glass-card mtss-card-surface p-6 rounded-[36px] border border-white/20 bg-gradient-to-br from-white/90 via-white/70 to-white/60 dark:from-white/10 dark:via-white/5 dark:to-white/5 backdrop-blur-2xl","data-aos":"fade-up","data-aos-delay":"120",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-4",children:[e.jsxs("div",{className:"space-y-1","data-aos":"fade-right","data-aos-delay":"150",children:[e.jsx("p",{className:"text-xs uppercase tracking-[0.4em] text-muted-foreground",children:"Roster"}),e.jsx("h3",{className:"text-2xl font-black text-foreground dark:text-white bg-gradient-to-r from-[#0ea5e9] via-[#8b5cf6] to-[#ec4899] bg-clip-text text-transparent",children:"All students in MTSS"}),e.jsx("p",{className:"text-sm text-muted-foreground max-w-xl",children:"Highlight tiers, next updates, and progress streaks so principals can triage faster."})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row sm:items-center sm:justify-end","data-aos":"fade-left","data-aos-delay":"180",children:[e.jsxs("div",{className:"flex items-center gap-3 w-full sm:w-auto px-4 py-2 rounded-2xl bg-gradient-to-r from-white/90 via-white/70 to-white/50 dark:from-white/10 dark:via-white/5 dark:to-white/0 border border-white/60 dark:border-white/10 shadow-inner shadow-white/40 dark:shadow-none",children:[e.jsx("div",{className:"w-8 h-8 rounded-xl bg-gradient-to-br from-[#f472b6] to-[#facc15] dark:from-[#1d4ed8] dark:to-[#a855f7] text-white flex items-center justify-center shadow-lg shadow-rose-200/60 dark:shadow-none",children:e.jsx(Y,{className:"w-4 h-4"})}),e.jsxs("div",{className:"text-sm font-semibold leading-tight text-slate-700 dark:text-white",children:[e.jsxs("span",{className:"block",children:[d," selected"]}),e.jsxs("span",{className:"text-xs font-normal text-slate-500 dark:text-white/60",children:[x," mentors available"]})]})]}),e.jsxs("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:[e.jsx("button",{onClick:b,disabled:d===0,className:`flex-1 sm:flex-none px-4 py-2 rounded-full border text-sm font-semibold transition ${d===0?"border-white/40 dark:border-white/10 text-slate-400 dark:text-white/30 cursor-not-allowed":"border-white/70 dark:border-white/30 text-foreground dark:text-white bg-white/80 dark:bg-white/5 shadow-inner hover:-translate-y-0.5"}`,children:"Clear selection"}),e.jsxs("button",{disabled:a,onClick:p,className:`flex-1 sm:flex-none px-4 py-2 rounded-full text-sm font-semibold text-white flex items-center justify-center gap-2 transition ${a?"bg-gradient-to-r from-slate-200 to-slate-100 dark:from-white/10 dark:to-white/5 text-slate-400 dark:text-white/40 cursor-not-allowed":"bg-gradient-to-r from-[#34d399] via-[#3b82f6] to-[#a855f7] shadow-lg shadow-primary/30 hover:-translate-y-0.5"}`,children:[e.jsx(q,{className:"w-4 h-4"}),"Assign Selected"]})]})]})]}),e.jsx(G,{students:n,TierPill:W,ProgressBadge:K,showActions:!0,onView:i,onUpdate:s,selectable:!0,selectedIds:r,onSelect:u}),e.jsxs("div",{ref:g,className:"mt-6 flex flex-col items-center gap-2 text-xs font-semibold text-muted-foreground","data-aos":"fade-up","data-aos-delay":"200",children:[e.jsxs("span",{children:["Showing ",n.length," of ",m," students"]}),c?e.jsx("span",{className:"px-3 py-1 rounded-full border border-white/50 dark:border-white/20 bg-white/70 dark:bg-white/5 text-[0.7rem] uppercase tracking-[0.3em]",children:"Scroll to load more"}):e.jsx("span",{className:"px-3 py-1 rounded-full border border-emerald-200/50 bg-emerald-50 text-emerald-500 text-[0.7rem] uppercase tracking-[0.3em]",children:"All caught up"})]})]}),P=10,E=({filters:n,onFilterChange:m,gradeOptions:d,tierOptions:x,typeOptions:b,mentorOptions:p,filteredStudents:a,allStudents:r,onViewStudent:u,onUpdateStudent:i,selectedIds:s,onToggleSelect:g,onResetSelection:c,mentorDirectory:f,onRefresh:w})=>{const[h,y]=o.useState(!1),[v,N]=o.useState(P),j=o.useRef(null),S=o.useMemo(()=>s?.length?r.filter(k=>s.includes(k.id||k._id)):[],[s,r]);o.useEffect(()=>{N(P)},[a]),o.useEffect(()=>{if(!j.current)return;const k=j.current,M=new IntersectionObserver(C=>{const[D]=C;D.isIntersecting&&N(T=>T>=a.length?T:Math.min(a.length,T+P))},{threshold:.4});return M.observe(k),()=>M.disconnect()},[a.length]);const t=o.useMemo(()=>a.slice(0,Math.min(v,a.length)),[a,v]),l=t.length<a.length,A=S.length<2||f.length===0;return e.jsxs("div",{className:"space-y-6",children:[e.jsx(Q,{filters:n,onFilterChange:m,gradeOptions:d,tierOptions:x,typeOptions:b,mentorOptions:p,filteredCount:a.length,totalCount:r.length}),e.jsx(X,{visibleStudents:t,filteredCount:a.length,selectedCount:S.length,mentorCount:f.length,onResetSelection:c,onOpenAssign:()=>y(!0),disableAssignment:A,selectedIds:s,onToggleSelect:g,onViewStudent:u,onUpdateStudent:i,loadMoreRef:j,hasMoreStudents:l}),h&&e.jsx(_,{open:h,onClose:()=>y(!1),students:S,mentors:f,onAssigned:()=>{c(),y(!1),w?.()}})]})};E.displayName="AdminStudentsPanel";const ie=o.memo(E);export{ie as default};
