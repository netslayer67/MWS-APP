import{j as e,r as a,b as Q,e as V,ad as I}from"./index-D2rZlo4J.js";import{S as P}from"./StudentsTable-DiXVOlmk.js";import{Q as U}from"./TeacherDashboardPage-ClAcE0KD.js";import{e as E,g as D}from"./interventionSelection-Vcld4Os_.js";import{F as B}from"./funnel-D662ROXN.js";import{S as H}from"./search-Djs8Wm4d.js";import"./users-round-BG7_TFG6.js";import"./teacherGradeUtils-COfj_G-K.js";import"./teacherSegmentUtils-BaJgF7HQ.js";import"./teacherMappingUtils-C7N1X8nf.js";import"./shield-check-DZFn7leu.js";import"./arrow-right-CkU_4ilH.js";import"./StatusPills-DlW3t5hA.js";const R=["All","Tier 1","Tier 2","Tier 3"],f=10,q=({activeTier:r,setActiveTier:i,query:n,setQuery:p})=>e.jsxs("div",{className:"rounded-[28px] border border-white/40 bg-white/90 dark:bg-white/5 p-5 flex flex-col gap-4 shadow-[0_10px_32px_rgba(15,23,42,0.12)]","data-aos":"fade-up","data-aos-delay":"40",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-semibold text-muted-foreground",children:[e.jsx(B,{className:"w-4 h-4"}),"Quick filters"]}),e.jsx("div",{className:"flex flex-wrap gap-2",children:R.map(o=>e.jsx("button",{onClick:()=>i(o),className:`mtss-filter-chip ${r===o?"mtss-filter-chip--active":""}`,"data-aos":"zoom-in","data-aos-delay":"80",children:o},o))}),e.jsxs("div",{className:"relative","data-aos":"fade-up","data-aos-delay":"100",children:[e.jsx(H,{className:"w-4 h-4 absolute left-4 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search kids or boost type...",value:n,onChange:o=>p(o.target.value),className:"w-full pl-11 pr-4 py-2.5 rounded-full bg-white/70 dark:bg-white/10 border border-primary/20 focus:ring-2 focus:ring-primary/40 focus:outline-none placeholder:text-muted-foreground/70 dark:placeholder:text-white/40"})]})]}),z=({visible:r,total:i})=>e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-3","data-aos":"fade-up","data-aos-delay":"60",children:[e.jsxs("div",{children:[e.jsx("p",{className:"uppercase text-xs text-muted-foreground tracking-[0.4em]",children:"Crew Roster"}),e.jsx("h2",{className:"text-2xl font-bold text-slate-900 dark:text-white",children:"Kids on your radar today"})]}),e.jsxs("div",{className:"text-sm text-muted-foreground",children:["Showing ",e.jsx("strong",{children:r})," of ",i," filtered students"]})]}),K=({visible:r,total:i,onLoadMore:n})=>e.jsx("div",{className:"flex flex-col items-center gap-2 text-xs text-muted-foreground py-3","data-aos":"fade-up","data-aos-delay":"160",children:r<i?e.jsxs("button",{type:"button",onClick:n,className:"px-4 py-2 rounded-full bg-white/80 dark:bg-white/10 border border-primary/30 text-sm font-semibold text-primary shadow-sm hover:-translate-y-0.5 transition",children:["Load 10 more kids (",r,"/",i,")"]}):e.jsx("span",{className:"px-3 py-1 rounded-full bg-emerald-50 dark:bg-emerald-500/10 text-emerald-600 dark:text-emerald-200 border border-emerald-200/70 dark:border-emerald-500/30",children:"All kids loaded"})}),O=a.memo(({students:r,TierPill:i,ProgressBadge:n,onRefresh:p})=>{const o=Q(),{toast:x}=V(),[c,S]=a.useState("All"),[v,C]=a.useState(""),[y,j]=a.useState({type:null,student:null}),[T,w]=a.useState(!1),[N,k]=a.useState(f),h=a.useDeferredValue(v.trim().toLowerCase()),d=a.useMemo(()=>r.filter(t=>{const s=E(t.interventions),u=D(s,t.profile,t),l=u?.tier||t.tier,m=c==="All"||l===c;if(!h)return m;const L=s.map(F=>F.label).join(" "),_=`${t.name} ${t.type||""} ${t.grade||""} ${t.className||""} ${u?.label||""} ${L}`.toLowerCase();return m&&_.includes(h)}),[r,c,h]),g=a.useMemo(()=>d.slice(0,Math.min(N,d.length)),[d,N]);a.useEffect(()=>{k(f)},[c,h,r.length]);const M=a.useCallback(t=>{o(`/mtss/student/${t.slug}`)},[o]),$=a.useCallback((t,s)=>j({type:t,student:s}),[]),b=a.useCallback(()=>j({type:null,student:null}),[]),A=a.useCallback(async(t,s)=>{const u=s?.assignmentId||t?.assignmentId;if(!u){x({title:"No active intervention",description:`${t?.name||"Student"} isn't linked to an active intervention yet.`,variant:"destructive"});return}w(!0);try{const l=s.notes?.trim()||"",m=s.scoreValue!==""?Number(s.scoreValue):void 0;await I(u,{checkIns:[{date:s.date,summary:l||"Quick update",nextSteps:l||void 0,value:Number.isFinite(m)?m:void 0,unit:s.scoreUnit,performed:s.performed==="yes",celebration:s.badge}]}),x({title:"Progress update saved",description:`${t.name}'s update was recorded!`}),b(),p?.()}catch(l){x({title:"Failed to save update",description:l?.response?.data?.message||l.message||"Please try again in a moment.",variant:"destructive"})}finally{w(!1)}},[x,b,p]);return e.jsxs("div",{className:"space-y-6 mtss-theme",children:[e.jsx(q,{activeTier:c,setActiveTier:S,query:v,setQuery:C}),e.jsxs("section",{className:"rounded-[32px] border border-white/40 bg-white/95 dark:bg-slate-900/40 p-6 space-y-4 shadow-[0_14px_48px_rgba(15,23,42,0.14)]","data-aos":"fade-up","data-aos-delay":"80",children:[e.jsx(z,{visible:g.length,total:d.length}),e.jsx("div",{"data-aos":"fade-up","data-aos-delay":"120",children:e.jsx(P,{students:g,TierPill:i,ProgressBadge:n,showActions:!0,onView:M,onUpdate:t=>$("update",t)})}),e.jsx(K,{visible:g.length,total:d.length,onLoadMore:()=>k(t=>Math.min(d.length,t+f))})]}),y.type==="update"&&e.jsx(U,{student:y.student,onClose:b,onSubmit:A,submitting:T})]})});O.displayName="StudentsPanel";export{O as default};
