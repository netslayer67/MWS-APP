import{a as P,b as E,I as T,d as $,r as l,Z as b,j as e,B as A}from"./index-BN59IPuR.js";import{b as D,f as c}from"./analyticsHelpers-CSR5MBQA.js";import{T as M}from"./target-BKXpjjKz.js";import{C as B}from"./clock-DhNh1aMV.js";import{C as j}from"./circle-alert-D9jL_IN1.js";import{U as W}from"./users-DfBEJjiL.js";import{S as z}from"./search-57XYSJ22.js";const F={today:"Today",week:"This Week",month:"This Month",semester:"This Semester",all:"Across All Time"},G=()=>{const p=P(),y=E(),N=T(),{stats:m,loading:v,selectedPeriod:n}=$(t=>t.dashboard),[u,w]=l.useState(""),[x,k]=l.useState("all"),o=N.state?.snapshot;l.useEffect(()=>{!m&&!o&&p(b({period:n||"today"}))},[p,m,o,n]);const a=l.useMemo(()=>o?{...o,period:o.period||n||"today",notSubmittedUsers:o.notSubmittedUsers||[]}:D(m,n),[o,m,n]),i=a?.notSubmittedUsers||[],g=l.useMemo(()=>{const t=new Set;return i.forEach(s=>{const r=s.unit||s.department;r&&t.add(String(r))}),Array.from(t).sort((s,r)=>s.localeCompare(r))},[i]),h=l.useMemo(()=>{if(!i.length)return[];const t=u.trim().toLowerCase();return i.filter(s=>x!=="all"&&(s.unit||s.department||"").toLowerCase()!==x.toLowerCase()?!1:t?[s.name,s.email,s.role,s.jobPosition,s.department,s.unit,s.grade,s.username].some(r=>typeof r=="string"&&r.toLowerCase().includes(t)):!0)},[i,u,x]),S=F[a?.period]||"Selected Period",f=a?.notSubmittedCount||i.length,C=()=>{y("/emotional-checkin/dashboard")};return!a&&v?e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"glass glass-card p-6 text-center space-y-2",children:[e.jsx("p",{className:"text-sm font-semibold text-muted-foreground",children:"Loading participation insights…"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"We’re preparing the latest dashboard data."})]})}):a?e.jsx("div",{className:"min-h-screen text-foreground relative overflow-hidden",children:e.jsxs("div",{className:"relative z-10 container-tight py-6",children:[e.jsxs("div",{className:"flex flex-col gap-4","data-aos":"fade-up",children:[e.jsxs("button",{type:"button",onClick:C,className:"inline-flex items-center gap-2 text-sm font-medium text-primary hover:text-primary/80 transition-colors w-fit",children:[e.jsx(A,{className:"w-4 h-4"}),"Back to dashboard"]}),e.jsx("div",{className:"glass glass-card p-5 space-y-3",children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-2",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs uppercase tracking-wide text-muted-foreground",children:S}),e.jsx("h1",{className:"text-2xl md:text-3xl font-semibold",children:"Participation follow-up"}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:f>0?`${f} people still need an emotional check-in.`:"Everyone has submitted their check-in for this period."})]}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:["Normalized across ",a.workdayCount===1?"today":`${a.workdayCount} workdays`]})]})})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-4 gap-4 mt-6",children:[{label:"Participation rate",value:`${a.participationRate??0}%`,description:`${c(a.totalCheckins)} submissions so far`,icon:M},{label:"Expected submissions",value:c(a.expectedSubmissions||0),description:`${c(a.totalUsers||0)} people × ${a.workdayCount} workdays`,icon:B},{label:"Missing submissions",value:c(f||0),description:"People to follow up with",icon:j},{label:"Team in scope",value:c(a.totalUsers||0),description:"Employees in this dashboard view",icon:W}].map((t,s)=>e.jsxs("div",{className:"glass glass-card p-4 border border-border/60 flex flex-col gap-2","data-aos":"fade-up","data-aos-delay":100+s*60,children:[e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground text-xs uppercase tracking-wide",children:[e.jsx(t.icon,{className:"w-4 h-4 text-primary"}),t.label]}),e.jsx("p",{className:"text-2xl font-semibold text-foreground",children:t.value}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.description})]},t.label))}),e.jsxs("div",{className:"glass glass-card mt-6 p-5","data-aos":"fade-up","data-aos-delay":"150",children:[e.jsxs("div",{className:"flex flex-col lg:flex-row lg:items-center lg:justify-between gap-4 mb-4",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-lg font-semibold",children:"Who still needs to submit?"}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Showing ",h.length," of ",i.length," people without a check-in."]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 w-full lg:w-auto",children:[e.jsxs("div",{className:"relative flex-1 min-w-[220px]",children:[e.jsx(z,{className:"w-4 h-4 absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground"}),e.jsx("input",{type:"text",placeholder:"Search by name, role, or unit",value:u,onChange:t=>w(t.target.value),className:"w-full pl-9 pr-3 py-2 rounded-lg border border-border bg-background/80 text-sm focus:outline-none focus:ring-2 focus:ring-primary/40"})]}),g.length>0&&e.jsxs("select",{value:x,onChange:t=>k(t.target.value),className:"w-full sm:w-56 rounded-lg border border-border bg-background/80 text-sm py-2 px-3 focus:outline-none focus:ring-2 focus:ring-primary/40",children:[e.jsx("option",{value:"all",children:"All units & departments"}),g.map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),h.length===0?e.jsxs("div",{className:"p-6 rounded-lg border border-dashed border-muted flex flex-col items-center text-center gap-2","data-aos":"fade-up",children:[e.jsx(j,{className:"w-8 h-8 text-amber-500"}),e.jsx("p",{className:"text-sm font-medium text-foreground",children:"No outstanding submissions"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Everyone has submitted their emotional check-in for this filter set."})]}):e.jsx("div",{className:"space-y-3",children:h.map((t,s)=>{const r=[t.jobPosition,t.role,t.unit,t.department,t.grade,t.classes?.[0]].filter((d,U,L)=>!!d&&L.indexOf(d)===U);return e.jsx("div",{className:"p-4 rounded-xl border border-border/70 bg-card/40 backdrop-blur-sm","data-aos":"fade-up","data-aos-delay":180+s*20,children:e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-3",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-base font-semibold text-foreground",children:t.name||t.username||"Unnamed user"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.email||"No email on record"}),r.length>0&&e.jsx("div",{className:"flex flex-wrap gap-2 mt-2",children:r.map(d=>e.jsx("span",{className:"px-2 py-0.5 text-xs rounded-full bg-primary/10 text-primary",children:d},d))})]}),t.lastCheckinDate&&e.jsxs("div",{className:"text-right text-xs text-muted-foreground",children:[e.jsx("p",{children:"Last check-in"}),e.jsx("p",{className:"font-medium text-foreground",children:new Date(t.lastCheckinDate).toLocaleDateString("en-US",{month:"short",day:"numeric"})})]})]})},t._id||t.id||t.email||`${t.name}-${s}`)})})]})]})}):e.jsx("div",{className:"min-h-screen flex items-center justify-center px-4",children:e.jsxs("div",{className:"glass glass-card p-6 text-center space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"We couldn’t load the participation data."}),e.jsx("button",{type:"button",onClick:()=>p(b({period:n||"today",force:!0})),className:"inline-flex items-center justify-center rounded-md bg-primary/90 text-white px-4 py-2 text-sm font-medium hover:bg-primary transition-colors",children:"Try again"})]})})};export{G as default};
