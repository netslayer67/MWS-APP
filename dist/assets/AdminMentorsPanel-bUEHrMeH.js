import{e as _,r as l,j as e,aQ as C,aR as T,aS as I,aT as D,aY as F,aZ as P,x as E,m as R}from"./index-C2UXQ8jH.js";import{d as $}from"./mtssService-BJ4S8av5.js";import{S as L}from"./search-B6bavH_W.js";const q=[{label:"Tier 2 - Targeted",value:"tier2"},{label:"Tier 3 - Intensive",value:"tier3"}],k=({open:i,onClose:d,mentor:o,students:m=[],onAssigned:p})=>{const{toast:u}=_(),[n,c]=l.useState("tier2"),[h,s]=l.useState(""),[r,x]=l.useState([]),[g,w]=l.useState(""),[j,N]=l.useState(""),[f,v]=l.useState(!1);l.useEffect(()=>{i||(x([]),w(""),N(""),s(""),c("tier2"))},[i]);const y=l.useMemo(()=>{const t=h.trim().toLowerCase();return t?m.filter(a=>a.name?.toLowerCase().includes(t)):m},[m,h]),A=t=>{x(a=>a.includes(t)?a.filter(b=>b!==t):[...a,t])},M=async t=>{if(t.preventDefault(),!(!o?._id||r.length<2)){v(!0);try{const a=g?g.split(",").map(b=>b.trim()).filter(Boolean):["Targeted Support"];await $({mentorId:o._id,studentIds:r,tier:n,focusAreas:a,notes:j}),u({title:"Assignment created",description:`Paired ${o.name} with ${r.length} students.`}),p?.()}catch(a){u({title:"Failed to assign",description:a?.response?.data?.message||a.message||"Unable to create assignment",variant:"destructive"})}finally{v(!1)}}};return e.jsx(C,{open:i,onOpenChange:t=>!t&&d?.(),children:e.jsxs(T,{className:"max-w-3xl space-y-6",children:[e.jsxs(I,{children:[e.jsxs(D,{children:["Assign students to ",o?.name]}),e.jsx(F,{children:"Select at least two students to create a new MTSS plan."})]}),e.jsxs("form",{onSubmit:M,className:"space-y-6",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Tier"}),e.jsx("select",{value:n,onChange:t=>c(t.target.value),className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3",children:q.map(t=>e.jsx("option",{value:t.value,children:t.label},t.value))})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Focus areas"}),e.jsx("input",{value:g,onChange:t=>w(t.target.value),placeholder:"Fluency boost, SEL routines",className:"w-full rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3"})]})]}),e.jsxs("label",{className:"space-y-2 text-sm font-semibold text-foreground dark:text-white",children:[e.jsx("span",{children:"Notes"}),e.jsx("textarea",{value:j,onChange:t=>N(t.target.value),placeholder:"Add optional context for the mentor…",className:"w-full h-24 rounded-2xl border border-border/60 bg-white/80 dark:bg-white/10 px-4 py-3 resize-none"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("p",{className:"text-sm font-semibold text-foreground dark:text-white",children:[r.length," students selected"]}),e.jsxs("div",{className:"relative w-64",children:[e.jsx(L,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx("input",{type:"text",value:h,onChange:t=>s(t.target.value),placeholder:"Search students…",className:"w-full pl-10 pr-4 py-2.5 rounded-full border border-border/60 bg-white/80 dark:bg-white/10 text-sm"})]})]}),e.jsxs("div",{className:"max-h-64 overflow-y-auto rounded-2xl border border-border/50 bg-white/70 dark:bg-white/10 p-4 space-y-2",children:[y.map(t=>{const a=t.id||t._id;return e.jsxs("label",{className:"flex items-center gap-3 text-sm text-foreground dark:text-white",children:[e.jsx("input",{type:"checkbox",checked:r.includes(a),onChange:()=>A(a),className:"rounded border-border/60"}),e.jsx("span",{className:"font-semibold",children:t.name}),e.jsxs("span",{className:"text-muted-foreground text-xs",children:[t.grade," · ",t.type]})]},a)}),!y.length&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No students match the search."})]})]}),e.jsxs(P,{children:[e.jsx("button",{type:"button",onClick:d,className:"px-4 py-2 rounded-full border border-border/60 text-sm font-semibold text-foreground dark:text-white",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:f||r.length<2,className:`px-5 py-2.5 rounded-full text-sm font-semibold text-white ${f||r.length<2?"bg-muted cursor-not-allowed opacity-60":"bg-gradient-to-r from-[#22d3ee] to-[#3b82f6] shadow hover:-translate-y-0.5 transition"}`,children:f?"Assigning…":"Assign Selected"})]})]})]})})};k.displayName="AdminMentorAssignModal";const S=({mentorRoster:i=[],mentorDirectory:d=[],students:o=[],onRefresh:m})=>{const p=(i.length?i:d).map(s=>({_id:s._id||s.id||s.mentorId?._id,name:s.name,role:s.jobPosition||s.role||"Teacher",activeStudents:s.activeStudents||s.students||0,successRate:s.successRate||"0%"})),[u,n]=l.useState(null),c=l.useMemo(()=>d.find(s=>s._id===u),[d,u]),h=l.useCallback(s=>{if(s._id){n(s._id);return}const r=d.find(x=>x.name===s.name);r?._id&&n(r._id)},[d]);return e.jsx("div",{className:"space-y-8",children:e.jsxs("div",{className:"glass glass-card mtss-card-surface p-8 rounded-[40px] shadow-[0_30px_90px_rgba(15,23,42,0.32)] border border-white/10 bg-white/15 dark:bg-white/5",children:[e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[0.7rem] uppercase tracking-[0.5em] text-muted-foreground dark:text-white/60",children:"Mentor Squad"}),e.jsx("h3",{className:"text-2xl font-black text-foreground dark:text-white",children:"Manage Mentors"}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-white/70 max-w-2xl",children:"Assign caseloads, check success rates, and celebrate wins without losing the playful flow."}),e.jsxs("div",{className:"mt-2 flex items-center gap-2 text-xs text-primary font-semibold",children:[e.jsx(E,{className:"w-4 h-4"}),"Tap “Assign students” to pair a mentor with multiple kids instantly."]})]}),e.jsx("button",{className:"px-5 py-2.5 rounded-full bg-gradient-to-r from-[#fef9c3] to-[#fbcfe8] text-sm font-semibold text-rose-600 shadow-lg hover:shadow-[#f43f5e]/30 transition",children:"Add Mentor"})]}),e.jsx("div",{className:"grid gap-6 md:grid-cols-3",children:p.map((s,r)=>e.jsxs(R.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},transition:{delay:r*.08},className:"rounded-[32px] bg-white/90 dark:bg-white/10 border border-white/60 dark:border-white/10 p-6 space-y-5 shadow-[0_25px_80px_rgba(15,23,42,0.24)] backdrop-blur-xl",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-2xl bg-gradient-to-br from-primary to-rose text-white font-black flex items-center justify-center shadow-inner",children:s.name.split(" ").map(x=>x[0]).slice(0,2).join("")}),e.jsxs("div",{children:[e.jsx("p",{className:"text-lg font-semibold text-foreground dark:text-white",children:s.name}),e.jsx("p",{className:"text-sm text-muted-foreground dark:text-white/70",children:s.role})]})]}),e.jsxs("div",{className:"flex items-center justify-between text-sm font-semibold text-foreground dark:text-white gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-[0.65rem] uppercase tracking-[0.6em] text-muted-foreground",children:"Active students"}),e.jsx("p",{className:"text-3xl font-black",children:s.activeStudents})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-[0.65rem] uppercase tracking-[0.6em] text-muted-foreground",children:"Success rate"}),e.jsx("p",{className:"text-3xl font-black text-emerald-500",children:s.successRate})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 sm:flex-row",children:[e.jsx("button",{className:"flex-1 px-4 py-2.5 rounded-full bg-gradient-to-r from-[#7dd3fc] to-[#60a5fa] text-white text-sm font-semibold shadow-md hover:-translate-y-0.5 transition",children:"View Details"}),e.jsx("button",{className:"flex-1 px-4 py-2.5 rounded-full border border-primary/40 text-primary text-sm font-semibold bg-white shadow-sm hover:shadow-lg hover:-translate-y-0.5 transition dark:bg-white/5 dark:text-white",onClick:()=>h(s),children:"Assign Students"})]})]},s.name))}),c&&e.jsx(k,{open:!!c,mentor:c,students:o,onClose:()=>n(null),onAssigned:()=>{n(null),m?.()}})]})})};S.displayName="AdminMentorsPanel";const H=l.memo(S);export{H as default};
